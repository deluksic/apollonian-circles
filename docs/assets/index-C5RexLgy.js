(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const f of o)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function n(o){const f={};return o.integrity&&(f.integrity=o.integrity),o.referrerPolicy&&(f.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?f.credentials="include":o.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(o){if(o.ep)return;o.ep=!0;const f=n(o);fetch(o.href,f)}})();const Qi=(t,e)=>t===e,ke=Symbol("solid-proxy"),Hr=Symbol("solid-track"),Mn={equals:Qi};let bs=Ts;const xe=1,Tn=2,_s={owned:null,cleanups:null,context:null,owner:null},cr={};var ht=null;let lr=null,to=null,yt=null,Pt=null,ye=null,Hn=0;function eo(t,e){const n=yt,r=ht,o=t.length===0,f=e===void 0?r:e,y=o?_s:{owned:null,cleanups:null,context:f?f.context:null,owner:f},v=o?t:()=>t(()=>he(()=>Je(y)));ht=y,yt=null;try{return Se(v,!0)}finally{yt=n,ht=r}}function qt(t,e){e=e?Object.assign({},Mn,e):Mn;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=o=>(typeof o=="function"&&(o=o(n.value)),Ms(n,o));return[Ss.bind(n),r]}function no(t,e,n){const r=Jn(t,e,!0,xe);Ne(r)}function $e(t,e,n){const r=Jn(t,e,!1,xe);Ne(r)}function Ae(t,e,n){bs=lo;const r=Jn(t,e,!1,xe);r.user=!0,ye?ye.push(r):Ne(r)}function ge(t,e,n){n=n?Object.assign({},Mn,n):Mn;const r=Jn(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Ne(r),Ss.bind(r)}function ro(t){return t&&typeof t=="object"&&"then"in t}function so(t,e,n){let r,o,f;arguments.length===2&&typeof e=="object"||arguments.length===1?(r=!0,o=t,f=e):(r=t,o=e,f={});let y=null,v=cr,U=!1,D="initialValue"in f,k=typeof r=="function"&&ge(r);const P=new Set,[F,B]=(f.storage||qt)(f.initialValue),[z,j]=qt(void 0),[tt,it]=qt(void 0,{equals:!1}),[nt,ot]=qt(D?"ready":"unresolved");function rt(st,H,Y,at){return y===st&&(y=null,at!==void 0&&(D=!0),(st===v||H===v)&&f.onHydrated&&queueMicrotask(()=>f.onHydrated(at,{value:H})),v=cr,dt(H,Y)),H}function dt(st,H){Se(()=>{H===void 0&&B(()=>st),ot(H!==void 0?"errored":D?"ready":"unresolved"),j(H);for(const Y of P.keys())Y.decrement();P.clear()},!1)}function pt(){const st=ao,H=F(),Y=z();if(Y!==void 0&&!y)throw Y;return yt&&yt.user,H}function gt(st=!0){if(st!==!1&&U)return;U=!1;const H=k?k():r;if(H==null||H===!1){rt(y,he(F));return}const Y=v!==cr?v:he(()=>o(H,{value:F(),refetching:st}));return ro(Y)?(y=Y,"value"in Y?(Y.status==="success"?rt(y,Y.value,void 0,H):rt(y,void 0,pr(Y.value),H),Y):(U=!0,queueMicrotask(()=>U=!1),Se(()=>{ot(D?"refreshing":"pending"),it()},!1),Y.then(at=>rt(Y,at,void 0,H),at=>rt(Y,void 0,pr(at),H)))):(rt(y,Y,void 0,H),Y)}return Object.defineProperties(pt,{state:{get:()=>nt()},error:{get:()=>z()},loading:{get(){const st=nt();return st==="pending"||st==="refreshing"}},latest:{get(){if(!D)return pt();const st=z();if(st&&!y)throw st;return F()}}}),k?no(()=>gt(!1)):gt(!1),[pt,{refetch:gt,mutate:B}]}function $s(t){return Se(t,!1)}function he(t){if(yt===null)return t();const e=yt;yt=null;try{return t()}finally{yt=e}}function an(t){return ht===null||(ht.cleanups===null?ht.cleanups=[t]:ht.cleanups.push(t)),t}function dr(){return yt}function Tr(t,e){const n=Symbol("context");return{id:n,Provider:fo(n),defaultValue:t}}function io(t){let e;return ht&&ht.context&&(e=ht.context[t.id])!==void 0?e:t.defaultValue}function oo(t){const e=ge(t),n=ge(()=>wr(e()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let ao;function Ss(){if(this.sources&&this.state)if(this.state===xe)Ne(this);else{const t=Pt;Pt=null,Se(()=>Un(this),!1),Pt=t}if(yt){const t=this.observers?this.observers.length:0;yt.sources?(yt.sources.push(this),yt.sourceSlots.push(t)):(yt.sources=[this],yt.sourceSlots=[t]),this.observers?(this.observers.push(yt),this.observerSlots.push(yt.sources.length-1)):(this.observers=[yt],this.observerSlots=[yt.sources.length-1])}return this.value}function Ms(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&Se(()=>{for(let o=0;o<t.observers.length;o+=1){const f=t.observers[o],y=lr&&lr.running;y&&lr.disposed.has(f),(y?!f.tState:!f.state)&&(f.pure?Pt.push(f):ye.push(f),f.observers&&Ds(f)),y||(f.state=xe)}if(Pt.length>1e6)throw Pt=[],new Error},!1)),e}function Ne(t){if(!t.fn)return;Je(t);const e=Hn;uo(t,t.value,e)}function uo(t,e,n){let r;const o=ht,f=yt;yt=ht=t;try{r=t.fn(e)}catch(y){return t.pure&&(t.state=xe,t.owned&&t.owned.forEach(Je),t.owned=null),t.updatedAt=n+1,Us(y)}finally{yt=f,ht=o}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Ms(t,r):t.value=r,t.updatedAt=n)}function Jn(t,e,n,r=xe,o){const f={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:ht,context:ht?ht.context:null,pure:n};return ht===null||ht!==_s&&(ht.owned?ht.owned.push(f):ht.owned=[f]),f}function Dn(t){if(t.state===0)return;if(t.state===Tn)return Un(t);if(t.suspense&&he(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Hn);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===xe)Ne(t);else if(t.state===Tn){const r=Pt;Pt=null,Se(()=>Un(t,e[0]),!1),Pt=r}}function Se(t,e){if(Pt)return t();let n=!1;e||(Pt=[]),ye?n=!0:ye=[],Hn++;try{const r=t();return co(n),r}catch(r){n||(ye=null),Pt=null,Us(r)}}function co(t){if(Pt&&(Ts(Pt),Pt=null),t)return;const e=ye;ye=null,e.length&&Se(()=>bs(e),!1)}function Ts(t){for(let e=0;e<t.length;e++)Dn(t[e])}function lo(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:Dn(r)}for(e=0;e<n;e++)Dn(t[e])}function Un(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const o=r.state;o===xe?r!==e&&(!r.updatedAt||r.updatedAt<Hn)&&Dn(r):o===Tn&&Un(r,e)}}}function Ds(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=Tn,n.pure?Pt.push(n):ye.push(n),n.observers&&Ds(n))}}function Je(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),o=n.observers;if(o&&o.length){const f=o.pop(),y=n.observerSlots.pop();r<o.length&&(f.sourceSlots[y]=r,o[r]=f,n.observerSlots[r]=y)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Je(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Je(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function pr(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Us(t,e=ht){throw pr(t)}function wr(t){if(typeof t=="function"&&!t.length)return wr(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=wr(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function fo(t,e){return function(r){let o;return $e(()=>o=he(()=>(ht.context={...ht.context,[t]:r.value},oo(()=>r.children))),void 0),o}}function Ht(t,e){return he(()=>t(e||{}))}const ho=t=>`Stale read from <${t}>.`;function Dr(t){const e=t.keyed,n=ge(()=>t.when,void 0,{equals:(r,o)=>e?r===o:!r==!o});return ge(()=>{const r=n();if(r){const o=t.children;return typeof o=="function"&&o.length>0?he(()=>o(e?r:()=>{if(!he(n))throw ho("Show");return t.when})):o}return t.fallback},void 0,void 0)}function po(t,e,n){let r=n.length,o=e.length,f=r,y=0,v=0,U=e[o-1].nextSibling,D=null;for(;y<o||v<f;){if(e[y]===n[v]){y++,v++;continue}for(;e[o-1]===n[f-1];)o--,f--;if(o===y){const k=f<r?v?n[v-1].nextSibling:n[f-v]:U;for(;v<f;)t.insertBefore(n[v++],k)}else if(f===v)for(;y<o;)(!D||!D.has(e[y]))&&e[y].remove(),y++;else if(e[y]===n[f-1]&&n[v]===e[o-1]){const k=e[--o].nextSibling;t.insertBefore(n[v++],e[y++].nextSibling),t.insertBefore(n[--f],k),e[o]=n[f]}else{if(!D){D=new Map;let P=v;for(;P<f;)D.set(n[P],P++)}const k=D.get(e[y]);if(k!=null)if(v<k&&k<f){let P=y,F=1,B;for(;++P<o&&P<f&&!((B=D.get(e[P]))==null||B!==k+F);)F++;if(F>k-v){const z=e[y];for(;v<k;)t.insertBefore(n[v++],z)}else t.replaceChild(n[v++],e[y++])}else y++;else e[y++].remove()}}}function wo(t,e,n,r={}){let o;return eo(f=>{o=f,e===document?t():gn(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{o(),e.textContent=""}}function Ur(t,e,n){let r;const o=()=>{const y=document.createElement("template");return y.innerHTML=t,y.content.firstChild},f=()=>(r||(r=o())).cloneNode(!0);return f.cloneNode=f,f}function Ce(t,e){e==null?t.removeAttribute("class"):t.className=e}function yo(t,e,n){return he(()=>t(e,n))}function gn(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return En(t,e,r,n);$e(o=>En(t,e(),o,n),r)}function En(t,e,n,r,o){for(;typeof n=="function";)n=n();if(e===n)return n;const f=typeof e,y=r!==void 0;if(t=y&&n[0]&&n[0].parentNode||t,f==="string"||f==="number"){if(f==="number"&&(e=e.toString(),e===n))return n;if(y){let v=n[0];v&&v.nodeType===3?v.data!==e&&(v.data=e):v=document.createTextNode(e),n=Pe(t,n,r,v)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||f==="boolean")n=Pe(t,n,r);else{if(f==="function")return $e(()=>{let v=e();for(;typeof v=="function";)v=v();n=En(t,v,n,r)}),()=>n;if(Array.isArray(e)){const v=[],U=n&&Array.isArray(n);if(yr(v,e,n,o))return $e(()=>n=En(t,v,n,r,!0)),()=>n;if(v.length===0){if(n=Pe(t,n,r),y)return n}else U?n.length===0?Jr(t,v,r):po(t,n,v):(n&&Pe(t),Jr(t,v));n=v}else if(e.nodeType){if(Array.isArray(n)){if(y)return n=Pe(t,n,r,e);Pe(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function yr(t,e,n,r){let o=!1;for(let f=0,y=e.length;f<y;f++){let v=e[f],U=n&&n[t.length],D;if(!(v==null||v===!0||v===!1))if((D=typeof v)=="object"&&v.nodeType)t.push(v);else if(Array.isArray(v))o=yr(t,v,U)||o;else if(D==="function")if(r){for(;typeof v=="function";)v=v();o=yr(t,Array.isArray(v)?v:[v],Array.isArray(U)?U:[U])||o}else t.push(v),o=!0;else{const k=String(v);U&&U.nodeType===3&&U.data===k?t.push(U):t.push(document.createTextNode(k))}}return o}function Jr(t,e,n=null){for(let r=0,o=e.length;r<o;r++)t.insertBefore(e[r],n)}function Pe(t,e,n,r){if(n===void 0)return t.textContent="";const o=r||document.createTextNode("");if(e.length){let f=!1;for(let y=e.length-1;y>=0;y--){const v=e[y];if(o!==v){const U=v.parentNode===t;!f&&!y?U?t.replaceChild(o,v):t.insertBefore(o,n):U&&v.remove()}else f=!0}}else t.insertBefore(o,n);return[o]}const mo="_page_1wxjl_1",go="_controls_1wxjl_6",xo="_circle-counter_1wxjl_18",vo="_welcome-message_1wxjl_38",bo="_fade-in_1wxjl_1",_o="_canvas_1wxjl_53",qe={page:mo,controls:go,circleCounter:xo,welcomeMessage:vo,fadeIn:bo,canvas:_o};function Er(t,e,n){const r=io(t);if(r===void 0)throw new Error(`Called '${e}' outside of ${n!==void 0?`<${n}>`:"its Provider"}.`);return r}const Es=Tr(),$o=Es.Provider;function Or(){return Er(Es,"useCamera","CameraContext")}var So=Object.defineProperty,Mo=Object.defineProperties,To=Object.getOwnPropertyDescriptors,Qr=Object.getOwnPropertySymbols,Do=Object.prototype.hasOwnProperty,Uo=Object.prototype.propertyIsEnumerable,mr=(t,e,n)=>e in t?So(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,De=(t,e)=>{for(var n in e||(e={}))Do.call(e,n)&&mr(t,n,e[n]);if(Qr)for(var n of Qr(e))Uo.call(e,n)&&mr(t,n,e[n]);return t},ze=(t,e)=>Mo(t,To(e)),A=(t,e,n)=>(mr(t,typeof e!="symbol"?e+"":e,n),n),Eo="Invariant failed";function On(t,e){if(!t)throw new Error(Eo)}var yn=class gr extends Error{constructor(e,n){let r=n.map(o=>`- ${o}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Resolution of the following tree failed: 
${r.join(`
`)}`),this.cause=e,this.trace=n,Object.setPrototypeOf(this,gr.prototype)}appendToTrace(e){let n=[e,...this.trace];return new gr(this.cause,n)}},Oo=class Os extends Error{constructor(e){super(`Missing value for '${e}'`),this.slot=e,Object.setPrototypeOf(this,Os.prototype)}},ts=class As extends Error{constructor(e){var n;super(`Buffer '${(n=e.label)!=null?n:"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,As.prototype)}},Ao=class ks extends Error{constructor(e,n){super(`The function '${e??"<unnamed>"}' is missing links to the following external values: ${n}.`),Object.setPrototypeOf(this,ks.prototype)}},Is=class Ps extends Error{constructor(e){super(`Bind group was not provided for '${e??"<unnamed>"}' layout.`),Object.setPrototypeOf(this,Ps.prototype)}},Xe=null;function ko(t,e){On(Xe===null),Xe=t;try{return e()}finally{Xe=null}}function Qe(){return Xe}var pe=()=>Xe!==null;function ne(t){let e={"~repr":void 0,type:t.type};return Object.assign((...n)=>{var r;let o=n;if(pe())return`${e.type}(${o.join(", ")})`;if(o.length<=1)return t.makeFromScalar((r=o[0])!=null?r:0);if(o.length===t.length)return t.make(...o);throw new Error(`'${t.type}' constructor called with invalid number of arguments.`)},e)}var Qn=class{constructor(t,e){this.x=t,this.y=e,A(this,"length",2)}*[Symbol.iterator](){yield this.x,yield this.y}get 0(){return this.x}get 1(){return this.y}set 0(t){this.x=t}set 1(t){this.y=t}resolve(){return`${this.kind}(${this.x}, ${this.y})`}toString(){return this.resolve()}},An=class Fs extends Qn{constructor(){super(...arguments),A(this,"kind","vec2f")}make2(e,n){return new Fs(e,n)}make3(e,n,r){return new Fn(e,n,r)}make4(e,n,r,o){return new Rn(e,n,r,o)}},kn=class zs extends Qn{constructor(){super(...arguments),A(this,"kind","vec2h")}make2(e,n){return new zs(e,n)}make3(e,n,r){return new zn(e,n,r)}make4(e,n,r,o){return new Nn(e,n,r,o)}},In=class Bs extends Qn{constructor(){super(...arguments),A(this,"kind","vec2i")}make2(e,n){return new Bs(e,n)}make3(e,n,r){return new Bn(e,n,r)}make4(e,n,r,o){return new Vn(e,n,r,o)}},Pn=class js extends Qn{constructor(){super(...arguments),A(this,"kind","vec2u")}make2(e,n){return new js(e,n)}make3(e,n,r){return new jn(e,n,r)}make4(e,n,r,o){return new Ln(e,n,r,o)}},tr=class{constructor(e,n,r){this.x=e,this.y=n,this.z=r,A(this,"length",3)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}resolve(){return`${this.kind}(${this.x}, ${this.y}, ${this.z})`}toString(){return this.resolve()}},Fn=class Rs extends tr{constructor(){super(...arguments),A(this,"kind","vec3f")}make2(e,n){return new An(e,n)}make3(e,n,r){return new Rs(e,n,r)}make4(e,n,r,o){return new Rn(e,n,r,o)}},zn=class Ns extends tr{constructor(){super(...arguments),A(this,"kind","vec3h")}make2(e,n){return new kn(e,n)}make3(e,n,r){return new Ns(e,n,r)}make4(e,n,r,o){return new Nn(e,n,r,o)}},Bn=class Vs extends tr{constructor(){super(...arguments),A(this,"kind","vec3i")}make2(e,n){return new In(e,n)}make3(e,n,r){return new Vs(e,n,r)}make4(e,n,r,o){return new Vn(e,n,r,o)}},jn=class Ls extends tr{constructor(){super(...arguments),A(this,"kind","vec3u")}make2(e,n){return new Pn(e,n)}make3(e,n,r){return new Ls(e,n,r)}make4(e,n,r,o){return new Ln(e,n,r,o)}},er=class{constructor(e,n,r,o){this.x=e,this.y=n,this.z=r,this.w=o,A(this,"length",4)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}get 3(){return this.w}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}set 3(e){this.w=e}resolve(){return`${this.kind}(${this.x}, ${this.y}, ${this.z}, ${this.w})`}toString(){return this.resolve()}},Rn=class Gs extends er{constructor(){super(...arguments),A(this,"kind","vec4f")}make2(e,n){return new An(e,n)}make3(e,n,r){return new Fn(e,n,r)}make4(e,n,r,o){return new Gs(e,n,r,o)}},Nn=class qs extends er{constructor(){super(...arguments),A(this,"kind","vec4h")}make2(e,n){return new kn(e,n)}make3(e,n,r){return new zn(e,n,r)}make4(e,n,r,o){return new qs(e,n,r,o)}},Vn=class Cs extends er{constructor(){super(...arguments),A(this,"kind","vec4i")}make2(e,n){return new In(e,n)}make3(e,n,r){return new Bn(e,n,r)}make4(e,n,r,o){return new Cs(e,n,r,o)}},Ln=class Ws extends er{constructor(){super(...arguments),A(this,"kind","vec4u")}make2(e,n){return new Pn(e,n)}make3(e,n,r){return new jn(e,n,r)}make4(e,n,r,o){return new Ws(e,n,r,o)}},ut={get:(t,e)=>{if(typeof e=="symbol"||!Number.isNaN(Number.parseInt(e)))return Reflect.get(t,e);let n=t,r=new Array(e.length),o=0;for(let f of e){switch(f){case"x":r[o]=n.x;break;case"y":r[o]=n.y;break;case"z":r[o]=n.z;break;case"w":r[o]=n.w;break;default:return Reflect.get(n,e)}o++}return e.length===4?new Proxy(n.make4(r[0],r[1],r[2],r[3]),ut):e.length===3?new Proxy(n.make3(r[0],r[1],r[2]),ut):e.length===2?new Proxy(n.make2(r[0],r[1]),ut):Reflect.get(t,e)}},q=ne({type:"vec2f",length:2,make:(t,e)=>new Proxy(new An(t,e),ut),makeFromScalar:t=>new Proxy(new An(t,t),ut)}),Io=ne({type:"vec2h",length:2,make:(t,e)=>new Proxy(new kn(t,e),ut),makeFromScalar:t=>new Proxy(new kn(t,t),ut)}),Ue=ne({type:"vec2i",length:2,make:(t,e)=>new Proxy(new In(t,e),ut),makeFromScalar:t=>new Proxy(new In(t,t),ut)}),Ee=ne({type:"vec2u",length:2,make:(t,e)=>new Proxy(new Pn(t,e),ut),makeFromScalar:t=>new Proxy(new Pn(t,t),ut)}),tn=ne({type:"vec3f",length:3,make:(t,e,n)=>new Proxy(new Fn(t,e,n),ut),makeFromScalar:t=>new Proxy(new Fn(t,t,t),ut)}),Po=ne({type:"vec3h",length:3,make:(t,e,n)=>new Proxy(new zn(t,e,n),ut),makeFromScalar:t=>new Proxy(new zn(t,t,t),ut)}),xr=ne({type:"vec3i",length:3,make:(t,e,n)=>new Proxy(new Bn(t,e,n),ut),makeFromScalar:t=>new Proxy(new Bn(t,t,t),ut)}),Oe=ne({type:"vec3u",length:3,make:(t,e,n)=>new Proxy(new jn(t,e,n),ut),makeFromScalar:t=>new Proxy(new jn(t,t,t),ut)}),G=ne({type:"vec4f",length:4,make:(t,e,n,r)=>new Proxy(new Rn(t,e,n,r),ut),makeFromScalar:t=>new Proxy(new Rn(t,t,t,t),ut)}),Fo=ne({type:"vec4h",length:4,make:(t,e,n,r)=>new Proxy(new Nn(t,e,n,r),ut),makeFromScalar:t=>new Proxy(new Nn(t,t,t,t),ut)}),te=ne({type:"vec4i",length:4,make:(t,e,n,r)=>new Proxy(new Vn(t,e,n,r),ut),makeFromScalar:t=>new Proxy(new Vn(t,t,t,t),ut)}),ee=ne({length:4,type:"vec4u",make:(t,e,n,r)=>new Proxy(new Ln(t,e,n,r),ut),makeFromScalar:t=>new Proxy(new Ln(t,t,t,t),ut)}),Ys=Object.defineProperty,zo=(t,e,n)=>e in t?Ys(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Bo=(t,e)=>{for(var n in e)Ys(t,n,{get:e[n],enumerable:!0})},J=(t,e,n)=>zo(t,typeof e!="symbol"?e+"":e,n),Xs={};Bo(Xs,{BufferReader:()=>xn,BufferWriter:()=>vn,MaxValue:()=>vt,Measurer:()=>xt,UnresolvedReferenceError:()=>Te,ValidationError:()=>nr,arrayOf:()=>Lo,bool:()=>qo,byte:()=>Ko,chars:()=>la,concat:()=>pa,dynamicArrayOf:()=>ya,f16:()=>oa,f32:()=>ua,f32Array:()=>ka,f64Array:()=>Ia,generic:()=>ha,genericEnum:()=>da,i16:()=>Jo,i16Array:()=>Oa,i32:()=>na,i32Array:()=>Aa,i8:()=>Xo,i8Array:()=>Ea,keyed:()=>xa,object:()=>fa,optional:()=>ba,string:()=>Wo,tupleOf:()=>Sa,u16:()=>ta,u16Array:()=>Da,u32:()=>sa,u32Array:()=>Ua,u8:()=>Qs,u8Array:()=>Ma,u8ClampedArray:()=>Ta});var Te=class Zs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zs.prototype)}},nr=class Ks extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ks.prototype)}},jo=class{constructor(){J(this,"size",Number.NaN),J(this,"unbounded",this),J(this,"isUnbounded",!0)}add(){return this}fork(){return this}},Ro=new jo,xt=class Hs{constructor(){J(this,"size",0),J(this,"unbounded",Ro),J(this,"isUnbounded",!1)}add(e){return this.size+=e,this}fork(){const e=new Hs;return e.size=this.size,e}},vt=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),Mt=class{constructor(){J(this,"__unwrapped")}resolveReferences(t){}seekProperty(t,e){return null}},No=class{constructor(t){this.key=t}},Ze={STRING:"string",ENUM:"enum"},Vo=class extends Mt{constructor(t,e){super(),this._unstableElementSchema=t,this.length=e,J(this,"elementSchema"),this.elementSchema=t}resolveReferences(t){this.elementSchema=t.resolve(this._unstableElementSchema)}write(t,e){if(e.length!==this.length)throw new nr(`Expected array of length ${this.length}, got ${e.length}`);for(const n of e)this.elementSchema.write(t,n)}read(t){const e=[];for(let n=0;n<this.length;++n)e.push(this.elementSchema.read(t));return e}get maxSize(){return this.elementSchema.measure(vt).size*this.length}measure(t,e=new xt){for(let n=0;n<this.length;++n)this.elementSchema.measure(t===vt?vt:t[n],e);return e}};function Lo(t,e){return new Vo(t,e)}var Go=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",1)}read(t){return t.readBool()}write(t,e){t.writeBool(e)}measure(t,e=new xt){return e.add(1)}},qo=new Go,Js=class We extends Mt{static get _encoder(){return We._cachedEncoder||(We._cachedEncoder=new TextEncoder),We._cachedEncoder}read(e){return e.readString()}write(e,n){e.writeString(n)}measure(e,n=new xt){if(e===vt)return n.unbounded;const r=We._encoder.encode(e);return n.add(r.byteLength+1)}};J(Js,"_cachedEncoder");var Co=Js,Wo=new Co,Yo=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",1)}read(t){return t.readInt8()}write(t,e){t.writeInt8(e)}measure(t,e=new xt){return e.add(1)}},Xo=new Yo,Zo=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",1)}read(t){return t.readUint8()}write(t,e){t.writeUint8(e)}measure(t,e=new xt){return e.add(1)}},Qs=new Zo,Ko=Qs,Ho=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",2)}read(t){return t.readInt16()}write(t,e){t.writeInt16(e)}measure(t,e=new xt){return e.add(2)}},Jo=new Ho,Qo=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",2)}read(t){return t.readUint16()}write(t,e){t.writeUint16(e)}measure(t,e=new xt){return e.add(2)}},ta=new Qo,ea=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",4)}read(t){return t.readInt32()}write(t,e){t.writeInt32(e)}measure(t,e=new xt){return e.add(4)}},na=new ea,ra=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",4)}read(t){return t.readUint32()}write(t,e){t.writeUint32(e)}measure(t,e=new xt){return e.add(4)}},sa=new ra,ia=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",2)}read(t){return t.readFloat16()}write(t,e){t.writeFloat16(e)}measure(t,e=new xt){return e.add(2)}},oa=new ia,aa=class extends Mt{constructor(){super(...arguments),J(this,"maxSize",4)}read(t){return t.readFloat32()}write(t,e){t.writeFloat32(e)}measure(t,e=new xt){return e.add(4)}},ua=new aa,ca=class extends Mt{constructor(t){super(),this.length=t}write(t,e){if(e.length!==this.length)throw new nr(`Expected char-string of length ${this.length}, got ${e.length}`);for(let n=0;n<e.length;++n)t.writeUint8(e.charCodeAt(n))}read(t){let e="";for(let n=0;n<this.length;++n)e+=String.fromCharCode(t.readByte());return e}measure(t,e=new xt){return e.add(this.length)}};function la(t){return new ca(t)}function _e(t){return Object.entries(t)}function ti(t,e){const n={};for(const[r,o]of _e(e))n[r]=t.resolve(o);return n}var Ar=class extends Mt{constructor(t){super(),this._properties=t,J(this,"properties"),this.properties=t}resolveReferences(t){this.properties=ti(t,this._properties)}write(t,e){for(const[n,r]of _e(this.properties))r.write(t,e[n])}read(t){const e={};for(const[n,r]of _e(this.properties))e[n]=r.read(t);return e}get maxSize(){const t=new xt;for(const e of Object.values(this.properties))e.measure(vt,t);return t.size}measure(t,e=new xt){for(const[n,r]of _e(this.properties))r.measure(t===vt?vt:t[n],e);return e}seekProperty(t,e){let n=0;for(const[r,o]of _e(this.properties)){if(r===e)return{bufferOffset:n,schema:o};n+=o.measure(t).size}return null}};function fa(t){return new Ar(t)}var ei=class extends Mt{constructor(t,e,n){super(),this.keyedBy=t,this._subTypeMap=n,J(this,"_baseObject"),J(this,"subTypeMap"),this._baseObject=new Ar(e),this.subTypeMap=n}resolveReferences(t){this._baseObject.resolveReferences(t),this.subTypeMap=ti(t,this._subTypeMap)}write(t,e){const n=e.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===Ze.ENUM?t.writeUint8(e.type):t.writeString(e.type),this._baseObject.write(t,e);for(const[o,f]of _e(r.properties))f.write(t,e[o])}read(t){const e=this.keyedBy===Ze.ENUM?t.readByte():t.readString(),n=this.subTypeMap[e]||null;if(n===null)throw new Error(`Unknown sub-type '${e}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const r=this._baseObject.read(t);if(r.type=e,n!==null)for(const[o,f]of _e(n.properties))r[o]=f.read(t);return r}measure(t,e=new xt){if(this._baseObject.measure(t,e),this.keyedBy===Ze.ENUM)e.add(1);else if(t!==vt)e.add(t.type.length+1);else return e.unbounded;if(t===vt){const n=Object.values(this.subTypeMap).map(r=>{const o=e.fork();for(const f of Object.values(r.properties))f.measure(vt,o);return[r,o.size]}).reduce((r,o)=>r[1]>o[1]?r:o)[0];for(const r of Object.values(n.properties))r.measure(vt,e)}else{const n=t.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[o,f]of _e(r.properties))f.measure(t[o],e)}return e}};function ha(t,e){return new ei(Ze.STRING,t,e)}function da(t,e){return new ei(Ze.ENUM,t,e)}function pa(t){return new Ar(Object.fromEntries(t.flatMap(({properties:e})=>Object.entries(e))))}var wa=class extends Mt{constructor(t){super(),this._unstableElementType=t,J(this,"elementType"),this.elementType=t}resolveReferences(t){this.elementType=t.resolve(this._unstableElementType)}write(t,e){t.writeUint32(e.length);for(const n of e)this.elementType.write(t,n)}read(t){const e=[],n=t.readUint32();for(let r=0;r<n;++r)e.push(this.elementType.read(t));return e}get maxSize(){return this.measure(vt).size}measure(t,e=new xt){if(t===vt)return e.unbounded;e.add(4);for(const n of t)this.elementType.measure(n,e);return e}seekProperty(t,e){if(typeof e=="symbol")return null;const n=Number.parseInt(String(e),10);if(Number.isNaN(n))return null;if(t===vt)return{bufferOffset:this.elementType.measure(vt).size*n,schema:this.elementType};if(n>=t.length)return null;const r=new xt;for(let o=0;o<n;++o)this.elementType.measure(t[o],r);return{bufferOffset:r.size,schema:this.elementType}}};function ya(t){return new wa(t)}var ni=class{constructor(t){J(this,"__unwrapped"),J(this,"ref"),this.ref=new No(t)}resolveReferences(){throw new Te("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Te("Tried to read a reference directly. Resolve it instead.")}write(){throw new Te("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Te("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Te("Tried to seek property of a reference directly. Resolve it instead.")}},ma=class{constructor(){J(this,"registry",{})}hasKey(t){return this.registry[t]!==void 0}register(t,e){this.registry[t]=e}resolve(t){if(t instanceof ni){const n=t.ref.key;if(this.registry[n]!==void 0)return this.registry[n];throw new Te(`Couldn't resolve reference to ${n}. Unknown key.`)}return t.resolveReferences(this),t}},ga=class{constructor(t,e){this.key=t,J(this,"__unwrapped"),J(this,"__keyDefinition"),J(this,"innerType"),this.innerType=e(new ni(t)),this.resolveReferences(new ma)}resolveReferences(t){t.hasKey(this.key)||(t.register(this.key,this.innerType),this.innerType.resolveReferences(t))}read(t){return this.innerType.read(t)}write(t,e){this.innerType.write(t,e)}get maxSize(){return this.measure(vt).size}measure(t,e=new xt){return this.innerType.measure(t,e)}seekProperty(t,e){return this.innerType.seekProperty(t,e)}};function xa(t,e){return new ga(t,e)}var va=class extends Mt{constructor(t){super(),this._innerUnstableSchema=t,J(this,"innerSchema"),this.innerSchema=t}resolveReferences(t){this.innerSchema=t.resolve(this._innerUnstableSchema)}write(t,e){e!=null?(t.writeBool(!0),this.innerSchema.write(t,e)):t.writeBool(!1)}read(t){if(t.readBool())return this.innerSchema.read(t)}get maxSize(){return this.measure(vt).size}measure(t,e=new xt){return t!==void 0&&this.innerSchema.measure(t,e),e.add(1)}};function ba(t){return new va(t)}function _a(t,e){return e.map(n=>t.resolve(n))}var $a=class extends Mt{constructor(t){super(),this._unstableSchemas=t,J(this,"schemas"),this.schemas=t}resolveReferences(t){this.schemas=_a(t,this._unstableSchemas)}write(t,e){if(e.length!==this.schemas.length)throw new nr(`Expected tuple of length ${this.schemas.length}, got ${e.length}`);for(let n=0;n<this.schemas.length;++n)this.schemas[n].write(t,e[n])}read(t){const e=[];for(let n=0;n<this.schemas.length;++n)e.push(this.schemas[n].read(t));return e}get maxSize(){return this.measure(vt).size}measure(t,e=new xt){for(let n=0;n<this.schemas.length;++n)this.schemas[n].measure(t===vt?vt:t[n],e);return e}};function Sa(t){return new $a(t)}var ve=class extends Mt{constructor(t,e){super(),this.length=t,this._arrayConstructor=e,J(this,"byteLength"),this.byteLength=t*e.BYTES_PER_ELEMENT}write(t,e){t.writeSlice(e)}read(t){const e=new ArrayBuffer(this.byteLength),n=new this._arrayConstructor(e,0,this.length);return t.readSlice(n,0,this.byteLength),n}measure(t,e=new xt){return e.add(this.byteLength)}},Ma=t=>new ve(t,Uint8Array),Ta=t=>new ve(t,Uint8ClampedArray),Da=t=>new ve(t,Uint16Array),Ua=t=>new ve(t,Uint32Array),Ea=t=>new ve(t,Int8Array),Oa=t=>new ve(t,Int16Array),Aa=t=>new ve(t,Int32Array),ka=t=>new ve(t,Float32Array),Ia=t=>new ve(t,Float64Array);function Pa(){const t=new Uint8Array(4),e=new Uint32Array(t.buffer);return e[0]=1,t[0]===0}function Fa(){return Pa()?"big":"little"}function kr(t){let e=0,n=t;return n&&"buffer"in n&&"byteOffset"in n&&(e+=n.byteOffset,n=n.buffer),{buffer:n,byteOffset:e,byteLength:t.byteLength}}var ri=class{constructor(t,e){J(this,"dataView"),J(this,"littleEndian"),J(this,"byteOffset",0),J(this,"endianness");const{byteOffset:n=0,endianness:r="system"}=e??{};this.byteOffset=n;const o=Fa();this.endianness=r==="system"?o:r,this.littleEndian=this.endianness==="little";const f=kr(t);this.byteOffset+=f.byteOffset,this.dataView=new DataView(f.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(t){this.byteOffset=t}skipBytes(t){this.byteOffset+=t}};function za(t){if(t===0)return 0;if(Number.isNaN(t))return 32256;if(!Number.isFinite(t))return t>0?31744:64512;const e=t<0?1:0,n=Math.abs(t),r=Math.floor(Math.log2(n)),o=n/2**r-1,f=r+15,y=Math.floor(o*1024);return e<<15|f<<10|y}function Ba(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?e===0?r/1024:-r/1024:n===31?r===0?e===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(e===0?1:-1)*(1+r/1024)*2**(n-15)}var xn=class extends ri{constructor(){super(...arguments),J(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const t=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,t}readUint16(){const t=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,t}readInt32(){const t=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readUint32(){const t=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readFloat16(){const t=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,Ba(t)}readFloat32(){const t=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readString(){let t=0;for(;this.byteOffset+t<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+t++)!==0;);const e=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,t-1));return this.byteOffset+=t,e}readSlice(t,e,n){const r=kr(t),o=new Uint8Array(r.buffer,r.byteOffset+e);for(let f=0;f<n;++f)o[f]=this.dataView.getUint8(this.byteOffset++)}},vn=class extends ri{constructor(){super(...arguments),J(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(t){this.dataView.setUint8(this.byteOffset++,t?1:0)}writeByte(t){this.dataView.setUint8(this.byteOffset++,t)}writeInt8(t){this.dataView.setInt8(this.byteOffset++,t)}writeUint8(t){this.dataView.setUint8(this.byteOffset++,t)}writeInt16(t){this.dataView.setInt16(this.byteOffset,t,this.littleEndian),this.byteOffset+=2}writeUint16(t){this.dataView.setUint16(this.byteOffset,t,this.littleEndian),this.byteOffset+=2}writeInt32(t){this.dataView.setInt32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeUint32(t){this.dataView.setUint32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeFloat16(t){this.dataView.setUint16(this.byteOffset,za(t),this.littleEndian),this.byteOffset+=2}writeFloat32(t){this.dataView.setFloat32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeString(t){const e=this._textEncoder.encodeInto(t,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=e.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(t){const e=kr(t),n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(const r of n)this.dataView.setUint8(this.byteOffset++,r)}},mn=Xs,es={type:"bool"},ja=t=>pe()?`u32(${t})`:typeof t=="boolean"?t?1:0:Number.isInteger(t)?((t<0||t>4294967295)&&console.warn(`u32 value ${t} overflowed`),(t&4294967295)>>>0):Math.max(0,Math.min(4294967295,Math.floor(t))),lt=Object.assign(ja,{type:"u32"}),Ra=t=>{if(pe())return`i32(${t})`;if(typeof t=="boolean")return t?1:0;if(Number.isInteger(t))return(t<-2147483648||t>2147483647)&&console.warn(`i32 value ${t} overflowed`),(t|0)&4294967295;let e=t<0?Math.ceil(t):Math.floor(t);return Math.max(-2147483648,Math.min(2147483647,e))},Zt=Object.assign(Ra,{type:"i32"}),Na=t=>{if(pe())return`f32(${t})`;if(typeof t=="boolean")return t?1:0;let e=new Float32Array(1);return e[0]=t,e[0]},I=Object.assign(Na,{type:"f32"}),Va=t=>{if(pe())return`f16(${t})`;if(typeof t=="boolean")return t?1:0;let e=new ArrayBuffer(2);return mn.f16.write(new mn.BufferWriter(e),t),mn.f16.read(new mn.BufferReader(e))};Object.assign(Va,{type:"f16"});var La=["bool","f32","f16","i32","u32","vec2f","vec2h","vec2i","vec2u","vec3f","vec3h","vec3i","vec3u","vec4f","vec4h","vec4i","vec4u","mat2x2f","mat3x3f","mat4x4f","struct","array","atomic","decorated"];function Ve(t){return La.includes(t?.type)}function Ir(t){return t?.type==="array"}function Le(t){return t?.type==="struct"}function si(t){return t?.type==="@align"}function ii(t){return t?.type==="@size"}function Ga(t){return t?.type==="@location"}function qa(t){return t?.type==="@builtin"}function Ge(t){return t?.type==="decorated"}var un=t=>new Ca(t),Ca=class{constructor(e){this.propTypes=e,A(this,"_label"),A(this,"type","struct"),A(this,"~repr"),A(this,"~exotic")}get label(){return this._label}$name(e){return this._label=e,this}toString(){var e;return`struct:${(e=this.label)!=null?e:"<unnamed>"}`}},me=(t,e)=>{let n=e-1,r=~n;return t&n?(t&r)+e:t},oi=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Wa={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"},Ya=["unstruct","disarray","loose-decorated",...oi];function ai(t){return Ya.includes(t?.type)}function Pr(t){return t?.type==="disarray"}function rr(t){return t?.type==="unstruct"}function Ie(t){return t?.type==="loose-decorated"}function Ke(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(si))==null?void 0:n.value}function Xa(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(ii))==null?void 0:n.value}function vr(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(Ga))==null?void 0:n.value}function sr(t){return Ve(t)||ai(t)}var C=class{constructor(t){this.type=t,A(this,"~repr")}},Za={uint8:lt,uint8x2:Ee,uint8x4:ee,sint8:Zt,sint8x2:Ue,sint8x4:te,unorm8:I,unorm8x2:q,unorm8x4:G,snorm8:I,snorm8x2:q,snorm8x4:G,uint16:lt,uint16x2:Ee,uint16x4:ee,sint16:Zt,sint16x2:Ue,sint16x4:te,unorm16:I,unorm16x2:q,unorm16x4:G,snorm16:I,snorm16x2:q,snorm16x4:G,float16:I,float16x2:q,float16x4:G,float32:I,float32x2:q,float32x3:tn,float32x4:G,uint32:lt,uint32x2:Ee,uint32x3:Oe,uint32x4:ee,sint32:Zt,sint32x2:Ue,sint32x3:xr,sint32x4:te,"unorm10-10-10-2":G,"unorm8x4-bgra":G},Ka=Object.keys(Za);new C("uint8");new C("uint8x2");new C("uint8x4");new C("sint8");new C("sint8x2");new C("sint8x4");new C("unorm8");new C("unorm8x2");new C("unorm8x4");new C("snorm8");new C("snorm8x2");new C("snorm8x4");new C("uint16");new C("uint16x2");new C("uint16x4");new C("sint16");new C("sint16x2");new C("sint16x4");new C("unorm16");new C("unorm16x2");new C("unorm16x4");new C("snorm16");new C("snorm16x2");new C("snorm16x4");new C("float16");new C("float16x2");new C("float16x4");new C("float32");new C("float32x2");new C("float32x3");new C("float32x4");new C("uint32");new C("uint32x2");new C("uint32x3");new C("uint32x4");new C("sint32");new C("sint32x2");new C("sint32x3");new C("sint32x4");new C("unorm10-10-10-2");new C("unorm8x4-bgra");var Ha={bool:4,f32:4,f16:2,i32:4,u32:4,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,mat2x2f:8,mat3x3f:16,mat4x4f:16};function Ja(t){var e,n,r;let o=t?.type,f=Ha[o];if(f!==void 0)return f;if(Le(t))return Object.values(t.propTypes).map(St).reduce((y,v)=>y>v?y:v);if(Ir(t))return St(t.elementType);if(rr(t)){let y=Object.values(t.propTypes)[0];return y&&(e=Ke(y))!=null?e:1}if(Pr(t))return(n=Ke(t.elementType))!=null?n:1;if(Ge(t)||Ie(t))return(r=Ke(t))!=null?r:St(t.inner);if(Ka.includes(o))return 1;throw new Error(`Cannot determine alignment of data: ${JSON.stringify(t)}`)}function Qa(t){var e,n;if(rr(t)){let r=Object.values(t.propTypes)[0];return r?ue(r):1}return Pr(t)?ue(t.elementType):Ie(t)?(e=Ke(t))!=null?e:ue(t.inner):(n=Ke(t))!=null?n:1}var ns=new WeakMap,rs=new WeakMap;function St(t){let e=ns.get(t);return e===void 0&&(e=Ja(t),ns.set(t,e)),e}function ue(t){let e=rs.get(t);return e===void 0&&(e=Qa(t),rs.set(t,e)),e}var tu={bool:4,f32:4,f16:2,i32:4,u32:4,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4};function eu(t){let e=0;for(let n of Object.values(t.propTypes)){if(Number.isNaN(e))throw new Error("Only the last property of a struct can be unbounded");if(e=me(e,St(n)),e+=mt(n),Number.isNaN(e)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return me(e,St(t))}function nu(t){let e=0;for(let n of Object.values(t.propTypes)){let r=ue(n);e=me(e,r),e+=mt(n)}return e}function ru(t){var e;let n=tu[t?.type];if(n!==void 0)return n;if(Le(t))return eu(t);if(rr(t))return nu(t);if(Ir(t)){if(t.elementCount===0)return Number.NaN;let r=St(t.elementType);return me(mt(t.elementType),r)*t.elementCount}if(Pr(t)){let r=ue(t.elementType);return me(mt(t.elementType),r)*t.elementCount}if(Ge(t)||Ie(t))return(e=Xa(t))!=null?e:mt(t.inner);throw new Error(`Cannot determine size of data: ${t}`)}var ss=new WeakMap;function mt(t){let e=ss.get(t);return e===void 0&&(e=ru(t),ss.set(t,e)),e}var en=(t,e)=>new su(t,e),su=class{constructor(e,n){if(this.elementType=e,this.elementCount=n,A(this,"type","array"),A(this,"~repr"),A(this,"~exotic"),Number.isNaN(mt(e)))throw new Error("Cannot nest runtime sized arrays.")}toString(){return`arrayOf(${this.elementType})`}};function Fr(t){let e={"~repr":void 0,type:t.type,label:t.type};return Object.assign((...n)=>{let r=[];for(let o of n)if(typeof o=="number")r.push(o);else for(let f=0;f<o.length;++f)r.push(o[f]);for(let o=r.length;o<t.columns*t.rows;++o)r.push(0);return t.makeFromElements(...r)},e)}var iu=class{constructor(...e){A(this,"columns"),A(this,"length",4),this.columns=[this.makeColumn(e[0],e[1]),this.makeColumn(e[2],e[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[1].x=e}set 3(e){this.columns[1].y=e}},ou=class extends iu{constructor(){super(...arguments),A(this,"kind","mat2x2f")}makeColumn(e,n){return q(e,n)}},au=class{constructor(...e){A(this,"columns"),A(this,"length",12),this.columns=[this.makeColumn(e[0],e[1],e[2]),this.makeColumn(e[3],e[4],e[5]),this.makeColumn(e[6],e[7],e[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[0].z=e}set 3(e){}set 4(e){this.columns[1].x=e}set 5(e){this.columns[1].y=e}set 6(e){this.columns[1].z=e}set 7(e){}set 8(e){this.columns[2].x=e}set 9(e){this.columns[2].y=e}set 10(e){this.columns[2].z=e}set 11(e){}},uu=class extends au{constructor(){super(...arguments),A(this,"kind","mat3x3f")}makeColumn(e,n,r){return tn(e,n,r)}},cu=class{constructor(...e){A(this,"columns"),A(this,"length",16),this.columns=[this.makeColumn(e[0],e[1],e[2],e[3]),this.makeColumn(e[4],e[5],e[6],e[7]),this.makeColumn(e[8],e[9],e[10],e[11]),this.makeColumn(e[12],e[13],e[14],e[15])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[0].z=e}set 3(e){this.columns[0].w=e}set 4(e){this.columns[1].x=e}set 5(e){this.columns[1].y=e}set 6(e){this.columns[1].z=e}set 7(e){this.columns[1].w=e}set 8(e){this.columns[2].x=e}set 9(e){this.columns[2].y=e}set 10(e){this.columns[2].z=e}set 11(e){this.columns[2].w=e}set 12(e){this.columns[3].x=e}set 13(e){this.columns[3].y=e}set 14(e){this.columns[3].z=e}set 15(e){this.columns[3].w=e}},lu=class extends cu{constructor(){super(...arguments),A(this,"kind","mat4x4f")}makeColumn(e,n,r,o){return G(e,n,r,o)}},fu=Fr({type:"mat2x2f",rows:2,columns:2,makeFromElements:(...t)=>new ou(...t)}),nn=Fr({type:"mat3x3f",rows:3,columns:3,makeFromElements:(...t)=>new uu(...t)}),ui=Fr({type:"mat4x4f",rows:4,columns:4,makeFromElements:(...t)=>new lu(...t)});function It(t,e){return Ge(t)?new is(t.inner,[e,...t.attribs]):Ie(t)?new os(t.inner,[e,...t.attribs]):ai(t)?new os(t,[e]):new is(t,[e])}function bn(t,e){return It(e,{type:"@location",value:t})}function hu(t,e){return It(e,{type:"@interpolate",value:t})}function ci(t){return(Ge(t)||Ie(t))&&t.attribs.find(qa)!==void 0}function du(t){return!Ge(t)&&!Ie(t)?"":t.attribs.map(e=>`${e.type}(${e.value}) `).join("")}var li=class{constructor(e,n){this.inner=e,this.attribs=n,A(this,"~repr");var r,o;let f=(r=n.find(si))==null?void 0:r.value,y=(o=n.find(ii))==null?void 0:o.value;if(f!==void 0){if(f<=0)throw new Error(`Custom data alignment must be a positive number, got: ${f}.`);if(Math.log2(f)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${f}.`);if(Ve(this.inner)&&f%St(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${f}, expected multiple of: ${St(this.inner)}.`)}if(y!==void 0){if(y<mt(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${y}, expected at least: ${mt(this.inner)}.`);if(y<=0)throw new Error(`Custom data size must be a positive number. Got: ${y}.`)}}},is=class extends li{constructor(){super(...arguments),A(this,"type","decorated")}},os=class extends li{constructor(){super(...arguments),A(this,"type","loose-decorated")}},pu={vertexIndex:It(lt,{type:"@builtin",value:"vertex_index"}),instanceIndex:It(lt,{type:"@builtin",value:"instance_index"}),position:It(G,{type:"@builtin",value:"position"}),clipDistances:It(en(lt,8),{type:"@builtin",value:"clip_distances"}),frontFacing:It(I,{type:"@builtin",value:"front_facing"}),fragDepth:It(I,{type:"@builtin",value:"frag_depth"}),sampleIndex:It(lt,{type:"@builtin",value:"sample_index"}),sampleMask:It(lt,{type:"@builtin",value:"sample_mask"}),localInvocationId:It(Oe,{type:"@builtin",value:"local_invocation_id"}),localInvocationIndex:It(lt,{type:"@builtin",value:"local_invocation_index"}),globalInvocationId:It(Oe,{type:"@builtin",value:"global_invocation_id"}),workgroupId:It(Oe,{type:"@builtin",value:"workgroup_id"}),numWorkgroups:It(Oe,{type:"@builtin",value:"num_workgroups"})};function fi(t){if(!(t.target instanceof HTMLElement))return q();const e=t.target?.getBoundingClientRect(),n=e.x+e.width/2,r=e.y+e.height/2,o=(t.clientX-n)/e.width*2,f=(r-t.clientY)/e.height*2;return q(o,f)}const Gn=Symbol("store-raw"),Be=Symbol("store-node"),we=Symbol("store-has"),hi=Symbol("store-self");function di(t){let e=t[ke];if(!e&&(Object.defineProperty(t,ke,{value:e=new Proxy(t,mu)}),!Array.isArray(t))){const n=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let o=0,f=n.length;o<f;o++){const y=n[o];r[y].get&&Object.defineProperty(t,y,{enumerable:r[y].enumerable,get:r[y].get.bind(e)})}}return e}function je(t){let e;return t!=null&&typeof t=="object"&&(t[ke]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function de(t,e=new Set){let n,r,o,f;if(n=t!=null&&t[Gn])return n;if(!je(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let y=0,v=t.length;y<v;y++)o=t[y],(r=de(o,e))!==o&&(t[y]=r)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const y=Object.keys(t),v=Object.getOwnPropertyDescriptors(t);for(let U=0,D=y.length;U<D;U++)f=y[U],!v[f].get&&(o=t[f],(r=de(o,e))!==o&&(t[f]=r))}return t}function qn(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function rn(t,e,n){if(t[e])return t[e];const[r,o]=qt(n,{equals:!1,internal:!0});return r.$=o,t[e]=r}function wu(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===ke||e===Be||(delete n.value,delete n.writable,n.get=()=>t[ke][e]),n}function pi(t){dr()&&rn(qn(t,Be),hi)()}function yu(t){return pi(t),Reflect.ownKeys(t)}const mu={get(t,e,n){if(e===Gn)return t;if(e===ke)return n;if(e===Hr)return pi(t),n;const r=qn(t,Be),o=r[e];let f=o?o():t[e];if(e===Be||e===we||e==="__proto__")return f;if(!o){const y=Object.getOwnPropertyDescriptor(t,e);dr()&&(typeof f!="function"||t.hasOwnProperty(e))&&!(y&&y.get)&&(f=rn(r,e,f)())}return je(f)?di(f):f},has(t,e){return e===Gn||e===ke||e===Hr||e===Be||e===we||e==="__proto__"?!0:(dr()&&rn(qn(t,we),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:yu,getOwnPropertyDescriptor:wu};function Re(t,e,n,r=!1){if(!r&&t[e]===n)return;const o=t[e],f=t.length;n===void 0?(delete t[e],t[we]&&t[we][e]&&o!==void 0&&t[we][e].$()):(t[e]=n,t[we]&&t[we][e]&&o===void 0&&t[we][e].$());let y=qn(t,Be),v;if((v=rn(y,e,o))&&v.$(()=>n),Array.isArray(t)&&t.length!==f){for(let U=t.length;U<f;U++)(v=y[U])&&v.$();(v=rn(y,"length",f))&&v.$(t.length)}(v=y[hi])&&v.$()}function wi(t,e){const n=Object.keys(e);for(let r=0;r<n.length;r+=1){const o=n[r];Re(t,o,e[o])}}function gu(t,e){if(typeof e=="function"&&(e=e(t)),e=de(e),Array.isArray(e)){if(t===e)return;let n=0,r=e.length;for(;n<r;n++){const o=e[n];t[n]!==o&&Re(t,n,o)}Re(t,"length",r)}else wi(t,e)}function Ye(t,e,n=[]){let r,o=t;if(e.length>1){r=e.shift();const y=typeof r,v=Array.isArray(t);if(Array.isArray(r)){for(let U=0;U<r.length;U++)Ye(t,[r[U]].concat(e),n);return}else if(v&&y==="function"){for(let U=0;U<t.length;U++)r(t[U],U)&&Ye(t,[U].concat(e),n);return}else if(v&&y==="object"){const{from:U=0,to:D=t.length-1,by:k=1}=r;for(let P=U;P<=D;P+=k)Ye(t,[P].concat(e),n);return}else if(e.length>1){Ye(t[r],e,[r].concat(n));return}o=t[r],n=[r].concat(n)}let f=e[0];typeof f=="function"&&(f=f(o,n),f===o)||r===void 0&&f==null||(f=de(f),r===void 0||je(o)&&je(f)&&!Array.isArray(f)?wi(o,f):Re(t,r,f))}function xu(...[t,e]){const n=de(t||{}),r=Array.isArray(n),o=di(n);function f(...y){$s(()=>{r&&y.length===1?gu(n,y[0]):Ye(n,y)})}return[o,f]}const Cn=new WeakMap,yi={get(t,e){if(e===Gn)return t;const n=t[e];let r;return je(n)?Cn.get(n)||(Cn.set(n,r=new Proxy(n,yi)),r):n},set(t,e,n){return Re(t,e,de(n)),!0},deleteProperty(t,e){return Re(t,e,void 0,!0),!0}};function mi(t){return e=>{if(je(e)){let n;(n=Cn.get(e))||Cn.set(e,n=new Proxy(e,yi)),t(n)}return e}}function vu(t,e){return class extends t{constructor(...n){super(...n),e(this)}}}const bu=vu(Array,t=>t.fill(0));let W=1e-6;function _u(t){function e(s=0,h=0){const i=new t(2);return s!==void 0&&(i[0]=s,h!==void 0&&(i[1]=h)),i}const n=e;function r(s,h,i){const u=i??new t(2);return u[0]=s,u[1]=h,u}function o(s,h){const i=h??new t(2);return i[0]=Math.ceil(s[0]),i[1]=Math.ceil(s[1]),i}function f(s,h){const i=h??new t(2);return i[0]=Math.floor(s[0]),i[1]=Math.floor(s[1]),i}function y(s,h){const i=h??new t(2);return i[0]=Math.round(s[0]),i[1]=Math.round(s[1]),i}function v(s,h=0,i=1,u){const p=u??new t(2);return p[0]=Math.min(i,Math.max(h,s[0])),p[1]=Math.min(i,Math.max(h,s[1])),p}function U(s,h,i){const u=i??new t(2);return u[0]=s[0]+h[0],u[1]=s[1]+h[1],u}function D(s,h,i,u){const p=u??new t(2);return p[0]=s[0]+h[0]*i,p[1]=s[1]+h[1]*i,p}function k(s,h){const i=s[0],u=s[1],p=h[0],_=h[1],T=Math.sqrt(i*i+u*u),d=Math.sqrt(p*p+_*_),w=T*d,b=w&&H(s,h)/w;return Math.acos(b)}function P(s,h,i){const u=i??new t(2);return u[0]=s[0]-h[0],u[1]=s[1]-h[1],u}const F=P;function B(s,h){return Math.abs(s[0]-h[0])<W&&Math.abs(s[1]-h[1])<W}function z(s,h){return s[0]===h[0]&&s[1]===h[1]}function j(s,h,i,u){const p=u??new t(2);return p[0]=s[0]+i*(h[0]-s[0]),p[1]=s[1]+i*(h[1]-s[1]),p}function tt(s,h,i,u){const p=u??new t(2);return p[0]=s[0]+i[0]*(h[0]-s[0]),p[1]=s[1]+i[1]*(h[1]-s[1]),p}function it(s,h,i){const u=i??new t(2);return u[0]=Math.max(s[0],h[0]),u[1]=Math.max(s[1],h[1]),u}function nt(s,h,i){const u=i??new t(2);return u[0]=Math.min(s[0],h[0]),u[1]=Math.min(s[1],h[1]),u}function ot(s,h,i){const u=i??new t(2);return u[0]=s[0]*h,u[1]=s[1]*h,u}const rt=ot;function dt(s,h,i){const u=i??new t(2);return u[0]=s[0]/h,u[1]=s[1]/h,u}function pt(s,h){const i=h??new t(2);return i[0]=1/s[0],i[1]=1/s[1],i}const gt=pt;function st(s,h,i){const u=i??new t(3),p=s[0]*h[1]-s[1]*h[0];return u[0]=0,u[1]=0,u[2]=p,u}function H(s,h){return s[0]*h[0]+s[1]*h[1]}function Y(s){const h=s[0],i=s[1];return Math.sqrt(h*h+i*i)}const at=Y;function X(s){const h=s[0],i=s[1];return h*h+i*i}const et=X;function K(s,h){const i=s[0]-h[0],u=s[1]-h[1];return Math.sqrt(i*i+u*u)}const re=K;function Ft(s,h){const i=s[0]-h[0],u=s[1]-h[1];return i*i+u*u}const se=Ft;function zt(s,h){const i=h??new t(2),u=s[0],p=s[1],_=Math.sqrt(u*u+p*p);return _>1e-5?(i[0]=u/_,i[1]=p/_):(i[0]=0,i[1]=0),i}function ie(s,h){const i=h??new t(2);return i[0]=-s[0],i[1]=-s[1],i}function ct(s,h){const i=h??new t(2);return i[0]=s[0],i[1]=s[1],i}const oe=ct;function Lt(s,h,i){const u=i??new t(2);return u[0]=s[0]*h[0],u[1]=s[1]*h[1],u}const ae=Lt;function Gt(s,h,i){const u=i??new t(2);return u[0]=s[0]/h[0],u[1]=s[1]/h[1],u}const Jt=Gt;function Ct(s=1,h){const i=h??new t(2),u=Math.random()*2*Math.PI;return i[0]=Math.cos(u)*s,i[1]=Math.sin(u)*s,i}function c(s){const h=s??new t(2);return h[0]=0,h[1]=0,h}function g(s,h,i){const u=i??new t(2),p=s[0],_=s[1];return u[0]=p*h[0]+_*h[4]+h[12],u[1]=p*h[1]+_*h[5]+h[13],u}function a(s,h,i){const u=i??new t(2),p=s[0],_=s[1];return u[0]=h[0]*p+h[4]*_+h[8],u[1]=h[1]*p+h[5]*_+h[9],u}function l(s,h,i,u){const p=u??new t(2),_=s[0]-h[0],T=s[1]-h[1],d=Math.sin(i),w=Math.cos(i);return p[0]=_*w-T*d+h[0],p[1]=_*d+T*w+h[1],p}function m(s,h,i){const u=i??new t(2);return zt(s,u),ot(u,h,u)}function x(s,h,i){const u=i??new t(2);return Y(s)>h?m(s,h,u):ct(s,u)}function M(s,h,i){const u=i??new t(2);return j(s,h,.5,u)}return{create:e,fromValues:n,set:r,ceil:o,floor:f,round:y,clamp:v,add:U,addScaled:D,angle:k,subtract:P,sub:F,equalsApproximately:B,equals:z,lerp:j,lerpV:tt,max:it,min:nt,mulScalar:ot,scale:rt,divScalar:dt,inverse:pt,invert:gt,cross:st,dot:H,length:Y,len:at,lengthSq:X,lenSq:et,distance:K,dist:re,distanceSq:Ft,distSq:se,normalize:zt,negate:ie,copy:ct,clone:oe,multiply:Lt,mul:ae,divide:Gt,div:Jt,random:Ct,zero:c,transformMat4:g,transformMat3:a,rotate:l,setLength:m,truncate:x,midpoint:M}}const as=new Map;function gi(t){let e=as.get(t);return e||(e=_u(t),as.set(t,e)),e}function $u(t){function e(d,w,b){const $=new t(3);return d!==void 0&&($[0]=d,w!==void 0&&($[1]=w,b!==void 0&&($[2]=b))),$}const n=e;function r(d,w,b,$){const S=$??new t(3);return S[0]=d,S[1]=w,S[2]=b,S}function o(d,w){const b=w??new t(3);return b[0]=Math.ceil(d[0]),b[1]=Math.ceil(d[1]),b[2]=Math.ceil(d[2]),b}function f(d,w){const b=w??new t(3);return b[0]=Math.floor(d[0]),b[1]=Math.floor(d[1]),b[2]=Math.floor(d[2]),b}function y(d,w){const b=w??new t(3);return b[0]=Math.round(d[0]),b[1]=Math.round(d[1]),b[2]=Math.round(d[2]),b}function v(d,w=0,b=1,$){const S=$??new t(3);return S[0]=Math.min(b,Math.max(w,d[0])),S[1]=Math.min(b,Math.max(w,d[1])),S[2]=Math.min(b,Math.max(w,d[2])),S}function U(d,w,b){const $=b??new t(3);return $[0]=d[0]+w[0],$[1]=d[1]+w[1],$[2]=d[2]+w[2],$}function D(d,w,b,$){const S=$??new t(3);return S[0]=d[0]+w[0]*b,S[1]=d[1]+w[1]*b,S[2]=d[2]+w[2]*b,S}function k(d,w){const b=d[0],$=d[1],S=d[2],E=w[0],O=w[1],N=w[2],L=Math.sqrt(b*b+$*$+S*S),R=Math.sqrt(E*E+O*O+N*N),V=L*R,Z=V&&H(d,w)/V;return Math.acos(Z)}function P(d,w,b){const $=b??new t(3);return $[0]=d[0]-w[0],$[1]=d[1]-w[1],$[2]=d[2]-w[2],$}const F=P;function B(d,w){return Math.abs(d[0]-w[0])<W&&Math.abs(d[1]-w[1])<W&&Math.abs(d[2]-w[2])<W}function z(d,w){return d[0]===w[0]&&d[1]===w[1]&&d[2]===w[2]}function j(d,w,b,$){const S=$??new t(3);return S[0]=d[0]+b*(w[0]-d[0]),S[1]=d[1]+b*(w[1]-d[1]),S[2]=d[2]+b*(w[2]-d[2]),S}function tt(d,w,b,$){const S=$??new t(3);return S[0]=d[0]+b[0]*(w[0]-d[0]),S[1]=d[1]+b[1]*(w[1]-d[1]),S[2]=d[2]+b[2]*(w[2]-d[2]),S}function it(d,w,b){const $=b??new t(3);return $[0]=Math.max(d[0],w[0]),$[1]=Math.max(d[1],w[1]),$[2]=Math.max(d[2],w[2]),$}function nt(d,w,b){const $=b??new t(3);return $[0]=Math.min(d[0],w[0]),$[1]=Math.min(d[1],w[1]),$[2]=Math.min(d[2],w[2]),$}function ot(d,w,b){const $=b??new t(3);return $[0]=d[0]*w,$[1]=d[1]*w,$[2]=d[2]*w,$}const rt=ot;function dt(d,w,b){const $=b??new t(3);return $[0]=d[0]/w,$[1]=d[1]/w,$[2]=d[2]/w,$}function pt(d,w){const b=w??new t(3);return b[0]=1/d[0],b[1]=1/d[1],b[2]=1/d[2],b}const gt=pt;function st(d,w,b){const $=b??new t(3),S=d[2]*w[0]-d[0]*w[2],E=d[0]*w[1]-d[1]*w[0];return $[0]=d[1]*w[2]-d[2]*w[1],$[1]=S,$[2]=E,$}function H(d,w){return d[0]*w[0]+d[1]*w[1]+d[2]*w[2]}function Y(d){const w=d[0],b=d[1],$=d[2];return Math.sqrt(w*w+b*b+$*$)}const at=Y;function X(d){const w=d[0],b=d[1],$=d[2];return w*w+b*b+$*$}const et=X;function K(d,w){const b=d[0]-w[0],$=d[1]-w[1],S=d[2]-w[2];return Math.sqrt(b*b+$*$+S*S)}const re=K;function Ft(d,w){const b=d[0]-w[0],$=d[1]-w[1],S=d[2]-w[2];return b*b+$*$+S*S}const se=Ft;function zt(d,w){const b=w??new t(3),$=d[0],S=d[1],E=d[2],O=Math.sqrt($*$+S*S+E*E);return O>1e-5?(b[0]=$/O,b[1]=S/O,b[2]=E/O):(b[0]=0,b[1]=0,b[2]=0),b}function ie(d,w){const b=w??new t(3);return b[0]=-d[0],b[1]=-d[1],b[2]=-d[2],b}function ct(d,w){const b=w??new t(3);return b[0]=d[0],b[1]=d[1],b[2]=d[2],b}const oe=ct;function Lt(d,w,b){const $=b??new t(3);return $[0]=d[0]*w[0],$[1]=d[1]*w[1],$[2]=d[2]*w[2],$}const ae=Lt;function Gt(d,w,b){const $=b??new t(3);return $[0]=d[0]/w[0],$[1]=d[1]/w[1],$[2]=d[2]/w[2],$}const Jt=Gt;function Ct(d=1,w){const b=w??new t(3),$=Math.random()*2*Math.PI,S=Math.random()*2-1,E=Math.sqrt(1-S*S)*d;return b[0]=Math.cos($)*E,b[1]=Math.sin($)*E,b[2]=S*d,b}function c(d){const w=d??new t(3);return w[0]=0,w[1]=0,w[2]=0,w}function g(d,w,b){const $=b??new t(3),S=d[0],E=d[1],O=d[2],N=w[3]*S+w[7]*E+w[11]*O+w[15]||1;return $[0]=(w[0]*S+w[4]*E+w[8]*O+w[12])/N,$[1]=(w[1]*S+w[5]*E+w[9]*O+w[13])/N,$[2]=(w[2]*S+w[6]*E+w[10]*O+w[14])/N,$}function a(d,w,b){const $=b??new t(3),S=d[0],E=d[1],O=d[2];return $[0]=S*w[0*4+0]+E*w[1*4+0]+O*w[2*4+0],$[1]=S*w[0*4+1]+E*w[1*4+1]+O*w[2*4+1],$[2]=S*w[0*4+2]+E*w[1*4+2]+O*w[2*4+2],$}function l(d,w,b){const $=b??new t(3),S=d[0],E=d[1],O=d[2];return $[0]=S*w[0]+E*w[4]+O*w[8],$[1]=S*w[1]+E*w[5]+O*w[9],$[2]=S*w[2]+E*w[6]+O*w[10],$}function m(d,w,b){const $=b??new t(3),S=w[0],E=w[1],O=w[2],N=w[3]*2,L=d[0],R=d[1],V=d[2],Z=E*V-O*R,Q=O*L-S*V,wt=S*R-E*L;return $[0]=L+Z*N+(E*wt-O*Q)*2,$[1]=R+Q*N+(O*Z-S*wt)*2,$[2]=V+wt*N+(S*Q-E*Z)*2,$}function x(d,w){const b=w??new t(3);return b[0]=d[12],b[1]=d[13],b[2]=d[14],b}function M(d,w,b){const $=b??new t(3),S=w*4;return $[0]=d[S+0],$[1]=d[S+1],$[2]=d[S+2],$}function s(d,w){const b=w??new t(3),$=d[0],S=d[1],E=d[2],O=d[4],N=d[5],L=d[6],R=d[8],V=d[9],Z=d[10];return b[0]=Math.sqrt($*$+S*S+E*E),b[1]=Math.sqrt(O*O+N*N+L*L),b[2]=Math.sqrt(R*R+V*V+Z*Z),b}function h(d,w,b,$){const S=$??new t(3),E=[],O=[];return E[0]=d[0]-w[0],E[1]=d[1]-w[1],E[2]=d[2]-w[2],O[0]=E[0],O[1]=E[1]*Math.cos(b)-E[2]*Math.sin(b),O[2]=E[1]*Math.sin(b)+E[2]*Math.cos(b),S[0]=O[0]+w[0],S[1]=O[1]+w[1],S[2]=O[2]+w[2],S}function i(d,w,b,$){const S=$??new t(3),E=[],O=[];return E[0]=d[0]-w[0],E[1]=d[1]-w[1],E[2]=d[2]-w[2],O[0]=E[2]*Math.sin(b)+E[0]*Math.cos(b),O[1]=E[1],O[2]=E[2]*Math.cos(b)-E[0]*Math.sin(b),S[0]=O[0]+w[0],S[1]=O[1]+w[1],S[2]=O[2]+w[2],S}function u(d,w,b,$){const S=$??new t(3),E=[],O=[];return E[0]=d[0]-w[0],E[1]=d[1]-w[1],E[2]=d[2]-w[2],O[0]=E[0]*Math.cos(b)-E[1]*Math.sin(b),O[1]=E[0]*Math.sin(b)+E[1]*Math.cos(b),O[2]=E[2],S[0]=O[0]+w[0],S[1]=O[1]+w[1],S[2]=O[2]+w[2],S}function p(d,w,b){const $=b??new t(3);return zt(d,$),ot($,w,$)}function _(d,w,b){const $=b??new t(3);return Y(d)>w?p(d,w,$):ct(d,$)}function T(d,w,b){const $=b??new t(3);return j(d,w,.5,$)}return{create:e,fromValues:n,set:r,ceil:o,floor:f,round:y,clamp:v,add:U,addScaled:D,angle:k,subtract:P,sub:F,equalsApproximately:B,equals:z,lerp:j,lerpV:tt,max:it,min:nt,mulScalar:ot,scale:rt,divScalar:dt,inverse:pt,invert:gt,cross:st,dot:H,length:Y,len:at,lengthSq:X,lenSq:et,distance:K,dist:re,distanceSq:Ft,distSq:se,normalize:zt,negate:ie,copy:ct,clone:oe,multiply:Lt,mul:ae,divide:Gt,div:Jt,random:Ct,zero:c,transformMat4:g,transformMat4Upper3x3:a,transformMat3:l,transformQuat:m,getTranslation:x,getAxis:M,getScaling:s,rotateX:h,rotateY:i,rotateZ:u,setLength:p,truncate:_,midpoint:T}}const us=new Map;function ir(t){let e=us.get(t);return e||(e=$u(t),us.set(t,e)),e}function Su(t){const e=gi(t),n=ir(t);function r(c,g,a,l,m,x,M,s,h){const i=new t(12);return i[3]=0,i[7]=0,i[11]=0,c!==void 0&&(i[0]=c,g!==void 0&&(i[1]=g,a!==void 0&&(i[2]=a,l!==void 0&&(i[4]=l,m!==void 0&&(i[5]=m,x!==void 0&&(i[6]=x,M!==void 0&&(i[8]=M,s!==void 0&&(i[9]=s,h!==void 0&&(i[10]=h))))))))),i}function o(c,g,a,l,m,x,M,s,h,i){const u=i??new t(12);return u[0]=c,u[1]=g,u[2]=a,u[3]=0,u[4]=l,u[5]=m,u[6]=x,u[7]=0,u[8]=M,u[9]=s,u[10]=h,u[11]=0,u}function f(c,g){const a=g??new t(12);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=0,a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=0,a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=0,a}function y(c,g){const a=g??new t(12),l=c[0],m=c[1],x=c[2],M=c[3],s=l+l,h=m+m,i=x+x,u=l*s,p=m*s,_=m*h,T=x*s,d=x*h,w=x*i,b=M*s,$=M*h,S=M*i;return a[0]=1-_-w,a[1]=p+S,a[2]=T-$,a[3]=0,a[4]=p-S,a[5]=1-u-w,a[6]=d+b,a[7]=0,a[8]=T+$,a[9]=d-b,a[10]=1-u-_,a[11]=0,a}function v(c,g){const a=g??new t(12);return a[0]=-c[0],a[1]=-c[1],a[2]=-c[2],a[4]=-c[4],a[5]=-c[5],a[6]=-c[6],a[8]=-c[8],a[9]=-c[9],a[10]=-c[10],a}function U(c,g){const a=g??new t(12);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[8]=c[8],a[9]=c[9],a[10]=c[10],a}const D=U;function k(c,g){return Math.abs(c[0]-g[0])<W&&Math.abs(c[1]-g[1])<W&&Math.abs(c[2]-g[2])<W&&Math.abs(c[4]-g[4])<W&&Math.abs(c[5]-g[5])<W&&Math.abs(c[6]-g[6])<W&&Math.abs(c[8]-g[8])<W&&Math.abs(c[9]-g[9])<W&&Math.abs(c[10]-g[10])<W}function P(c,g){return c[0]===g[0]&&c[1]===g[1]&&c[2]===g[2]&&c[4]===g[4]&&c[5]===g[5]&&c[6]===g[6]&&c[8]===g[8]&&c[9]===g[9]&&c[10]===g[10]}function F(c){const g=c??new t(12);return g[0]=1,g[1]=0,g[2]=0,g[4]=0,g[5]=1,g[6]=0,g[8]=0,g[9]=0,g[10]=1,g}function B(c,g){const a=g??new t(12);if(a===c){let _;return _=c[1],c[1]=c[4],c[4]=_,_=c[2],c[2]=c[8],c[8]=_,_=c[6],c[6]=c[9],c[9]=_,a}const l=c[0*4+0],m=c[0*4+1],x=c[0*4+2],M=c[1*4+0],s=c[1*4+1],h=c[1*4+2],i=c[2*4+0],u=c[2*4+1],p=c[2*4+2];return a[0]=l,a[1]=M,a[2]=i,a[4]=m,a[5]=s,a[6]=u,a[8]=x,a[9]=h,a[10]=p,a}function z(c,g){const a=g??new t(12),l=c[0*4+0],m=c[0*4+1],x=c[0*4+2],M=c[1*4+0],s=c[1*4+1],h=c[1*4+2],i=c[2*4+0],u=c[2*4+1],p=c[2*4+2],_=p*s-h*u,T=-p*M+h*i,d=u*M-s*i,w=1/(l*_+m*T+x*d);return a[0]=_*w,a[1]=(-p*m+x*u)*w,a[2]=(h*m-x*s)*w,a[4]=T*w,a[5]=(p*l-x*i)*w,a[6]=(-h*l+x*M)*w,a[8]=d*w,a[9]=(-u*l+m*i)*w,a[10]=(s*l-m*M)*w,a}function j(c){const g=c[0],a=c[0*4+1],l=c[0*4+2],m=c[1*4+0],x=c[1*4+1],M=c[1*4+2],s=c[2*4+0],h=c[2*4+1],i=c[2*4+2];return g*(x*i-h*M)-m*(a*i-h*l)+s*(a*M-x*l)}const tt=z;function it(c,g,a){const l=a??new t(12),m=c[0],x=c[1],M=c[2],s=c[4],h=c[5],i=c[6],u=c[8],p=c[9],_=c[10],T=g[0],d=g[1],w=g[2],b=g[4],$=g[5],S=g[6],E=g[8],O=g[9],N=g[10];return l[0]=m*T+s*d+u*w,l[1]=x*T+h*d+p*w,l[2]=M*T+i*d+_*w,l[4]=m*b+s*$+u*S,l[5]=x*b+h*$+p*S,l[6]=M*b+i*$+_*S,l[8]=m*E+s*O+u*N,l[9]=x*E+h*O+p*N,l[10]=M*E+i*O+_*N,l}const nt=it;function ot(c,g,a){const l=a??F();return c!==l&&(l[0]=c[0],l[1]=c[1],l[2]=c[2],l[4]=c[4],l[5]=c[5],l[6]=c[6]),l[8]=g[0],l[9]=g[1],l[10]=1,l}function rt(c,g){const a=g??e.create();return a[0]=c[8],a[1]=c[9],a}function dt(c,g,a){const l=a??e.create(),m=g*4;return l[0]=c[m+0],l[1]=c[m+1],l}function pt(c,g,a,l){const m=l===c?c:U(c,l),x=a*4;return m[x+0]=g[0],m[x+1]=g[1],m}function gt(c,g){const a=g??e.create(),l=c[0],m=c[1],x=c[4],M=c[5];return a[0]=Math.sqrt(l*l+m*m),a[1]=Math.sqrt(x*x+M*M),a}function st(c,g){const a=g??n.create(),l=c[0],m=c[1],x=c[2],M=c[4],s=c[5],h=c[6],i=c[8],u=c[9],p=c[10];return a[0]=Math.sqrt(l*l+m*m+x*x),a[1]=Math.sqrt(M*M+s*s+h*h),a[2]=Math.sqrt(i*i+u*u+p*p),a}function H(c,g){const a=g??new t(12);return a[0]=1,a[1]=0,a[2]=0,a[4]=0,a[5]=1,a[6]=0,a[8]=c[0],a[9]=c[1],a[10]=1,a}function Y(c,g,a){const l=a??new t(12),m=g[0],x=g[1],M=c[0],s=c[1],h=c[2],i=c[1*4+0],u=c[1*4+1],p=c[1*4+2],_=c[2*4+0],T=c[2*4+1],d=c[2*4+2];return c!==l&&(l[0]=M,l[1]=s,l[2]=h,l[4]=i,l[5]=u,l[6]=p),l[8]=M*m+i*x+_,l[9]=s*m+u*x+T,l[10]=h*m+p*x+d,l}function at(c,g){const a=g??new t(12),l=Math.cos(c),m=Math.sin(c);return a[0]=l,a[1]=m,a[2]=0,a[4]=-m,a[5]=l,a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function X(c,g,a){const l=a??new t(12),m=c[0*4+0],x=c[0*4+1],M=c[0*4+2],s=c[1*4+0],h=c[1*4+1],i=c[1*4+2],u=Math.cos(g),p=Math.sin(g);return l[0]=u*m+p*s,l[1]=u*x+p*h,l[2]=u*M+p*i,l[4]=u*s-p*m,l[5]=u*h-p*x,l[6]=u*i-p*M,c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function et(c,g){const a=g??new t(12),l=Math.cos(c),m=Math.sin(c);return a[0]=1,a[1]=0,a[2]=0,a[4]=0,a[5]=l,a[6]=m,a[8]=0,a[9]=-m,a[10]=l,a}function K(c,g,a){const l=a??new t(12),m=c[4],x=c[5],M=c[6],s=c[8],h=c[9],i=c[10],u=Math.cos(g),p=Math.sin(g);return l[4]=u*m+p*s,l[5]=u*x+p*h,l[6]=u*M+p*i,l[8]=u*s-p*m,l[9]=u*h-p*x,l[10]=u*i-p*M,c!==l&&(l[0]=c[0],l[1]=c[1],l[2]=c[2]),l}function re(c,g){const a=g??new t(12),l=Math.cos(c),m=Math.sin(c);return a[0]=l,a[1]=0,a[2]=-m,a[4]=0,a[5]=1,a[6]=0,a[8]=m,a[9]=0,a[10]=l,a}function Ft(c,g,a){const l=a??new t(12),m=c[0*4+0],x=c[0*4+1],M=c[0*4+2],s=c[2*4+0],h=c[2*4+1],i=c[2*4+2],u=Math.cos(g),p=Math.sin(g);return l[0]=u*m-p*s,l[1]=u*x-p*h,l[2]=u*M-p*i,l[8]=u*s+p*m,l[9]=u*h+p*x,l[10]=u*i+p*M,c!==l&&(l[4]=c[4],l[5]=c[5],l[6]=c[6]),l}const se=at,zt=X;function ie(c,g){const a=g??new t(12);return a[0]=c[0],a[1]=0,a[2]=0,a[4]=0,a[5]=c[1],a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function ct(c,g,a){const l=a??new t(12),m=g[0],x=g[1];return l[0]=m*c[0*4+0],l[1]=m*c[0*4+1],l[2]=m*c[0*4+2],l[4]=x*c[1*4+0],l[5]=x*c[1*4+1],l[6]=x*c[1*4+2],c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function oe(c,g){const a=g??new t(12);return a[0]=c[0],a[1]=0,a[2]=0,a[4]=0,a[5]=c[1],a[6]=0,a[8]=0,a[9]=0,a[10]=c[2],a}function Lt(c,g,a){const l=a??new t(12),m=g[0],x=g[1],M=g[2];return l[0]=m*c[0*4+0],l[1]=m*c[0*4+1],l[2]=m*c[0*4+2],l[4]=x*c[1*4+0],l[5]=x*c[1*4+1],l[6]=x*c[1*4+2],l[8]=M*c[2*4+0],l[9]=M*c[2*4+1],l[10]=M*c[2*4+2],l}function ae(c,g){const a=g??new t(12);return a[0]=c,a[1]=0,a[2]=0,a[4]=0,a[5]=c,a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function Gt(c,g,a){const l=a??new t(12);return l[0]=g*c[0*4+0],l[1]=g*c[0*4+1],l[2]=g*c[0*4+2],l[4]=g*c[1*4+0],l[5]=g*c[1*4+1],l[6]=g*c[1*4+2],c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function Jt(c,g){const a=g??new t(12);return a[0]=c,a[1]=0,a[2]=0,a[4]=0,a[5]=c,a[6]=0,a[8]=0,a[9]=0,a[10]=c,a}function Ct(c,g,a){const l=a??new t(12);return l[0]=g*c[0*4+0],l[1]=g*c[0*4+1],l[2]=g*c[0*4+2],l[4]=g*c[1*4+0],l[5]=g*c[1*4+1],l[6]=g*c[1*4+2],l[8]=g*c[2*4+0],l[9]=g*c[2*4+1],l[10]=g*c[2*4+2],l}return{clone:D,create:r,set:o,fromMat4:f,fromQuat:y,negate:v,copy:U,equalsApproximately:k,equals:P,identity:F,transpose:B,inverse:z,invert:tt,determinant:j,mul:nt,multiply:it,setTranslation:ot,getTranslation:rt,getAxis:dt,setAxis:pt,getScaling:gt,get3DScaling:st,translation:H,translate:Y,rotation:at,rotate:X,rotationX:et,rotateX:K,rotationY:re,rotateY:Ft,rotationZ:se,rotateZ:zt,scaling:ie,scale:ct,uniformScaling:ae,uniformScale:Gt,scaling3D:oe,scale3D:Lt,uniformScaling3D:Jt,uniformScale3D:Ct}}const cs=new Map;function Mu(t){let e=cs.get(t);return e||(e=Su(t),cs.set(t,e)),e}function Tu(t){const e=ir(t);function n(s,h,i,u,p,_,T,d,w,b,$,S,E,O,N,L){const R=new t(16);return s!==void 0&&(R[0]=s,h!==void 0&&(R[1]=h,i!==void 0&&(R[2]=i,u!==void 0&&(R[3]=u,p!==void 0&&(R[4]=p,_!==void 0&&(R[5]=_,T!==void 0&&(R[6]=T,d!==void 0&&(R[7]=d,w!==void 0&&(R[8]=w,b!==void 0&&(R[9]=b,$!==void 0&&(R[10]=$,S!==void 0&&(R[11]=S,E!==void 0&&(R[12]=E,O!==void 0&&(R[13]=O,N!==void 0&&(R[14]=N,L!==void 0&&(R[15]=L)))))))))))))))),R}function r(s,h,i,u,p,_,T,d,w,b,$,S,E,O,N,L,R){const V=R??new t(16);return V[0]=s,V[1]=h,V[2]=i,V[3]=u,V[4]=p,V[5]=_,V[6]=T,V[7]=d,V[8]=w,V[9]=b,V[10]=$,V[11]=S,V[12]=E,V[13]=O,V[14]=N,V[15]=L,V}function o(s,h){const i=h??new t(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=0,i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=0,i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function f(s,h){const i=h??new t(16),u=s[0],p=s[1],_=s[2],T=s[3],d=u+u,w=p+p,b=_+_,$=u*d,S=p*d,E=p*w,O=_*d,N=_*w,L=_*b,R=T*d,V=T*w,Z=T*b;return i[0]=1-E-L,i[1]=S+Z,i[2]=O-V,i[3]=0,i[4]=S-Z,i[5]=1-$-L,i[6]=N+R,i[7]=0,i[8]=O+V,i[9]=N-R,i[10]=1-$-E,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function y(s,h){const i=h??new t(16);return i[0]=-s[0],i[1]=-s[1],i[2]=-s[2],i[3]=-s[3],i[4]=-s[4],i[5]=-s[5],i[6]=-s[6],i[7]=-s[7],i[8]=-s[8],i[9]=-s[9],i[10]=-s[10],i[11]=-s[11],i[12]=-s[12],i[13]=-s[13],i[14]=-s[14],i[15]=-s[15],i}function v(s,h){const i=h??new t(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i}const U=v;function D(s,h){return Math.abs(s[0]-h[0])<W&&Math.abs(s[1]-h[1])<W&&Math.abs(s[2]-h[2])<W&&Math.abs(s[3]-h[3])<W&&Math.abs(s[4]-h[4])<W&&Math.abs(s[5]-h[5])<W&&Math.abs(s[6]-h[6])<W&&Math.abs(s[7]-h[7])<W&&Math.abs(s[8]-h[8])<W&&Math.abs(s[9]-h[9])<W&&Math.abs(s[10]-h[10])<W&&Math.abs(s[11]-h[11])<W&&Math.abs(s[12]-h[12])<W&&Math.abs(s[13]-h[13])<W&&Math.abs(s[14]-h[14])<W&&Math.abs(s[15]-h[15])<W}function k(s,h){return s[0]===h[0]&&s[1]===h[1]&&s[2]===h[2]&&s[3]===h[3]&&s[4]===h[4]&&s[5]===h[5]&&s[6]===h[6]&&s[7]===h[7]&&s[8]===h[8]&&s[9]===h[9]&&s[10]===h[10]&&s[11]===h[11]&&s[12]===h[12]&&s[13]===h[13]&&s[14]===h[14]&&s[15]===h[15]}function P(s){const h=s??new t(16);return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function F(s,h){const i=h??new t(16);if(i===s){let Q;return Q=s[1],s[1]=s[4],s[4]=Q,Q=s[2],s[2]=s[8],s[8]=Q,Q=s[3],s[3]=s[12],s[12]=Q,Q=s[6],s[6]=s[9],s[9]=Q,Q=s[7],s[7]=s[13],s[13]=Q,Q=s[11],s[11]=s[14],s[14]=Q,i}const u=s[0*4+0],p=s[0*4+1],_=s[0*4+2],T=s[0*4+3],d=s[1*4+0],w=s[1*4+1],b=s[1*4+2],$=s[1*4+3],S=s[2*4+0],E=s[2*4+1],O=s[2*4+2],N=s[2*4+3],L=s[3*4+0],R=s[3*4+1],V=s[3*4+2],Z=s[3*4+3];return i[0]=u,i[1]=d,i[2]=S,i[3]=L,i[4]=p,i[5]=w,i[6]=E,i[7]=R,i[8]=_,i[9]=b,i[10]=O,i[11]=V,i[12]=T,i[13]=$,i[14]=N,i[15]=Z,i}function B(s,h){const i=h??new t(16),u=s[0*4+0],p=s[0*4+1],_=s[0*4+2],T=s[0*4+3],d=s[1*4+0],w=s[1*4+1],b=s[1*4+2],$=s[1*4+3],S=s[2*4+0],E=s[2*4+1],O=s[2*4+2],N=s[2*4+3],L=s[3*4+0],R=s[3*4+1],V=s[3*4+2],Z=s[3*4+3],Q=O*Z,wt=V*N,bt=b*Z,_t=V*$,Tt=b*N,Dt=O*$,Ut=_*Z,Et=V*T,Ot=_*N,At=O*T,Bt=_*$,jt=b*T,Rt=S*R,Nt=L*E,Wt=d*R,Yt=L*w,Xt=d*E,cn=S*w,ln=u*R,fn=L*p,hn=u*E,dn=S*p,pn=u*w,wn=d*p,Yr=Q*w+_t*E+Tt*R-(wt*w+bt*E+Dt*R),Xr=wt*p+Ut*E+At*R-(Q*p+Et*E+Ot*R),Zr=bt*p+Et*w+Bt*R-(_t*p+Ut*w+jt*R),Kr=Dt*p+Ot*w+jt*E-(Tt*p+At*w+Bt*E),kt=1/(u*Yr+d*Xr+S*Zr+L*Kr);return i[0]=kt*Yr,i[1]=kt*Xr,i[2]=kt*Zr,i[3]=kt*Kr,i[4]=kt*(wt*d+bt*S+Dt*L-(Q*d+_t*S+Tt*L)),i[5]=kt*(Q*u+Et*S+Ot*L-(wt*u+Ut*S+At*L)),i[6]=kt*(_t*u+Ut*d+jt*L-(bt*u+Et*d+Bt*L)),i[7]=kt*(Tt*u+At*d+Bt*S-(Dt*u+Ot*d+jt*S)),i[8]=kt*(Rt*$+Yt*N+Xt*Z-(Nt*$+Wt*N+cn*Z)),i[9]=kt*(Nt*T+ln*N+dn*Z-(Rt*T+fn*N+hn*Z)),i[10]=kt*(Wt*T+fn*$+pn*Z-(Yt*T+ln*$+wn*Z)),i[11]=kt*(cn*T+hn*$+wn*N-(Xt*T+dn*$+pn*N)),i[12]=kt*(Wt*O+cn*V+Nt*b-(Xt*V+Rt*b+Yt*O)),i[13]=kt*(hn*V+Rt*_+fn*O-(ln*O+dn*V+Nt*_)),i[14]=kt*(ln*b+wn*V+Yt*_-(pn*V+Wt*_+fn*b)),i[15]=kt*(pn*O+Xt*_+dn*b-(hn*b+wn*O+cn*_)),i}function z(s){const h=s[0],i=s[0*4+1],u=s[0*4+2],p=s[0*4+3],_=s[1*4+0],T=s[1*4+1],d=s[1*4+2],w=s[1*4+3],b=s[2*4+0],$=s[2*4+1],S=s[2*4+2],E=s[2*4+3],O=s[3*4+0],N=s[3*4+1],L=s[3*4+2],R=s[3*4+3],V=S*R,Z=L*E,Q=d*R,wt=L*w,bt=d*E,_t=S*w,Tt=u*R,Dt=L*p,Ut=u*E,Et=S*p,Ot=u*w,At=d*p,Bt=V*T+wt*$+bt*N-(Z*T+Q*$+_t*N),jt=Z*i+Tt*$+Et*N-(V*i+Dt*$+Ut*N),Rt=Q*i+Dt*T+Ot*N-(wt*i+Tt*T+At*N),Nt=_t*i+Ut*T+At*$-(bt*i+Et*T+Ot*$);return h*Bt+_*jt+b*Rt+O*Nt}const j=B;function tt(s,h,i){const u=i??new t(16),p=s[0],_=s[1],T=s[2],d=s[3],w=s[4],b=s[5],$=s[6],S=s[7],E=s[8],O=s[9],N=s[10],L=s[11],R=s[12],V=s[13],Z=s[14],Q=s[15],wt=h[0],bt=h[1],_t=h[2],Tt=h[3],Dt=h[4],Ut=h[5],Et=h[6],Ot=h[7],At=h[8],Bt=h[9],jt=h[10],Rt=h[11],Nt=h[12],Wt=h[13],Yt=h[14],Xt=h[15];return u[0]=p*wt+w*bt+E*_t+R*Tt,u[1]=_*wt+b*bt+O*_t+V*Tt,u[2]=T*wt+$*bt+N*_t+Z*Tt,u[3]=d*wt+S*bt+L*_t+Q*Tt,u[4]=p*Dt+w*Ut+E*Et+R*Ot,u[5]=_*Dt+b*Ut+O*Et+V*Ot,u[6]=T*Dt+$*Ut+N*Et+Z*Ot,u[7]=d*Dt+S*Ut+L*Et+Q*Ot,u[8]=p*At+w*Bt+E*jt+R*Rt,u[9]=_*At+b*Bt+O*jt+V*Rt,u[10]=T*At+$*Bt+N*jt+Z*Rt,u[11]=d*At+S*Bt+L*jt+Q*Rt,u[12]=p*Nt+w*Wt+E*Yt+R*Xt,u[13]=_*Nt+b*Wt+O*Yt+V*Xt,u[14]=T*Nt+$*Wt+N*Yt+Z*Xt,u[15]=d*Nt+S*Wt+L*Yt+Q*Xt,u}const it=tt;function nt(s,h,i){const u=i??P();return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11]),u[12]=h[0],u[13]=h[1],u[14]=h[2],u[15]=1,u}function ot(s,h){const i=h??e.create();return i[0]=s[12],i[1]=s[13],i[2]=s[14],i}function rt(s,h,i){const u=i??e.create(),p=h*4;return u[0]=s[p+0],u[1]=s[p+1],u[2]=s[p+2],u}function dt(s,h,i,u){const p=u===s?u:v(s,u),_=i*4;return p[_+0]=h[0],p[_+1]=h[1],p[_+2]=h[2],p}function pt(s,h){const i=h??e.create(),u=s[0],p=s[1],_=s[2],T=s[4],d=s[5],w=s[6],b=s[8],$=s[9],S=s[10];return i[0]=Math.sqrt(u*u+p*p+_*_),i[1]=Math.sqrt(T*T+d*d+w*w),i[2]=Math.sqrt(b*b+$*$+S*S),i}function gt(s,h,i,u,p){const _=p??new t(16),T=Math.tan(Math.PI*.5-.5*s);if(_[0]=T/h,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,Number.isFinite(u)){const d=1/(i-u);_[10]=u*d,_[14]=u*i*d}else _[10]=-1,_[14]=-i;return _}function st(s,h,i,u=1/0,p){const _=p??new t(16),T=1/Math.tan(s*.5);if(_[0]=T/h,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,u===1/0)_[10]=0,_[14]=i;else{const d=1/(u-i);_[10]=i*d,_[14]=u*i*d}return _}function H(s,h,i,u,p,_,T){const d=T??new t(16);return d[0]=2/(h-s),d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=2/(u-i),d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1/(p-_),d[11]=0,d[12]=(h+s)/(s-h),d[13]=(u+i)/(i-u),d[14]=p/(p-_),d[15]=1,d}function Y(s,h,i,u,p,_,T){const d=T??new t(16),w=h-s,b=u-i,$=p-_;return d[0]=2*p/w,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=2*p/b,d[6]=0,d[7]=0,d[8]=(s+h)/w,d[9]=(u+i)/b,d[10]=_/$,d[11]=-1,d[12]=0,d[13]=0,d[14]=p*_/$,d[15]=0,d}function at(s,h,i,u,p,_=1/0,T){const d=T??new t(16),w=h-s,b=u-i;if(d[0]=2*p/w,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=2*p/b,d[6]=0,d[7]=0,d[8]=(s+h)/w,d[9]=(u+i)/b,d[11]=-1,d[12]=0,d[13]=0,d[15]=0,_===1/0)d[10]=0,d[14]=p;else{const $=1/(_-p);d[10]=p*$,d[14]=_*p*$}return d}const X=e.create(),et=e.create(),K=e.create();function re(s,h,i,u){const p=u??new t(16);return e.normalize(e.subtract(h,s,K),K),e.normalize(e.cross(i,K,X),X),e.normalize(e.cross(K,X,et),et),p[0]=X[0],p[1]=X[1],p[2]=X[2],p[3]=0,p[4]=et[0],p[5]=et[1],p[6]=et[2],p[7]=0,p[8]=K[0],p[9]=K[1],p[10]=K[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function Ft(s,h,i,u){const p=u??new t(16);return e.normalize(e.subtract(s,h,K),K),e.normalize(e.cross(i,K,X),X),e.normalize(e.cross(K,X,et),et),p[0]=X[0],p[1]=X[1],p[2]=X[2],p[3]=0,p[4]=et[0],p[5]=et[1],p[6]=et[2],p[7]=0,p[8]=K[0],p[9]=K[1],p[10]=K[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function se(s,h,i,u){const p=u??new t(16);return e.normalize(e.subtract(s,h,K),K),e.normalize(e.cross(i,K,X),X),e.normalize(e.cross(K,X,et),et),p[0]=X[0],p[1]=et[0],p[2]=K[0],p[3]=0,p[4]=X[1],p[5]=et[1],p[6]=K[1],p[7]=0,p[8]=X[2],p[9]=et[2],p[10]=K[2],p[11]=0,p[12]=-(X[0]*s[0]+X[1]*s[1]+X[2]*s[2]),p[13]=-(et[0]*s[0]+et[1]*s[1]+et[2]*s[2]),p[14]=-(K[0]*s[0]+K[1]*s[1]+K[2]*s[2]),p[15]=1,p}function zt(s,h){const i=h??new t(16);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i}function ie(s,h,i){const u=i??new t(16),p=h[0],_=h[1],T=h[2],d=s[0],w=s[1],b=s[2],$=s[3],S=s[1*4+0],E=s[1*4+1],O=s[1*4+2],N=s[1*4+3],L=s[2*4+0],R=s[2*4+1],V=s[2*4+2],Z=s[2*4+3],Q=s[3*4+0],wt=s[3*4+1],bt=s[3*4+2],_t=s[3*4+3];return s!==u&&(u[0]=d,u[1]=w,u[2]=b,u[3]=$,u[4]=S,u[5]=E,u[6]=O,u[7]=N,u[8]=L,u[9]=R,u[10]=V,u[11]=Z),u[12]=d*p+S*_+L*T+Q,u[13]=w*p+E*_+R*T+wt,u[14]=b*p+O*_+V*T+bt,u[15]=$*p+N*_+Z*T+_t,u}function ct(s,h){const i=h??new t(16),u=Math.cos(s),p=Math.sin(s);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=p,i[7]=0,i[8]=0,i[9]=-p,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oe(s,h,i){const u=i??new t(16),p=s[4],_=s[5],T=s[6],d=s[7],w=s[8],b=s[9],$=s[10],S=s[11],E=Math.cos(h),O=Math.sin(h);return u[4]=E*p+O*w,u[5]=E*_+O*b,u[6]=E*T+O*$,u[7]=E*d+O*S,u[8]=E*w-O*p,u[9]=E*b-O*_,u[10]=E*$-O*T,u[11]=E*S-O*d,s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Lt(s,h){const i=h??new t(16),u=Math.cos(s),p=Math.sin(s);return i[0]=u,i[1]=0,i[2]=-p,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=p,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ae(s,h,i){const u=i??new t(16),p=s[0*4+0],_=s[0*4+1],T=s[0*4+2],d=s[0*4+3],w=s[2*4+0],b=s[2*4+1],$=s[2*4+2],S=s[2*4+3],E=Math.cos(h),O=Math.sin(h);return u[0]=E*p-O*w,u[1]=E*_-O*b,u[2]=E*T-O*$,u[3]=E*d-O*S,u[8]=E*w+O*p,u[9]=E*b+O*_,u[10]=E*$+O*T,u[11]=E*S+O*d,s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Gt(s,h){const i=h??new t(16),u=Math.cos(s),p=Math.sin(s);return i[0]=u,i[1]=p,i[2]=0,i[3]=0,i[4]=-p,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Jt(s,h,i){const u=i??new t(16),p=s[0*4+0],_=s[0*4+1],T=s[0*4+2],d=s[0*4+3],w=s[1*4+0],b=s[1*4+1],$=s[1*4+2],S=s[1*4+3],E=Math.cos(h),O=Math.sin(h);return u[0]=E*p+O*w,u[1]=E*_+O*b,u[2]=E*T+O*$,u[3]=E*d+O*S,u[4]=E*w-O*p,u[5]=E*b-O*_,u[6]=E*$-O*T,u[7]=E*S-O*d,s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Ct(s,h,i){const u=i??new t(16);let p=s[0],_=s[1],T=s[2];const d=Math.sqrt(p*p+_*_+T*T);p/=d,_/=d,T/=d;const w=p*p,b=_*_,$=T*T,S=Math.cos(h),E=Math.sin(h),O=1-S;return u[0]=w+(1-w)*S,u[1]=p*_*O+T*E,u[2]=p*T*O-_*E,u[3]=0,u[4]=p*_*O-T*E,u[5]=b+(1-b)*S,u[6]=_*T*O+p*E,u[7]=0,u[8]=p*T*O+_*E,u[9]=_*T*O-p*E,u[10]=$+(1-$)*S,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}const c=Ct;function g(s,h,i,u){const p=u??new t(16);let _=h[0],T=h[1],d=h[2];const w=Math.sqrt(_*_+T*T+d*d);_/=w,T/=w,d/=w;const b=_*_,$=T*T,S=d*d,E=Math.cos(i),O=Math.sin(i),N=1-E,L=b+(1-b)*E,R=_*T*N+d*O,V=_*d*N-T*O,Z=_*T*N-d*O,Q=$+(1-$)*E,wt=T*d*N+_*O,bt=_*d*N+T*O,_t=T*d*N-_*O,Tt=S+(1-S)*E,Dt=s[0],Ut=s[1],Et=s[2],Ot=s[3],At=s[4],Bt=s[5],jt=s[6],Rt=s[7],Nt=s[8],Wt=s[9],Yt=s[10],Xt=s[11];return p[0]=L*Dt+R*At+V*Nt,p[1]=L*Ut+R*Bt+V*Wt,p[2]=L*Et+R*jt+V*Yt,p[3]=L*Ot+R*Rt+V*Xt,p[4]=Z*Dt+Q*At+wt*Nt,p[5]=Z*Ut+Q*Bt+wt*Wt,p[6]=Z*Et+Q*jt+wt*Yt,p[7]=Z*Ot+Q*Rt+wt*Xt,p[8]=bt*Dt+_t*At+Tt*Nt,p[9]=bt*Ut+_t*Bt+Tt*Wt,p[10]=bt*Et+_t*jt+Tt*Yt,p[11]=bt*Ot+_t*Rt+Tt*Xt,s!==p&&(p[12]=s[12],p[13]=s[13],p[14]=s[14],p[15]=s[15]),p}const a=g;function l(s,h){const i=h??new t(16);return i[0]=s[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function m(s,h,i){const u=i??new t(16),p=h[0],_=h[1],T=h[2];return u[0]=p*s[0*4+0],u[1]=p*s[0*4+1],u[2]=p*s[0*4+2],u[3]=p*s[0*4+3],u[4]=_*s[1*4+0],u[5]=_*s[1*4+1],u[6]=_*s[1*4+2],u[7]=_*s[1*4+3],u[8]=T*s[2*4+0],u[9]=T*s[2*4+1],u[10]=T*s[2*4+2],u[11]=T*s[2*4+3],s!==u&&(u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function x(s,h){const i=h??new t(16);return i[0]=s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function M(s,h,i){const u=i??new t(16);return u[0]=h*s[0*4+0],u[1]=h*s[0*4+1],u[2]=h*s[0*4+2],u[3]=h*s[0*4+3],u[4]=h*s[1*4+0],u[5]=h*s[1*4+1],u[6]=h*s[1*4+2],u[7]=h*s[1*4+3],u[8]=h*s[2*4+0],u[9]=h*s[2*4+1],u[10]=h*s[2*4+2],u[11]=h*s[2*4+3],s!==u&&(u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}return{create:n,set:r,fromMat3:o,fromQuat:f,negate:y,copy:v,clone:U,equalsApproximately:D,equals:k,identity:P,transpose:F,inverse:B,determinant:z,invert:j,multiply:tt,mul:it,setTranslation:nt,getTranslation:ot,getAxis:rt,setAxis:dt,getScaling:pt,perspective:gt,perspectiveReverseZ:st,ortho:H,frustum:Y,frustumReverseZ:at,aim:re,cameraAim:Ft,lookAt:se,translation:zt,translate:ie,rotationX:ct,rotateX:oe,rotationY:Lt,rotateY:ae,rotationZ:Gt,rotateZ:Jt,axisRotation:Ct,rotation:c,axisRotate:g,rotate:a,scaling:l,scale:m,uniformScaling:x,uniformScale:M}}const ls=new Map;function Du(t){let e=ls.get(t);return e||(e=Tu(t),ls.set(t,e)),e}function Uu(t){const e=ir(t);function n(c,g,a,l){const m=new t(4);return c!==void 0&&(m[0]=c,g!==void 0&&(m[1]=g,a!==void 0&&(m[2]=a,l!==void 0&&(m[3]=l)))),m}const r=n;function o(c,g,a,l,m){const x=m??new t(4);return x[0]=c,x[1]=g,x[2]=a,x[3]=l,x}function f(c,g,a){const l=a??new t(4),m=g*.5,x=Math.sin(m);return l[0]=x*c[0],l[1]=x*c[1],l[2]=x*c[2],l[3]=Math.cos(m),l}function y(c,g){const a=g??e.create(3),l=Math.acos(c[3])*2,m=Math.sin(l*.5);return m>W?(a[0]=c[0]/m,a[1]=c[1]/m,a[2]=c[2]/m):(a[0]=1,a[1]=0,a[2]=0),{angle:l,axis:a}}function v(c,g){const a=Y(c,g);return Math.acos(2*a*a-1)}function U(c,g,a){const l=a??new t(4),m=c[0],x=c[1],M=c[2],s=c[3],h=g[0],i=g[1],u=g[2],p=g[3];return l[0]=m*p+s*h+x*u-M*i,l[1]=x*p+s*i+M*h-m*u,l[2]=M*p+s*u+m*i-x*h,l[3]=s*p-m*h-x*i-M*u,l}const D=U;function k(c,g,a){const l=a??new t(4),m=g*.5,x=c[0],M=c[1],s=c[2],h=c[3],i=Math.sin(m),u=Math.cos(m);return l[0]=x*u+h*i,l[1]=M*u+s*i,l[2]=s*u-M*i,l[3]=h*u-x*i,l}function P(c,g,a){const l=a??new t(4),m=g*.5,x=c[0],M=c[1],s=c[2],h=c[3],i=Math.sin(m),u=Math.cos(m);return l[0]=x*u-s*i,l[1]=M*u+h*i,l[2]=s*u+x*i,l[3]=h*u-M*i,l}function F(c,g,a){const l=a??new t(4),m=g*.5,x=c[0],M=c[1],s=c[2],h=c[3],i=Math.sin(m),u=Math.cos(m);return l[0]=x*u+M*i,l[1]=M*u-x*i,l[2]=s*u+h*i,l[3]=h*u-s*i,l}function B(c,g,a,l){const m=l??new t(4),x=c[0],M=c[1],s=c[2],h=c[3];let i=g[0],u=g[1],p=g[2],_=g[3],T=x*i+M*u+s*p+h*_;T<0&&(T=-T,i=-i,u=-u,p=-p,_=-_);let d,w;if(1-T>W){const b=Math.acos(T),$=Math.sin(b);d=Math.sin((1-a)*b)/$,w=Math.sin(a*b)/$}else d=1-a,w=a;return m[0]=d*x+w*i,m[1]=d*M+w*u,m[2]=d*s+w*p,m[3]=d*h+w*_,m}function z(c,g){const a=g??new t(4),l=c[0],m=c[1],x=c[2],M=c[3],s=l*l+m*m+x*x+M*M,h=s?1/s:0;return a[0]=-l*h,a[1]=-m*h,a[2]=-x*h,a[3]=M*h,a}function j(c,g){const a=g??new t(4);return a[0]=-c[0],a[1]=-c[1],a[2]=-c[2],a[3]=c[3],a}function tt(c,g){const a=g??new t(4),l=c[0]+c[5]+c[10];if(l>0){const m=Math.sqrt(l+1);a[3]=.5*m;const x=.5/m;a[0]=(c[6]-c[9])*x,a[1]=(c[8]-c[2])*x,a[2]=(c[1]-c[4])*x}else{let m=0;c[5]>c[0]&&(m=1),c[10]>c[m*4+m]&&(m=2);const x=(m+1)%3,M=(m+2)%3,s=Math.sqrt(c[m*4+m]-c[x*4+x]-c[M*4+M]+1);a[m]=.5*s;const h=.5/s;a[3]=(c[x*4+M]-c[M*4+x])*h,a[x]=(c[x*4+m]+c[m*4+x])*h,a[M]=(c[M*4+m]+c[m*4+M])*h}return a}function it(c,g,a,l,m){const x=m??new t(4),M=c*.5,s=g*.5,h=a*.5,i=Math.sin(M),u=Math.cos(M),p=Math.sin(s),_=Math.cos(s),T=Math.sin(h),d=Math.cos(h);switch(l){case"xyz":x[0]=i*_*d+u*p*T,x[1]=u*p*d-i*_*T,x[2]=u*_*T+i*p*d,x[3]=u*_*d-i*p*T;break;case"xzy":x[0]=i*_*d-u*p*T,x[1]=u*p*d-i*_*T,x[2]=u*_*T+i*p*d,x[3]=u*_*d+i*p*T;break;case"yxz":x[0]=i*_*d+u*p*T,x[1]=u*p*d-i*_*T,x[2]=u*_*T-i*p*d,x[3]=u*_*d+i*p*T;break;case"yzx":x[0]=i*_*d+u*p*T,x[1]=u*p*d+i*_*T,x[2]=u*_*T-i*p*d,x[3]=u*_*d-i*p*T;break;case"zxy":x[0]=i*_*d-u*p*T,x[1]=u*p*d+i*_*T,x[2]=u*_*T+i*p*d,x[3]=u*_*d-i*p*T;break;case"zyx":x[0]=i*_*d-u*p*T,x[1]=u*p*d+i*_*T,x[2]=u*_*T-i*p*d,x[3]=u*_*d+i*p*T;break;default:throw new Error(`Unknown rotation order: ${l}`)}return x}function nt(c,g){const a=g??new t(4);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a}const ot=nt;function rt(c,g,a){const l=a??new t(4);return l[0]=c[0]+g[0],l[1]=c[1]+g[1],l[2]=c[2]+g[2],l[3]=c[3]+g[3],l}function dt(c,g,a){const l=a??new t(4);return l[0]=c[0]-g[0],l[1]=c[1]-g[1],l[2]=c[2]-g[2],l[3]=c[3]-g[3],l}const pt=dt;function gt(c,g,a){const l=a??new t(4);return l[0]=c[0]*g,l[1]=c[1]*g,l[2]=c[2]*g,l[3]=c[3]*g,l}const st=gt;function H(c,g,a){const l=a??new t(4);return l[0]=c[0]/g,l[1]=c[1]/g,l[2]=c[2]/g,l[3]=c[3]/g,l}function Y(c,g){return c[0]*g[0]+c[1]*g[1]+c[2]*g[2]+c[3]*g[3]}function at(c,g,a,l){const m=l??new t(4);return m[0]=c[0]+a*(g[0]-c[0]),m[1]=c[1]+a*(g[1]-c[1]),m[2]=c[2]+a*(g[2]-c[2]),m[3]=c[3]+a*(g[3]-c[3]),m}function X(c){const g=c[0],a=c[1],l=c[2],m=c[3];return Math.sqrt(g*g+a*a+l*l+m*m)}const et=X;function K(c){const g=c[0],a=c[1],l=c[2],m=c[3];return g*g+a*a+l*l+m*m}const re=K;function Ft(c,g){const a=g??new t(4),l=c[0],m=c[1],x=c[2],M=c[3],s=Math.sqrt(l*l+m*m+x*x+M*M);return s>1e-5?(a[0]=l/s,a[1]=m/s,a[2]=x/s,a[3]=M/s):(a[0]=0,a[1]=0,a[2]=0,a[3]=1),a}function se(c,g){return Math.abs(c[0]-g[0])<W&&Math.abs(c[1]-g[1])<W&&Math.abs(c[2]-g[2])<W&&Math.abs(c[3]-g[3])<W}function zt(c,g){return c[0]===g[0]&&c[1]===g[1]&&c[2]===g[2]&&c[3]===g[3]}function ie(c){const g=c??new t(4);return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g}const ct=e.create(),oe=e.create(),Lt=e.create();function ae(c,g,a){const l=a??new t(4),m=e.dot(c,g);return m<-.999999?(e.cross(oe,c,ct),e.len(ct)<1e-6&&e.cross(Lt,c,ct),e.normalize(ct,ct),f(ct,Math.PI,l),l):m>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(e.cross(c,g,ct),l[0]=ct[0],l[1]=ct[1],l[2]=ct[2],l[3]=1+m,Ft(l,l))}const Gt=new t(4),Jt=new t(4);function Ct(c,g,a,l,m,x){const M=x??new t(4);return B(c,l,m,Gt),B(g,a,m,Jt),B(Gt,Jt,2*m*(1-m),M),M}return{create:n,fromValues:r,set:o,fromAxisAngle:f,toAxisAngle:y,angle:v,multiply:U,mul:D,rotateX:k,rotateY:P,rotateZ:F,slerp:B,inverse:z,conjugate:j,fromMat:tt,fromEuler:it,copy:nt,clone:ot,add:rt,subtract:dt,sub:pt,mulScalar:gt,scale:st,divScalar:H,dot:Y,lerp:at,length:X,len:et,lengthSq:K,lenSq:re,normalize:Ft,equalsApproximately:se,equals:zt,identity:ie,rotationTo:ae,sqlerp:Ct}}const fs=new Map;function Eu(t){let e=fs.get(t);return e||(e=Uu(t),fs.set(t,e)),e}function Ou(t){function e(a,l,m,x){const M=new t(4);return a!==void 0&&(M[0]=a,l!==void 0&&(M[1]=l,m!==void 0&&(M[2]=m,x!==void 0&&(M[3]=x)))),M}const n=e;function r(a,l,m,x,M){const s=M??new t(4);return s[0]=a,s[1]=l,s[2]=m,s[3]=x,s}function o(a,l){const m=l??new t(4);return m[0]=Math.ceil(a[0]),m[1]=Math.ceil(a[1]),m[2]=Math.ceil(a[2]),m[3]=Math.ceil(a[3]),m}function f(a,l){const m=l??new t(4);return m[0]=Math.floor(a[0]),m[1]=Math.floor(a[1]),m[2]=Math.floor(a[2]),m[3]=Math.floor(a[3]),m}function y(a,l){const m=l??new t(4);return m[0]=Math.round(a[0]),m[1]=Math.round(a[1]),m[2]=Math.round(a[2]),m[3]=Math.round(a[3]),m}function v(a,l=0,m=1,x){const M=x??new t(4);return M[0]=Math.min(m,Math.max(l,a[0])),M[1]=Math.min(m,Math.max(l,a[1])),M[2]=Math.min(m,Math.max(l,a[2])),M[3]=Math.min(m,Math.max(l,a[3])),M}function U(a,l,m){const x=m??new t(4);return x[0]=a[0]+l[0],x[1]=a[1]+l[1],x[2]=a[2]+l[2],x[3]=a[3]+l[3],x}function D(a,l,m,x){const M=x??new t(4);return M[0]=a[0]+l[0]*m,M[1]=a[1]+l[1]*m,M[2]=a[2]+l[2]*m,M[3]=a[3]+l[3]*m,M}function k(a,l,m){const x=m??new t(4);return x[0]=a[0]-l[0],x[1]=a[1]-l[1],x[2]=a[2]-l[2],x[3]=a[3]-l[3],x}const P=k;function F(a,l){return Math.abs(a[0]-l[0])<W&&Math.abs(a[1]-l[1])<W&&Math.abs(a[2]-l[2])<W&&Math.abs(a[3]-l[3])<W}function B(a,l){return a[0]===l[0]&&a[1]===l[1]&&a[2]===l[2]&&a[3]===l[3]}function z(a,l,m,x){const M=x??new t(4);return M[0]=a[0]+m*(l[0]-a[0]),M[1]=a[1]+m*(l[1]-a[1]),M[2]=a[2]+m*(l[2]-a[2]),M[3]=a[3]+m*(l[3]-a[3]),M}function j(a,l,m,x){const M=x??new t(4);return M[0]=a[0]+m[0]*(l[0]-a[0]),M[1]=a[1]+m[1]*(l[1]-a[1]),M[2]=a[2]+m[2]*(l[2]-a[2]),M[3]=a[3]+m[3]*(l[3]-a[3]),M}function tt(a,l,m){const x=m??new t(4);return x[0]=Math.max(a[0],l[0]),x[1]=Math.max(a[1],l[1]),x[2]=Math.max(a[2],l[2]),x[3]=Math.max(a[3],l[3]),x}function it(a,l,m){const x=m??new t(4);return x[0]=Math.min(a[0],l[0]),x[1]=Math.min(a[1],l[1]),x[2]=Math.min(a[2],l[2]),x[3]=Math.min(a[3],l[3]),x}function nt(a,l,m){const x=m??new t(4);return x[0]=a[0]*l,x[1]=a[1]*l,x[2]=a[2]*l,x[3]=a[3]*l,x}const ot=nt;function rt(a,l,m){const x=m??new t(4);return x[0]=a[0]/l,x[1]=a[1]/l,x[2]=a[2]/l,x[3]=a[3]/l,x}function dt(a,l){const m=l??new t(4);return m[0]=1/a[0],m[1]=1/a[1],m[2]=1/a[2],m[3]=1/a[3],m}const pt=dt;function gt(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3]}function st(a){const l=a[0],m=a[1],x=a[2],M=a[3];return Math.sqrt(l*l+m*m+x*x+M*M)}const H=st;function Y(a){const l=a[0],m=a[1],x=a[2],M=a[3];return l*l+m*m+x*x+M*M}const at=Y;function X(a,l){const m=a[0]-l[0],x=a[1]-l[1],M=a[2]-l[2],s=a[3]-l[3];return Math.sqrt(m*m+x*x+M*M+s*s)}const et=X;function K(a,l){const m=a[0]-l[0],x=a[1]-l[1],M=a[2]-l[2],s=a[3]-l[3];return m*m+x*x+M*M+s*s}const re=K;function Ft(a,l){const m=l??new t(4),x=a[0],M=a[1],s=a[2],h=a[3],i=Math.sqrt(x*x+M*M+s*s+h*h);return i>1e-5?(m[0]=x/i,m[1]=M/i,m[2]=s/i,m[3]=h/i):(m[0]=0,m[1]=0,m[2]=0,m[3]=0),m}function se(a,l){const m=l??new t(4);return m[0]=-a[0],m[1]=-a[1],m[2]=-a[2],m[3]=-a[3],m}function zt(a,l){const m=l??new t(4);return m[0]=a[0],m[1]=a[1],m[2]=a[2],m[3]=a[3],m}const ie=zt;function ct(a,l,m){const x=m??new t(4);return x[0]=a[0]*l[0],x[1]=a[1]*l[1],x[2]=a[2]*l[2],x[3]=a[3]*l[3],x}const oe=ct;function Lt(a,l,m){const x=m??new t(4);return x[0]=a[0]/l[0],x[1]=a[1]/l[1],x[2]=a[2]/l[2],x[3]=a[3]/l[3],x}const ae=Lt;function Gt(a){const l=a??new t(4);return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l}function Jt(a,l,m){const x=m??new t(4),M=a[0],s=a[1],h=a[2],i=a[3];return x[0]=l[0]*M+l[4]*s+l[8]*h+l[12]*i,x[1]=l[1]*M+l[5]*s+l[9]*h+l[13]*i,x[2]=l[2]*M+l[6]*s+l[10]*h+l[14]*i,x[3]=l[3]*M+l[7]*s+l[11]*h+l[15]*i,x}function Ct(a,l,m){const x=m??new t(4);return Ft(a,x),nt(x,l,x)}function c(a,l,m){const x=m??new t(4);return st(a)>l?Ct(a,l,x):zt(a,x)}function g(a,l,m){const x=m??new t(4);return z(a,l,.5,x)}return{create:e,fromValues:n,set:r,ceil:o,floor:f,round:y,clamp:v,add:U,addScaled:D,subtract:k,sub:P,equalsApproximately:F,equals:B,lerp:z,lerpV:j,max:tt,min:it,mulScalar:nt,scale:ot,divScalar:rt,inverse:dt,invert:pt,dot:gt,length:st,len:H,lengthSq:Y,lenSq:at,distance:X,dist:et,distanceSq:K,distSq:re,normalize:Ft,negate:se,copy:zt,clone:ie,multiply:ct,mul:oe,divide:Lt,div:ae,zero:Gt,transformMat4:Jt,setLength:Ct,truncate:c,midpoint:g}}const hs=new Map;function Au(t){let e=hs.get(t);return e||(e=Ou(t),hs.set(t,e)),e}function zr(t,e,n,r,o,f){return{mat3:Mu(t),mat4:Du(e),quat:Eu(n),vec2:gi(r),vec3:ir(o),vec4:Au(f)}}const{mat3:ku,mat4:Iu,quat:pf,vec2:ft,vec3:Pu,vec4:wf}=zr(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);zr(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);zr(bu,Array,Array,Array,Array,Array);const{sign:xi,sqrt:Wn,abs:ds,min:Fu,max:zu}=Math;function vi(){return new Promise(t=>requestAnimationFrame(t))}function br({x:t,y:e}){return q(-e,t)}function Bu(t,e,n,r,o){return q(t.x+e.x*n+r.x*o,t.y+e.y*n+r.y*o)}function bi(t){const e=Wn(t.x*t.x+t.y*t.y)||1;return q(t.x/e,t.y/e)}const[ce,_i]=xu([]),[$i,ju]=qt(!1);function Ru(t){const n=de(ce).findIndex(r=>ft.distance(r.center,t)<r.radius);return n===-1?(_i(mi(r=>{r.push({center:t,radius:0})})),ce.length-1):n}function Nu(t){const e=de(ce);let n=Number.POSITIVE_INFINITY,r;const{center:o}=e[t];for(let y=0;y<e.length;++y){if(y===t)continue;const v=e[y],U=ft.distance(v.center,o)-v.radius;U<n&&(n=U,r=y)}return{index:r,radius:n,curve:()=>o}}function Vu(t,e,n){const r=ft.sub(e.center,t.center,q()),o=e.radius-t.radius,f=ft.dot(r,r),y=ft.dot(n,r);return(f-o*o)/(2*(y+o*ft.length(n)))-t.radius}function Lu(t,e){const n=de(ce),r=n[t],o=n[e],f=bi(ft.sub(o.center,r.center,q()));let y=Number.POSITIVE_INFINITY,v;for(let D=0;D<n.length;++D){if(D===t||D===e)continue;const k=n[D],P=Vu(r,k,f);P>=-r.radius/2&&P<y&&(y=P,v=D)}return{index:v,radius:y,curve:D=>ft.addScaled(r.center,f,r.radius+D,q())}}function Gu(t,e,n,r){t.radius<e.radius&&([t,e]=[e,t]);const o=t.radius,f=e.radius,y=n.radius;if(o===f)throw new Error("Not Implemented when radii are the same");const v=ft.sub(e.center,t.center,q()),U=bi(v),D=br(U),k=ft.sub(n.center,t.center,q()),P=ft.lengthSq(k),F=xi(ft.dot(D,ft.sub(r.center,t.center,q()))),B=ft.dot(U,k),z=ft.dot(D,k)*F,j=ft.length(v),tt=j/(o-f),it=(o-f)/2-j*j/(2*(o-f)),nt=tt*tt,ot=z*z,rt=y-o,dt=rt*rt,pt=P-dt,gt=ot-dt,st=tt*(2*it*gt+rt*pt)+B*(pt-2*it*rt),H=pt*((nt-1)*pt+4*it*(tt*B+it+rt));if(H<0||Number.isNaN(H))return Number.POSITIVE_INFINITY;const Y=2*(2*tt*rt*B+P-nt*gt),at=(st-z*Wn(H))/Y,X=Wn((tt*at+it)**2-at*at),et=tt*at+it-o;return at<j/2||ds(ft.distance([at,X],[B,z])-y-et)>ds(ft.distance([at,-X],[B,z])-y-et)?Number.POSITIVE_INFINITY:et}function qu(t,e,n,r){t.radius>e.radius&&([t,e]=[e,t]);const o=ft.sub(e.center,t.center,q()),f=ft.length(o),y=t.radius,v=e.radius,U=n,D=(y*y-v*v+2*(y-v)*U+f*f)/(2*f),k=(y+U)**2-D*D;if(k<0)return;const P=ft.scale(o,1/f,q()),F=br(P),B=Wn(k),z=xi(ft.dot(br(o),ft.sub(r.center,t.center,q())));return Bu(t.center,P,D,F,B*z)}function Cu(t,e,n){const r=de(ce),o=r[n],f=r[t],y=r[e];let v=Number.POSITIVE_INFINITY,U;for(let k=0;k<ce.length;++k){if(k===n||k===t||k===e)continue;const P=r[k],F=Gu(f,y,P,o);F!==void 0&&F<v&&(v=zu(F,o.radius),U=k)}return{index:U,radius:v,curve:k=>qu(f,y,k,o)}}async function fr(t,e,n,r,o){const f=ce[t];for(;;){if(await Promise.race([vi(),o])instanceof PointerEvent)return;const v=Fu(e,f.radius*1.025+.004/r()),U=n(v);if(!U||(_i(t,mi(D=>{D.radius=v,D.center=U})),v===e))return}}const Si=Tr(),Wu=Si.Provider;function or(){return Er(Si,"useCanvas","CanvasContext")}function Yu(){let t,e;return{promise:new Promise((r,o)=>{t=r,e=o}),resolve:t,reject:e}}var Br=class{constructor(){A(this,"lastUniqueId",0)}makeUnique(t){let e;return t?(e=t.replaceAll(/\s/g,"_"),e=e.replaceAll(/[^\w\d]/g,"")):e="item",`${e}_${this.lastUniqueId++}`}},jr=class{constructor(){A(this,"_usedNames",new Set)}makeUnique(t){if(t===void 0)throw new Error("Unnamed item found when using a strict name registry");let e=0,n=t;for(;this._usedNames.has(n);)e++,n=`${t}_${e}`;return this._usedNames.add(n),n}};function Rr(t){return t?.resourceType==="slot"}function Mi(t){return t?.resourceType==="derived"}function Nr(t){return t?.resourceType==="accessor"}function Xu(t,e){let n="size"in t?t.size:t.currentByteOffset,r=e-1,o=n&r;"skipBytes"in t?t.skipBytes(e-o&r):t.add(e-o&r)}var $t=Xu,le={bool(t,e,n){t.writeBool(n)},f32(t,e,n){t.writeFloat32(n)},f16(t,e,n){t.writeFloat16(n)},i32(t,e,n){t.writeInt32(n)},u32(t,e,n){t.writeUint32(n)},vec2f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y)},vec2h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y)},vec2i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y)},vec2u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y)},vec3f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z)},vec3h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z)},vec3i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z)},vec3u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z)},vec4f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z),t.writeFloat32(n.w)},vec4h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z),t.writeFloat16(n.w)},vec4i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z),t.writeInt32(n.w)},vec4u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z),t.writeUint32(n.w)},mat2x2f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},mat3x3f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},mat4x4f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},struct(t,e,n){let r=St(e);$t(t,r);for(let[o,f]of Object.entries(e.propTypes))$t(t,St(f)),He(t,f,n[o]);$t(t,r)},array(t,e,n){if(e.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let r=St(e);$t(t,r);let o=t.currentByteOffset;for(let f=0;f<Math.min(e.elementCount,n.length);f++)$t(t,r),He(t,e.elementType,n[f]);t.seekTo(o+mt(e))},atomic(t,e,n){var r;(r=le[e.inner.type])==null||r.call(le,t,e,n)},decorated(t,e,n){var r,o;let f=ue(e);$t(t,f);let y=t.currentByteOffset;(o=le[(r=e.inner)==null?void 0:r.type])==null||o.call(le,t,e.inner,n),t.seekTo(y+mt(e))},uint8(t,e,n){t.writeUint8(n)},uint8x2(t,e,n){t.writeUint8(n.x),t.writeUint8(n.y)},uint8x4(t,e,n){t.writeUint8(n.x),t.writeUint8(n.y),t.writeUint8(n.z),t.writeUint8(n.w)},sint8(t,e,n){t.writeInt8(n)},sint8x2(t,e,n){t.writeInt8(n.x),t.writeInt8(n.y)},sint8x4(t,e,n){t.writeInt8(n.x),t.writeInt8(n.y),t.writeInt8(n.z),t.writeInt8(n.w)},unorm8(t,e,n){t.writeUint8(n*255)},unorm8x2(t,e,n){t.writeUint8(n.x*255),t.writeUint8(n.y*255)},unorm8x4(t,e,n){t.writeUint8(n.x*255),t.writeUint8(n.y*255),t.writeUint8(n.z*255),t.writeUint8(n.w*255)},snorm8(t,e,n){t.writeUint8(n*127+128)},snorm8x2(t,e,n){t.writeUint8(n.x*127+128),t.writeUint8(n.y*127+128)},snorm8x4(t,e,n){t.writeUint8(n.x*127+128),t.writeUint8(n.y*127+128),t.writeUint8(n.z*127+128),t.writeUint8(n.w*127+128)},uint16(t,e,n){t.writeUint16(n)},uint16x2(t,e,n){t.writeUint16(n.x),t.writeUint16(n.y)},uint16x4(t,e,n){t.writeUint16(n.x),t.writeUint16(n.y),t.writeUint16(n.z),t.writeUint16(n.w)},sint16(t,e,n){t.writeInt16(n)},sint16x2(t,e,n){t.writeInt16(n.x),t.writeInt16(n.y)},sint16x4(t,e,n){t.writeInt16(n.x),t.writeInt16(n.y),t.writeInt16(n.z),t.writeInt16(n.w)},unorm16(t,e,n){t.writeUint16(n*65535)},unorm16x2(t,e,n){t.writeUint16(n.x*65535),t.writeUint16(n.y*65535)},unorm16x4(t,e,n){t.writeUint16(n.x*65535),t.writeUint16(n.y*65535),t.writeUint16(n.z*65535),t.writeUint16(n.w*65535)},snorm16(t,e,n){t.writeUint16(n*32767+32768)},snorm16x2(t,e,n){t.writeUint16(n.x*32767+32768),t.writeUint16(n.y*32767+32768)},snorm16x4(t,e,n){t.writeUint16(n.x*32767+32768),t.writeUint16(n.y*32767+32768),t.writeUint16(n.z*32767+32768),t.writeUint16(n.w*32767+32768)},float16(t,e,n){t.writeFloat16(n)},float16x2(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y)},float16x4(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z),t.writeFloat16(n.w)},float32(t,e,n){t.writeFloat32(n)},float32x2(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y)},float32x3(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z)},float32x4(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z),t.writeFloat32(n.w)},uint32(t,e,n){t.writeUint32(n)},uint32x2(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y)},uint32x3(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z)},uint32x4(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z),t.writeUint32(n.w)},sint32(t,e,n){t.writeInt32(n)},sint32x2(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y)},sint32x3(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z)},sint32x4(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z),t.writeInt32(n.w)},"unorm10-10-10-2"(t,e,n){let r=0;r|=(n.x*1023&1023)<<22,r|=(n.x*1023&1023)<<12,r|=(n.y*1023&1023)<<2,r|=n.z*3&3,t.writeUint32(r)},"unorm8x4-bgra"(t,e,n){t.writeUint8(n.z*255),t.writeUint8(n.y*255),t.writeUint8(n.x*255),t.writeUint8(n.w*255)},disarray(t,e,n){var r,o;let f=St(e);$t(t,f);let y=t.currentByteOffset;for(let v=0;v<Math.min(e.elementCount,n.length);v++)$t(t,f),(o=le[(r=e.elementType)==null?void 0:r.type])==null||o.call(le,t,e.elementType,n[v]);t.seekTo(y+mt(e))},unstruct(t,e,n){var r;for(let[o,f]of Object.entries(e.propTypes))(r=le[f.type])==null||r.call(le,t,f,n[o])},"loose-decorated"(t,e,n){var r;let o=ue(e);$t(t,o);let f=t.currentByteOffset,y=le[(r=e.inner)==null?void 0:r.type];return y?.(t,e.inner,n),t.seekTo(f+mt(e)),n}};function He(t,e,n){let r=le[e.type];if(!r)throw new Error(`Cannot write data of type '${e.type}'.`);r(t,e,n)}var Me={bool(t){return t.readBool()},f32(t){return t.readFloat32()},f16(t){return t.readFloat16()},i32(t){return t.readInt32()},u32(t){return t.readUint32()},vec2f(t){return q(t.readFloat32(),t.readFloat32())},vec3f(t){return tn(t.readFloat32(),t.readFloat32(),t.readFloat32())},vec4f(t){return G(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},vec2h(t){return Io(t.readFloat16(),t.readFloat16())},vec3h(t){return Po(t.readFloat16(),t.readFloat16(),t.readFloat16())},vec4h(t){return Fo(t.readFloat16(),t.readFloat16(),t.readFloat16(),t.readFloat16())},vec2i(t){return Ue(t.readInt32(),t.readInt32())},vec3i(t){return xr(t.readInt32(),t.readInt32(),t.readInt32())},vec4i(t){return te(t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32())},vec2u(t){return Ee(t.readUint32(),t.readUint32())},vec3u(t){return Oe(t.readUint32(),t.readUint32(),t.readUint32())},vec4u(t){return ee(t.readUint32(),t.readUint32(),t.readUint32(),t.readUint32())},mat2x2f(t){return fu(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},mat3x3f(t){let e=()=>{let n=t.readFloat32();return t.readFloat32(),n};return nn(t.readFloat32(),t.readFloat32(),e(),t.readFloat32(),t.readFloat32(),e(),t.readFloat32(),t.readFloat32(),e())},mat4x4f(t){return ui(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},struct(t,e){let n=St(e);$t(t,n);let r={};for(let[o,f]of Object.entries(e.propTypes))$t(t,St(f)),r[o]=fe(t,f);return $t(t,n),r},array(t,e){if(e.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let n=St(e),r=[];for(let o=0;o<e.elementCount;o++){$t(t,n);let f=e.elementType,y=fe(t,f);r.push(y)}return $t(t,n),r},atomic(t,e){return fe(t,e.inner)},decorated(t,e){let n=ue(e);$t(t,n);let r=t.currentByteOffset,o=fe(t,e.inner);return t.seekTo(r+mt(e)),o},uint8:t=>t.readUint8(),uint8x2:t=>Ee(t.readUint8(),t.readUint8()),uint8x4:t=>ee(t.readUint8(),t.readUint8(),t.readUint8(),t.readUint8()),sint8:t=>t.readInt8(),sint8x2:t=>Ue(t.readInt8(),t.readInt8()),sint8x4:t=>te(t.readInt8(),t.readInt8(),t.readInt8(),t.readInt8()),unorm8:t=>t.readUint8()/255,unorm8x2:t=>q(t.readUint8()/255,t.readUint8()/255),unorm8x4:t=>G(t.readUint8()/255,t.readUint8()/255,t.readUint8()/255,t.readUint8()/255),snorm8:t=>(t.readUint8()-128)/127,snorm8x2:t=>q((t.readUint8()-128)/127,(t.readUint8()-128)/127),snorm8x4:t=>G((t.readUint8()-128)/127,(t.readUint8()-128)/127,(t.readUint8()-128)/127,(t.readUint8()-128)/127),uint16:t=>t.readUint16(),uint16x2:t=>Ee(t.readUint16(),t.readUint16()),uint16x4:t=>ee(t.readUint16(),t.readUint16(),t.readUint16(),t.readUint16()),sint16:t=>t.readInt16(),sint16x2:t=>Ue(t.readInt16(),t.readInt16()),sint16x4:t=>te(t.readInt16(),t.readInt16(),t.readInt16(),t.readInt16()),unorm16:t=>t.readUint16()/65535,unorm16x2:t=>q(t.readUint16()/65535,t.readUint16()/65535),unorm16x4:t=>G(t.readUint16()/65535,t.readUint16()/65535,t.readUint16()/65535,t.readUint16()/65535),snorm16:t=>(t.readUint16()-32768)/32767,snorm16x2:t=>q(Me.snorm16(t),Me.snorm16(t)),snorm16x4:t=>G(Me.snorm16(t),Me.snorm16(t),Me.snorm16(t),Me.snorm16(t)),float16(t){return t.readFloat16()},float16x2:t=>q(t.readFloat16(),t.readFloat16()),float16x4:t=>G(t.readFloat16(),t.readFloat16(),t.readFloat16(),t.readFloat16()),float32:t=>t.readFloat32(),float32x2:t=>q(t.readFloat32(),t.readFloat32()),float32x3:t=>tn(t.readFloat32(),t.readFloat32(),t.readFloat32()),float32x4:t=>G(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32()),uint32:t=>t.readUint32(),uint32x2:t=>Ee(t.readUint32(),t.readUint32()),uint32x3:t=>Oe(t.readUint32(),t.readUint32(),t.readUint32()),uint32x4:t=>ee(t.readUint32(),t.readUint32(),t.readUint32(),t.readUint32()),sint32:t=>t.readInt32(),sint32x2:t=>Ue(t.readInt32(),t.readInt32()),sint32x3:t=>xr(t.readInt32(),t.readInt32(),t.readInt32()),sint32x4:t=>te(t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32()),"unorm10-10-10-2"(t){let e=t.readUint32(),n=(e>>22)/1023,r=(e>>12&1023)/1023,o=(e>>2&1023)/1023,f=(e&3)/3;return G(n,r,o,f)},"unorm8x4-bgra"(t){let e=t.readByte()/255,n=t.readByte()/255,r=t.readByte()/255,o=t.readByte()/255;return G(r,n,e,o)},unstruct(t,e){let n={};for(let[r,o]of Object.entries(e.propTypes))n[r]=fe(t,o);return n},disarray(t,e){let n=St(e),r=[];for(let o=0;o<e.elementCount;o++)$t(t,n),r.push(fe(t,e.elementType));return $t(t,n),r},"loose-decorated"(t,e){$t(t,ue(e));let n=t.currentByteOffset,r=fe(t,e.inner);return t.seekTo(n+mt(e)),r}};function fe(t,e){let n=Me[e.type];if(!n)throw new Error(`Cannot read data of type '${e.type}'.`);return n(t,e)}var Qt=Symbol("Unknown data type");function Ti(t){return!!t&&(typeof t=="object"||typeof t=="function")&&"resolve"in t}function Vr(t){return typeof t=="number"||typeof t=="boolean"||typeof t=="string"||Ti(t)||Rr(t)||Mi(t)}function Zu(t){return!!t&&typeof t=="object"&&"getMappedRange"in t&&"mapAsync"in t}function Ku(t,e,n){return Ve(e)?new ps(t,e,n):new ps(t,e,n,["storage","uniform"])}function _r(t){return t.resourceType==="buffer"}function Hu(t){return!!t.usableAsUniform}var ps=class{constructor(t,e,n,r){this._group=t,this.dataType=e,this.initialOrBuffer=n,this._disallowedUsages=r,A(this,"resourceType","buffer"),A(this,"flags",GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),A(this,"_buffer",null),A(this,"_ownBuffer"),A(this,"_destroyed",!1),A(this,"_label"),A(this,"initial"),A(this,"usableAsUniform",!1),A(this,"usableAsStorage",!1),A(this,"usableAsVertex",!1),Zu(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}get label(){return this._label}get buffer(){var t;let e=this._group.device;if(this._destroyed)throw new Error("This buffer has been destroyed");if(!this._buffer&&(this._buffer=e.createBuffer({size:mt(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:(t=this.label)!=null?t:"<unnamed>"}),this.initial)){let n=new vn(this._buffer.getMappedRange());He(n,this.dataType,this.initial),this._buffer.unmap()}return this._buffer}get destroyed(){return this._destroyed}$name(t){return this._label=t,this._buffer&&(this._buffer.label=t),this}$usage(...t){var e;for(let n of t){if((e=this._disallowedUsages)!=null&&e.includes(n))throw new Error(`Buffer of type ${this.dataType} cannot be used as ${n}`);this.flags|=n==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=n==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=n==="vertex"?GPUBufferUsage.VERTEX:0,this.usableAsUniform=this.usableAsUniform||n==="uniform",this.usableAsStorage=this.usableAsStorage||n==="storage",this.usableAsVertex=this.usableAsVertex||n==="vertex"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}write(t){let e=this.buffer,n=this._group.device;if(e.mapState==="mapped"){let f=e.getMappedRange();He(new vn(f),this.dataType,t);return}let r=mt(this.dataType);this._group.flush();let o=new ArrayBuffer(r);He(new vn(o),this.dataType,t),n.queue.writeBuffer(e,0,o,0,r)}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let e=mt(this.dataType);this._group.commandEncoder.copyBufferToBuffer(t.buffer,0,this.buffer,0,e)}async read(){this._group.flush();let t=this.buffer,e=this._group.device;if(t.mapState==="mapped"){let f=t.getMappedRange();return fe(new xn(f),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let f=t.getMappedRange(),y=fe(new xn(f),this.dataType);return t.unmap(),y}let n=e.createBuffer({size:mt(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),r=e.createCommandEncoder();r.copyBufferToBuffer(t,0,n,0,mt(this.dataType)),e.queue.submit([r.finish()]),await e.queue.onSubmittedWorkDone(),await n.mapAsync(GPUMapMode.READ,0,mt(this.dataType));let o=fe(new xn(n.getMappedRange()),this.dataType);return n.unmap(),n.destroy(),o}destroy(){var t;this._destroyed||(this._destroyed=!0,this._ownBuffer&&((t=this._buffer)==null||t.destroy()))}toString(){var t;return`buffer:${(t=this._label)!=null?t:"<unnamed>"}`}};function ws(t){return!!(t!=null&&t.usableAsStorage)}var Ju=class Di extends Error{constructor(e){var n;super(`Resource '${(n=e.label)!=null?n:"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,Di.prototype)}};function Qu(t){return t?.resourceType==="buffer-usage"}var tc={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},ys=class{constructor(e,n,r){this.usage=e,this.dataType=n,this._membership=r,A(this,"~repr"),A(this,"resourceType","buffer-usage")}get label(){return this._membership.key}resolve(e){let n=e.names.makeUnique(this.label),r=e.allocateLayoutEntry(this._membership.layout),o=tc[this.usage];return e.addDeclaration(`@group(${r}) @binding(${this._membership.idx}) var<${o}> ${n}: ${e.resolve(this.dataType)};`),n}toString(){var e;return`${this.usage}:${(e=this.label)!=null?e:"<unnamed>"}`}get value(){if(!pe())throw new Error("Cannot access buffer's value directly in JS.");return this}},ec=class{constructor(t){this._membership=t,A(this,"resourceType","sampler")}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: sampler;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},nc=class{constructor(t){this._membership=t,A(this,"resourceType","sampler-comparison")}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: sampler_comparison;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},rc={r8unorm:I,r8snorm:I,r8uint:lt,r8sint:Zt,r16uint:lt,r16sint:Zt,r16float:I,rg8unorm:I,rg8snorm:I,rg8uint:lt,rg8sint:Zt,r32uint:lt,r32sint:Zt,r32float:I,rg16uint:lt,rg16sint:Zt,rg16float:I,rgba8unorm:I,"rgba8unorm-srgb":I,rgba8snorm:I,rgba8uint:lt,rgba8sint:Zt,bgra8unorm:I,"bgra8unorm-srgb":I,rgb9e5ufloat:I,rgb10a2uint:lt,rgb10a2unorm:I,rg11b10ufloat:I,rg32uint:lt,rg32sint:Zt,rg32float:I,rgba16uint:lt,rgba16sint:Zt,rgba16float:I,rgba32uint:lt,rgba32sint:Zt,rgba32float:I,stencil8:I,depth16unorm:I,depth24plus:I,"depth24plus-stencil8":I,depth32float:I,"depth32float-stencil8":I,"bc1-rgba-unorm":I,"bc1-rgba-unorm-srgb":I,"bc2-rgba-unorm":I,"bc2-rgba-unorm-srgb":I,"bc3-rgba-unorm":I,"bc3-rgba-unorm-srgb":I,"bc4-r-unorm":I,"bc4-r-snorm":I,"bc5-rg-unorm":I,"bc5-rg-snorm":I,"bc6h-rgb-ufloat":I,"bc6h-rgb-float":I,"bc7-rgba-unorm":I,"bc7-rgba-unorm-srgb":I,"etc2-rgb8unorm":I,"etc2-rgb8unorm-srgb":I,"etc2-rgb8a1unorm":I,"etc2-rgb8a1unorm-srgb":I,"etc2-rgba8unorm":I,"etc2-rgba8unorm-srgb":I,"eac-r11unorm":I,"eac-r11snorm":I,"eac-rg11unorm":I,"eac-rg11snorm":I,"astc-4x4-unorm":I,"astc-4x4-unorm-srgb":I,"astc-5x4-unorm":I,"astc-5x4-unorm-srgb":I,"astc-5x5-unorm":I,"astc-5x5-unorm-srgb":I,"astc-6x5-unorm":I,"astc-6x5-unorm-srgb":I,"astc-6x6-unorm":I,"astc-6x6-unorm-srgb":I,"astc-8x5-unorm":I,"astc-8x5-unorm-srgb":I,"astc-8x6-unorm":I,"astc-8x6-unorm-srgb":I,"astc-8x8-unorm":I,"astc-8x8-unorm-srgb":I,"astc-10x5-unorm":I,"astc-10x5-unorm-srgb":I,"astc-10x6-unorm":I,"astc-10x6-unorm-srgb":I,"astc-10x8-unorm":I,"astc-10x8-unorm-srgb":I,"astc-10x10-unorm":I,"astc-10x10-unorm-srgb":I,"astc-12x10-unorm":I,"astc-12x10-unorm-srgb":I,"astc-12x12-unorm":I,"astc-12x12-unorm-srgb":I},Yn={rgba8unorm:G,rgba8snorm:G,rgba8uint:ee,rgba8sint:te,rgba16uint:ee,rgba16sint:te,rgba16float:G,r32uint:ee,r32sint:te,r32float:G,rg32uint:ee,rg32sint:te,rg32float:G,rgba32uint:ee,rgba32sint:te,rgba32float:G,bgra8unorm:G},sc={f32:"float",u32:"uint",i32:"sint"},ic={float:I,"unfilterable-float":I,uint:lt,sint:Zt,depth:I};function oc(t,e){return new cc(t,e)}function Xn(t){return t?.resourceType==="texture"}function ac(t){return t?.resourceType==="texture-storage-view"}function uc(t){return t?.resourceType==="texture-sampled-view"}var Ui={mutable:"read_write",readonly:"read",writeonly:"write"},cc=class{constructor(t,e){this.props=t,this._branch=e,A(this,"resourceType","texture"),A(this,"usableAsSampled",!1),A(this,"usableAsStorage",!1),A(this,"usableAsRender",!1),A(this,"_destroyed",!1),A(this,"_label"),A(this,"_flags",GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC),A(this,"_texture",null)}get label(){return this._label}$name(t){return this._label=t,this}unwrap(){var t,e,n,r,o;if(this._destroyed)throw new Error("This texture has been destroyed");return this._texture||(this._texture=this._branch.device.createTexture({label:(t=this._label)!=null?t:"<unnamed>",format:this.props.format,size:this.props.size,usage:this._flags,dimension:(e=this.props.dimension)!=null?e:"2d",viewFormats:(n=this.props.viewFormats)!=null?n:[],mipLevelCount:(r=this.props.mipLevelCount)!=null?r:1,sampleCount:(o=this.props.sampleCount)!=null?o:1})),this._texture}$usage(...t){let e=t.includes("storage"),n=t.includes("sampled"),r=t.includes("render");return this._flags|=n?GPUTextureUsage.TEXTURE_BINDING:0,this._flags|=e?GPUTextureUsage.STORAGE_BINDING:0,this._flags|=r?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||(this.usableAsStorage=e),this.usableAsSampled||(this.usableAsSampled=n),this.usableAsRender||(this.usableAsRender=r),this}createView(t,e){if(t==="sampled")return this._asSampled(e);let n=e;switch(t){case"mutable":return this._asMutable(n);case"readonly":return this._asReadonly(n);case"writeonly":return this._asWriteonly(n)}}_asStorage(t,e){var n;if(!this.usableAsStorage)throw new Error("Unusable as storage");let r=(n=t?.format)!=null?n:this.props.format,o=Yn[r];return On(!!o),new lc(t??{},e,this)}_asReadonly(t){return this._asStorage(t,"readonly")}_asWriteonly(t){return this._asStorage(t,"writeonly")}_asMutable(t){return this._asStorage(t,"mutable")}_asSampled(t){var e;if(!this.usableAsSampled)throw new Error("Unusable as sampled");let n=(e=t?.format)!=null?e:this.props.format;if(!Yn[n])throw new Error(`Unsupported storage texture format: ${n}`);return new hc(t,this)}destroy(){var t;this._destroyed||(this._destroyed=!0,(t=this._texture)==null||t.destroy())}},ar={"1d":"1d","2d":"2d","2d-array":"2d_array",cube:"cube","cube-array":"cube_array","3d":"3d"},lc=class{constructor(t,e,n){this.access=e,this._texture=n,A(this,"resourceType","texture-storage-view"),A(this,"texelDataType"),A(this,"dimension"),A(this,"_view"),A(this,"_format");var r,o,f;this.dimension=(o=(r=t?.dimension)!=null?r:n.props.dimension)!=null?o:"2d",this._format=(f=t?.format)!=null?f:n.props.format,this.texelDataType=Yn[this._format]}get label(){return this._texture.label}$name(t){return this._texture.$name(t),this}unwrap(){var t;return this._view||(this._view=this._texture.unwrap().createView({label:`${(t=this.label)!=null?t:"<unnamed>"} - View`,format:this._format,dimension:this.dimension})),this._view}resolve(t){let e=t.names.makeUnique(this.label),{group:n,binding:r}=t.allocateFixedEntry({storageTexture:this._format,access:this.access,viewDimension:this.dimension},this),o=`texture_storage_${ar[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${r}) var ${e}: ${o}<${this._format}, ${Ui[this.access]}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},fc=class{constructor(t,e,n,r){this._format=t,this.dimension=e,this.access=n,this._membership=r,A(this,"resourceType","texture-storage-view"),A(this,"texelDataType"),this.texelDataType=Yn[this._format]}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=`texture_storage_${ar[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: ${r}<${this._format}, ${Ui[this.access]}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},hc=class{constructor(t,e){this._props=t,this._texture=e,A(this,"resourceType","texture-sampled-view"),A(this,"channelDataType"),A(this,"dimension"),A(this,"_format"),A(this,"_view");var n,r,o;this.dimension=(r=(n=t?.dimension)!=null?n:e.props.dimension)!=null?r:"2d",this._format=(o=t?.format)!=null?o:e.props.format,this.channelDataType=rc[this._format]}get label(){return this._texture.label}$name(t){return this._texture.$name(t),this}unwrap(){var t;return this._view||(this._view=this._texture.unwrap().createView(De({label:`${(t=this.label)!=null?t:"<unnamed>"} - View`},this._props))),this._view}resolve(t){var e;let n=t.names.makeUnique(this.label),r=((e=this._texture.props.sampleCount)!=null?e:1)>1,{group:o,binding:f}=t.allocateFixedEntry({texture:sc[this.channelDataType.type],viewDimension:this.dimension,multisampled:r},this),y=r?"texture_multisampled_2d":`texture_${ar[this.dimension]}`;return t.addDeclaration(`@group(${o}) @binding(${f}) var ${n}: ${y}<${t.resolve(this.channelDataType)}>;`),n}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},dc=class{constructor(t,e,n,r){this.dimension=e,this._multisampled=n,this._membership=r,A(this,"resourceType","texture-sampled-view"),A(this,"channelDataType"),this.channelDataType=ic[t]}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=this._multisampled?"texture_multisampled_2d":`texture_${ar[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: ${r}<${t.resolve(this.channelDataType)}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}};function pc(t){return!!(t!=null&&t.usableAsSampled)}var wc=class Ei extends Error{constructor(e){var n;super(`Resource '${(n=e.label)!=null?n:"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,Ei.prototype)}},yc=class{constructor(t){this._membership=t,A(this,"resourceType","external-texture")}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: texture_external;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}};function Oi(t){return new xc(t)}function Ai(t){return!!t&&t.resourceType==="bind-group-layout"}function mc(t){return!!t&&t.resourceType==="bind-group"}var gc=class ki extends Error{constructor(e,n){super(`Bind group '${e??"<unnamed>"}' is missing a required binding '${n}'`),Object.setPrototypeOf(this,ki.prototype)}},ms=["compute"],Fe=["compute","vertex","fragment"],xc=class{constructor(e){this.entries=e,A(this,"_label"),A(this,"_index"),A(this,"resourceType","bind-group-layout"),A(this,"bound",{});var n,r,o,f,y;let v=0;for(let[U,D]of Object.entries(e)){if(D===null){v++;continue}let k={idx:v,key:U,layout:this};if("uniform"in D&&(this.bound[U]=new ys("uniform",D.uniform,k)),"storage"in D){let P="type"in D.storage?D.storage:D.storage(0);this.bound[U]=new ys((n=D.access)!=null?n:"readonly",P,k)}"texture"in D&&(this.bound[U]=new dc(D.texture,(r=D.viewDimension)!=null?r:"2d",(o=D.multisampled)!=null?o:!1,k)),"storageTexture"in D&&(this.bound[U]=new fc(D.storageTexture,(f=D.viewDimension)!=null?f:"2d",(y=D.access)!=null?y:"writeonly",k)),"externalTexture"in D&&(this.bound[U]=new yc(k)),"sampler"in D&&(D.sampler==="comparison"?this.bound[U]=new nc(k):this.bound[U]=new ec(k)),v++}}get label(){return this._label}get index(){return this._index}$name(e){return this._label=e,this}$idx(e){return this._index=e,this}unwrap(e){var n;return e.device.createBindGroupLayout({label:(n=this.label)!=null?n:"<unnamed>",entries:Object.values(this.entries).map((r,o)=>{var f,y,v,U;if(r===null)return null;let D=r.visibility,k={binding:o,visibility:0};if("uniform"in r)D=D??Fe,k.buffer={type:"uniform"};else if("storage"in r)D=D??(r.access==="mutable"?ms:Fe),k.buffer={type:r.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in r)D=D??Fe,k.sampler={type:r.sampler};else if("texture"in r)D=D??Fe,k.texture={sampleType:r.texture,viewDimension:(f=r.viewDimension)!=null?f:"2d",multisampled:(y=r.multisampled)!=null?y:!1};else if("storageTexture"in r){let P=(v=r.access)!=null?v:"writeonly";D=D??(P==="readonly"?Fe:ms),k.storageTexture={format:r.storageTexture,access:{mutable:"read-write",readonly:"read-only",writeonly:"write-only"}[P],viewDimension:(U=r.viewDimension)!=null?U:"2d"}}else"externalTexture"in r&&(D=D??Fe,k.externalTexture={});return D!=null&&D.includes("compute")&&(k.visibility|=GPUShaderStage.COMPUTE),D!=null&&D.includes("vertex")&&(k.visibility|=GPUShaderStage.VERTEX),D!=null&&D.includes("fragment")&&(k.visibility|=GPUShaderStage.FRAGMENT),k}).filter(r=>r!==null)})}populate(e){return new Lr(this,e)}},Lr=class{constructor(t,e){this.layout=t,this.entries=e,A(this,"resourceType","bind-group");for(let n of Object.keys(t.entries))if(t.entries[n]!==null&&!(n in e))throw new gc(t.label,n)}unwrap(t){var e;return t.device.createBindGroup({label:(e=this.layout.label)!=null?e:"<unnamed>",layout:t.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([n,r],o)=>{var f;if(r===null)return null;let y=this.entries[n];if(y===void 0)throw new Error(`'${n}' is a resource required to populate bind group layout '${(f=this.layout.label)!=null?f:"<unnamed>"}'.`);if("uniform"in r){let v;if(_r(y)){if(!Hu(y))throw new ts(y);v={buffer:t.unwrap(y)}}else v={buffer:y};return{binding:o,resource:v}}if("storage"in r){let v;if(_r(y)){if(!ws(y))throw new ts(y);v={buffer:t.unwrap(y)}}else v={buffer:y};return{binding:o,resource:v}}if("texture"in r){let v;if(Xn(y)){if(!pc(y))throw new wc(y);v=t.unwrap(y.createView("sampled"))}else v=y;return{binding:o,resource:v}}if("storageTexture"in r){let v;if(Xn(y)){if(!ws(y))throw new Ju(y);r.access==="readonly"?v=t.unwrap(y.createView("readonly")):r.access==="mutable"?v=t.unwrap(y.createView("mutable")):v=t.unwrap(y.createView("writeonly"))}else v=y;return{binding:o,resource:v}}if("externalTexture"in r||"sampler"in r)return{binding:o,resource:y};throw new Error(`Malformed bind group entry: ${y} (${JSON.stringify(y)})`)}).filter(n=>n!==null)})}};function vc(t,e){throw new Error(`Failed to handle ${t} at ${e}`)}var bc=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"];function _c(t){return bc.includes(t.type)}function $c(t,[e,n]){return`  ${du(n)}${e}: ${t.resolve(n)},
`}function Sc(t,e){let n=t.names.makeUnique(e.label);return t.addDeclaration(`
struct ${n} {
${Object.entries(e.propTypes).map(r=>$c(t,r)).join("")}}
`),n}function Mc(t,e){let n=t.resolve(e.elementType);return e.elementCount===0?`array<${n}>`:`array<${n}, ${e.elementCount}>`}function Ii(t,e){if(_c(e))return e.type;if(e.type==="struct")return Sc(t,e);if(e.type==="array")return Mc(t,e);if(e.type==="atomic")return`atomic<${Ii(t,e.inner)}>`;if(e.type==="decorated")return t.resolve(e.inner);vc(e,"resolveData")}function*Tc(t){let e=0;for(;;)t.has(e)||(yield e),e++}var Dc=["==","!=","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"];function Vt(t,e){return Vr(e.value)||Ve(e.value)?t.resolve(e.value):String(e.value)}function Uc(t){throw new Error(`'${JSON.stringify(t)}' was not handled by the WGSL generator.`)}function Pi(t,e){return e?{value:"true",dataType:es}:{value:"false",dataType:es}}function Fi(t,e){return`${t.indent()}{
${e.b.map(n=>Sr(t,n)).join(`
`)}
${t.dedent()}}`}function $r(t,e){return t.getById(e)}function Kt(t,e){if(typeof e=="string")return $r(t,e);if(typeof e=="boolean")return Pi(t,e);if("x"in e){let[n,r,o]=e.x,f=Vt(t,Kt(t,n)),y=Vt(t,Kt(t,o));return{value:Dc.includes(r)?`(${f} ${r} ${y})`:`${f} ${r} ${y}`,dataType:Qt}}if("u"in e){let[n,r]=e.u,o=Vt(t,Kt(t,r));return{value:`${n}${o}`,dataType:Qt}}if("a"in e){let[n,r]=e.a,o=Kt(t,n),f=Vt(t,Kt(t,r));if(typeof o.value=="string")return{value:`${o.value}.${f}`,dataType:Qt};if(Vr(o.value))return f==="value"?{value:Vt(t,o),dataType:Qt}:{value:o.value[f],dataType:Qt};if(typeof o.value=="object")return{value:o.value[f],dataType:Qt};throw new Error(`Cannot access member ${f} of ${o.value}`)}if("i"in e){let[n,r]=e.i,o=Vt(t,Kt(t,n)),f=Vt(t,Kt(t,r));return{value:`${o}[${f}]`,dataType:Qt}}if("n"in e)return{value:e.n,dataType:Qt};if("f"in e){let[n,r]=e.f,o=Kt(t,n).value,f=r.map(y=>Kt(t,y)).map(y=>Vt(t,y));return typeof o=="string"?{value:`${o}(${f.join(", ")})`,dataType:Qt}:{value:o(...f),dataType:Qt}}Uc(e)}function Sr(t,e){if(typeof e=="string")return`${t.pre}${Vt(t,$r(t,e))};`;if(typeof e=="boolean")return`${t.pre}${Vt(t,Pi(t,e))};`;if("r"in e)return e.r===null?`${t.pre}return;`:`${t.pre}return ${Vt(t,Kt(t,e.r))};`;if("q"in e){let[n,r,o]=e.q,f=Vt(t,Kt(t,n));t.indent();let y=Sr(t,r);t.dedent(),t.indent();let v=o?Sr(t,o):void 0;return t.dedent(),v?`${t.pre}if (${f})
${y}
${t.pre}else
${v}`:`${t.pre}if (${f})
${y}`}if("l"in e||"c"in e){let[n,r]="l"in e?e.l:e.c,o=Vt(t,$r(t,n)),f=r?Kt(t,r):void 0;if(!f)throw new Error("Cannot create variable without an initial value.");return`${t.pre}var ${o} = ${Vt(t,f)};`}return"b"in e?Fi(t,e):`${t.pre}${Vt(t,Kt(t,e))};`}function Ec(t,e){return Fi(t,e)}var zi="#CATCHALL#",Oc=class{constructor(){A(this,"_stack",[]),A(this,"_itemDepth",0)}get itemDepth(){return this._itemDepth}get topItem(){let t=this._stack[this._stack.length-1];if(!t||t.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return t}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}pushSlotBindings(t){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(t)})}pushFunctionScope(t,e,n){this._stack.push({type:"functionScope",args:t,returnType:e,externalMap:n})}pop(){let t=this._stack.pop();t?.type==="item"&&this._itemDepth--}readSlot(t){for(let e=this._stack.length-1;e>=0;--e){let n=this._stack[e];if(n?.type==="item")n.usedSlots.add(t);else if(n?.type==="slotBinding"){let r=n.bindingMap.get(t);if(r!==void 0)return r}else if(!(n?.type==="functionScope"||n?.type==="blockScope"))throw new Error("Unknown layer type.")}return t.defaultValue}getResourceById(t){for(let e=this._stack.length-1;e>=0;--e){let n=this._stack[e];if(n?.type==="functionScope"){let r=n.args.find(f=>f.value===t);if(r!==void 0)return r;let o=n.externalMap[t];return o!==void 0?{value:o,dataType:Qt}:void 0}if(n?.type==="blockScope"){let r=n.declarations.get(t);if(r!==void 0)return{value:t,dataType:r}}}}},_n=["","  ","    ","      ","        ","          ","            ","              ","                "],hr=_n.length-1,Ac=class{constructor(){A(this,"identLevel",0)}get pre(){var t;return(t=_n[this.identLevel])!=null?t:_n[hr].repeat(this.identLevel/hr)+_n[this.identLevel%hr]}indent(){let t=this.pre;return this.identLevel++,t}dedent(){return this.identLevel--,this.pre}},kc=class{constructor(t){A(this,"_memoizedResolves",new WeakMap),A(this,"_memoizedDerived",new WeakMap),A(this,"_indentController",new Ac),A(this,"_jitTranspiler"),A(this,"_itemStateStack",new Oc),A(this,"_declarations",[]),A(this,"bindGroupLayoutsToPlaceholderMap",new Map),A(this,"_nextFreeLayoutPlaceholderIdx",0),A(this,"fixedBindings",[]),A(this,"names"),this.names=t.names,this._jitTranspiler=t.jitTranspiler}get pre(){return this._indentController.pre}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}getById(t){var e;return(e=this._itemStateStack.getResourceById(t))!=null?e:{value:t,dataType:Qt}}transpileFn(t){if(!this._jitTranspiler)throw new Error("Tried to execute a tgpu.fn function without providing a JIT transpiler, or transpiling at build time.");return this._jitTranspiler.transpileFn(t)}fnToWgsl(t){this._itemStateStack.pushFunctionScope(t.args,t.returnType,t.externalMap);let e=Ec(this,t.body);this._itemStateStack.pop();let n=t.args.map(r=>`${r.value}: ${this.resolve(r.dataType)}`).join(", ");return{head:t.returnType!==void 0?`(${n}) -> ${this.resolve(t.returnType)}`:`(${n})`,body:e}}addDeclaration(t){this._declarations.push(t)}allocateLayoutEntry(t){let e=this.bindGroupLayoutsToPlaceholderMap,n=e.get(t);return n||(n=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,e.set(t,n)),n}allocateFixedEntry(t,e){let n=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:t,resource:e}),{group:zi,binding:n}}readSlot(t){let e=this._itemStateStack.readSlot(t);if(e===void 0)throw new Oo(t);return e}withSlots(t,e){this._itemStateStack.pushSlotBindings(t);try{return e()}finally{this._itemStateStack.pop()}}unwrap(t){let e=t;for(;;)if(Rr(e))e=this.readSlot(e);else if(Mi(e))e=this._getOrCompute(e);else break;return e}_getOrCompute(t){var e;let n=(e=this._memoizedDerived.get(t))!=null?e:[];this._itemStateStack.pushItem();try{for(let f of n)if([...f.slotToValueMap.entries()].every(([y,v])=>y.areEqual(this._itemStateStack.readSlot(y),v)))return f.result;let r=t["~compute"](),o=new Map;for(let f of this._itemStateStack.topItem.usedSlots)o.set(f,this._itemStateStack.readSlot(f));return n.push({slotToValueMap:o,result:r}),this._memoizedDerived.set(t,n),r}catch(r){throw r instanceof yn?r.appendToTrace(t):new yn(r,[t])}finally{this._itemStateStack.pop()}}_getOrInstantiate(t){var e;let n=(e=this._memoizedResolves.get(t))!=null?e:[];this._itemStateStack.pushItem();try{for(let f of n)if([...f.slotToValueMap.entries()].every(([y,v])=>y.areEqual(this._itemStateStack.readSlot(y),v)))return f.result;let r=Ve(t)?Ii(this,t):t.resolve(this),o=new Map;for(let f of this._itemStateStack.topItem.usedSlots)o.set(f,this._itemStateStack.readSlot(f));return n.push({slotToValueMap:o,result:r}),this._memoizedResolves.set(t,n),r}catch(r){throw r instanceof yn?r.appendToTrace(t):new yn(r,[t])}finally{this._itemStateStack.pop()}}resolve(t){let e=this.unwrap(t);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return String(e);if(this._itemStateStack.itemDepth===0){let n=ko(this,()=>this._getOrInstantiate(e));return`${[...this._declarations].join(`

`)}${n}`}return this._getOrInstantiate(e)}resolveValue(t,e){if(Vr(t))return this.resolve(t);if(Ir(e))return`array(${t.map(n=>this.resolveValue(n,e.elementType))})`;if(Le(e))return`${this.resolve(e)}(${Object.entries(e.propTypes).map(([n,r])=>this.resolveValue(t[n],r))})`;throw new Error(`Value ${t} of schema ${e} is not resolvable to WGSL`)}};function Gr(t,e){var n;let r=new kc(e),o=r.resolve(t),f=r.bindGroupLayoutsToPlaceholderMap,y=[],v=new Set([...f.keys()].map(F=>F.index).filter(F=>F!==void 0)),U=Tc(v),D=r.fixedBindings.map((F,B)=>[String(B),F.layoutEntry]),k=()=>{let F=U.next().value,B=Oi(Object.fromEntries(D));return y[F]=B,o=o.replaceAll(zi,String(F)),[F,new Lr(B,Object.fromEntries(r.fixedBindings.map((z,j)=>[String(j),z.resource])))]},P=D.length>0?k():null;for(let[F,B]of f.entries()){let z=(n=F.index)!=null?n:U.next().value;y[z]=F,o=o.replaceAll(B,String(z))}return{code:o,bindGroupLayouts:y,catchall:P}}function Ic(t){return!!t&&(typeof t=="object"||typeof t=="function")&&"$name"in t}function Zn(t,e){for(let[n,r]of Object.entries(e))t[n]=r,Ic(r)&&(!("label"in r)||r.label===void 0)&&r.$name(n)}function qr(t,e,n){return Object.entries(e).reduce((r,[o,f])=>{let y=Ti(f)||Ve(f)||Rr(f)?t.resolve(f):String(f);return r.replaceAll(new RegExp(`(?<![\\w_])${o}(?![\\w_])`,"g"),y)},n)}function Pc(t){let{externals:e,template:n,names:r,unstable_jitTranspiler:o}=t,f={};Zn(f,e??{});let y={resolve(U){return qr(U,f,n??"")},toString:()=>"<root>"},{code:v}=Gr(y,{names:r==="strict"?new jr:new Br,jitTranspiler:o});return v}function Fc(t,e="vertex"){return new Bc(t,e)}function zc(t){return t?.resourceType==="vertex-layout"}function $n(t,e,n){if(Ge(e)||Ie(e))return $n(t,e.inner,me(n,ue(e)));if(Le(e)){let r=n;return Object.fromEntries(Object.entries(e.propTypes).map(([o,f])=>{r=me(r,St(f));let y=[o,$n(t,f,r)];return r+=mt(f),y}))}if(rr(e)){let r=n;return Object.fromEntries(Object.entries(e.propTypes).map(([o,f])=>{r=me(r,ue(f));let y=[o,$n(t,f,r)];return r+=mt(f),y}))}if("type"in e&&typeof e.type=="string"){if(oi.includes(e.type))return{_layout:t,format:e.type,offset:n};let r=Wa[e.type];if(r)return{_layout:t,format:r,offset:n}}throw new Error(`Unsupported data used in vertex layout: ${String(e)}`)}var Bc=class{constructor(t,e){this.schemaForCount=t,this.stepMode=e,A(this,"resourceType","vertex-layout"),A(this,"stride"),A(this,"attrib"),A(this,"_label");let n=t(0);this.stride=me(mt(n.elementType),St(n)),this.attrib=$n(this,n.elementType,0)}get label(){return this._label}$name(t){return this._label=t,this}},gs=class{constructor(e){this._make=e,A(this,"_map",new WeakMap)}getOrMake(e,...n){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...n);return this._map.set(e,r),r}};function jc(t,e,n){return new Nc(new Vc(t,e,n),{})}function Rc(t){return t?.resourceType==="compute-pipeline"}var Nc=class Bi{constructor(e,n){this._core=e,this._priors=n,A(this,"resourceType","compute-pipeline")}get label(){return this._core.label}get rawPipeline(){return this._core.unwrap().pipeline}with(e,n){var r;return new Bi(this._core,{bindGroupLayoutMap:new Map([...(r=this._priors.bindGroupLayoutMap)!=null?r:[],[e,n]])})}dispatchWorkgroups(e,n,r){var o;let f=this._core.unwrap(),y=this._core.branch.commandEncoder.beginComputePass({label:(o=this._core.label)!=null?o:"<unnamed>"});y.setPipeline(f.pipeline),f.bindGroupLayouts.forEach((v,U)=>{var D;if(f.catchall&&U===f.catchall[0])y.setBindGroup(U,this._core.branch.unwrap(f.catchall[1]));else{let k=(D=this._priors.bindGroupLayoutMap)==null?void 0:D.get(v);if(k===void 0)throw new Is(v.label);y.setBindGroup(U,this._core.branch.unwrap(k))}}),y.dispatchWorkgroups(e,n,r),y.end()}$name(e){return this._core.label=e,this}},Vc=class{constructor(t,e,n){this.branch=t,this._slotBindings=e,this._entryFn=n,A(this,"label"),A(this,"_memo")}unwrap(){var t,e,n,r,o;if(this._memo===void 0){let f=this.branch.device,{code:y,bindGroupLayouts:v,catchall:U}=Gr({resolve:D=>(D.withSlots(this._slotBindings,()=>{D.resolve(this._entryFn)}),""),toString:()=>{var D;return`computePipeline:${(D=this.label)!=null?D:"<unnamed>"}`}},{names:this.branch.nameRegistry,jitTranspiler:this.branch.jitTranspiler});U!==null&&((e=v[U[0]])==null||e.$name(`${(t=this.label)!=null?t:"<unnamed>"} - Automatic Bind Group & Layout`)),this._memo={pipeline:f.createComputePipeline({label:(n=this.label)!=null?n:"<unnamed>",layout:f.createPipelineLayout({label:`${(r=this.label)!=null?r:"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:v.map(D=>this.branch.unwrap(D))}),compute:{module:f.createShaderModule({label:`${(o=this.label)!=null?o:"<unnamed>"} - Shader`,code:y})}}),bindGroupLayouts:v,catchall:U}}return this._memo}};function Lc(t){return typeof t?.format=="string"}function Gc(t,e){var n,r;let o=[];if(sr(t)){if(!Lc(e))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return o.push(e._layout),{usedVertexLayouts:o,bufferDefinitions:[{arrayStride:e._layout.stride,stepMode:e._layout.stepMode,attributes:[{format:e.format,offset:e.offset,shaderLocation:(n=vr(t))!=null?n:0}]}]}}let f=[],y=new WeakMap,v=0;for(let[U,D]of Object.entries(t)){if(ci(D))continue;let k=e[U];if(!k)throw new Error(`An attribute by the name of '${U}' was not provided to the shader.`);let P=k._layout,F=y.get(P);F||(o.push(P),F=[],f.push({arrayStride:P.stride,stepMode:P.stepMode,attributes:F}),y.set(P,F)),v=(r=vr(D))!=null?r:v,F.push({format:k.format,offset:k.offset,shaderLocation:v++})}return{usedVertexLayouts:o,bufferDefinitions:f}}function qc(t){return typeof t?.loadOp=="string"}function Cc(t,e){if(sr(t)){if(!qc(e))throw new Error("Expected a single color attachment, not a record.");return[e]}let n=[];for(let r of Object.keys(t)){let o=e[r];if(!o)throw new Error(`A color attachment by the name of '${r}' was not provided to the shader.`);n.push(o)}return n}function Wc(t){return typeof t?.format=="string"}function Yc(t,e){if(sr(t)){if(!Wc(e))throw new Error("Expected a single color target configuration, not a record.");return[e]}let n=[];for(let r of Object.keys(t)){let o=e[r];if(!o)throw new Error(`A color target by the name of '${r}' was not provided to the shader.`);n.push(o)}return n}function Xc(t){return new Zc(new Kc(t),{})}var Zc=class Sn{constructor(e,n){this._core=e,this._priors=n,A(this,"resourceType","render-pipeline")}get label(){return this._core.label}$name(e){return this._core.label=e,this}with(e,n){var r,o;if(Ai(e))return new Sn(this._core,ze(De({},this._priors),{bindGroupLayoutMap:new Map([...(r=this._priors.bindGroupLayoutMap)!=null?r:[],[e,n]])}));if(zc(e))return new Sn(this._core,ze(De({},this._priors),{vertexLayoutMap:new Map([...(o=this._priors.vertexLayoutMap)!=null?o:[],[e,n]])}));throw new Error("Unsupported value passed into .with()")}withColorAttachment(e){return new Sn(this._core,ze(De({},this._priors),{colorAttachment:e}))}draw(e,n,r,o){var f,y;let v=this._core.unwrap(),{branch:U,fragmentFn:D}=this._core.options,k=Cc(D.shell.returnType,(f=this._priors.colorAttachment)!=null?f:{}).map(F=>Xn(F.view)?ze(De({},F),{view:U.unwrap(F.view).createView()}):F),P=U.commandEncoder.beginRenderPass({label:(y=this._core.label)!=null?y:"<unnamed>",colorAttachments:k});P.setPipeline(v.pipeline),v.bindGroupLayouts.forEach((F,B)=>{var z;if(v.catchall&&B===v.catchall[0])P.setBindGroup(B,U.unwrap(v.catchall[1]));else{let j=(z=this._priors.bindGroupLayoutMap)==null?void 0:z.get(F);if(j===void 0)throw new Is(F.label);P.setBindGroup(B,U.unwrap(j))}}),this._core.usedVertexLayouts.forEach((F,B)=>{var z,j;let tt=(z=this._priors.vertexLayoutMap)==null?void 0:z.get(F);if(!tt)throw new Error(`Missing vertex buffer for layout '${(j=F.label)!=null?j:"<unnamed>"}'. Please provide it using pipeline.with(layout, buffer).(...)`);P.setVertexBuffer(B,U.unwrap(tt))}),P.draw(e,n,r,o),P.end()}},Kc=class{constructor(t){this.options=t,A(this,"label"),A(this,"usedVertexLayouts"),A(this,"_memo"),A(this,"_vertexBufferLayouts"),A(this,"_targets");let e=Gc(t.vertexFn.shell.argTypes[0],t.vertexAttribs);this._vertexBufferLayouts=e.bufferDefinitions,this.usedVertexLayouts=e.usedVertexLayouts,this._targets=Yc(t.fragmentFn.shell.returnType,t.targets)}unwrap(){var t,e,n,r,o;if(this._memo===void 0){let{branch:f,vertexFn:y,fragmentFn:v,slotBindings:U,primitiveState:D}=this.options,{code:k,bindGroupLayouts:P,catchall:F}=Gr({resolve:j=>(j.withSlots(U,()=>{j.resolve(y),j.resolve(v)}),""),toString:()=>{var j;return`renderPipeline:${(j=this.label)!=null?j:"<unnamed>"}`}},{names:f.nameRegistry,jitTranspiler:f.jitTranspiler});F!==null&&((e=P[F[0]])==null||e.$name(`${(t=this.label)!=null?t:"<unnamed>"} - Automatic Bind Group & Layout`));let B=f.device,z=B.createShaderModule({label:`${(n=this.label)!=null?n:"<unnamed>"} - Shader`,code:k});this._memo={pipeline:B.createRenderPipeline({label:(r=this.label)!=null?r:"<unnamed>",layout:B.createPipelineLayout({label:`${(o=this.label)!=null?o:"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:P.map(j=>f.unwrap(j))}),vertex:{module:z,buffers:this._vertexBufferLayouts},fragment:{module:z,targets:this._targets},primitive:D??{}}),bindGroupLayouts:P,catchall:F}}return this._memo}},Hc=class ji{constructor(e,n){this._getRoot=e,this._slotBindings=n}with(e,n){return new ji(this._getRoot,[...this._slotBindings,[Nr(e)?e.slot:e,n]])}withCompute(e){return new Jc(this._getRoot(),this._slotBindings,e)}withVertex(e,n){return new Qc({branch:this._getRoot(),primitiveState:void 0,slotBindings:this._slotBindings,vertexFn:e,vertexAttribs:n})}},Jc=class{constructor(t,e,n){this._root=t,this._slotBindings=e,this._entryFn=n}createPipeline(){return jc(this._root,this._slotBindings,this._entryFn)}},Qc=class{constructor(t){this._options=t}withFragment(t,e,n){return On(typeof t!="string"),On(typeof e!="string"),new tl(ze(De({},this._options),{fragmentFn:t,targets:e}))}},tl=class Ri{constructor(e){this._options=e}withPrimitive(e){return new Ri(ze(De({},this._options),{primitiveState:e}))}createPipeline(){return Xc(this._options)}},Ni=class extends Hc{constructor(t,e,n,r){super(()=>this,[]),this.device=t,this.nameRegistry=e,this.jitTranspiler=n,this._ownDevice=r,A(this,"_disposables",[]),A(this,"_unwrappedBindGroupLayouts",new gs(o=>o.unwrap(this))),A(this,"_unwrappedBindGroups",new gs(o=>o.unwrap(this))),A(this,"_commandEncoder",null)}get commandEncoder(){return this._commandEncoder||(this._commandEncoder=this.device.createCommandEncoder()),this._commandEncoder}createBuffer(t,e){let n=Ku(this,t,e);return this._disposables.push(n),n}createTexture(t){let e=oc(t,this);return this._disposables.push(e),e}createBindGroup(t,e){return new Lr(t,e)}destroy(){for(let t of this._disposables)t.destroy();this._ownDevice&&this.device.destroy()}unwrap(t){if(Rc(t))return t.rawPipeline;if(Ai(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(mc(t))return this._unwrappedBindGroups.getOrMake(t);if(_r(t))return t.buffer;if(Xn(t)||ac(t)||uc(t))return t.unwrap();throw new Error(`Unknown resource type: ${t}`)}flush(){this._commandEncoder&&(this.device.queue.submit([this._commandEncoder.finish()]),this._commandEncoder=null)}};async function el(t){let{adapter:e,device:n,unstable_names:r="random",unstable_jitTranspiler:o}=t??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let f=await navigator.gpu.requestAdapter(e);if(!f)throw new Error("Could not find a compatible GPU");return new Ni(await f.requestDevice(n),r==="random"?new Br:new jr,o,!0)}function nl(t){let{device:e,unstable_names:n="random",unstable_jitTranspiler:r}=t??{};return new Ni(e,n==="random"?new Br:new jr,r,!1)}function rl(t,e){return new sl(t,e)}var sl=class{constructor(t,e){this.dataType=t,this._value=e,A(this,"_label")}get label(){return this._label}$name(t){return this._label=t,this}resolve(t){let e=t.names.makeUnique(this._label),n=t.resolveValue(this._value,this.dataType);return t.addDeclaration(`const ${e} = ${n};`),e}toString(){var t;return`const:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){return pe()?this:this._value}};function il(t){return new ol(t)}var ol=class{constructor(t){this.declaration=t,A(this,"externalsToApply",[])}$uses(t){return this.externalsToApply.push(t),this}resolve(t){let e={};for(let r of this.externalsToApply)Zn(e,r);let n=qr(t,e,this.declaration);return t.addDeclaration(n),""}toString(){return`declare: ${this.declaration}`}},Vi=new WeakMap;function al(t){return Vi.get(t)}function ul(t,e,n){return Vi.set(t,{ast:e,externals:n}),t}function ur(t,e){let n=[];return{label:void 0,applyExternals(r){n.push(r)},resolve(r,o=""){var f;let y={};for(let U of n)Zn(y,U);let v=r.names.makeUnique(this.label);if(typeof e=="string"){let U=qr(r,y,e.trim());r.addDeclaration(`${o}fn ${v}${U}`)}else{let U=al(e);if(U!=null&&U.externals){let z=Object.fromEntries(Object.entries(U.externals).filter(([j])=>!(j in y)));Zn(y,z)}let D=(f=U?.ast)!=null?f:r.transpileFn(String(e)),k=D.externalNames.filter(z=>!(z in y));if(k.length>0)throw new Ao(this.label,k);let P=D.argNames.map((z,j)=>({value:z,dataType:t.argTypes[j]})),{head:F,body:B}=r.fnToWgsl({args:P,returnType:t.returnType,body:D.body,externalMap:y});r.addDeclaration(`${o}fn ${v}${r.resolve(F)}${r.resolve(B)}`)}return v}}}function cl(t,e){var n,r,o;let{workgroupSize:f}=e;return{argTypes:[],returnType:void 0,workgroupSize:[(n=f[0])!=null?n:1,(r=f[1])!=null?r:1,(o=f[2])!=null?o:1],does(y){return ll(this,f,y)}}}function ll(t,e,n){let r=ur(t,n);return{shell:t,get label(){return r.label},$uses(o){return r.applyExternals(o),this},$name(o){return r.label=o,this},resolve(o){return r.resolve(o,`@compute @workgroup_size(${e.join(", ")}) `)},toString(){var o;return`computeFn:${(o=this.label)!=null?o:"<unnamed>"}`}}}function Li(t,e){return{argTypes:t,returnType:e,does(n){return dl(this,n)}}}function fl(t){return Li([]).does(t)}function hl(t){return t?.resourceType==="function"}function dl(t,e){let n=ur(t,e),r=Object.assign((...o)=>{if(pe())return new qi(r,o);if(typeof e=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");return e(...o)},{shell:t,resourceType:"function",$uses(o){return n.applyExternals(o),this},$name(o){return n.label=o,this},with(o,f){return Gi(r,Nr(o)?o.slot:o,f)},resolve(o){return n.resolve(o)}});return Object.defineProperty(r,"label",{get:()=>n.label}),Object.defineProperty(r,"toString",{value:()=>{var o;return`fn:${(o=n.label)!=null?o:"<unnamed>"}`}}),r}function Gi(t,e,n){let r={shell:t.shell,resourceType:"function",$uses(f){return t.$uses(f),this},$name(f){return t.$name(f),this},with(f,y){return Gi(o,Nr(f)?f.slot:f,y)},resolve(f){return f.withSlots([[e,n]],()=>f.resolve(t))}},o=Object.assign((...f)=>pe()?new qi(o,f):t(...f),r);return Object.defineProperty(o,"label",{get:()=>t.label}),Object.defineProperty(o,"toString",{value(){var f,y;return`fn:${(f=t.label)!=null?f:"<unnamed>"}[${(y=e.label)!=null?y:"<unnamed>"}=${n}]`}}),o}var qi=class{constructor(t,e){this._fn=t,this._params=e}get label(){return this._fn.label}resolve(t){return t.resolve(`${t.resolve(this._fn)}(${this._params.map(e=>t.resolve(e)).join(", ")})`)}toString(){var t;return`call:${(t=this.label)!=null?t:"<unnamed>"}`}};function pl(t){let e=0;return Object.fromEntries(Object.entries(t).map(([n,r])=>{if(ci(r))return[n,r];let o=vr(r);return o!==void 0?(e=o+1,[n,r]):[n,It(r,{type:"@location",value:e++})]}))}function Ci(t,e,n){var r,o,f;let y=sr(n)?bn(0,n):un(pl(n));if(typeof e=="string"){let v=(f=(o=(r=e.match(new RegExp("->(?<output>.*?){","s")))==null?void 0:r.groups)==null?void 0:o.output)==null?void 0:f.trim();v&&!/\s/g.test(v)&&t.applyExternals({[v]:y})}return y}function wl(t,e){return{argTypes:[t],returnType:e,does(n){return yl(this,n)}}}function yl(t,e){let n=ur(t,e),r=Ci(n,e,t.returnType);return{shell:t,outputType:r,get label(){return n.label},$uses(o){return n.applyExternals(o),this},$name(o){return n.label=o,Le(r)&&r.$name(`${o}_Output`),this},resolve(o){return n.resolve(o,"@fragment ")},toString(){var o;return`fragmentFn:${(o=this.label)!=null?o:"<unnamed>"}`}}}function ml(t,e){return{argTypes:[t],returnType:e,does(n){return gl(this,n)}}}function gl(t,e){let n=ur(t,e),r=Ci(n,e,t.returnType);return{shell:t,outputType:r,get label(){return n.label},$uses(o){return n.applyExternals(o),this},$name(o){return n.label=o,Le(r)&&r.$name(`${o}_Output`),this},resolve(o){return n.resolve(o,"@vertex ")},toString(){var o;return`vertexFn:${(o=this.label)!=null?o:"<unnamed>"}`}}}function Wi(t){return new xl(t)}var xl=class{constructor(t=void 0){this.defaultValue=t,A(this,"resourceType","slot"),A(this,"label")}$name(t){return this.label=t,this}areEqual(t,e){return Object.is(t,e)}toString(){var t;return`slot:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){let t=Qe();if(!t)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return t.unwrap(this)}};function vl(t,e){return new bl(t,e)}var bl=class{constructor(t,e=void 0){this.schema=t,this.defaultValue=e,A(this,"resourceType","accessor"),A(this,"label"),A(this,"slot"),this.slot=Wi(e)}$name(t){return this.label=t,this.slot.$name(t),this}toString(){var t;return`accessor:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!Qe())throw new Error("Cannot access tgpu.accessor's value outside of resolution.");return this}resolve(t){let e=t.unwrap(this.slot);return Qu(e)?t.resolve(e):hl(e)?`${t.resolve(e)}()`:t.resolveValue(e,this.schema)}};function _l(t){return $l(t)}function $l(t){return{resourceType:"derived","~compute":t,get value(){let e=Qe();if(!e)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return e.unwrap(this)},with(e,n){return Yi(t,this,[e,n])},toString(){return"derived"}}}function Yi(t,e,n){return{resourceType:"derived","~compute"(){let r=Qe();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return r.withSlots([n],()=>r.unwrap(e))},get value(){let r=Qe();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return r.unwrap(this)},with(r,o){return Yi(t,this,[r,o])},toString(){var r;let[o,f]=n;return`derived[${(r=o.label)!=null?r:"<unnamed>"}=${f}]`}}}function Sl(t,e){return new Xi("private",t,e)}function Ml(t){return new Xi("workgroup",t)}var Xi=class{constructor(t,e,n){this.scope=t,this._dataType=e,this._initialValue=n,A(this,"_label")}$name(t){return this._label=t,this}get label(){return this._label}resolve(t){let e=t.names.makeUnique(this._label);return this._initialValue?t.addDeclaration(`var<${this.scope}> ${e}: ${t.resolve(this._dataType)} = ${t.resolveValue(this._initialValue,this._dataType)};`):t.addDeclaration(`var<${this.scope}> ${e}: ${t.resolve(this._dataType)};`),e}toString(){var t;return`var:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!pe())throw new Error("Cannot access tgpu.var's value directly in JS.");return this}},Cr={Uniform:"uniform",Storage:"storage",Vertex:"vertex",fn:Li,procedure:fl,fragmentFn:wl,vertexFn:ml,computeFn:cl,vertexLayout:Fc,bindGroupLayout:Oi,derived:_l,slot:Wi,accessor:vl,privateVar:Sl,workgroupVar:Ml,const:rl,declare:il,init:el,initFromDevice:nl,resolve:Pc};Object.assign(Cr,{__assignAst:ul});var be=Cr;const Zi=Tr(),Tl=Zi.Provider;function Wr(){return Er(Zi,"useRootContext","RootContext")}function Dl(t){const[e]=so(()=>({adapterOptions:t.adapterOptions}),async({adapterOptions:n})=>{an(()=>{f?.destroy(),o?.destroy()});const r=await navigator.gpu?.requestAdapter(n);if(!r)throw new Error("Failed to get GPUAdapter, make sure to use a browser with WebGPU support.");console.info(`Using ${r.info.vendor} adapter.`);const o=await r?.requestDevice();if(!o)throw new Error("Failed to get GPUDevice, make sure to use a browser with WebGPU support.");const f=Cr.initFromDevice({device:o});return{adapter:r,device:o,root:f}});return Ht(Dr,{get when(){return e()},keyed:!0,children:n=>Ht(Tl,{value:n,get children(){return t.children}})})}function Ul(t,e){const[n,r]=qt();return Ae(()=>{const o=t();if(!o)return;const f=new ResizeObserver(y=>{const v=y[0]?.devicePixelContentBoxSize[0];if(!o.isConnected||!v)return;const{width:U,height:D}=o.getBoundingClientRect(),k=v.inlineSize,P=v.blockSize,F={width:U,height:D,widthPX:k,heightPX:P};r(F),e?.(F)});f.observe(o),an(()=>{f.disconnect()})}),n}var El=Ur("<canvas>");const{min:xs,max:vs}=Math;function Ol(t){const{device:e}=Wr(),[n,r]=qt(),o=Ul(n,y=>{const v=n();v&&(v.width=vs(1,xs(y.widthPX,e.limits.maxTextureDimension2D)),v.height=vs(1,xs(y.heightPX,e.limits.maxTextureDimension2D)))});function f(y){const v=y.getContext("webgpu");if(!v)throw new Error("GPUCanvasContext failed to initialize.");return v.configure({device:e,format:navigator.gpu.getPreferredCanvasFormat()}),v}return[(()=>{var y=El();return yo(r,y),y.style.setProperty("width","100%"),y.style.setProperty("height","100%"),$e(()=>Ce(y,t.class)),y})(),Ht(Dr,{get when(){return n()},keyed:!0,children:y=>Ht(Wu,{get value(){return{canvas:y,context:f(y),canvasSize:()=>({width:o()?.widthPX??0,height:o()?.heightPX??0})}},get children(){return t.children}})})]}const Ki=un({viewMatrix:nn,viewMatrixInverse:nn,resolution:q}).$name("Camera2DUniforms"),sn=be.bindGroupLayout({camera2DUniforms:{uniform:Ki}}).$name("Camera2DBindGroupLayout"),Al=be.fn([q],q).does(`(world: vec2f) -> vec2f {
      let clip = camera2DUniforms.viewMatrix * vec3(world, 1);
      return clip.xy / clip.z;
    }`).$uses({...sn.bound}).$name("camera2DWorldToClip"),kl=be.fn([q],q).does(`(clip: vec2f) -> vec2f {
      let world = camera2DUniforms.viewMatrixInverse * vec3(clip, 1);
      return world.xy / world.z;
    }`).$uses({...sn.bound}).$name("camera2DClipToWorld"),Il=be.fn([q],q).does(`(clip: vec2f) -> vec2f {
      return 0.5 * clip * camera2DUniforms.resolution;
    }`).$uses({...sn.bound}).$name("camera2DClipToPixels");function Pl(t){const{root:e}=Wr(),{canvasSize:n}=or(),r=()=>1/t.fovy,o=e.createBuffer(Ki).$usage("uniform").$name("Camera2DUniforms"),f=sn.populate({camera2DUniforms:o}),y=ge(()=>{const{position:D,fovy:k}=t,{x:P,y:F}=D,{width:B,height:z}=n(),j=B/z,tt=ui();Iu.ortho(P-j*k,P+j*k,F-k,F+k,0,0,tt);const it=nn(tt.columns[0].xyw,tt.columns[1].xyw,tt.columns[3].xyw),nt=ku.inverse(it,nn());return{viewMatrix:it,viewMatrixInverse:nt,resolution:q(B,z)}});function v({x:D,y:k}){return Pu.transformMat3(tn(D,k,1),y().viewMatrixInverse,q())}function U(){o.write(y())}return Ht($o,{value:{update:U,bindGroup:f,BindGroupLayout:sn,wgsl:{worldToClip:Al,clipToWorld:kl,clipToPixels:Il},js:{clipToWorld:v},zoom:r},get children(){return t.children}})}function Fl(t){const{canvas:e}=or(),[n,r]=qt(1),[o,f]=qt(q());let y;function v(U){U.preventDefault();const D=fi(U),k=y?.(D);if(!k)return;const P=n(),F=P*(1-U.deltaY*.001),B=P/F;$s(()=>{f(({x:z,y:j})=>q(z+(k.x-z)*(1-B),j+(k.y-j)*(1-B))),r(F)})}return Ae(()=>{e.addEventListener("wheel",v,{passive:!1}),an(()=>{e.removeEventListener("wheel",v)})}),Ht(Pl,{get position(){return o()},get fovy(){return 1/n()},get children(){return[ge(()=>(()=>{let{js:U}=Or();return y=U.clipToWorld,null})()),ge(()=>t.children)]}})}function zl(t){Ae(()=>{let e=-1;function n(){he(t),e=requestAnimationFrame(n)}an(()=>{cancelAnimationFrame(e)}),n()})}function Bl(t,...e){const n=[],r=[];for(let o=0;o<t.length;++o)if(r.push(t[o]),o<e.length){const f=e[o];typeof f=="object"?n.push(f):r.push(f)}return be.resolve({template:r.join(""),externals:Object.assign({},...n)})}const jl={color:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},on=un({position:pu.position,positionOriginal:bn(0,q),innerRatio:bn(1,I),styleIndex:bn(2,hu("flat, either",lt))}),Hi=un({center:q,radius:I,styleIndex:lt}).$name("Circle"),Mr=un({rimColor:G,fadeColor:G}),Rl=1e4,Ji=24,Kn=be.bindGroupLayout({circles:{storage:t=>en(Hi,t)},styles:{storage:t=>en(Mr,t)}}),Nl=be.fn([I,I,I],I).does(`
  (edge0: f32, edge1: f32, x: f32) -> f32 {
    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
  }`),Vl=t=>be.fn([lt,lt],on).does(`
    (vertexIndex: u32, instanceIndex: u32) -> VertexOutput {
      const SUBDIVS = ${Ji};
      const WEDGE_ANGLE = radians(360.0) / SUBDIVS;
      const MIN_INNER_RADIUS = 0.5;
      const MAX_INNER_RADIUS = 0.95;
      const OVERSIZE_FACTOR = 1.01;

      let circle = circles[instanceIndex];
      let angle = f32(vertexIndex / 2) * WEDGE_ANGLE;
      let unitCircle = vec2f(cos(angle), sin(angle));
      let clip0 = worldToClip(circle.center);
      let clip1 = worldToClip(circle.center + unitCircle * circle.radius);
      let lengthPX = length(clipToPixels(clip1 - clip0));
      let innerRatio = clamp(1 - 20 / lengthPX, MIN_INNER_RADIUS, MAX_INNER_RADIUS);
      let ratio = select(innerRatio, OVERSIZE_FACTOR, vertexIndex % 2 == 0);
      let clip = mix(clip0, clip1, ratio);

      var out: VertexOutput;
      out.position = vec4f(clip, 0, 1);
      out.positionOriginal = mix(vec2f(0,0), unitCircle, ratio);
      out.innerRatio = innerRatio;
      out.styleIndex = circle.styleIndex;
      return out;
    }
  `).$uses({VertexOutput:on,...t.BindGroupLayout.bound,circles:Kn.bound.circles,worldToClip:t.wgsl.worldToClip,clipToPixels:t.wgsl.clipToPixels}),Ll=be.fn([on],G).does(`
    (in: VertexOutput) -> vec4f {
      const OUTER_RADIUS = 1.0;
      let style = styles[in.styleIndex];
      let dist = length(in.positionOriginal);
      let distWidth = fwidth(dist);
      // adding half a distWidth in order for circles to touch fully
      let disk = clamp((0.5*distWidth + OUTER_RADIUS - dist) / distWidth, 0, 1);
      let fade = linearstep(in.innerRatio, OUTER_RADIUS, dist);
      return mix(style.fadeColor, style.rimColor, fade * fade) * vec4f(1, 1, 1, disk * fade);
    }
  `).$uses({VertexOutput:on,styles:Kn.bound.styles,linearstep:Nl});function Gl(t){const e=Or(),{root:n,device:r}=Wr(),{context:o}=or(),f=n.createBuffer(en(Hi,Rl)).$usage("storage").$name("circles");Ae(()=>{f.write(t.circles)});const y=n.createBuffer(Mr).$usage("uniform").$name("color");Ae(()=>{y.write(t.color??{rimColor:G(0,0,0,1),fadeColor:G(0,0,0,1)})});const v=n.createBuffer(en(Mr,t.styles.length)).$usage("storage").$name("styles");Ae(()=>{v.write(t.styles)});const U=ge(()=>{const k=Bl`
      ${{VertexOutput:on,vert:Vl(e),frag:Ll}}

      @vertex fn vs(
        @builtin(vertex_index) vertexIndex: u32,
        @builtin(instance_index) instanceIndex: u32,
      ) -> VertexOutput {
        return vert(vertexIndex, instanceIndex);
      }

      @fragment fn fs(in: VertexOutput) -> @location(0) vec4f {
        let color = frag(in);
        return vec4f(color.rgb * color.a, color.a);
      }
    `,P=r.createShaderModule({label:"our hardcoded red triangle shaders",code:k}),F=r.createRenderPipeline({label:"our hardcoded red triangle pipeline",primitive:{topology:"triangle-strip"},layout:r.createPipelineLayout({bindGroupLayouts:[n.unwrap(e.BindGroupLayout),n.unwrap(Kn)]}),vertex:{entryPoint:"vs",module:P},fragment:{entryPoint:"fs",module:P,targets:[{format:navigator.gpu.getPreferredCanvasFormat(),blend:jl}]}}),B=Kn.populate({circles:f.buffer,styles:v.buffer});return{pipeline:F,uniformBindGroup:B}});return zl(()=>{const{pipeline:k,uniformBindGroup:P}=U(),F=o.getCurrentTexture().createView();e.update();const B=r.createCommandEncoder(),z=B.beginRenderPass({label:"our basic canvas renderPass",colorAttachments:[{clearValue:t.clearColor??[1,1,1,1],loadOp:"clear",storeOp:"store",view:F}]});z.setPipeline(k),z.setBindGroup(0,n.unwrap(e.bindGroup)),z.setBindGroup(1,n.unwrap(P)),t.circles.length>0&&z.draw((Ji+1)*2,t.circles.length),z.end();const j=B.finish();r.queue.submit([j])}),null}var ql=Ur("<div><h1>Apollonian Circles</h1><span>Click to create, scroll to zoom."),Cl=Ur("<div><div>Number of Circles: </div><div><label><input type=checkbox> Debug mode");const Wl={rimColor:G(0,0,0,1),fadeColor:G(0,0,0,1)},Yl={rimColor:G(0,0,0,1),fadeColor:G(.5,.8,1,1)},Xl={rimColor:G(0,0,0,1),fadeColor:G(1,0,0,1)},Zl={rimColor:G(0,0,0,1),fadeColor:G(0,1,0,1)},Kl={rimColor:G(0,0,0,1),fadeColor:G(0,0,1,1)},Hl=[Yl,Xl,Zl,Kl,Wl];function Jl(){const{js:{clipToWorld:t},zoom:e}=Or(),[n,r]=qt(),[o,f]=qt(),[y,v]=qt(),[U,D]=qt();async function k(z,j){for(;;){const tt=fi(z),it=t(tt),nt=Ru(it);r(nt),f(void 0),v(void 0),D(void 0);const ot=Nu(nt);if(await fr(nt,ot.radius,ot.curve,e,j),ot.index===void 0)return;f(ot.index);const rt=Lu(ot.index,nt);if(await fr(nt,rt.radius,rt.curve,e,j),rt.index===void 0)return;v(rt.index);const dt=Cu(ot.index,rt.index,nt);if(await fr(nt,dt.radius,dt.curve,e,j),dt.index===void 0)return;D(dt.index),r(void 0);{const gt=ce[nt];if(ft.distance(gt.center,it)<gt.radius)return}if(await Promise.race([vi(),j])instanceof PointerEvent)return}}const{canvas:P}=or();async function F(z){const{currentTarget:j}=z;if(!(j instanceof HTMLElement))return;j.setPointerCapture(z.pointerId);const{promise:tt,resolve:it}=Yu();j.addEventListener("pointerup",it),tt.finally(()=>{j.removeEventListener("pointerup",it)}),k(z,tt)}Ae(()=>{P.addEventListener("pointerdown",F),an(()=>{P.removeEventListener("pointerdown",F)})});function B(z){if(z===n())return 0;if($i())switch(z){case o():return 1;case y():return 2;case U():return 3}return 4}return Ht(Gl,{get circles(){return ce.map((z,j)=>({...z,styleIndex:B(j)}))},styles:Hl})}function Ql(){return(()=>{var t=Cl(),e=t.firstChild;e.firstChild;var n=e.nextSibling,r=n.firstChild,o=r.firstChild;return gn(e,()=>ce.length,null),o.addEventListener("change",f=>ju(f.target.checked)),gn(t,Ht(Dr,{get when(){return ce.length===0},get children(){var f=ql();return $e(()=>Ce(f,qe.welcomeMessage)),f}}),null),gn(t,Ht(Dl,{get children(){return Ht(Ol,{get class(){return qe.canvas},get children(){return Ht(Fl,{get children(){return Ht(Jl,{})}})}})}}),null),$e(f=>{var y=qe.page,v=qe.circleCounter,U=qe.controls;return y!==f.e&&Ce(t,f.e=y),v!==f.t&&Ce(e,f.t=v),U!==f.a&&Ce(n,f.a=U),f},{e:void 0,t:void 0,a:void 0}),$e(()=>o.checked=$i()),t})()}const tf=document.getElementById("root");wo(()=>Ht(Ql,{}),tf);
