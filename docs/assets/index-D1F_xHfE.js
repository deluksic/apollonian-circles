(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function n(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(a){if(a.ep)return;a.ep=!0;const d=n(a);fetch(a.href,d)}})();const Si=(t,e)=>t===e,yn={equals:Si};let ws=vs;const ge=1,gn=2,ms={owned:null,cleanups:null,context:null,owner:null},Gn={};var dt=null;let qn=null,Di=null,mt=null,kt=null,me=null,En=0;function Ui(t,e){const n=mt,r=dt,a=t.length===0,d=e===void 0?r:e,m=a?ms:{owned:null,cleanups:null,context:d?d.context:null,owner:d},g=a?t:()=>t(()=>de(()=>Ce(m)));dt=m,mt=null;try{return _e(g,!0)}finally{mt=n,dt=r}}function Nt(t,e){e=e?Object.assign({},yn,e):yn;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=a=>(typeof a=="function"&&(a=a(n.value)),gs(n,a));return[ys.bind(n),r]}function Ei(t,e,n){const r=On(t,e,!0,ge);Be(r)}function we(t,e,n){const r=On(t,e,!1,ge);Be(r)}function Ie(t,e,n){ws=ji;const r=On(t,e,!1,ge);r.user=!0,me?me.push(r):Be(r)}function ce(t,e,n){n=n?Object.assign({},yn,n):yn;const r=On(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Be(r),ys.bind(r)}function Oi(t){return t&&typeof t=="object"&&"then"in t}function Ii(t,e,n){let r,a,d;arguments.length===2&&typeof e=="object"||arguments.length===1?(r=!0,a=t,d=e):(r=t,a=e,d={});let m=null,g=Gn,T=!1,I="initialValue"in d,A=typeof r=="function"&&ce(r);const z=new Set,[F,j]=(d.storage||Nt)(d.initialValue),[B,P]=Nt(void 0),[q,st]=Nt(void 0,{equals:!1}),[ot,it]=Nt(I?"ready":"unresolved");function et(nt,J,X,ct){return m===nt&&(m=null,ct!==void 0&&(I=!0),(nt===g||J===g)&&d.onHydrated&&queueMicrotask(()=>d.onHydrated(ct,{value:J})),g=Gn,at(J,X)),J}function at(nt,J){_e(()=>{J===void 0&&j(()=>nt),it(J!==void 0?"errored":I?"ready":"unresolved"),P(J);for(const X of z.keys())X.decrement();z.clear()},!1)}function ut(){const nt=zi,J=F(),X=B();if(X!==void 0&&!m)throw X;return mt&&mt.user,J}function vt(nt=!0){if(nt!==!1&&T)return;T=!1;const J=A?A():r;if(J==null||J===!1){et(m,de(F));return}const X=g!==Gn?g:de(()=>a(J,{value:F(),refetching:nt}));return Oi(X)?(m=X,"value"in X?(X.status==="success"?et(m,X.value,void 0,J):et(m,void 0,Xn(X.value),J),X):(T=!0,queueMicrotask(()=>T=!1),_e(()=>{it(I?"refreshing":"pending"),st()},!1),X.then(ct=>et(X,ct,void 0,J),ct=>et(X,void 0,Xn(ct),J)))):(et(m,X,void 0,J),X)}return Object.defineProperties(ut,{state:{get:()=>ot()},error:{get:()=>B()},loading:{get(){const nt=ot();return nt==="pending"||nt==="refreshing"}},latest:{get(){if(!I)return ut();const nt=B();if(nt&&!m)throw nt;return F()}}}),A?Ei(()=>vt(!1)):vt(!1),[ut,{refetch:vt,mutate:j}]}function Ai(t){return _e(t,!1)}function de(t){if(mt===null)return t();const e=mt;mt=null;try{return t()}finally{mt=e}}function Je(t){return dt===null||(dt.cleanups===null?dt.cleanups=[t]:dt.cleanups.push(t)),t}function br(t,e){const n=Symbol("context");return{id:n,Provider:Ri(n),defaultValue:t}}function ki(t){let e;return dt&&dt.context&&(e=dt.context[t.id])!==void 0?e:t.defaultValue}function Fi(t){const e=ce(t),n=ce(()=>Zn(e()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let zi;function ys(){if(this.sources&&this.state)if(this.state===ge)Be(this);else{const t=kt;kt=null,_e(()=>xn(this),!1),kt=t}if(mt){const t=this.observers?this.observers.length:0;mt.sources?(mt.sources.push(this),mt.sourceSlots.push(t)):(mt.sources=[this],mt.sourceSlots=[t]),this.observers?(this.observers.push(mt),this.observerSlots.push(mt.sources.length-1)):(this.observers=[mt],this.observerSlots=[mt.sources.length-1])}return this.value}function gs(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&_e(()=>{for(let a=0;a<t.observers.length;a+=1){const d=t.observers[a],m=qn&&qn.running;m&&qn.disposed.has(d),(m?!d.tState:!d.state)&&(d.pure?kt.push(d):me.push(d),d.observers&&xs(d)),m||(d.state=ge)}if(kt.length>1e6)throw kt=[],new Error},!1)),e}function Be(t){if(!t.fn)return;Ce(t);const e=En;Pi(t,t.value,e)}function Pi(t,e,n){let r;const a=dt,d=mt;mt=dt=t;try{r=t.fn(e)}catch(m){return t.pure&&(t.state=ge,t.owned&&t.owned.forEach(Ce),t.owned=null),t.updatedAt=n+1,bs(m)}finally{mt=d,dt=a}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?gs(t,r):t.value=r,t.updatedAt=n)}function On(t,e,n,r=ge,a){const d={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:dt,context:dt?dt.context:null,pure:n};return dt===null||dt!==ms&&(dt.owned?dt.owned.push(d):dt.owned=[d]),d}function vn(t){if(t.state===0)return;if(t.state===gn)return xn(t);if(t.suspense&&de(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<En);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===ge)Be(t);else if(t.state===gn){const r=kt;kt=null,_e(()=>xn(t,e[0]),!1),kt=r}}function _e(t,e){if(kt)return t();let n=!1;e||(kt=[]),me?n=!0:me=[],En++;try{const r=t();return Bi(n),r}catch(r){n||(me=null),kt=null,bs(r)}}function Bi(t){if(kt&&(vs(kt),kt=null),t)return;const e=me;me=null,e.length&&_e(()=>ws(e),!1)}function vs(t){for(let e=0;e<t.length;e++)vn(t[e])}function ji(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:vn(r)}for(e=0;e<n;e++)vn(t[e])}function xn(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const a=r.state;a===ge?r!==e&&(!r.updatedAt||r.updatedAt<En)&&vn(r):a===gn&&xn(r,e)}}}function xs(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=gn,n.pure?kt.push(n):me.push(n),n.observers&&xs(n))}}function Ce(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),a=n.observers;if(a&&a.length){const d=a.pop(),m=n.observerSlots.pop();r<a.length&&(d.sourceSlots[m]=r,a[r]=d,n.observerSlots[r]=m)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ce(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ce(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Xn(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function bs(t,e=dt){throw Xn(t)}function Zn(t){if(typeof t=="function"&&!t.length)return Zn(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=Zn(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function Ri(t,e){return function(r){let a;return we(()=>a=de(()=>(dt.context={...dt.context,[t]:r.value},Fi(()=>r.children))),void 0),a}}function Kt(t,e){return de(()=>t(e||{}))}const Vi=t=>`Stale read from <${t}>.`;function _r(t){const e=t.keyed,n=ce(()=>t.when,void 0,{equals:(r,a)=>e?r===a:!r==!a});return ce(()=>{const r=n();if(r){const a=t.children;return typeof a=="function"&&a.length>0?de(()=>a(e?r:()=>{if(!de(n))throw Vi("Show");return t.when})):a}return t.fallback},void 0,void 0)}function Ni(t,e,n){let r=n.length,a=e.length,d=r,m=0,g=0,T=e[a-1].nextSibling,I=null;for(;m<a||g<d;){if(e[m]===n[g]){m++,g++;continue}for(;e[a-1]===n[d-1];)a--,d--;if(a===m){const A=d<r?g?n[g-1].nextSibling:n[d-g]:T;for(;g<d;)t.insertBefore(n[g++],A)}else if(d===g)for(;m<a;)(!I||!I.has(e[m]))&&e[m].remove(),m++;else if(e[m]===n[d-1]&&n[g]===e[a-1]){const A=e[--a].nextSibling;t.insertBefore(n[g++],e[m++].nextSibling),t.insertBefore(n[--d],A),e[a]=n[d]}else{if(!I){I=new Map;let z=g;for(;z<d;)I.set(n[z],z++)}const A=I.get(e[m]);if(A!=null)if(g<A&&A<d){let z=m,F=1,j;for(;++z<a&&z<d&&!((j=I.get(e[z]))==null||j!==A+F);)F++;if(F>A-g){const B=e[m];for(;g<A;)t.insertBefore(n[g++],B)}else t.replaceChild(n[g++],e[m++])}else m++;else e[m++].remove()}}}function Li(t,e,n,r={}){let a;return Ui(d=>{a=d,e===document?t():ln(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{a(),e.textContent=""}}function $r(t,e,n){let r;const a=()=>{const m=document.createElement("template");return m.innerHTML=t,m.content.firstChild},d=()=>(r||(r=a())).cloneNode(!0);return d.cloneNode=d,d}function ze(t,e){e==null?t.removeAttribute("class"):t.className=e}function Gi(t,e,n={}){const r=Object.keys(e),a=Object.keys(n);let d,m;for(d=0,m=a.length;d<m;d++){const g=a[d];!g||g==="undefined"||e[g]||(Cr(t,g,!1),delete n[g])}for(d=0,m=r.length;d<m;d++){const g=r[d],T=!!e[g];!g||g==="undefined"||n[g]===T||!T||(Cr(t,g,!0),n[g]=T)}return n}function qi(t,e,n){return de(()=>t(e,n))}function ln(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return bn(t,e,r,n);we(a=>bn(t,e(),a,n),r)}function Cr(t,e,n){const r=e.trim().split(/\s+/);for(let a=0,d=r.length;a<d;a++)t.classList.toggle(r[a],n)}function bn(t,e,n,r,a){for(;typeof n=="function";)n=n();if(e===n)return n;const d=typeof e,m=r!==void 0;if(t=m&&n[0]&&n[0].parentNode||t,d==="string"||d==="number"){if(d==="number"&&(e=e.toString(),e===n))return n;if(m){let g=n[0];g&&g.nodeType===3?g.data!==e&&(g.data=e):g=document.createTextNode(e),n=ke(t,n,r,g)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||d==="boolean")n=ke(t,n,r);else{if(d==="function")return we(()=>{let g=e();for(;typeof g=="function";)g=g();n=bn(t,g,n,r)}),()=>n;if(Array.isArray(e)){const g=[],T=n&&Array.isArray(n);if(Kn(g,e,n,a))return we(()=>n=bn(t,g,n,r,!0)),()=>n;if(g.length===0){if(n=ke(t,n,r),m)return n}else T?n.length===0?Wr(t,g,r):Ni(t,n,g):(n&&ke(t),Wr(t,g));n=g}else if(e.nodeType){if(Array.isArray(n)){if(m)return n=ke(t,n,r,e);ke(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Kn(t,e,n,r){let a=!1;for(let d=0,m=e.length;d<m;d++){let g=e[d],T=n&&n[t.length],I;if(!(g==null||g===!0||g===!1))if((I=typeof g)=="object"&&g.nodeType)t.push(g);else if(Array.isArray(g))a=Kn(t,g,T)||a;else if(I==="function")if(r){for(;typeof g=="function";)g=g();a=Kn(t,Array.isArray(g)?g:[g],Array.isArray(T)?T:[T])||a}else t.push(g),a=!0;else{const A=String(g);T&&T.nodeType===3&&T.data===A?t.push(T):t.push(document.createTextNode(A))}}return a}function Wr(t,e,n=null){for(let r=0,a=e.length;r<a;r++)t.insertBefore(e[r],n)}function ke(t,e,n,r){if(n===void 0)return t.textContent="";const a=r||document.createTextNode("");if(e.length){let d=!1;for(let m=e.length-1;m>=0;m--){const g=e[m];if(a!==g){const T=g.parentNode===t;!d&&!m?T?t.replaceChild(a,g):t.insertBefore(a,n):T&&g.remove()}else d=!0}}else t.insertBefore(a,n);return[a]}const Ci="_light_16okt_1",Wi="_dark_16okt_6",Yi="_page_16okt_12",Xi="_controls_16okt_23",Zi="_circle-counter_16okt_37",Ki="_welcome-message_16okt_57",Hi="_fade-in_16okt_1",Ji="_welcomeMessageSubtitle_16okt_74",Qi="_canvas_16okt_78",Te={light:Ci,dark:Wi,page:Yi,controls:Xi,circleCounter:Zi,welcomeMessage:Ki,fadeIn:Hi,welcomeMessageSubtitle:Ji,canvas:Qi};function Tr(t,e,n){const r=ki(t);if(r===void 0)throw new Error(`Called '${e}' outside of ${n!==void 0?`<${n}>`:"its Provider"}.`);return r}const _s=br(),to=_s.Provider;function Mr(){return Tr(_s,"useCamera","CameraContext")}var eo=Object.defineProperty,no=Object.defineProperties,ro=Object.getOwnPropertyDescriptors,Yr=Object.getOwnPropertySymbols,so=Object.prototype.hasOwnProperty,io=Object.prototype.propertyIsEnumerable,Cn=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Hn=(t,e,n)=>e in t?eo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,De=(t,e)=>{for(var n in e||(e={}))so.call(e,n)&&Hn(t,n,e[n]);if(Yr)for(var n of Yr(e))io.call(e,n)&&Hn(t,n,e[n]);return t},Pe=(t,e)=>no(t,ro(e)),E=(t,e,n)=>(Hn(t,typeof e!="symbol"?e+"":e,n),n),oo=function(t,e){this[0]=t,this[1]=e},ao=t=>{var e=t[Cn("asyncIterator")],n=!1,r,a={};return e==null?(e=t[Cn("iterator")](),r=d=>a[d]=m=>e[d](m)):(e=e.call(t),r=d=>a[d]=m=>{if(n){if(n=!1,d==="throw")throw m;return m}return n=!0,{done:!1,value:new oo(new Promise(g=>{var T=e[d](m);if(!(T instanceof Object))throw TypeError("Object expected");g(T)}),1)}}),a[Cn("iterator")]=()=>a,r("next"),"throw"in e?r("throw"):a.throw=d=>{throw d},"return"in e&&r("return"),a},uo="Invariant failed";function _n(t,e){if(!t)throw new Error(uo)}var un=class Jn extends Error{constructor(e,n){let r=n.map(a=>`- ${a}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Resolution of the following tree failed: 
${r.join(`
`)}`),this.cause=e,this.trace=n,Object.setPrototypeOf(this,Jn.prototype)}appendToTrace(e){let n=[e,...this.trace];return new Jn(this.cause,n)}},co=class $s extends Error{constructor(e){super(`Missing value for '${e}'`),this.slot=e,Object.setPrototypeOf(this,$s.prototype)}},Xr=class Ts extends Error{constructor(e){var n;super(`Buffer '${(n=e.label)!=null?n:"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,Ts.prototype)}},lo=class Ms extends Error{constructor(e,n){super(`The function '${e??"<unnamed>"}' is missing links to the following external values: ${n}.`),Object.setPrototypeOf(this,Ms.prototype)}},Ss=class Ds extends Error{constructor(e){super(`Bind group was not provided for '${e??"<unnamed>"}' layout.`),Object.setPrototypeOf(this,Ds.prototype)}},Ne=null;function fo(t,e){_n(Ne===null),Ne=t;try{return e()}finally{Ne=null}}function We(){return Ne}var le=()=>Ne!==null;function*ho(t){let e=0;for(;;)t.has(e)||(yield e),e++}function*Us(t,e){if(e>1)for(let n of Us(t,e-1))for(let r of t)yield n+r;else yield*ao(t)}var Sr=class extends Array{"~resolve"(){return`${this.kind}(${this.join(", ")})`}toString(){return this["~resolve"]()}},In=class extends Sr{constructor(t,e){var n;super(),E(this,0),E(this,1),this[0]=t??0,this[1]=(n=e??t)!=null?n:0}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}},An=class extends Sr{constructor(e,n,r){var a,d;super(),E(this,0),E(this,1),E(this,2),this[0]=e??0,this[1]=(a=n??e)!=null?a:0,this[2]=(d=r??e)!=null?d:0}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}},kn=class extends Sr{constructor(e,n,r,a){var d,m,g;super(),E(this,0),E(this,1),E(this,2),E(this,3),this[0]=e??0,this[1]=(d=n??e)!=null?d:0,this[2]=(m=r??e)!=null?m:0,this[3]=(g=a??e)!=null?g:0}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set w(e){this[3]=e}},Qn=class extends In{constructor(){super(...arguments),E(this,"kind","vec2f")}},tr=class extends In{constructor(){super(...arguments),E(this,"kind","vec2h")}},er=class extends In{constructor(){super(...arguments),E(this,"kind","vec2i")}},nr=class extends In{constructor(){super(...arguments),E(this,"kind","vec2u")}},rr=class extends An{constructor(){super(...arguments),E(this,"kind","vec3f")}},sr=class extends An{constructor(){super(...arguments),E(this,"kind","vec3h")}},ir=class extends An{constructor(){super(...arguments),E(this,"kind","vec3i")}},or=class extends An{constructor(){super(...arguments),E(this,"kind","vec3u")}},ar=class extends kn{constructor(){super(...arguments),E(this,"kind","vec4f")}},ur=class extends kn{constructor(){super(...arguments),E(this,"kind","vec4h")}},cr=class extends kn{constructor(){super(...arguments),E(this,"kind","vec4i")}},lr=class extends kn{constructor(){super(...arguments),E(this,"kind","vec4u")}};function Jt(t,e,n){let r={x:0,y:1,z:2,w:3};for(let a of[2,3,4]){let d=n[a],m=`_Vec${a}`;Object.defineProperty(t.prototype,m,{value:d,configurable:!1,enumerable:!1,writable:!1});for(let g of Us(e,a)){let T=new Function(`return new this.${m}(
          ${[...g].map(I=>`this[${r[I]}]`)}
        )`);Object.defineProperty(t.prototype,g,{get:T,configurable:!1,enumerable:!1})}}}function po(){let t={f:{2:Qn,3:rr,4:ar},h:{2:tr,3:sr,4:ur},i:{2:er,3:ir,4:cr},u:{2:nr,3:or,4:lr}};Jt(Qn,"xy",t.f),Jt(tr,"xy",t.h),Jt(er,"xy",t.i),Jt(nr,"xy",t.u),Jt(rr,"xyz",t.f),Jt(sr,"xyz",t.h),Jt(ir,"xyz",t.i),Jt(or,"xyz",t.u),Jt(ar,"xyzw",t.f),Jt(ur,"xyzw",t.h),Jt(cr,"xyzw",t.i),Jt(lr,"xyzw",t.u)}po();function ne(t){let e={"~repr":void 0,type:t.type};return Object.assign((...n)=>{let r=n;if(le())return`${e.type}(${r.join(", ")})`;if(r.length<=1||r.length===t.length)return t.make(...r);throw new Error(`'${t.type}' constructor called with invalid number of arguments.`)},e)}var C=ne({type:"vec2f",length:2,make:(t,e)=>new Qn(t,e)}),wo=ne({type:"vec2h",length:2,make:(t,e)=>new tr(t,e)}),Ue=ne({type:"vec2i",length:2,make:(t,e)=>new er(t,e)}),Ee=ne({type:"vec2u",length:2,make:(t,e)=>new nr(t,e)}),Ye=ne({type:"vec3f",length:3,make:(t,e,n)=>new rr(t,e,n)}),mo=ne({type:"vec3h",length:3,make:(t,e,n)=>new sr(t,e,n)}),fr=ne({type:"vec3i",length:3,make:(t,e,n)=>new ir(t,e,n)}),Oe=ne({type:"vec3u",length:3,make:(t,e,n)=>new or(t,e,n)}),L=ne({type:"vec4f",length:4,make:(t,e,n,r)=>new ar(t,e,n,r)}),yo=ne({type:"vec4h",length:4,make:(t,e,n,r)=>new ur(t,e,n,r)}),te=ne({type:"vec4i",length:4,make:(t,e,n,r)=>new cr(t,e,n,r)}),ee=ne({length:4,type:"vec4u",make:(t,e,n,r)=>new lr(t,e,n,r)}),Es=Object.defineProperty,go=(t,e,n)=>e in t?Es(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vo=(t,e)=>{for(var n in e)Es(t,n,{get:e[n],enumerable:!0})},Q=(t,e,n)=>go(t,typeof e!="symbol"?e+"":e,n),Os={};vo(Os,{BufferReader:()=>fn,BufferWriter:()=>hn,MaxValue:()=>gt,Measurer:()=>yt,UnresolvedReferenceError:()=>Se,ValidationError:()=>Fn,arrayOf:()=>To,bool:()=>So,byte:()=>Ao,chars:()=>Wo,concat:()=>Ko,dynamicArrayOf:()=>Jo,f16:()=>Lo,f32:()=>qo,f32Array:()=>pa,f64Array:()=>wa,generic:()=>Xo,genericEnum:()=>Zo,i16:()=>Fo,i16Array:()=>ha,i32:()=>jo,i32Array:()=>da,i8:()=>Oo,i8Array:()=>fa,keyed:()=>ea,object:()=>Yo,optional:()=>ra,string:()=>Uo,tupleOf:()=>oa,u16:()=>Po,u16Array:()=>ca,u32:()=>Vo,u32Array:()=>la,u8:()=>zs,u8Array:()=>aa,u8ClampedArray:()=>ua});var Se=class Is extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Is.prototype)}},Fn=class As extends Error{constructor(e){super(e),Object.setPrototypeOf(this,As.prototype)}},xo=class{constructor(){Q(this,"size",Number.NaN),Q(this,"unbounded",this),Q(this,"isUnbounded",!0)}add(){return this}fork(){return this}},bo=new xo,yt=class ks{constructor(){Q(this,"size",0),Q(this,"unbounded",bo),Q(this,"isUnbounded",!1)}add(e){return this.size+=e,this}fork(){const e=new ks;return e.size=this.size,e}},gt=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),Tt=class{constructor(){Q(this,"__unwrapped")}resolveReferences(t){}seekProperty(t,e){return null}},_o=class{constructor(t){this.key=t}},Le={STRING:"string",ENUM:"enum"},$o=class extends Tt{constructor(t,e){super(),this._unstableElementSchema=t,this.length=e,Q(this,"elementSchema"),this.elementSchema=t}resolveReferences(t){this.elementSchema=t.resolve(this._unstableElementSchema)}write(t,e){if(e.length!==this.length)throw new Fn(`Expected array of length ${this.length}, got ${e.length}`);for(const n of e)this.elementSchema.write(t,n)}read(t){const e=[];for(let n=0;n<this.length;++n)e.push(this.elementSchema.read(t));return e}get maxSize(){return this.elementSchema.measure(gt).size*this.length}measure(t,e=new yt){for(let n=0;n<this.length;++n)this.elementSchema.measure(t===gt?gt:t[n],e);return e}};function To(t,e){return new $o(t,e)}var Mo=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",1)}read(t){return t.readBool()}write(t,e){t.writeBool(e)}measure(t,e=new yt){return e.add(1)}},So=new Mo,Fs=class Ve extends Tt{static get _encoder(){return Ve._cachedEncoder||(Ve._cachedEncoder=new TextEncoder),Ve._cachedEncoder}read(e){return e.readString()}write(e,n){e.writeString(n)}measure(e,n=new yt){if(e===gt)return n.unbounded;const r=Ve._encoder.encode(e);return n.add(r.byteLength+1)}};Q(Fs,"_cachedEncoder");var Do=Fs,Uo=new Do,Eo=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",1)}read(t){return t.readInt8()}write(t,e){t.writeInt8(e)}measure(t,e=new yt){return e.add(1)}},Oo=new Eo,Io=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",1)}read(t){return t.readUint8()}write(t,e){t.writeUint8(e)}measure(t,e=new yt){return e.add(1)}},zs=new Io,Ao=zs,ko=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",2)}read(t){return t.readInt16()}write(t,e){t.writeInt16(e)}measure(t,e=new yt){return e.add(2)}},Fo=new ko,zo=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",2)}read(t){return t.readUint16()}write(t,e){t.writeUint16(e)}measure(t,e=new yt){return e.add(2)}},Po=new zo,Bo=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",4)}read(t){return t.readInt32()}write(t,e){t.writeInt32(e)}measure(t,e=new yt){return e.add(4)}},jo=new Bo,Ro=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",4)}read(t){return t.readUint32()}write(t,e){t.writeUint32(e)}measure(t,e=new yt){return e.add(4)}},Vo=new Ro,No=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",2)}read(t){return t.readFloat16()}write(t,e){t.writeFloat16(e)}measure(t,e=new yt){return e.add(2)}},Lo=new No,Go=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",4)}read(t){return t.readFloat32()}write(t,e){t.writeFloat32(e)}measure(t,e=new yt){return e.add(4)}},qo=new Go,Co=class extends Tt{constructor(t){super(),this.length=t}write(t,e){if(e.length!==this.length)throw new Fn(`Expected char-string of length ${this.length}, got ${e.length}`);for(let n=0;n<e.length;++n)t.writeUint8(e.charCodeAt(n))}read(t){let e="";for(let n=0;n<this.length;++n)e+=String.fromCharCode(t.readByte());return e}measure(t,e=new yt){return e.add(this.length)}};function Wo(t){return new Co(t)}function be(t){return Object.entries(t)}function Ps(t,e){const n={};for(const[r,a]of be(e))n[r]=t.resolve(a);return n}var Dr=class extends Tt{constructor(t){super(),this._properties=t,Q(this,"properties"),this.properties=t}resolveReferences(t){this.properties=Ps(t,this._properties)}write(t,e){for(const[n,r]of be(this.properties))r.write(t,e[n])}read(t){const e={};for(const[n,r]of be(this.properties))e[n]=r.read(t);return e}get maxSize(){const t=new yt;for(const e of Object.values(this.properties))e.measure(gt,t);return t.size}measure(t,e=new yt){for(const[n,r]of be(this.properties))r.measure(t===gt?gt:t[n],e);return e}seekProperty(t,e){let n=0;for(const[r,a]of be(this.properties)){if(r===e)return{bufferOffset:n,schema:a};n+=a.measure(t).size}return null}};function Yo(t){return new Dr(t)}var Bs=class extends Tt{constructor(t,e,n){super(),this.keyedBy=t,this._subTypeMap=n,Q(this,"_baseObject"),Q(this,"subTypeMap"),this._baseObject=new Dr(e),this.subTypeMap=n}resolveReferences(t){this._baseObject.resolveReferences(t),this.subTypeMap=Ps(t,this._subTypeMap)}write(t,e){const n=e.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===Le.ENUM?t.writeUint8(e.type):t.writeString(e.type),this._baseObject.write(t,e);for(const[a,d]of be(r.properties))d.write(t,e[a])}read(t){const e=this.keyedBy===Le.ENUM?t.readByte():t.readString(),n=this.subTypeMap[e]||null;if(n===null)throw new Error(`Unknown sub-type '${e}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const r=this._baseObject.read(t);if(r.type=e,n!==null)for(const[a,d]of be(n.properties))r[a]=d.read(t);return r}measure(t,e=new yt){if(this._baseObject.measure(t,e),this.keyedBy===Le.ENUM)e.add(1);else if(t!==gt)e.add(t.type.length+1);else return e.unbounded;if(t===gt){const n=Object.values(this.subTypeMap).map(r=>{const a=e.fork();for(const d of Object.values(r.properties))d.measure(gt,a);return[r,a.size]}).reduce((r,a)=>r[1]>a[1]?r:a)[0];for(const r of Object.values(n.properties))r.measure(gt,e)}else{const n=t.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[a,d]of be(r.properties))d.measure(t[a],e)}return e}};function Xo(t,e){return new Bs(Le.STRING,t,e)}function Zo(t,e){return new Bs(Le.ENUM,t,e)}function Ko(t){return new Dr(Object.fromEntries(t.flatMap(({properties:e})=>Object.entries(e))))}var Ho=class extends Tt{constructor(t){super(),this._unstableElementType=t,Q(this,"elementType"),this.elementType=t}resolveReferences(t){this.elementType=t.resolve(this._unstableElementType)}write(t,e){t.writeUint32(e.length);for(const n of e)this.elementType.write(t,n)}read(t){const e=[],n=t.readUint32();for(let r=0;r<n;++r)e.push(this.elementType.read(t));return e}get maxSize(){return this.measure(gt).size}measure(t,e=new yt){if(t===gt)return e.unbounded;e.add(4);for(const n of t)this.elementType.measure(n,e);return e}seekProperty(t,e){if(typeof e=="symbol")return null;const n=Number.parseInt(String(e),10);if(Number.isNaN(n))return null;if(t===gt)return{bufferOffset:this.elementType.measure(gt).size*n,schema:this.elementType};if(n>=t.length)return null;const r=new yt;for(let a=0;a<n;++a)this.elementType.measure(t[a],r);return{bufferOffset:r.size,schema:this.elementType}}};function Jo(t){return new Ho(t)}var js=class{constructor(t){Q(this,"__unwrapped"),Q(this,"ref"),this.ref=new _o(t)}resolveReferences(){throw new Se("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Se("Tried to read a reference directly. Resolve it instead.")}write(){throw new Se("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Se("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Se("Tried to seek property of a reference directly. Resolve it instead.")}},Qo=class{constructor(){Q(this,"registry",{})}hasKey(t){return this.registry[t]!==void 0}register(t,e){this.registry[t]=e}resolve(t){if(t instanceof js){const n=t.ref.key;if(this.registry[n]!==void 0)return this.registry[n];throw new Se(`Couldn't resolve reference to ${n}. Unknown key.`)}return t.resolveReferences(this),t}},ta=class{constructor(t,e){this.key=t,Q(this,"__unwrapped"),Q(this,"__keyDefinition"),Q(this,"innerType"),this.innerType=e(new js(t)),this.resolveReferences(new Qo)}resolveReferences(t){t.hasKey(this.key)||(t.register(this.key,this.innerType),this.innerType.resolveReferences(t))}read(t){return this.innerType.read(t)}write(t,e){this.innerType.write(t,e)}get maxSize(){return this.measure(gt).size}measure(t,e=new yt){return this.innerType.measure(t,e)}seekProperty(t,e){return this.innerType.seekProperty(t,e)}};function ea(t,e){return new ta(t,e)}var na=class extends Tt{constructor(t){super(),this._innerUnstableSchema=t,Q(this,"innerSchema"),this.innerSchema=t}resolveReferences(t){this.innerSchema=t.resolve(this._innerUnstableSchema)}write(t,e){e!=null?(t.writeBool(!0),this.innerSchema.write(t,e)):t.writeBool(!1)}read(t){if(t.readBool())return this.innerSchema.read(t)}get maxSize(){return this.measure(gt).size}measure(t,e=new yt){return t!==void 0&&this.innerSchema.measure(t,e),e.add(1)}};function ra(t){return new na(t)}function sa(t,e){return e.map(n=>t.resolve(n))}var ia=class extends Tt{constructor(t){super(),this._unstableSchemas=t,Q(this,"schemas"),this.schemas=t}resolveReferences(t){this.schemas=sa(t,this._unstableSchemas)}write(t,e){if(e.length!==this.schemas.length)throw new Fn(`Expected tuple of length ${this.schemas.length}, got ${e.length}`);for(let n=0;n<this.schemas.length;++n)this.schemas[n].write(t,e[n])}read(t){const e=[];for(let n=0;n<this.schemas.length;++n)e.push(this.schemas[n].read(t));return e}get maxSize(){return this.measure(gt).size}measure(t,e=new yt){for(let n=0;n<this.schemas.length;++n)this.schemas[n].measure(t===gt?gt:t[n],e);return e}};function oa(t){return new ia(t)}var ve=class extends Tt{constructor(t,e){super(),this.length=t,this._arrayConstructor=e,Q(this,"byteLength"),this.byteLength=t*e.BYTES_PER_ELEMENT}write(t,e){t.writeSlice(e)}read(t){const e=new ArrayBuffer(this.byteLength),n=new this._arrayConstructor(e,0,this.length);return t.readSlice(n,0,this.byteLength),n}measure(t,e=new yt){return e.add(this.byteLength)}},aa=t=>new ve(t,Uint8Array),ua=t=>new ve(t,Uint8ClampedArray),ca=t=>new ve(t,Uint16Array),la=t=>new ve(t,Uint32Array),fa=t=>new ve(t,Int8Array),ha=t=>new ve(t,Int16Array),da=t=>new ve(t,Int32Array),pa=t=>new ve(t,Float32Array),wa=t=>new ve(t,Float64Array);function ma(){const t=new Uint8Array(4),e=new Uint32Array(t.buffer);return e[0]=1,t[0]===0}function ya(){return ma()?"big":"little"}function Ur(t){let e=0,n=t;return n&&"buffer"in n&&"byteOffset"in n&&(e+=n.byteOffset,n=n.buffer),{buffer:n,byteOffset:e,byteLength:t.byteLength}}var Rs=class{constructor(t,e){Q(this,"dataView"),Q(this,"littleEndian"),Q(this,"byteOffset",0),Q(this,"endianness");const{byteOffset:n=0,endianness:r="system"}=e??{};this.byteOffset=n;const a=ya();this.endianness=r==="system"?a:r,this.littleEndian=this.endianness==="little";const d=Ur(t);this.byteOffset+=d.byteOffset,this.dataView=new DataView(d.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(t){this.byteOffset=t}skipBytes(t){this.byteOffset+=t}};function ga(t){if(t===0)return 0;if(Number.isNaN(t))return 32256;if(!Number.isFinite(t))return t>0?31744:64512;const e=t<0?1:0,n=Math.abs(t),r=Math.floor(Math.log2(n)),a=n/2**r-1,d=r+15,m=Math.floor(a*1024);return e<<15|d<<10|m}function va(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?e===0?r/1024:-r/1024:n===31?r===0?e===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(e===0?1:-1)*(1+r/1024)*2**(n-15)}var fn=class extends Rs{constructor(){super(...arguments),Q(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const t=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,t}readUint16(){const t=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,t}readInt32(){const t=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readUint32(){const t=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readFloat16(){const t=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,va(t)}readFloat32(){const t=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readString(){let t=0;for(;this.byteOffset+t<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+t++)!==0;);const e=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,t-1));return this.byteOffset+=t,e}readSlice(t,e,n){const r=Ur(t),a=new Uint8Array(r.buffer,r.byteOffset+e);for(let d=0;d<n;++d)a[d]=this.dataView.getUint8(this.byteOffset++)}},hn=class extends Rs{constructor(){super(...arguments),Q(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(t){this.dataView.setUint8(this.byteOffset++,t?1:0)}writeByte(t){this.dataView.setUint8(this.byteOffset++,t)}writeInt8(t){this.dataView.setInt8(this.byteOffset++,t)}writeUint8(t){this.dataView.setUint8(this.byteOffset++,t)}writeInt16(t){this.dataView.setInt16(this.byteOffset,t,this.littleEndian),this.byteOffset+=2}writeUint16(t){this.dataView.setUint16(this.byteOffset,t,this.littleEndian),this.byteOffset+=2}writeInt32(t){this.dataView.setInt32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeUint32(t){this.dataView.setUint32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeFloat16(t){this.dataView.setUint16(this.byteOffset,ga(t),this.littleEndian),this.byteOffset+=2}writeFloat32(t){this.dataView.setFloat32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeString(t){const e=this._textEncoder.encodeInto(t,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=e.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(t){const e=Ur(t),n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(const r of n)this.dataView.setUint8(this.byteOffset++,r)}},cn=Os,Zr={type:"bool"},xa=t=>le()?`u32(${t})`:typeof t=="boolean"?t?1:0:Number.isInteger(t)?((t<0||t>4294967295)&&console.warn(`u32 value ${t} overflowed`),(t&4294967295)>>>0):Math.max(0,Math.min(4294967295,Math.floor(t))),ft=Object.assign(xa,{type:"u32"}),ba=t=>{if(le())return`i32(${t})`;if(typeof t=="boolean")return t?1:0;if(Number.isInteger(t))return(t<-2147483648||t>2147483647)&&console.warn(`i32 value ${t} overflowed`),(t|0)&4294967295;let e=t<0?Math.ceil(t):Math.floor(t);return Math.max(-2147483648,Math.min(2147483647,e))},Xt=Object.assign(ba,{type:"i32"}),_a=t=>{if(le())return`f32(${t})`;if(typeof t=="boolean")return t?1:0;let e=new Float32Array(1);return e[0]=t,e[0]},k=Object.assign(_a,{type:"f32"}),$a=t=>{if(le())return`f16(${t})`;if(typeof t=="boolean")return t?1:0;let e=new ArrayBuffer(2);return cn.f16.write(new cn.BufferWriter(e),t),cn.f16.read(new cn.BufferReader(e))};Object.assign($a,{type:"f16"});var Ta=["bool","f32","f16","i32","u32","vec2f","vec2h","vec2i","vec2u","vec3f","vec3h","vec3i","vec3u","vec4f","vec4h","vec4i","vec4u","mat2x2f","mat3x3f","mat4x4f","struct","array","atomic","decorated"];function je(t){return Ta.includes(t?.type)}function Er(t){return t?.type==="array"}function $e(t){return t?.type==="struct"}function Vs(t){return t?.type==="@align"}function Ns(t){return t?.type==="@size"}function Ma(t){return t?.type==="@location"}function Sa(t){return t?.type==="@builtin"}function Re(t){return t?.type==="decorated"}var Qe=t=>new Da(t),Da=class{constructor(e){this.propTypes=e,E(this,"_label"),E(this,"type","struct"),E(this,"~repr"),E(this,"~exotic")}get label(){return this._label}$name(e){return this._label=e,this}toString(){var e;return`struct:${(e=this.label)!=null?e:"<unnamed>"}`}},ye=(t,e)=>{let n=e-1,r=~n;return t&n?(t&r)+e:t},Ls=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Ua={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"},Ea=["unstruct","disarray","loose-decorated",...Ls];function Gs(t){return Ea.includes(t?.type)}function Or(t){return t?.type==="disarray"}function zn(t){return t?.type==="unstruct"}function Ae(t){return t?.type==="loose-decorated"}function Ge(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(Vs))==null?void 0:n.value}function Oa(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(Ns))==null?void 0:n.value}function hr(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(Ma))==null?void 0:n.value}function Pn(t){return je(t)||Gs(t)}var W=class{constructor(t){this.type=t,E(this,"~repr")}},Ia={uint8:ft,uint8x2:Ee,uint8x4:ee,sint8:Xt,sint8x2:Ue,sint8x4:te,unorm8:k,unorm8x2:C,unorm8x4:L,snorm8:k,snorm8x2:C,snorm8x4:L,uint16:ft,uint16x2:Ee,uint16x4:ee,sint16:Xt,sint16x2:Ue,sint16x4:te,unorm16:k,unorm16x2:C,unorm16x4:L,snorm16:k,snorm16x2:C,snorm16x4:L,float16:k,float16x2:C,float16x4:L,float32:k,float32x2:C,float32x3:Ye,float32x4:L,uint32:ft,uint32x2:Ee,uint32x3:Oe,uint32x4:ee,sint32:Xt,sint32x2:Ue,sint32x3:fr,sint32x4:te,"unorm10-10-10-2":L,"unorm8x4-bgra":L},Aa=Object.keys(Ia);new W("uint8");new W("uint8x2");new W("uint8x4");new W("sint8");new W("sint8x2");new W("sint8x4");new W("unorm8");new W("unorm8x2");new W("unorm8x4");new W("snorm8");new W("snorm8x2");new W("snorm8x4");new W("uint16");new W("uint16x2");new W("uint16x4");new W("sint16");new W("sint16x2");new W("sint16x4");new W("unorm16");new W("unorm16x2");new W("unorm16x4");new W("snorm16");new W("snorm16x2");new W("snorm16x4");new W("float16");new W("float16x2");new W("float16x4");new W("float32");new W("float32x2");new W("float32x3");new W("float32x4");new W("uint32");new W("uint32x2");new W("uint32x3");new W("uint32x4");new W("sint32");new W("sint32x2");new W("sint32x3");new W("sint32x4");new W("unorm10-10-10-2");new W("unorm8x4-bgra");var ka={bool:4,f32:4,f16:2,i32:4,u32:4,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,mat2x2f:8,mat3x3f:16,mat4x4f:16};function Fa(t){var e,n,r;let a=t?.type,d=ka[a];if(d!==void 0)return d;if($e(t))return Object.values(t.propTypes).map($t).reduce((m,g)=>m>g?m:g);if(Er(t))return $t(t.elementType);if(zn(t)){let m=Object.values(t.propTypes)[0];return m&&(e=Ge(m))!=null?e:1}if(Or(t))return(n=Ge(t.elementType))!=null?n:1;if(Re(t)||Ae(t))return(r=Ge(t))!=null?r:$t(t.inner);if(Aa.includes(a))return 1;throw new Error(`Cannot determine alignment of data: ${JSON.stringify(t)}`)}function za(t){var e,n;if(zn(t)){let r=Object.values(t.propTypes)[0];return r?ue(r):1}return Or(t)?ue(t.elementType):Ae(t)?(e=Ge(t))!=null?e:ue(t.inner):(n=Ge(t))!=null?n:1}var Kr=new WeakMap,Hr=new WeakMap;function $t(t){let e=Kr.get(t);return e===void 0&&(e=Fa(t),Kr.set(t,e)),e}function ue(t){let e=Hr.get(t);return e===void 0&&(e=za(t),Hr.set(t,e)),e}var Pa={bool:4,f32:4,f16:2,i32:4,u32:4,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4};function Ba(t){let e=0;for(let n of Object.values(t.propTypes)){if(Number.isNaN(e))throw new Error("Only the last property of a struct can be unbounded");if(e=ye(e,$t(n)),e+=pt(n),Number.isNaN(e)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return ye(e,$t(t))}function ja(t){let e=0;for(let n of Object.values(t.propTypes)){let r=ue(n);e=ye(e,r),e+=pt(n)}return e}function Ra(t){var e;let n=Pa[t?.type];if(n!==void 0)return n;if($e(t))return Ba(t);if(zn(t))return ja(t);if(Er(t)){if(t.elementCount===0)return Number.NaN;let r=$t(t.elementType);return ye(pt(t.elementType),r)*t.elementCount}if(Or(t)){let r=ue(t.elementType);return ye(pt(t.elementType),r)*t.elementCount}if(Re(t)||Ae(t))return(e=Oa(t))!=null?e:pt(t.inner);throw new Error(`Cannot determine size of data: ${t}`)}var Jr=new WeakMap;function pt(t){let e=Jr.get(t);return e===void 0&&(e=Ra(t),Jr.set(t,e)),e}function Va(t){return pt(t)}var Xe=(t,e)=>new Na(t,e),Na=class{constructor(t,e){if(this.elementType=t,this.elementCount=e,E(this,"type","array"),E(this,"~repr"),E(this,"~exotic"),Number.isNaN(pt(t)))throw new Error("Cannot nest runtime sized arrays.")}toString(){return`arrayOf(${this.elementType})`}};function Ir(t){let e={"~repr":void 0,type:t.type,label:t.type};return Object.assign((...n)=>{if(le())return`${e.type}(${n.join(", ")})`;let r=[];for(let a of n)if(typeof a=="number")r.push(a);else for(let d=0;d<a.length;++d)r.push(a[d]);for(let a=r.length;a<t.columns*t.rows;++a)r.push(0);return t.makeFromElements(...r)},e)}var La=class{constructor(...e){E(this,"columns"),E(this,"length",4),this.columns=[this.makeColumn(e[0],e[1]),this.makeColumn(e[2],e[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[1].x=e}set 3(e){this.columns[1].y=e}"~resolve"(){return`${this.kind}(${Array.from({length:this.length}).map((e,n)=>this[n]).join(", ")})`}},Ga=class extends La{constructor(){super(...arguments),E(this,"kind","mat2x2f")}makeColumn(e,n){return C(e,n)}},qa=class{constructor(...t){E(this,"columns"),E(this,"length",12),this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}"~resolve"(){return`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`}},Ca=class extends qa{constructor(){super(...arguments),E(this,"kind","mat3x3f")}makeColumn(e,n,r){return Ye(e,n,r)}},Wa=class{constructor(...e){E(this,"columns"),E(this,"length",16),this.columns=[this.makeColumn(e[0],e[1],e[2],e[3]),this.makeColumn(e[4],e[5],e[6],e[7]),this.makeColumn(e[8],e[9],e[10],e[11]),this.makeColumn(e[12],e[13],e[14],e[15])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[0].z=e}set 3(e){this.columns[0].w=e}set 4(e){this.columns[1].x=e}set 5(e){this.columns[1].y=e}set 6(e){this.columns[1].z=e}set 7(e){this.columns[1].w=e}set 8(e){this.columns[2].x=e}set 9(e){this.columns[2].y=e}set 10(e){this.columns[2].z=e}set 11(e){this.columns[2].w=e}set 12(e){this.columns[3].x=e}set 13(e){this.columns[3].y=e}set 14(e){this.columns[3].z=e}set 15(e){this.columns[3].w=e}"~resolve"(){return`${this.kind}(${Array.from({length:this.length}).map((e,n)=>this[n]).join(", ")})`}},Ya=class extends Wa{constructor(){super(...arguments),E(this,"kind","mat4x4f")}makeColumn(e,n,r,a){return L(e,n,r,a)}},Xa=Ir({type:"mat2x2f",rows:2,columns:2,makeFromElements:(...t)=>new Ga(...t)}),Ze=Ir({type:"mat3x3f",rows:3,columns:3,makeFromElements:(...t)=>new Ca(...t)}),qs=Ir({type:"mat4x4f",rows:4,columns:4,makeFromElements:(...t)=>new Ya(...t)});function At(t,e){return Re(t)?new Qr(t.inner,[e,...t.attribs]):Ae(t)?new ts(t.inner,[e,...t.attribs]):Gs(t)?new ts(t,[e]):new Qr(t,[e])}function dn(t,e){return At(e,{type:"@location",value:t})}function Za(t,e){return At(e,{type:"@interpolate",value:t})}function Cs(t){return(Re(t)||Ae(t))&&t.attribs.find(Sa)!==void 0}function Ka(t){return!Re(t)&&!Ae(t)?"":t.attribs.map(e=>`${e.type}(${e.value}) `).join("")}var Ws=class{constructor(e,n){this.inner=e,this.attribs=n,E(this,"~repr");var r,a;let d=(r=n.find(Vs))==null?void 0:r.value,m=(a=n.find(Ns))==null?void 0:a.value;if(d!==void 0){if(d<=0)throw new Error(`Custom data alignment must be a positive number, got: ${d}.`);if(Math.log2(d)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${d}.`);if(je(this.inner)&&d%$t(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${d}, expected multiple of: ${$t(this.inner)}.`)}if(m!==void 0){if(m<pt(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${m}, expected at least: ${pt(this.inner)}.`);if(m<=0)throw new Error(`Custom data size must be a positive number. Got: ${m}.`)}}},Qr=class extends Ws{constructor(){super(...arguments),E(this,"type","decorated")}},ts=class extends Ws{constructor(){super(...arguments),E(this,"type","loose-decorated")}},Ha={vertexIndex:At(ft,{type:"@builtin",value:"vertex_index"}),instanceIndex:At(ft,{type:"@builtin",value:"instance_index"}),position:At(L,{type:"@builtin",value:"position"}),clipDistances:At(Xe(ft,8),{type:"@builtin",value:"clip_distances"}),frontFacing:At(k,{type:"@builtin",value:"front_facing"}),fragDepth:At(k,{type:"@builtin",value:"frag_depth"}),sampleIndex:At(ft,{type:"@builtin",value:"sample_index"}),sampleMask:At(ft,{type:"@builtin",value:"sample_mask"}),localInvocationId:At(Oe,{type:"@builtin",value:"local_invocation_id"}),localInvocationIndex:At(ft,{type:"@builtin",value:"local_invocation_index"}),globalInvocationId:At(Oe,{type:"@builtin",value:"global_invocation_id"}),workgroupId:At(Oe,{type:"@builtin",value:"workgroup_id"}),numWorkgroups:At(Oe,{type:"@builtin",value:"num_workgroups"})};function Ys(t){if(!(t.target instanceof HTMLElement))return C();const e=t.target?.getBoundingClientRect(),n=e.x+e.width/2,r=e.y+e.height/2,a=(t.clientX-n)/e.width*2,d=(r-t.clientY)/e.height*2;return C(a,d)}function Ja(t,e){return class extends t{constructor(...n){super(...n),e(this)}}}const Qa=Ja(Array,t=>t.fill(0));let Y=1e-6;function tu(t){function e(s=0,f=0){const i=new t(2);return s!==void 0&&(i[0]=s,f!==void 0&&(i[1]=f)),i}const n=e;function r(s,f,i){const u=i??new t(2);return u[0]=s,u[1]=f,u}function a(s,f){const i=f??new t(2);return i[0]=Math.ceil(s[0]),i[1]=Math.ceil(s[1]),i}function d(s,f){const i=f??new t(2);return i[0]=Math.floor(s[0]),i[1]=Math.floor(s[1]),i}function m(s,f){const i=f??new t(2);return i[0]=Math.round(s[0]),i[1]=Math.round(s[1]),i}function g(s,f=0,i=1,u){const p=u??new t(2);return p[0]=Math.min(i,Math.max(f,s[0])),p[1]=Math.min(i,Math.max(f,s[1])),p}function T(s,f,i){const u=i??new t(2);return u[0]=s[0]+f[0],u[1]=s[1]+f[1],u}function I(s,f,i,u){const p=u??new t(2);return p[0]=s[0]+f[0]*i,p[1]=s[1]+f[1]*i,p}function A(s,f){const i=s[0],u=s[1],p=f[0],_=f[1],D=Math.sqrt(i*i+u*u),h=Math.sqrt(p*p+_*_),w=D*h,b=w&&J(s,f)/w;return Math.acos(b)}function z(s,f,i){const u=i??new t(2);return u[0]=s[0]-f[0],u[1]=s[1]-f[1],u}const F=z;function j(s,f){return Math.abs(s[0]-f[0])<Y&&Math.abs(s[1]-f[1])<Y}function B(s,f){return s[0]===f[0]&&s[1]===f[1]}function P(s,f,i,u){const p=u??new t(2);return p[0]=s[0]+i*(f[0]-s[0]),p[1]=s[1]+i*(f[1]-s[1]),p}function q(s,f,i,u){const p=u??new t(2);return p[0]=s[0]+i[0]*(f[0]-s[0]),p[1]=s[1]+i[1]*(f[1]-s[1]),p}function st(s,f,i){const u=i??new t(2);return u[0]=Math.max(s[0],f[0]),u[1]=Math.max(s[1],f[1]),u}function ot(s,f,i){const u=i??new t(2);return u[0]=Math.min(s[0],f[0]),u[1]=Math.min(s[1],f[1]),u}function it(s,f,i){const u=i??new t(2);return u[0]=s[0]*f,u[1]=s[1]*f,u}const et=it;function at(s,f,i){const u=i??new t(2);return u[0]=s[0]/f,u[1]=s[1]/f,u}function ut(s,f){const i=f??new t(2);return i[0]=1/s[0],i[1]=1/s[1],i}const vt=ut;function nt(s,f,i){const u=i??new t(3),p=s[0]*f[1]-s[1]*f[0];return u[0]=0,u[1]=0,u[2]=p,u}function J(s,f){return s[0]*f[0]+s[1]*f[1]}function X(s){const f=s[0],i=s[1];return Math.sqrt(f*f+i*i)}const ct=X;function Z(s){const f=s[0],i=s[1];return f*f+i*i}const rt=Z;function H(s,f){const i=s[0]-f[0],u=s[1]-f[1];return Math.sqrt(i*i+u*u)}const re=H;function Ft(s,f){const i=s[0]-f[0],u=s[1]-f[1];return i*i+u*u}const se=Ft;function zt(s,f){const i=f??new t(2),u=s[0],p=s[1],_=Math.sqrt(u*u+p*p);return _>1e-5?(i[0]=u/_,i[1]=p/_):(i[0]=0,i[1]=0),i}function ie(s,f){const i=f??new t(2);return i[0]=-s[0],i[1]=-s[1],i}function lt(s,f){const i=f??new t(2);return i[0]=s[0],i[1]=s[1],i}const oe=lt;function Lt(s,f,i){const u=i??new t(2);return u[0]=s[0]*f[0],u[1]=s[1]*f[1],u}const ae=Lt;function Gt(s,f,i){const u=i??new t(2);return u[0]=s[0]/f[0],u[1]=s[1]/f[1],u}const Ht=Gt;function qt(s=1,f){const i=f??new t(2),u=Math.random()*2*Math.PI;return i[0]=Math.cos(u)*s,i[1]=Math.sin(u)*s,i}function c(s){const f=s??new t(2);return f[0]=0,f[1]=0,f}function v(s,f,i){const u=i??new t(2),p=s[0],_=s[1];return u[0]=p*f[0]+_*f[4]+f[12],u[1]=p*f[1]+_*f[5]+f[13],u}function o(s,f,i){const u=i??new t(2),p=s[0],_=s[1];return u[0]=f[0]*p+f[4]*_+f[8],u[1]=f[1]*p+f[5]*_+f[9],u}function l(s,f,i,u){const p=u??new t(2),_=s[0]-f[0],D=s[1]-f[1],h=Math.sin(i),w=Math.cos(i);return p[0]=_*w-D*h+f[0],p[1]=_*h+D*w+f[1],p}function y(s,f,i){const u=i??new t(2);return zt(s,u),it(u,f,u)}function x(s,f,i){const u=i??new t(2);return X(s)>f?y(s,f,u):lt(s,u)}function S(s,f,i){const u=i??new t(2);return P(s,f,.5,u)}return{create:e,fromValues:n,set:r,ceil:a,floor:d,round:m,clamp:g,add:T,addScaled:I,angle:A,subtract:z,sub:F,equalsApproximately:j,equals:B,lerp:P,lerpV:q,max:st,min:ot,mulScalar:it,scale:et,divScalar:at,inverse:ut,invert:vt,cross:nt,dot:J,length:X,len:ct,lengthSq:Z,lenSq:rt,distance:H,dist:re,distanceSq:Ft,distSq:se,normalize:zt,negate:ie,copy:lt,clone:oe,multiply:Lt,mul:ae,divide:Gt,div:Ht,random:qt,zero:c,transformMat4:v,transformMat3:o,rotate:l,setLength:y,truncate:x,midpoint:S}}const es=new Map;function Xs(t){let e=es.get(t);return e||(e=tu(t),es.set(t,e)),e}function eu(t){function e(h,w,b){const $=new t(3);return h!==void 0&&($[0]=h,w!==void 0&&($[1]=w,b!==void 0&&($[2]=b))),$}const n=e;function r(h,w,b,$){const M=$??new t(3);return M[0]=h,M[1]=w,M[2]=b,M}function a(h,w){const b=w??new t(3);return b[0]=Math.ceil(h[0]),b[1]=Math.ceil(h[1]),b[2]=Math.ceil(h[2]),b}function d(h,w){const b=w??new t(3);return b[0]=Math.floor(h[0]),b[1]=Math.floor(h[1]),b[2]=Math.floor(h[2]),b}function m(h,w){const b=w??new t(3);return b[0]=Math.round(h[0]),b[1]=Math.round(h[1]),b[2]=Math.round(h[2]),b}function g(h,w=0,b=1,$){const M=$??new t(3);return M[0]=Math.min(b,Math.max(w,h[0])),M[1]=Math.min(b,Math.max(w,h[1])),M[2]=Math.min(b,Math.max(w,h[2])),M}function T(h,w,b){const $=b??new t(3);return $[0]=h[0]+w[0],$[1]=h[1]+w[1],$[2]=h[2]+w[2],$}function I(h,w,b,$){const M=$??new t(3);return M[0]=h[0]+w[0]*b,M[1]=h[1]+w[1]*b,M[2]=h[2]+w[2]*b,M}function A(h,w){const b=h[0],$=h[1],M=h[2],U=w[0],O=w[1],V=w[2],G=Math.sqrt(b*b+$*$+M*M),R=Math.sqrt(U*U+O*O+V*V),N=G*R,K=N&&J(h,w)/N;return Math.acos(K)}function z(h,w,b){const $=b??new t(3);return $[0]=h[0]-w[0],$[1]=h[1]-w[1],$[2]=h[2]-w[2],$}const F=z;function j(h,w){return Math.abs(h[0]-w[0])<Y&&Math.abs(h[1]-w[1])<Y&&Math.abs(h[2]-w[2])<Y}function B(h,w){return h[0]===w[0]&&h[1]===w[1]&&h[2]===w[2]}function P(h,w,b,$){const M=$??new t(3);return M[0]=h[0]+b*(w[0]-h[0]),M[1]=h[1]+b*(w[1]-h[1]),M[2]=h[2]+b*(w[2]-h[2]),M}function q(h,w,b,$){const M=$??new t(3);return M[0]=h[0]+b[0]*(w[0]-h[0]),M[1]=h[1]+b[1]*(w[1]-h[1]),M[2]=h[2]+b[2]*(w[2]-h[2]),M}function st(h,w,b){const $=b??new t(3);return $[0]=Math.max(h[0],w[0]),$[1]=Math.max(h[1],w[1]),$[2]=Math.max(h[2],w[2]),$}function ot(h,w,b){const $=b??new t(3);return $[0]=Math.min(h[0],w[0]),$[1]=Math.min(h[1],w[1]),$[2]=Math.min(h[2],w[2]),$}function it(h,w,b){const $=b??new t(3);return $[0]=h[0]*w,$[1]=h[1]*w,$[2]=h[2]*w,$}const et=it;function at(h,w,b){const $=b??new t(3);return $[0]=h[0]/w,$[1]=h[1]/w,$[2]=h[2]/w,$}function ut(h,w){const b=w??new t(3);return b[0]=1/h[0],b[1]=1/h[1],b[2]=1/h[2],b}const vt=ut;function nt(h,w,b){const $=b??new t(3),M=h[2]*w[0]-h[0]*w[2],U=h[0]*w[1]-h[1]*w[0];return $[0]=h[1]*w[2]-h[2]*w[1],$[1]=M,$[2]=U,$}function J(h,w){return h[0]*w[0]+h[1]*w[1]+h[2]*w[2]}function X(h){const w=h[0],b=h[1],$=h[2];return Math.sqrt(w*w+b*b+$*$)}const ct=X;function Z(h){const w=h[0],b=h[1],$=h[2];return w*w+b*b+$*$}const rt=Z;function H(h,w){const b=h[0]-w[0],$=h[1]-w[1],M=h[2]-w[2];return Math.sqrt(b*b+$*$+M*M)}const re=H;function Ft(h,w){const b=h[0]-w[0],$=h[1]-w[1],M=h[2]-w[2];return b*b+$*$+M*M}const se=Ft;function zt(h,w){const b=w??new t(3),$=h[0],M=h[1],U=h[2],O=Math.sqrt($*$+M*M+U*U);return O>1e-5?(b[0]=$/O,b[1]=M/O,b[2]=U/O):(b[0]=0,b[1]=0,b[2]=0),b}function ie(h,w){const b=w??new t(3);return b[0]=-h[0],b[1]=-h[1],b[2]=-h[2],b}function lt(h,w){const b=w??new t(3);return b[0]=h[0],b[1]=h[1],b[2]=h[2],b}const oe=lt;function Lt(h,w,b){const $=b??new t(3);return $[0]=h[0]*w[0],$[1]=h[1]*w[1],$[2]=h[2]*w[2],$}const ae=Lt;function Gt(h,w,b){const $=b??new t(3);return $[0]=h[0]/w[0],$[1]=h[1]/w[1],$[2]=h[2]/w[2],$}const Ht=Gt;function qt(h=1,w){const b=w??new t(3),$=Math.random()*2*Math.PI,M=Math.random()*2-1,U=Math.sqrt(1-M*M)*h;return b[0]=Math.cos($)*U,b[1]=Math.sin($)*U,b[2]=M*h,b}function c(h){const w=h??new t(3);return w[0]=0,w[1]=0,w[2]=0,w}function v(h,w,b){const $=b??new t(3),M=h[0],U=h[1],O=h[2],V=w[3]*M+w[7]*U+w[11]*O+w[15]||1;return $[0]=(w[0]*M+w[4]*U+w[8]*O+w[12])/V,$[1]=(w[1]*M+w[5]*U+w[9]*O+w[13])/V,$[2]=(w[2]*M+w[6]*U+w[10]*O+w[14])/V,$}function o(h,w,b){const $=b??new t(3),M=h[0],U=h[1],O=h[2];return $[0]=M*w[0*4+0]+U*w[1*4+0]+O*w[2*4+0],$[1]=M*w[0*4+1]+U*w[1*4+1]+O*w[2*4+1],$[2]=M*w[0*4+2]+U*w[1*4+2]+O*w[2*4+2],$}function l(h,w,b){const $=b??new t(3),M=h[0],U=h[1],O=h[2];return $[0]=M*w[0]+U*w[4]+O*w[8],$[1]=M*w[1]+U*w[5]+O*w[9],$[2]=M*w[2]+U*w[6]+O*w[10],$}function y(h,w,b){const $=b??new t(3),M=w[0],U=w[1],O=w[2],V=w[3]*2,G=h[0],R=h[1],N=h[2],K=U*N-O*R,tt=O*G-M*N,wt=M*R-U*G;return $[0]=G+K*V+(U*wt-O*tt)*2,$[1]=R+tt*V+(O*K-M*wt)*2,$[2]=N+wt*V+(M*tt-U*K)*2,$}function x(h,w){const b=w??new t(3);return b[0]=h[12],b[1]=h[13],b[2]=h[14],b}function S(h,w,b){const $=b??new t(3),M=w*4;return $[0]=h[M+0],$[1]=h[M+1],$[2]=h[M+2],$}function s(h,w){const b=w??new t(3),$=h[0],M=h[1],U=h[2],O=h[4],V=h[5],G=h[6],R=h[8],N=h[9],K=h[10];return b[0]=Math.sqrt($*$+M*M+U*U),b[1]=Math.sqrt(O*O+V*V+G*G),b[2]=Math.sqrt(R*R+N*N+K*K),b}function f(h,w,b,$){const M=$??new t(3),U=[],O=[];return U[0]=h[0]-w[0],U[1]=h[1]-w[1],U[2]=h[2]-w[2],O[0]=U[0],O[1]=U[1]*Math.cos(b)-U[2]*Math.sin(b),O[2]=U[1]*Math.sin(b)+U[2]*Math.cos(b),M[0]=O[0]+w[0],M[1]=O[1]+w[1],M[2]=O[2]+w[2],M}function i(h,w,b,$){const M=$??new t(3),U=[],O=[];return U[0]=h[0]-w[0],U[1]=h[1]-w[1],U[2]=h[2]-w[2],O[0]=U[2]*Math.sin(b)+U[0]*Math.cos(b),O[1]=U[1],O[2]=U[2]*Math.cos(b)-U[0]*Math.sin(b),M[0]=O[0]+w[0],M[1]=O[1]+w[1],M[2]=O[2]+w[2],M}function u(h,w,b,$){const M=$??new t(3),U=[],O=[];return U[0]=h[0]-w[0],U[1]=h[1]-w[1],U[2]=h[2]-w[2],O[0]=U[0]*Math.cos(b)-U[1]*Math.sin(b),O[1]=U[0]*Math.sin(b)+U[1]*Math.cos(b),O[2]=U[2],M[0]=O[0]+w[0],M[1]=O[1]+w[1],M[2]=O[2]+w[2],M}function p(h,w,b){const $=b??new t(3);return zt(h,$),it($,w,$)}function _(h,w,b){const $=b??new t(3);return X(h)>w?p(h,w,$):lt(h,$)}function D(h,w,b){const $=b??new t(3);return P(h,w,.5,$)}return{create:e,fromValues:n,set:r,ceil:a,floor:d,round:m,clamp:g,add:T,addScaled:I,angle:A,subtract:z,sub:F,equalsApproximately:j,equals:B,lerp:P,lerpV:q,max:st,min:ot,mulScalar:it,scale:et,divScalar:at,inverse:ut,invert:vt,cross:nt,dot:J,length:X,len:ct,lengthSq:Z,lenSq:rt,distance:H,dist:re,distanceSq:Ft,distSq:se,normalize:zt,negate:ie,copy:lt,clone:oe,multiply:Lt,mul:ae,divide:Gt,div:Ht,random:qt,zero:c,transformMat4:v,transformMat4Upper3x3:o,transformMat3:l,transformQuat:y,getTranslation:x,getAxis:S,getScaling:s,rotateX:f,rotateY:i,rotateZ:u,setLength:p,truncate:_,midpoint:D}}const ns=new Map;function Bn(t){let e=ns.get(t);return e||(e=eu(t),ns.set(t,e)),e}function nu(t){const e=Xs(t),n=Bn(t);function r(c,v,o,l,y,x,S,s,f){const i=new t(12);return i[3]=0,i[7]=0,i[11]=0,c!==void 0&&(i[0]=c,v!==void 0&&(i[1]=v,o!==void 0&&(i[2]=o,l!==void 0&&(i[4]=l,y!==void 0&&(i[5]=y,x!==void 0&&(i[6]=x,S!==void 0&&(i[8]=S,s!==void 0&&(i[9]=s,f!==void 0&&(i[10]=f))))))))),i}function a(c,v,o,l,y,x,S,s,f,i){const u=i??new t(12);return u[0]=c,u[1]=v,u[2]=o,u[3]=0,u[4]=l,u[5]=y,u[6]=x,u[7]=0,u[8]=S,u[9]=s,u[10]=f,u[11]=0,u}function d(c,v){const o=v??new t(12);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=0,o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=0,o[8]=c[8],o[9]=c[9],o[10]=c[10],o[11]=0,o}function m(c,v){const o=v??new t(12),l=c[0],y=c[1],x=c[2],S=c[3],s=l+l,f=y+y,i=x+x,u=l*s,p=y*s,_=y*f,D=x*s,h=x*f,w=x*i,b=S*s,$=S*f,M=S*i;return o[0]=1-_-w,o[1]=p+M,o[2]=D-$,o[3]=0,o[4]=p-M,o[5]=1-u-w,o[6]=h+b,o[7]=0,o[8]=D+$,o[9]=h-b,o[10]=1-u-_,o[11]=0,o}function g(c,v){const o=v??new t(12);return o[0]=-c[0],o[1]=-c[1],o[2]=-c[2],o[4]=-c[4],o[5]=-c[5],o[6]=-c[6],o[8]=-c[8],o[9]=-c[9],o[10]=-c[10],o}function T(c,v){const o=v??new t(12);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[8]=c[8],o[9]=c[9],o[10]=c[10],o}const I=T;function A(c,v){return Math.abs(c[0]-v[0])<Y&&Math.abs(c[1]-v[1])<Y&&Math.abs(c[2]-v[2])<Y&&Math.abs(c[4]-v[4])<Y&&Math.abs(c[5]-v[5])<Y&&Math.abs(c[6]-v[6])<Y&&Math.abs(c[8]-v[8])<Y&&Math.abs(c[9]-v[9])<Y&&Math.abs(c[10]-v[10])<Y}function z(c,v){return c[0]===v[0]&&c[1]===v[1]&&c[2]===v[2]&&c[4]===v[4]&&c[5]===v[5]&&c[6]===v[6]&&c[8]===v[8]&&c[9]===v[9]&&c[10]===v[10]}function F(c){const v=c??new t(12);return v[0]=1,v[1]=0,v[2]=0,v[4]=0,v[5]=1,v[6]=0,v[8]=0,v[9]=0,v[10]=1,v}function j(c,v){const o=v??new t(12);if(o===c){let _;return _=c[1],c[1]=c[4],c[4]=_,_=c[2],c[2]=c[8],c[8]=_,_=c[6],c[6]=c[9],c[9]=_,o}const l=c[0*4+0],y=c[0*4+1],x=c[0*4+2],S=c[1*4+0],s=c[1*4+1],f=c[1*4+2],i=c[2*4+0],u=c[2*4+1],p=c[2*4+2];return o[0]=l,o[1]=S,o[2]=i,o[4]=y,o[5]=s,o[6]=u,o[8]=x,o[9]=f,o[10]=p,o}function B(c,v){const o=v??new t(12),l=c[0*4+0],y=c[0*4+1],x=c[0*4+2],S=c[1*4+0],s=c[1*4+1],f=c[1*4+2],i=c[2*4+0],u=c[2*4+1],p=c[2*4+2],_=p*s-f*u,D=-p*S+f*i,h=u*S-s*i,w=1/(l*_+y*D+x*h);return o[0]=_*w,o[1]=(-p*y+x*u)*w,o[2]=(f*y-x*s)*w,o[4]=D*w,o[5]=(p*l-x*i)*w,o[6]=(-f*l+x*S)*w,o[8]=h*w,o[9]=(-u*l+y*i)*w,o[10]=(s*l-y*S)*w,o}function P(c){const v=c[0],o=c[0*4+1],l=c[0*4+2],y=c[1*4+0],x=c[1*4+1],S=c[1*4+2],s=c[2*4+0],f=c[2*4+1],i=c[2*4+2];return v*(x*i-f*S)-y*(o*i-f*l)+s*(o*S-x*l)}const q=B;function st(c,v,o){const l=o??new t(12),y=c[0],x=c[1],S=c[2],s=c[4],f=c[5],i=c[6],u=c[8],p=c[9],_=c[10],D=v[0],h=v[1],w=v[2],b=v[4],$=v[5],M=v[6],U=v[8],O=v[9],V=v[10];return l[0]=y*D+s*h+u*w,l[1]=x*D+f*h+p*w,l[2]=S*D+i*h+_*w,l[4]=y*b+s*$+u*M,l[5]=x*b+f*$+p*M,l[6]=S*b+i*$+_*M,l[8]=y*U+s*O+u*V,l[9]=x*U+f*O+p*V,l[10]=S*U+i*O+_*V,l}const ot=st;function it(c,v,o){const l=o??F();return c!==l&&(l[0]=c[0],l[1]=c[1],l[2]=c[2],l[4]=c[4],l[5]=c[5],l[6]=c[6]),l[8]=v[0],l[9]=v[1],l[10]=1,l}function et(c,v){const o=v??e.create();return o[0]=c[8],o[1]=c[9],o}function at(c,v,o){const l=o??e.create(),y=v*4;return l[0]=c[y+0],l[1]=c[y+1],l}function ut(c,v,o,l){const y=l===c?c:T(c,l),x=o*4;return y[x+0]=v[0],y[x+1]=v[1],y}function vt(c,v){const o=v??e.create(),l=c[0],y=c[1],x=c[4],S=c[5];return o[0]=Math.sqrt(l*l+y*y),o[1]=Math.sqrt(x*x+S*S),o}function nt(c,v){const o=v??n.create(),l=c[0],y=c[1],x=c[2],S=c[4],s=c[5],f=c[6],i=c[8],u=c[9],p=c[10];return o[0]=Math.sqrt(l*l+y*y+x*x),o[1]=Math.sqrt(S*S+s*s+f*f),o[2]=Math.sqrt(i*i+u*u+p*p),o}function J(c,v){const o=v??new t(12);return o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=1,o[6]=0,o[8]=c[0],o[9]=c[1],o[10]=1,o}function X(c,v,o){const l=o??new t(12),y=v[0],x=v[1],S=c[0],s=c[1],f=c[2],i=c[1*4+0],u=c[1*4+1],p=c[1*4+2],_=c[2*4+0],D=c[2*4+1],h=c[2*4+2];return c!==l&&(l[0]=S,l[1]=s,l[2]=f,l[4]=i,l[5]=u,l[6]=p),l[8]=S*y+i*x+_,l[9]=s*y+u*x+D,l[10]=f*y+p*x+h,l}function ct(c,v){const o=v??new t(12),l=Math.cos(c),y=Math.sin(c);return o[0]=l,o[1]=y,o[2]=0,o[4]=-y,o[5]=l,o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function Z(c,v,o){const l=o??new t(12),y=c[0*4+0],x=c[0*4+1],S=c[0*4+2],s=c[1*4+0],f=c[1*4+1],i=c[1*4+2],u=Math.cos(v),p=Math.sin(v);return l[0]=u*y+p*s,l[1]=u*x+p*f,l[2]=u*S+p*i,l[4]=u*s-p*y,l[5]=u*f-p*x,l[6]=u*i-p*S,c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function rt(c,v){const o=v??new t(12),l=Math.cos(c),y=Math.sin(c);return o[0]=1,o[1]=0,o[2]=0,o[4]=0,o[5]=l,o[6]=y,o[8]=0,o[9]=-y,o[10]=l,o}function H(c,v,o){const l=o??new t(12),y=c[4],x=c[5],S=c[6],s=c[8],f=c[9],i=c[10],u=Math.cos(v),p=Math.sin(v);return l[4]=u*y+p*s,l[5]=u*x+p*f,l[6]=u*S+p*i,l[8]=u*s-p*y,l[9]=u*f-p*x,l[10]=u*i-p*S,c!==l&&(l[0]=c[0],l[1]=c[1],l[2]=c[2]),l}function re(c,v){const o=v??new t(12),l=Math.cos(c),y=Math.sin(c);return o[0]=l,o[1]=0,o[2]=-y,o[4]=0,o[5]=1,o[6]=0,o[8]=y,o[9]=0,o[10]=l,o}function Ft(c,v,o){const l=o??new t(12),y=c[0*4+0],x=c[0*4+1],S=c[0*4+2],s=c[2*4+0],f=c[2*4+1],i=c[2*4+2],u=Math.cos(v),p=Math.sin(v);return l[0]=u*y-p*s,l[1]=u*x-p*f,l[2]=u*S-p*i,l[8]=u*s+p*y,l[9]=u*f+p*x,l[10]=u*i+p*S,c!==l&&(l[4]=c[4],l[5]=c[5],l[6]=c[6]),l}const se=ct,zt=Z;function ie(c,v){const o=v??new t(12);return o[0]=c[0],o[1]=0,o[2]=0,o[4]=0,o[5]=c[1],o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function lt(c,v,o){const l=o??new t(12),y=v[0],x=v[1];return l[0]=y*c[0*4+0],l[1]=y*c[0*4+1],l[2]=y*c[0*4+2],l[4]=x*c[1*4+0],l[5]=x*c[1*4+1],l[6]=x*c[1*4+2],c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function oe(c,v){const o=v??new t(12);return o[0]=c[0],o[1]=0,o[2]=0,o[4]=0,o[5]=c[1],o[6]=0,o[8]=0,o[9]=0,o[10]=c[2],o}function Lt(c,v,o){const l=o??new t(12),y=v[0],x=v[1],S=v[2];return l[0]=y*c[0*4+0],l[1]=y*c[0*4+1],l[2]=y*c[0*4+2],l[4]=x*c[1*4+0],l[5]=x*c[1*4+1],l[6]=x*c[1*4+2],l[8]=S*c[2*4+0],l[9]=S*c[2*4+1],l[10]=S*c[2*4+2],l}function ae(c,v){const o=v??new t(12);return o[0]=c,o[1]=0,o[2]=0,o[4]=0,o[5]=c,o[6]=0,o[8]=0,o[9]=0,o[10]=1,o}function Gt(c,v,o){const l=o??new t(12);return l[0]=v*c[0*4+0],l[1]=v*c[0*4+1],l[2]=v*c[0*4+2],l[4]=v*c[1*4+0],l[5]=v*c[1*4+1],l[6]=v*c[1*4+2],c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function Ht(c,v){const o=v??new t(12);return o[0]=c,o[1]=0,o[2]=0,o[4]=0,o[5]=c,o[6]=0,o[8]=0,o[9]=0,o[10]=c,o}function qt(c,v,o){const l=o??new t(12);return l[0]=v*c[0*4+0],l[1]=v*c[0*4+1],l[2]=v*c[0*4+2],l[4]=v*c[1*4+0],l[5]=v*c[1*4+1],l[6]=v*c[1*4+2],l[8]=v*c[2*4+0],l[9]=v*c[2*4+1],l[10]=v*c[2*4+2],l}return{clone:I,create:r,set:a,fromMat4:d,fromQuat:m,negate:g,copy:T,equalsApproximately:A,equals:z,identity:F,transpose:j,inverse:B,invert:q,determinant:P,mul:ot,multiply:st,setTranslation:it,getTranslation:et,getAxis:at,setAxis:ut,getScaling:vt,get3DScaling:nt,translation:J,translate:X,rotation:ct,rotate:Z,rotationX:rt,rotateX:H,rotationY:re,rotateY:Ft,rotationZ:se,rotateZ:zt,scaling:ie,scale:lt,uniformScaling:ae,uniformScale:Gt,scaling3D:oe,scale3D:Lt,uniformScaling3D:Ht,uniformScale3D:qt}}const rs=new Map;function ru(t){let e=rs.get(t);return e||(e=nu(t),rs.set(t,e)),e}function su(t){const e=Bn(t);function n(s,f,i,u,p,_,D,h,w,b,$,M,U,O,V,G){const R=new t(16);return s!==void 0&&(R[0]=s,f!==void 0&&(R[1]=f,i!==void 0&&(R[2]=i,u!==void 0&&(R[3]=u,p!==void 0&&(R[4]=p,_!==void 0&&(R[5]=_,D!==void 0&&(R[6]=D,h!==void 0&&(R[7]=h,w!==void 0&&(R[8]=w,b!==void 0&&(R[9]=b,$!==void 0&&(R[10]=$,M!==void 0&&(R[11]=M,U!==void 0&&(R[12]=U,O!==void 0&&(R[13]=O,V!==void 0&&(R[14]=V,G!==void 0&&(R[15]=G)))))))))))))))),R}function r(s,f,i,u,p,_,D,h,w,b,$,M,U,O,V,G,R){const N=R??new t(16);return N[0]=s,N[1]=f,N[2]=i,N[3]=u,N[4]=p,N[5]=_,N[6]=D,N[7]=h,N[8]=w,N[9]=b,N[10]=$,N[11]=M,N[12]=U,N[13]=O,N[14]=V,N[15]=G,N}function a(s,f){const i=f??new t(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=0,i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=0,i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function d(s,f){const i=f??new t(16),u=s[0],p=s[1],_=s[2],D=s[3],h=u+u,w=p+p,b=_+_,$=u*h,M=p*h,U=p*w,O=_*h,V=_*w,G=_*b,R=D*h,N=D*w,K=D*b;return i[0]=1-U-G,i[1]=M+K,i[2]=O-N,i[3]=0,i[4]=M-K,i[5]=1-$-G,i[6]=V+R,i[7]=0,i[8]=O+N,i[9]=V-R,i[10]=1-$-U,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function m(s,f){const i=f??new t(16);return i[0]=-s[0],i[1]=-s[1],i[2]=-s[2],i[3]=-s[3],i[4]=-s[4],i[5]=-s[5],i[6]=-s[6],i[7]=-s[7],i[8]=-s[8],i[9]=-s[9],i[10]=-s[10],i[11]=-s[11],i[12]=-s[12],i[13]=-s[13],i[14]=-s[14],i[15]=-s[15],i}function g(s,f){const i=f??new t(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i}const T=g;function I(s,f){return Math.abs(s[0]-f[0])<Y&&Math.abs(s[1]-f[1])<Y&&Math.abs(s[2]-f[2])<Y&&Math.abs(s[3]-f[3])<Y&&Math.abs(s[4]-f[4])<Y&&Math.abs(s[5]-f[5])<Y&&Math.abs(s[6]-f[6])<Y&&Math.abs(s[7]-f[7])<Y&&Math.abs(s[8]-f[8])<Y&&Math.abs(s[9]-f[9])<Y&&Math.abs(s[10]-f[10])<Y&&Math.abs(s[11]-f[11])<Y&&Math.abs(s[12]-f[12])<Y&&Math.abs(s[13]-f[13])<Y&&Math.abs(s[14]-f[14])<Y&&Math.abs(s[15]-f[15])<Y}function A(s,f){return s[0]===f[0]&&s[1]===f[1]&&s[2]===f[2]&&s[3]===f[3]&&s[4]===f[4]&&s[5]===f[5]&&s[6]===f[6]&&s[7]===f[7]&&s[8]===f[8]&&s[9]===f[9]&&s[10]===f[10]&&s[11]===f[11]&&s[12]===f[12]&&s[13]===f[13]&&s[14]===f[14]&&s[15]===f[15]}function z(s){const f=s??new t(16);return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function F(s,f){const i=f??new t(16);if(i===s){let tt;return tt=s[1],s[1]=s[4],s[4]=tt,tt=s[2],s[2]=s[8],s[8]=tt,tt=s[3],s[3]=s[12],s[12]=tt,tt=s[6],s[6]=s[9],s[9]=tt,tt=s[7],s[7]=s[13],s[13]=tt,tt=s[11],s[11]=s[14],s[14]=tt,i}const u=s[0*4+0],p=s[0*4+1],_=s[0*4+2],D=s[0*4+3],h=s[1*4+0],w=s[1*4+1],b=s[1*4+2],$=s[1*4+3],M=s[2*4+0],U=s[2*4+1],O=s[2*4+2],V=s[2*4+3],G=s[3*4+0],R=s[3*4+1],N=s[3*4+2],K=s[3*4+3];return i[0]=u,i[1]=h,i[2]=M,i[3]=G,i[4]=p,i[5]=w,i[6]=U,i[7]=R,i[8]=_,i[9]=b,i[10]=O,i[11]=N,i[12]=D,i[13]=$,i[14]=V,i[15]=K,i}function j(s,f){const i=f??new t(16),u=s[0*4+0],p=s[0*4+1],_=s[0*4+2],D=s[0*4+3],h=s[1*4+0],w=s[1*4+1],b=s[1*4+2],$=s[1*4+3],M=s[2*4+0],U=s[2*4+1],O=s[2*4+2],V=s[2*4+3],G=s[3*4+0],R=s[3*4+1],N=s[3*4+2],K=s[3*4+3],tt=O*K,wt=N*V,xt=b*K,bt=N*$,Mt=b*V,St=O*$,Dt=_*K,Ut=N*D,Et=_*V,Ot=O*D,Pt=_*$,Bt=b*D,jt=M*R,Rt=G*U,Ct=h*R,Wt=G*w,Yt=h*U,tn=M*w,en=u*R,nn=G*p,rn=u*U,sn=M*p,on=u*w,an=h*p,Nr=tt*w+bt*U+Mt*R-(wt*w+xt*U+St*R),Lr=wt*p+Dt*U+Ot*R-(tt*p+Ut*U+Et*R),Gr=xt*p+Ut*w+Pt*R-(bt*p+Dt*w+Bt*R),qr=St*p+Et*w+Bt*U-(Mt*p+Ot*w+Pt*U),It=1/(u*Nr+h*Lr+M*Gr+G*qr);return i[0]=It*Nr,i[1]=It*Lr,i[2]=It*Gr,i[3]=It*qr,i[4]=It*(wt*h+xt*M+St*G-(tt*h+bt*M+Mt*G)),i[5]=It*(tt*u+Ut*M+Et*G-(wt*u+Dt*M+Ot*G)),i[6]=It*(bt*u+Dt*h+Bt*G-(xt*u+Ut*h+Pt*G)),i[7]=It*(Mt*u+Ot*h+Pt*M-(St*u+Et*h+Bt*M)),i[8]=It*(jt*$+Wt*V+Yt*K-(Rt*$+Ct*V+tn*K)),i[9]=It*(Rt*D+en*V+sn*K-(jt*D+nn*V+rn*K)),i[10]=It*(Ct*D+nn*$+on*K-(Wt*D+en*$+an*K)),i[11]=It*(tn*D+rn*$+an*V-(Yt*D+sn*$+on*V)),i[12]=It*(Ct*O+tn*N+Rt*b-(Yt*N+jt*b+Wt*O)),i[13]=It*(rn*N+jt*_+nn*O-(en*O+sn*N+Rt*_)),i[14]=It*(en*b+an*N+Wt*_-(on*N+Ct*_+nn*b)),i[15]=It*(on*O+Yt*_+sn*b-(rn*b+an*O+tn*_)),i}function B(s){const f=s[0],i=s[0*4+1],u=s[0*4+2],p=s[0*4+3],_=s[1*4+0],D=s[1*4+1],h=s[1*4+2],w=s[1*4+3],b=s[2*4+0],$=s[2*4+1],M=s[2*4+2],U=s[2*4+3],O=s[3*4+0],V=s[3*4+1],G=s[3*4+2],R=s[3*4+3],N=M*R,K=G*U,tt=h*R,wt=G*w,xt=h*U,bt=M*w,Mt=u*R,St=G*p,Dt=u*U,Ut=M*p,Et=u*w,Ot=h*p,Pt=N*D+wt*$+xt*V-(K*D+tt*$+bt*V),Bt=K*i+Mt*$+Ut*V-(N*i+St*$+Dt*V),jt=tt*i+St*D+Et*V-(wt*i+Mt*D+Ot*V),Rt=bt*i+Dt*D+Ot*$-(xt*i+Ut*D+Et*$);return f*Pt+_*Bt+b*jt+O*Rt}const P=j;function q(s,f,i){const u=i??new t(16),p=s[0],_=s[1],D=s[2],h=s[3],w=s[4],b=s[5],$=s[6],M=s[7],U=s[8],O=s[9],V=s[10],G=s[11],R=s[12],N=s[13],K=s[14],tt=s[15],wt=f[0],xt=f[1],bt=f[2],Mt=f[3],St=f[4],Dt=f[5],Ut=f[6],Et=f[7],Ot=f[8],Pt=f[9],Bt=f[10],jt=f[11],Rt=f[12],Ct=f[13],Wt=f[14],Yt=f[15];return u[0]=p*wt+w*xt+U*bt+R*Mt,u[1]=_*wt+b*xt+O*bt+N*Mt,u[2]=D*wt+$*xt+V*bt+K*Mt,u[3]=h*wt+M*xt+G*bt+tt*Mt,u[4]=p*St+w*Dt+U*Ut+R*Et,u[5]=_*St+b*Dt+O*Ut+N*Et,u[6]=D*St+$*Dt+V*Ut+K*Et,u[7]=h*St+M*Dt+G*Ut+tt*Et,u[8]=p*Ot+w*Pt+U*Bt+R*jt,u[9]=_*Ot+b*Pt+O*Bt+N*jt,u[10]=D*Ot+$*Pt+V*Bt+K*jt,u[11]=h*Ot+M*Pt+G*Bt+tt*jt,u[12]=p*Rt+w*Ct+U*Wt+R*Yt,u[13]=_*Rt+b*Ct+O*Wt+N*Yt,u[14]=D*Rt+$*Ct+V*Wt+K*Yt,u[15]=h*Rt+M*Ct+G*Wt+tt*Yt,u}const st=q;function ot(s,f,i){const u=i??z();return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11]),u[12]=f[0],u[13]=f[1],u[14]=f[2],u[15]=1,u}function it(s,f){const i=f??e.create();return i[0]=s[12],i[1]=s[13],i[2]=s[14],i}function et(s,f,i){const u=i??e.create(),p=f*4;return u[0]=s[p+0],u[1]=s[p+1],u[2]=s[p+2],u}function at(s,f,i,u){const p=u===s?u:g(s,u),_=i*4;return p[_+0]=f[0],p[_+1]=f[1],p[_+2]=f[2],p}function ut(s,f){const i=f??e.create(),u=s[0],p=s[1],_=s[2],D=s[4],h=s[5],w=s[6],b=s[8],$=s[9],M=s[10];return i[0]=Math.sqrt(u*u+p*p+_*_),i[1]=Math.sqrt(D*D+h*h+w*w),i[2]=Math.sqrt(b*b+$*$+M*M),i}function vt(s,f,i,u,p){const _=p??new t(16),D=Math.tan(Math.PI*.5-.5*s);if(_[0]=D/f,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=D,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,Number.isFinite(u)){const h=1/(i-u);_[10]=u*h,_[14]=u*i*h}else _[10]=-1,_[14]=-i;return _}function nt(s,f,i,u=1/0,p){const _=p??new t(16),D=1/Math.tan(s*.5);if(_[0]=D/f,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=D,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,u===1/0)_[10]=0,_[14]=i;else{const h=1/(u-i);_[10]=i*h,_[14]=u*i*h}return _}function J(s,f,i,u,p,_,D){const h=D??new t(16);return h[0]=2/(f-s),h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/(u-i),h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1/(p-_),h[11]=0,h[12]=(f+s)/(s-f),h[13]=(u+i)/(i-u),h[14]=p/(p-_),h[15]=1,h}function X(s,f,i,u,p,_,D){const h=D??new t(16),w=f-s,b=u-i,$=p-_;return h[0]=2*p/w,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*p/b,h[6]=0,h[7]=0,h[8]=(s+f)/w,h[9]=(u+i)/b,h[10]=_/$,h[11]=-1,h[12]=0,h[13]=0,h[14]=p*_/$,h[15]=0,h}function ct(s,f,i,u,p,_=1/0,D){const h=D??new t(16),w=f-s,b=u-i;if(h[0]=2*p/w,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*p/b,h[6]=0,h[7]=0,h[8]=(s+f)/w,h[9]=(u+i)/b,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,_===1/0)h[10]=0,h[14]=p;else{const $=1/(_-p);h[10]=p*$,h[14]=_*p*$}return h}const Z=e.create(),rt=e.create(),H=e.create();function re(s,f,i,u){const p=u??new t(16);return e.normalize(e.subtract(f,s,H),H),e.normalize(e.cross(i,H,Z),Z),e.normalize(e.cross(H,Z,rt),rt),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=rt[0],p[5]=rt[1],p[6]=rt[2],p[7]=0,p[8]=H[0],p[9]=H[1],p[10]=H[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function Ft(s,f,i,u){const p=u??new t(16);return e.normalize(e.subtract(s,f,H),H),e.normalize(e.cross(i,H,Z),Z),e.normalize(e.cross(H,Z,rt),rt),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=rt[0],p[5]=rt[1],p[6]=rt[2],p[7]=0,p[8]=H[0],p[9]=H[1],p[10]=H[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function se(s,f,i,u){const p=u??new t(16);return e.normalize(e.subtract(s,f,H),H),e.normalize(e.cross(i,H,Z),Z),e.normalize(e.cross(H,Z,rt),rt),p[0]=Z[0],p[1]=rt[0],p[2]=H[0],p[3]=0,p[4]=Z[1],p[5]=rt[1],p[6]=H[1],p[7]=0,p[8]=Z[2],p[9]=rt[2],p[10]=H[2],p[11]=0,p[12]=-(Z[0]*s[0]+Z[1]*s[1]+Z[2]*s[2]),p[13]=-(rt[0]*s[0]+rt[1]*s[1]+rt[2]*s[2]),p[14]=-(H[0]*s[0]+H[1]*s[1]+H[2]*s[2]),p[15]=1,p}function zt(s,f){const i=f??new t(16);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i}function ie(s,f,i){const u=i??new t(16),p=f[0],_=f[1],D=f[2],h=s[0],w=s[1],b=s[2],$=s[3],M=s[1*4+0],U=s[1*4+1],O=s[1*4+2],V=s[1*4+3],G=s[2*4+0],R=s[2*4+1],N=s[2*4+2],K=s[2*4+3],tt=s[3*4+0],wt=s[3*4+1],xt=s[3*4+2],bt=s[3*4+3];return s!==u&&(u[0]=h,u[1]=w,u[2]=b,u[3]=$,u[4]=M,u[5]=U,u[6]=O,u[7]=V,u[8]=G,u[9]=R,u[10]=N,u[11]=K),u[12]=h*p+M*_+G*D+tt,u[13]=w*p+U*_+R*D+wt,u[14]=b*p+O*_+N*D+xt,u[15]=$*p+V*_+K*D+bt,u}function lt(s,f){const i=f??new t(16),u=Math.cos(s),p=Math.sin(s);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=p,i[7]=0,i[8]=0,i[9]=-p,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oe(s,f,i){const u=i??new t(16),p=s[4],_=s[5],D=s[6],h=s[7],w=s[8],b=s[9],$=s[10],M=s[11],U=Math.cos(f),O=Math.sin(f);return u[4]=U*p+O*w,u[5]=U*_+O*b,u[6]=U*D+O*$,u[7]=U*h+O*M,u[8]=U*w-O*p,u[9]=U*b-O*_,u[10]=U*$-O*D,u[11]=U*M-O*h,s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Lt(s,f){const i=f??new t(16),u=Math.cos(s),p=Math.sin(s);return i[0]=u,i[1]=0,i[2]=-p,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=p,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ae(s,f,i){const u=i??new t(16),p=s[0*4+0],_=s[0*4+1],D=s[0*4+2],h=s[0*4+3],w=s[2*4+0],b=s[2*4+1],$=s[2*4+2],M=s[2*4+3],U=Math.cos(f),O=Math.sin(f);return u[0]=U*p-O*w,u[1]=U*_-O*b,u[2]=U*D-O*$,u[3]=U*h-O*M,u[8]=U*w+O*p,u[9]=U*b+O*_,u[10]=U*$+O*D,u[11]=U*M+O*h,s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Gt(s,f){const i=f??new t(16),u=Math.cos(s),p=Math.sin(s);return i[0]=u,i[1]=p,i[2]=0,i[3]=0,i[4]=-p,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ht(s,f,i){const u=i??new t(16),p=s[0*4+0],_=s[0*4+1],D=s[0*4+2],h=s[0*4+3],w=s[1*4+0],b=s[1*4+1],$=s[1*4+2],M=s[1*4+3],U=Math.cos(f),O=Math.sin(f);return u[0]=U*p+O*w,u[1]=U*_+O*b,u[2]=U*D+O*$,u[3]=U*h+O*M,u[4]=U*w-O*p,u[5]=U*b-O*_,u[6]=U*$-O*D,u[7]=U*M-O*h,s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function qt(s,f,i){const u=i??new t(16);let p=s[0],_=s[1],D=s[2];const h=Math.sqrt(p*p+_*_+D*D);p/=h,_/=h,D/=h;const w=p*p,b=_*_,$=D*D,M=Math.cos(f),U=Math.sin(f),O=1-M;return u[0]=w+(1-w)*M,u[1]=p*_*O+D*U,u[2]=p*D*O-_*U,u[3]=0,u[4]=p*_*O-D*U,u[5]=b+(1-b)*M,u[6]=_*D*O+p*U,u[7]=0,u[8]=p*D*O+_*U,u[9]=_*D*O-p*U,u[10]=$+(1-$)*M,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}const c=qt;function v(s,f,i,u){const p=u??new t(16);let _=f[0],D=f[1],h=f[2];const w=Math.sqrt(_*_+D*D+h*h);_/=w,D/=w,h/=w;const b=_*_,$=D*D,M=h*h,U=Math.cos(i),O=Math.sin(i),V=1-U,G=b+(1-b)*U,R=_*D*V+h*O,N=_*h*V-D*O,K=_*D*V-h*O,tt=$+(1-$)*U,wt=D*h*V+_*O,xt=_*h*V+D*O,bt=D*h*V-_*O,Mt=M+(1-M)*U,St=s[0],Dt=s[1],Ut=s[2],Et=s[3],Ot=s[4],Pt=s[5],Bt=s[6],jt=s[7],Rt=s[8],Ct=s[9],Wt=s[10],Yt=s[11];return p[0]=G*St+R*Ot+N*Rt,p[1]=G*Dt+R*Pt+N*Ct,p[2]=G*Ut+R*Bt+N*Wt,p[3]=G*Et+R*jt+N*Yt,p[4]=K*St+tt*Ot+wt*Rt,p[5]=K*Dt+tt*Pt+wt*Ct,p[6]=K*Ut+tt*Bt+wt*Wt,p[7]=K*Et+tt*jt+wt*Yt,p[8]=xt*St+bt*Ot+Mt*Rt,p[9]=xt*Dt+bt*Pt+Mt*Ct,p[10]=xt*Ut+bt*Bt+Mt*Wt,p[11]=xt*Et+bt*jt+Mt*Yt,s!==p&&(p[12]=s[12],p[13]=s[13],p[14]=s[14],p[15]=s[15]),p}const o=v;function l(s,f){const i=f??new t(16);return i[0]=s[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function y(s,f,i){const u=i??new t(16),p=f[0],_=f[1],D=f[2];return u[0]=p*s[0*4+0],u[1]=p*s[0*4+1],u[2]=p*s[0*4+2],u[3]=p*s[0*4+3],u[4]=_*s[1*4+0],u[5]=_*s[1*4+1],u[6]=_*s[1*4+2],u[7]=_*s[1*4+3],u[8]=D*s[2*4+0],u[9]=D*s[2*4+1],u[10]=D*s[2*4+2],u[11]=D*s[2*4+3],s!==u&&(u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function x(s,f){const i=f??new t(16);return i[0]=s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function S(s,f,i){const u=i??new t(16);return u[0]=f*s[0*4+0],u[1]=f*s[0*4+1],u[2]=f*s[0*4+2],u[3]=f*s[0*4+3],u[4]=f*s[1*4+0],u[5]=f*s[1*4+1],u[6]=f*s[1*4+2],u[7]=f*s[1*4+3],u[8]=f*s[2*4+0],u[9]=f*s[2*4+1],u[10]=f*s[2*4+2],u[11]=f*s[2*4+3],s!==u&&(u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}return{create:n,set:r,fromMat3:a,fromQuat:d,negate:m,copy:g,clone:T,equalsApproximately:I,equals:A,identity:z,transpose:F,inverse:j,determinant:B,invert:P,multiply:q,mul:st,setTranslation:ot,getTranslation:it,getAxis:et,setAxis:at,getScaling:ut,perspective:vt,perspectiveReverseZ:nt,ortho:J,frustum:X,frustumReverseZ:ct,aim:re,cameraAim:Ft,lookAt:se,translation:zt,translate:ie,rotationX:lt,rotateX:oe,rotationY:Lt,rotateY:ae,rotationZ:Gt,rotateZ:Ht,axisRotation:qt,rotation:c,axisRotate:v,rotate:o,scaling:l,scale:y,uniformScaling:x,uniformScale:S}}const ss=new Map;function iu(t){let e=ss.get(t);return e||(e=su(t),ss.set(t,e)),e}function ou(t){const e=Bn(t);function n(c,v,o,l){const y=new t(4);return c!==void 0&&(y[0]=c,v!==void 0&&(y[1]=v,o!==void 0&&(y[2]=o,l!==void 0&&(y[3]=l)))),y}const r=n;function a(c,v,o,l,y){const x=y??new t(4);return x[0]=c,x[1]=v,x[2]=o,x[3]=l,x}function d(c,v,o){const l=o??new t(4),y=v*.5,x=Math.sin(y);return l[0]=x*c[0],l[1]=x*c[1],l[2]=x*c[2],l[3]=Math.cos(y),l}function m(c,v){const o=v??e.create(3),l=Math.acos(c[3])*2,y=Math.sin(l*.5);return y>Y?(o[0]=c[0]/y,o[1]=c[1]/y,o[2]=c[2]/y):(o[0]=1,o[1]=0,o[2]=0),{angle:l,axis:o}}function g(c,v){const o=X(c,v);return Math.acos(2*o*o-1)}function T(c,v,o){const l=o??new t(4),y=c[0],x=c[1],S=c[2],s=c[3],f=v[0],i=v[1],u=v[2],p=v[3];return l[0]=y*p+s*f+x*u-S*i,l[1]=x*p+s*i+S*f-y*u,l[2]=S*p+s*u+y*i-x*f,l[3]=s*p-y*f-x*i-S*u,l}const I=T;function A(c,v,o){const l=o??new t(4),y=v*.5,x=c[0],S=c[1],s=c[2],f=c[3],i=Math.sin(y),u=Math.cos(y);return l[0]=x*u+f*i,l[1]=S*u+s*i,l[2]=s*u-S*i,l[3]=f*u-x*i,l}function z(c,v,o){const l=o??new t(4),y=v*.5,x=c[0],S=c[1],s=c[2],f=c[3],i=Math.sin(y),u=Math.cos(y);return l[0]=x*u-s*i,l[1]=S*u+f*i,l[2]=s*u+x*i,l[3]=f*u-S*i,l}function F(c,v,o){const l=o??new t(4),y=v*.5,x=c[0],S=c[1],s=c[2],f=c[3],i=Math.sin(y),u=Math.cos(y);return l[0]=x*u+S*i,l[1]=S*u-x*i,l[2]=s*u+f*i,l[3]=f*u-s*i,l}function j(c,v,o,l){const y=l??new t(4),x=c[0],S=c[1],s=c[2],f=c[3];let i=v[0],u=v[1],p=v[2],_=v[3],D=x*i+S*u+s*p+f*_;D<0&&(D=-D,i=-i,u=-u,p=-p,_=-_);let h,w;if(1-D>Y){const b=Math.acos(D),$=Math.sin(b);h=Math.sin((1-o)*b)/$,w=Math.sin(o*b)/$}else h=1-o,w=o;return y[0]=h*x+w*i,y[1]=h*S+w*u,y[2]=h*s+w*p,y[3]=h*f+w*_,y}function B(c,v){const o=v??new t(4),l=c[0],y=c[1],x=c[2],S=c[3],s=l*l+y*y+x*x+S*S,f=s?1/s:0;return o[0]=-l*f,o[1]=-y*f,o[2]=-x*f,o[3]=S*f,o}function P(c,v){const o=v??new t(4);return o[0]=-c[0],o[1]=-c[1],o[2]=-c[2],o[3]=c[3],o}function q(c,v){const o=v??new t(4),l=c[0]+c[5]+c[10];if(l>0){const y=Math.sqrt(l+1);o[3]=.5*y;const x=.5/y;o[0]=(c[6]-c[9])*x,o[1]=(c[8]-c[2])*x,o[2]=(c[1]-c[4])*x}else{let y=0;c[5]>c[0]&&(y=1),c[10]>c[y*4+y]&&(y=2);const x=(y+1)%3,S=(y+2)%3,s=Math.sqrt(c[y*4+y]-c[x*4+x]-c[S*4+S]+1);o[y]=.5*s;const f=.5/s;o[3]=(c[x*4+S]-c[S*4+x])*f,o[x]=(c[x*4+y]+c[y*4+x])*f,o[S]=(c[S*4+y]+c[y*4+S])*f}return o}function st(c,v,o,l,y){const x=y??new t(4),S=c*.5,s=v*.5,f=o*.5,i=Math.sin(S),u=Math.cos(S),p=Math.sin(s),_=Math.cos(s),D=Math.sin(f),h=Math.cos(f);switch(l){case"xyz":x[0]=i*_*h+u*p*D,x[1]=u*p*h-i*_*D,x[2]=u*_*D+i*p*h,x[3]=u*_*h-i*p*D;break;case"xzy":x[0]=i*_*h-u*p*D,x[1]=u*p*h-i*_*D,x[2]=u*_*D+i*p*h,x[3]=u*_*h+i*p*D;break;case"yxz":x[0]=i*_*h+u*p*D,x[1]=u*p*h-i*_*D,x[2]=u*_*D-i*p*h,x[3]=u*_*h+i*p*D;break;case"yzx":x[0]=i*_*h+u*p*D,x[1]=u*p*h+i*_*D,x[2]=u*_*D-i*p*h,x[3]=u*_*h-i*p*D;break;case"zxy":x[0]=i*_*h-u*p*D,x[1]=u*p*h+i*_*D,x[2]=u*_*D+i*p*h,x[3]=u*_*h-i*p*D;break;case"zyx":x[0]=i*_*h-u*p*D,x[1]=u*p*h+i*_*D,x[2]=u*_*D-i*p*h,x[3]=u*_*h+i*p*D;break;default:throw new Error(`Unknown rotation order: ${l}`)}return x}function ot(c,v){const o=v??new t(4);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o}const it=ot;function et(c,v,o){const l=o??new t(4);return l[0]=c[0]+v[0],l[1]=c[1]+v[1],l[2]=c[2]+v[2],l[3]=c[3]+v[3],l}function at(c,v,o){const l=o??new t(4);return l[0]=c[0]-v[0],l[1]=c[1]-v[1],l[2]=c[2]-v[2],l[3]=c[3]-v[3],l}const ut=at;function vt(c,v,o){const l=o??new t(4);return l[0]=c[0]*v,l[1]=c[1]*v,l[2]=c[2]*v,l[3]=c[3]*v,l}const nt=vt;function J(c,v,o){const l=o??new t(4);return l[0]=c[0]/v,l[1]=c[1]/v,l[2]=c[2]/v,l[3]=c[3]/v,l}function X(c,v){return c[0]*v[0]+c[1]*v[1]+c[2]*v[2]+c[3]*v[3]}function ct(c,v,o,l){const y=l??new t(4);return y[0]=c[0]+o*(v[0]-c[0]),y[1]=c[1]+o*(v[1]-c[1]),y[2]=c[2]+o*(v[2]-c[2]),y[3]=c[3]+o*(v[3]-c[3]),y}function Z(c){const v=c[0],o=c[1],l=c[2],y=c[3];return Math.sqrt(v*v+o*o+l*l+y*y)}const rt=Z;function H(c){const v=c[0],o=c[1],l=c[2],y=c[3];return v*v+o*o+l*l+y*y}const re=H;function Ft(c,v){const o=v??new t(4),l=c[0],y=c[1],x=c[2],S=c[3],s=Math.sqrt(l*l+y*y+x*x+S*S);return s>1e-5?(o[0]=l/s,o[1]=y/s,o[2]=x/s,o[3]=S/s):(o[0]=0,o[1]=0,o[2]=0,o[3]=1),o}function se(c,v){return Math.abs(c[0]-v[0])<Y&&Math.abs(c[1]-v[1])<Y&&Math.abs(c[2]-v[2])<Y&&Math.abs(c[3]-v[3])<Y}function zt(c,v){return c[0]===v[0]&&c[1]===v[1]&&c[2]===v[2]&&c[3]===v[3]}function ie(c){const v=c??new t(4);return v[0]=0,v[1]=0,v[2]=0,v[3]=1,v}const lt=e.create(),oe=e.create(),Lt=e.create();function ae(c,v,o){const l=o??new t(4),y=e.dot(c,v);return y<-.999999?(e.cross(oe,c,lt),e.len(lt)<1e-6&&e.cross(Lt,c,lt),e.normalize(lt,lt),d(lt,Math.PI,l),l):y>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(e.cross(c,v,lt),l[0]=lt[0],l[1]=lt[1],l[2]=lt[2],l[3]=1+y,Ft(l,l))}const Gt=new t(4),Ht=new t(4);function qt(c,v,o,l,y,x){const S=x??new t(4);return j(c,l,y,Gt),j(v,o,y,Ht),j(Gt,Ht,2*y*(1-y),S),S}return{create:n,fromValues:r,set:a,fromAxisAngle:d,toAxisAngle:m,angle:g,multiply:T,mul:I,rotateX:A,rotateY:z,rotateZ:F,slerp:j,inverse:B,conjugate:P,fromMat:q,fromEuler:st,copy:ot,clone:it,add:et,subtract:at,sub:ut,mulScalar:vt,scale:nt,divScalar:J,dot:X,lerp:ct,length:Z,len:rt,lengthSq:H,lenSq:re,normalize:Ft,equalsApproximately:se,equals:zt,identity:ie,rotationTo:ae,sqlerp:qt}}const is=new Map;function au(t){let e=is.get(t);return e||(e=ou(t),is.set(t,e)),e}function uu(t){function e(o,l,y,x){const S=new t(4);return o!==void 0&&(S[0]=o,l!==void 0&&(S[1]=l,y!==void 0&&(S[2]=y,x!==void 0&&(S[3]=x)))),S}const n=e;function r(o,l,y,x,S){const s=S??new t(4);return s[0]=o,s[1]=l,s[2]=y,s[3]=x,s}function a(o,l){const y=l??new t(4);return y[0]=Math.ceil(o[0]),y[1]=Math.ceil(o[1]),y[2]=Math.ceil(o[2]),y[3]=Math.ceil(o[3]),y}function d(o,l){const y=l??new t(4);return y[0]=Math.floor(o[0]),y[1]=Math.floor(o[1]),y[2]=Math.floor(o[2]),y[3]=Math.floor(o[3]),y}function m(o,l){const y=l??new t(4);return y[0]=Math.round(o[0]),y[1]=Math.round(o[1]),y[2]=Math.round(o[2]),y[3]=Math.round(o[3]),y}function g(o,l=0,y=1,x){const S=x??new t(4);return S[0]=Math.min(y,Math.max(l,o[0])),S[1]=Math.min(y,Math.max(l,o[1])),S[2]=Math.min(y,Math.max(l,o[2])),S[3]=Math.min(y,Math.max(l,o[3])),S}function T(o,l,y){const x=y??new t(4);return x[0]=o[0]+l[0],x[1]=o[1]+l[1],x[2]=o[2]+l[2],x[3]=o[3]+l[3],x}function I(o,l,y,x){const S=x??new t(4);return S[0]=o[0]+l[0]*y,S[1]=o[1]+l[1]*y,S[2]=o[2]+l[2]*y,S[3]=o[3]+l[3]*y,S}function A(o,l,y){const x=y??new t(4);return x[0]=o[0]-l[0],x[1]=o[1]-l[1],x[2]=o[2]-l[2],x[3]=o[3]-l[3],x}const z=A;function F(o,l){return Math.abs(o[0]-l[0])<Y&&Math.abs(o[1]-l[1])<Y&&Math.abs(o[2]-l[2])<Y&&Math.abs(o[3]-l[3])<Y}function j(o,l){return o[0]===l[0]&&o[1]===l[1]&&o[2]===l[2]&&o[3]===l[3]}function B(o,l,y,x){const S=x??new t(4);return S[0]=o[0]+y*(l[0]-o[0]),S[1]=o[1]+y*(l[1]-o[1]),S[2]=o[2]+y*(l[2]-o[2]),S[3]=o[3]+y*(l[3]-o[3]),S}function P(o,l,y,x){const S=x??new t(4);return S[0]=o[0]+y[0]*(l[0]-o[0]),S[1]=o[1]+y[1]*(l[1]-o[1]),S[2]=o[2]+y[2]*(l[2]-o[2]),S[3]=o[3]+y[3]*(l[3]-o[3]),S}function q(o,l,y){const x=y??new t(4);return x[0]=Math.max(o[0],l[0]),x[1]=Math.max(o[1],l[1]),x[2]=Math.max(o[2],l[2]),x[3]=Math.max(o[3],l[3]),x}function st(o,l,y){const x=y??new t(4);return x[0]=Math.min(o[0],l[0]),x[1]=Math.min(o[1],l[1]),x[2]=Math.min(o[2],l[2]),x[3]=Math.min(o[3],l[3]),x}function ot(o,l,y){const x=y??new t(4);return x[0]=o[0]*l,x[1]=o[1]*l,x[2]=o[2]*l,x[3]=o[3]*l,x}const it=ot;function et(o,l,y){const x=y??new t(4);return x[0]=o[0]/l,x[1]=o[1]/l,x[2]=o[2]/l,x[3]=o[3]/l,x}function at(o,l){const y=l??new t(4);return y[0]=1/o[0],y[1]=1/o[1],y[2]=1/o[2],y[3]=1/o[3],y}const ut=at;function vt(o,l){return o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]*l[3]}function nt(o){const l=o[0],y=o[1],x=o[2],S=o[3];return Math.sqrt(l*l+y*y+x*x+S*S)}const J=nt;function X(o){const l=o[0],y=o[1],x=o[2],S=o[3];return l*l+y*y+x*x+S*S}const ct=X;function Z(o,l){const y=o[0]-l[0],x=o[1]-l[1],S=o[2]-l[2],s=o[3]-l[3];return Math.sqrt(y*y+x*x+S*S+s*s)}const rt=Z;function H(o,l){const y=o[0]-l[0],x=o[1]-l[1],S=o[2]-l[2],s=o[3]-l[3];return y*y+x*x+S*S+s*s}const re=H;function Ft(o,l){const y=l??new t(4),x=o[0],S=o[1],s=o[2],f=o[3],i=Math.sqrt(x*x+S*S+s*s+f*f);return i>1e-5?(y[0]=x/i,y[1]=S/i,y[2]=s/i,y[3]=f/i):(y[0]=0,y[1]=0,y[2]=0,y[3]=0),y}function se(o,l){const y=l??new t(4);return y[0]=-o[0],y[1]=-o[1],y[2]=-o[2],y[3]=-o[3],y}function zt(o,l){const y=l??new t(4);return y[0]=o[0],y[1]=o[1],y[2]=o[2],y[3]=o[3],y}const ie=zt;function lt(o,l,y){const x=y??new t(4);return x[0]=o[0]*l[0],x[1]=o[1]*l[1],x[2]=o[2]*l[2],x[3]=o[3]*l[3],x}const oe=lt;function Lt(o,l,y){const x=y??new t(4);return x[0]=o[0]/l[0],x[1]=o[1]/l[1],x[2]=o[2]/l[2],x[3]=o[3]/l[3],x}const ae=Lt;function Gt(o){const l=o??new t(4);return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l}function Ht(o,l,y){const x=y??new t(4),S=o[0],s=o[1],f=o[2],i=o[3];return x[0]=l[0]*S+l[4]*s+l[8]*f+l[12]*i,x[1]=l[1]*S+l[5]*s+l[9]*f+l[13]*i,x[2]=l[2]*S+l[6]*s+l[10]*f+l[14]*i,x[3]=l[3]*S+l[7]*s+l[11]*f+l[15]*i,x}function qt(o,l,y){const x=y??new t(4);return Ft(o,x),ot(x,l,x)}function c(o,l,y){const x=y??new t(4);return nt(o)>l?qt(o,l,x):zt(o,x)}function v(o,l,y){const x=y??new t(4);return B(o,l,.5,x)}return{create:e,fromValues:n,set:r,ceil:a,floor:d,round:m,clamp:g,add:T,addScaled:I,subtract:A,sub:z,equalsApproximately:F,equals:j,lerp:B,lerpV:P,max:q,min:st,mulScalar:ot,scale:it,divScalar:et,inverse:at,invert:ut,dot:vt,length:nt,len:J,lengthSq:X,lenSq:ct,distance:Z,dist:rt,distanceSq:H,distSq:re,normalize:Ft,negate:se,copy:zt,clone:ie,multiply:lt,mul:oe,divide:Lt,div:ae,zero:Gt,transformMat4:Ht,setLength:qt,truncate:c,midpoint:v}}const os=new Map;function cu(t){let e=os.get(t);return e||(e=uu(t),os.set(t,e)),e}function Ar(t,e,n,r,a,d){return{mat3:ru(t),mat4:iu(e),quat:au(n),vec2:Xs(r),vec3:Bn(a),vec4:cu(d)}}const{mat3:lu,mat4:fu,quat:ef,vec2:ht,vec3:hu,vec4:nf}=Ar(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Ar(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Ar(Qa,Array,Array,Array,Array,Array);function du(){return window.matchMedia("(prefers-color-scheme: dark)")?"dark":"light"}const{sign:Zs,sqrt:$n,abs:as,min:pu,max:wu}=Math;function Ks(){return new Promise(t=>requestAnimationFrame(t))}function dr({x:t,y:e}){return C(-e,t)}function mu(t,e,n,r,a){return C(t.x+e.x*n+r.x*a,t.y+e.y*n+r.y*a)}function Hs(t){const e=$n(t.x*t.x+t.y*t.y)||1;return C(t.x/e,t.y/e)}const[pe,Js]=Nt([],{equals:!1}),[Qs,yu]=Nt(!1),[Tn,gu]=Nt(du());function vu(t){const n=pe().findIndex(r=>ht.distance(r.center,t)<r.radius);return n===-1?(Js(r=>(r.push({center:t,radius:0}),r)),pe().length-1):n}function xu(t){const e=pe();let n=Number.POSITIVE_INFINITY,r;const{center:a}=e[t];for(let m=0;m<e.length;++m){if(m===t)continue;const g=e[m],T=ht.distance(g.center,a)-g.radius;T<n&&(n=T,r=m)}return{index:r,radius:n,curve:()=>a}}function bu(t,e,n){const r=ht.sub(e.center,t.center,C()),a=e.radius-t.radius,d=ht.dot(r,r),m=ht.dot(n,r);return(d-a*a)/(2*(m+a*ht.length(n)))-t.radius}function _u(t,e){const n=pe(),r=n[t],a=n[e],d=Hs(ht.sub(a.center,r.center,C()));let m=Number.POSITIVE_INFINITY,g;for(let I=0;I<n.length;++I){if(I===t||I===e)continue;const A=n[I],z=bu(r,A,d);z>=-r.radius/2&&z<m&&(m=z,g=I)}return{index:g,radius:m,curve:I=>ht.addScaled(r.center,d,r.radius+I,C())}}function $u(t,e,n,r){t.radius<e.radius&&([t,e]=[e,t]);const a=t.radius,d=e.radius,m=n.radius;if(a===d)throw new Error("Not Implemented when radii are the same");const g=ht.sub(e.center,t.center,C()),T=Hs(g),I=dr(T),A=ht.sub(n.center,t.center,C()),z=ht.lengthSq(A),F=Zs(ht.dot(I,ht.sub(r.center,t.center,C()))),j=ht.dot(T,A),B=ht.dot(I,A)*F,P=ht.length(g),q=P/(a-d),st=(a-d)/2-P*P/(2*(a-d)),ot=q*q,it=B*B,et=m-a,at=et*et,ut=z-at,vt=it-at,nt=q*(2*st*vt+et*ut)+j*(ut-2*st*et),J=ut*((ot-1)*ut+4*st*(q*j+st+et));if(J<0||Number.isNaN(J))return Number.POSITIVE_INFINITY;const X=2*(2*q*et*j+z-ot*vt),ct=(nt-B*$n(J))/X,Z=$n((q*ct+st)**2-ct*ct),rt=q*ct+st-a;return ct<P/2||as(ht.distance([ct,Z],[j,B])-m-rt)>as(ht.distance([ct,-Z],[j,B])-m-rt)?Number.POSITIVE_INFINITY:rt}function Tu(t,e,n,r){t.radius>e.radius&&([t,e]=[e,t]);const a=ht.sub(e.center,t.center,C()),d=ht.length(a),m=t.radius,g=e.radius,T=n,I=(m*m-g*g+2*(m-g)*T+d*d)/(2*d),A=(m+T)**2-I*I;if(A<0)return;const z=ht.scale(a,1/d,C()),F=dr(z),j=$n(A),B=Zs(ht.dot(dr(a),ht.sub(r.center,t.center,C())));return mu(t.center,z,I,F,j*B)}function Mu(t,e,n){const r=pe(),a=r[n],d=r[t],m=r[e];let g=Number.POSITIVE_INFINITY,T;for(let A=0;A<r.length;++A){if(A===n||A===t||A===e)continue;const z=r[A],F=$u(d,m,z,a);F!==void 0&&F<g&&(g=wu(F,a.radius),T=A)}return{index:T,radius:g,curve:A=>Tu(d,m,A,a)}}async function Wn(t,e,n,r,a){const d=pe()[t];for(;;){if(await Promise.race([Ks(),a])instanceof PointerEvent)return;const g=pu(e,d.radius*1.025+.004/r()),T=n(g);if(!T||(Js(I=>(I[t].radius=g,I[t].center=T,I)),g===e))return}}const ti=br(),Su=ti.Provider;function jn(){return Tr(ti,"useCanvas","CanvasContext")}function Du(){let t,e;return{promise:new Promise((r,a)=>{t=r,e=a}),resolve:t,reject:e}}function Uu(t,e){return new Eu(t,e)}var Eu=class{constructor(t,e){this.dataType=t,this._value=e,E(this,"_label")}get label(){return this._label}$name(t){return this._label=t,this}"~resolve"(t){let e=t.names.makeUnique(this._label),n=t.resolveValue(this._value,this.dataType);return t.addDeclaration(`const ${e} = ${n};`),e}toString(){var t;return`const:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){return le()?this:this._value}};function Ou(t){return!!t&&(typeof t=="object"||typeof t=="function")&&"$name"in t}function pr(t){return t?.resourceType==="slot"}function wr(t){return t?.resourceType==="derived"}function kr(t){return t?.resourceType==="accessor"}var Qt=Symbol("Unknown data type");function ei(t){return typeof t?.["~resolve"]=="function"}function Rn(t){return typeof t=="number"||typeof t=="boolean"||typeof t=="string"||ei(t)||je(t)||pr(t)||wr(t)}function Iu(t){return!!t&&typeof t=="object"&&"getMappedRange"in t&&"mapAsync"in t}function Mn(t,e){for(let[n,r]of Object.entries(e))t[n]=r,Ou(r)&&(!("label"in r)||r.label===void 0)&&r.$name(n)}function Au(t,e,n){let r=[...t.matchAll(new RegExp(":\\s*(?<arg>.*?)\\s*[,)]","g"))].map(a=>{var d;return(d=a.groups)==null?void 0:d.arg});n(Object.fromEntries(e.flatMap((a,d)=>{let m=r[d];return $e(a)&&m!==void 0?[[m,a]]:[]})))}function Fr(t,e,n){var r,a,d;let m=(d=(a=(r=t.match(new RegExp("->(?<output>.*?){","s")))==null?void 0:r.groups)==null?void 0:a.output)==null?void 0:d.trim();$e(e)&&m&&!/\s/g.test(m)&&n({[m]:e})}function ku(t){return new RegExp(`(?<![\\w_.])${t}(?![\\w_])`,"g")}function Vn(t,e,n){return Object.entries(e).reduce((r,[a,d])=>{var m;return Rn(d)?r.replaceAll(ku(a),t.resolve(d)):d!==null&&typeof d=="object"?((m=[...n.matchAll(new RegExp(`${a}\\.(?<prop>.*?)(?![\\w_])`,"g"))].map(g=>g[1]))!=null?m:[]).reduce((g,T)=>T&&T in d?Vn(t,{[`${a}.${T}`]:d[T]},g):g,r):r},n)}function Fu(t){return new zu(t)}var zu=class{constructor(t){this.declaration=t,E(this,"externalsToApply",[])}$uses(t){return this.externalsToApply.push(t),this}"~resolve"(t){let e={};for(let r of this.externalsToApply)Mn(e,r);let n=Vn(t,e,this.declaration);return t.addDeclaration(n),""}toString(){return`declare: ${this.declaration}`}},ni=new WeakMap;function Pu(t){return ni.get(t)}function Bu(t,e,n){return ni.set(t,{ast:e,externals:n}),t}function Nn(t,e){let n=[];return typeof e=="string"&&(Au(e,t.argTypes,r=>n.push(r)),Fr(e,t.returnType,r=>n.push(r))),{label:void 0,applyExternals(r){n.push(r)},resolve(r,a=""){var d;let m={};for(let T of n)Mn(m,T);let g=r.names.makeUnique(this.label);if(typeof e=="string"){let T=Vn(r,m,e.trim());r.addDeclaration(`${a}fn ${g}${T}`)}else{let T=Pu(e);if(T!=null&&T.externals){let B=Object.fromEntries(Object.entries(T.externals).filter(([P])=>!(P in m)));Mn(m,B)}let I=(d=T?.ast)!=null?d:r.transpileFn(String(e)),A=I.externalNames.filter(B=>!(B in m));if(A.length>0)throw new lo(this.label,A);let z=I.argNames.map((B,P)=>({value:B,dataType:t.argTypes[P]})),{head:F,body:j}=r.fnToWgsl({args:z,returnType:t.returnType,body:I.body,externalMap:m});r.addDeclaration(`${a}fn ${g}${r.resolve(F)}${r.resolve(j)}`)}return g}}}function ju(t,e){var n,r,a;let{workgroupSize:d}=e;return{argTypes:[],returnType:void 0,workgroupSize:[(n=d[0])!=null?n:1,(r=d[1])!=null?r:1,(a=d[2])!=null?a:1],does(m){return Ru(this,d,m)}}}function Ru(t,e,n){let r=Nn(t,n);return{shell:t,get label(){return r.label},$uses(a){return r.applyExternals(a),this},$name(a){return r.label=a,this},"~resolve"(a){return r.resolve(a,`@compute @workgroup_size(${e.join(", ")}) `)},toString(){var a;return`computeFn:${(a=this.label)!=null?a:"<unnamed>"}`}}}function Vu(t,e){return{argTypes:t,returnType:e,does(n){return Lu(this,n)}}}function Nu(t){return t?.resourceType==="function"}function Lu(t,e){let n=Nn(t,e),r=Object.assign((...a)=>{if(le())return new si(r,a);if(typeof e=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");return e(...a)},{shell:t,resourceType:"function",$uses(a){return n.applyExternals(a),this},$name(a){return n.label=a,this},with(a,d){return ri(r,kr(a)?a.slot:a,d)},"~resolve"(a){return n.resolve(a)}});return Object.defineProperty(r,"label",{get:()=>n.label}),Object.defineProperty(r,"toString",{value:()=>{var a;return`fn:${(a=n.label)!=null?a:"<unnamed>"}`}}),r}function ri(t,e,n){let r={resourceType:"function",shell:t.shell,$uses(d){return t.$uses(d),this},$name(d){return t.$name(d),this},with(d,m){return ri(a,kr(d)?d.slot:d,m)},"~resolve"(d){return d.withSlots([[e,n]],()=>d.resolve(t))}},a=Object.assign((...d)=>le()?new si(a,d):t(...d),r);return Object.defineProperty(a,"label",{get:()=>t.label}),Object.defineProperty(a,"toString",{value(){var d,m;return`fn:${(d=t.label)!=null?d:"<unnamed>"}[${(m=e.label)!=null?m:"<unnamed>"}=${n}]`}}),a}var si=class{constructor(t,e){this._fn=t,this._params=e}get label(){return this._fn.label}"~resolve"(t){return t.resolve(`${t.resolve(this._fn)}(${this._params.map(e=>t.resolve(e)).join(", ")})`)}toString(){var t;return`call:${(t=this.label)!=null?t:"<unnamed>"}`}};function Gu(t){let e=0;return Object.fromEntries(Object.entries(t).map(([n,r])=>{if(Cs(r))return[n,r];let a=hr(r);return a!==void 0?(e=a+1,[n,r]):[n,At(r,{type:"@location",value:e++})]}))}function ii(t){return Pn(t)?dn(0,t):Qe(Gu(t))}function qu(t,e){return{argTypes:[t],returnType:e,does(n){return Cu(this,n)}}}function Cu(t,e){let n=Nn(t,e),r=ii(t.returnType);return typeof e=="string"&&Fr(e,r,a=>n.applyExternals(a)),{shell:t,outputType:r,get label(){return n.label},$uses(a){return n.applyExternals(a),this},$name(a){return n.label=a,$e(r)&&r.$name(`${a}_Output`),this},"~resolve"(a){return n.resolve(a,"@fragment ")},toString(){var a;return`fragmentFn:${(a=this.label)!=null?a:"<unnamed>"}`}}}function Wu(t,e){return{argTypes:[t],returnType:e,does(n){return Yu(this,n)}}}function Yu(t,e){let n=Nn(t,e),r=ii(t.returnType);return typeof e=="string"&&Fr(e,r,a=>n.applyExternals(a)),{shell:t,outputType:r,get label(){return n.label},$uses(a){return n.applyExternals(a),this},$name(a){return n.label=a,$e(r)&&r.$name(`${a}_Output`),this},"~resolve"(a){return n.resolve(a,"@vertex ")},toString(){var a;return`vertexFn:${(a=this.label)!=null?a:"<unnamed>"}`}}}var zr=class{constructor(){E(this,"lastUniqueId",0)}makeUnique(t){let e;return t?(e=t.replaceAll(/\s/g,"_"),e=e.replaceAll(/[^\w\d]/g,"")):e="item",`${e}_${this.lastUniqueId++}`}},Pr=class{constructor(){E(this,"_usedNames",new Set)}makeUnique(e){if(e===void 0)throw new Error("Unnamed item found when using a strict name registry");let n=0,r=e;for(;this._usedNames.has(r);)n++,r=`${e}_${n}`;return this._usedNames.add(r),r}};function Xu(t,e){throw new Error(`Failed to handle ${t} at ${e}`)}var Zu=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"];function Ku(t){return Zu.includes(t.type)}function Hu(t,[e,n]){return`  ${Ka(n)}${e}: ${t.resolve(n)},
`}function Ju(t,e){let n=t.names.makeUnique(e.label);return t.addDeclaration(`
struct ${n} {
${Object.entries(e.propTypes).map(r=>Hu(t,r)).join("")}}
`),n}function Qu(t,e){let n=t.resolve(e.elementType);return e.elementCount===0?`array<${n}>`:`array<${n}, ${e.elementCount}>`}function oi(t,e){if(Ku(e))return e.type;if(e.type==="struct")return Ju(t,e);if(e.type==="array")return Qu(t,e);if(e.type==="atomic")return`atomic<${oi(t,e.inner)}>`;if(e.type==="decorated")return t.resolve(e.inner);Xu(e,"resolveData")}var tc=["==","!=","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"];function Vt(t,e){return Rn(e.value)||je(e.value)?t.resolve(e.value):String(e.value)}function ec(t){throw new Error(`'${JSON.stringify(t)}' was not handled by the WGSL generator.`)}function ai(t,e){return e?{value:"true",dataType:Zr}:{value:"false",dataType:Zr}}function ui(t,e){return`${t.indent()}{
${e.b.map(n=>yr(t,n)).join(`
`)}
${t.dedent()}}`}function mr(t,e){return t.getById(e)}function Zt(t,e){if(typeof e=="string")return mr(t,e);if(typeof e=="boolean")return ai(t,e);if("x"in e){let[n,r,a]=e.x,d=Vt(t,Zt(t,n)),m=Vt(t,Zt(t,a));return{value:tc.includes(r)?`(${d} ${r} ${m})`:`${d} ${r} ${m}`,dataType:Qt}}if("u"in e){let[n,r]=e.u,a=Vt(t,Zt(t,r));return{value:`${n}${a}`,dataType:Qt}}if("a"in e){let[n,r]=e.a,a=Zt(t,n),d=Vt(t,Zt(t,r));if(typeof a.value=="string")return{value:`${a.value}.${d}`,dataType:Qt};if(Rn(a.value))return d==="value"?{value:Vt(t,a),dataType:Qt}:{value:a.value[d],dataType:Qt};if(typeof a.value=="object")return{value:a.value[d],dataType:Qt};throw new Error(`Cannot access member ${d} of ${a.value}`)}if("i"in e){let[n,r]=e.i,a=Vt(t,Zt(t,n)),d=Vt(t,Zt(t,r));return{value:`${a}[${d}]`,dataType:Qt}}if("n"in e)return{value:e.n,dataType:Qt};if("f"in e){let[n,r]=e.f,a=Zt(t,n).value,d=r.map(m=>Zt(t,m)).map(m=>Vt(t,m));return typeof a=="string"?{value:`${a}(${d.join(", ")})`,dataType:Qt}:{value:a(...d),dataType:Qt}}ec(e)}function yr(t,e){if(typeof e=="string")return`${t.pre}${Vt(t,mr(t,e))};`;if(typeof e=="boolean")return`${t.pre}${Vt(t,ai(t,e))};`;if("r"in e)return e.r===null?`${t.pre}return;`:`${t.pre}return ${Vt(t,Zt(t,e.r))};`;if("q"in e){let[n,r,a]=e.q,d=Vt(t,Zt(t,n));t.indent();let m=yr(t,r);t.dedent(),t.indent();let g=a?yr(t,a):void 0;return t.dedent(),g?`${t.pre}if (${d})
${m}
${t.pre}else
${g}`:`${t.pre}if (${d})
${m}`}if("l"in e||"c"in e){let[n,r]="l"in e?e.l:e.c,a=Vt(t,mr(t,n)),d=r?Zt(t,r):void 0;if(!d)throw new Error("Cannot create variable without an initial value.");return`${t.pre}var ${a} = ${Vt(t,d)};`}return"b"in e?ui(t,e):`${t.pre}${Vt(t,Zt(t,e))};`}function nc(t,e){return ui(t,e)}function rc(t,e){let n="size"in t?t.size:t.currentByteOffset,r=e-1,a=n&r;"skipBytes"in t?t.skipBytes(e-a&r):t.add(e-a&r)}var _t=rc,fe={bool(t,e,n){t.writeBool(n)},f32(t,e,n){t.writeFloat32(n)},f16(t,e,n){t.writeFloat16(n)},i32(t,e,n){t.writeInt32(n)},u32(t,e,n){t.writeUint32(n)},vec2f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y)},vec2h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y)},vec2i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y)},vec2u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y)},vec3f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z)},vec3h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z)},vec3i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z)},vec3u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z)},vec4f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z),t.writeFloat32(n.w)},vec4h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z),t.writeFloat16(n.w)},vec4i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z),t.writeInt32(n.w)},vec4u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z),t.writeUint32(n.w)},mat2x2f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},mat3x3f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},mat4x4f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},struct(t,e,n){let r=$t(e);_t(t,r);for(let[a,d]of Object.entries(e.propTypes))_t(t,$t(d)),qe(t,d,n[a]);_t(t,r)},array(t,e,n){if(e.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let r=$t(e);_t(t,r);let a=t.currentByteOffset;for(let d=0;d<Math.min(e.elementCount,n.length);d++)_t(t,r),qe(t,e.elementType,n[d]);t.seekTo(a+pt(e))},atomic(t,e,n){var r;(r=fe[e.inner.type])==null||r.call(fe,t,e,n)},decorated(t,e,n){var r,a;let d=ue(e);_t(t,d);let m=t.currentByteOffset;(a=fe[(r=e.inner)==null?void 0:r.type])==null||a.call(fe,t,e.inner,n),t.seekTo(m+pt(e))},uint8(t,e,n){t.writeUint8(n)},uint8x2(t,e,n){t.writeUint8(n.x),t.writeUint8(n.y)},uint8x4(t,e,n){t.writeUint8(n.x),t.writeUint8(n.y),t.writeUint8(n.z),t.writeUint8(n.w)},sint8(t,e,n){t.writeInt8(n)},sint8x2(t,e,n){t.writeInt8(n.x),t.writeInt8(n.y)},sint8x4(t,e,n){t.writeInt8(n.x),t.writeInt8(n.y),t.writeInt8(n.z),t.writeInt8(n.w)},unorm8(t,e,n){t.writeUint8(n*255)},unorm8x2(t,e,n){t.writeUint8(n.x*255),t.writeUint8(n.y*255)},unorm8x4(t,e,n){t.writeUint8(n.x*255),t.writeUint8(n.y*255),t.writeUint8(n.z*255),t.writeUint8(n.w*255)},snorm8(t,e,n){t.writeUint8(n*127+128)},snorm8x2(t,e,n){t.writeUint8(n.x*127+128),t.writeUint8(n.y*127+128)},snorm8x4(t,e,n){t.writeUint8(n.x*127+128),t.writeUint8(n.y*127+128),t.writeUint8(n.z*127+128),t.writeUint8(n.w*127+128)},uint16(t,e,n){t.writeUint16(n)},uint16x2(t,e,n){t.writeUint16(n.x),t.writeUint16(n.y)},uint16x4(t,e,n){t.writeUint16(n.x),t.writeUint16(n.y),t.writeUint16(n.z),t.writeUint16(n.w)},sint16(t,e,n){t.writeInt16(n)},sint16x2(t,e,n){t.writeInt16(n.x),t.writeInt16(n.y)},sint16x4(t,e,n){t.writeInt16(n.x),t.writeInt16(n.y),t.writeInt16(n.z),t.writeInt16(n.w)},unorm16(t,e,n){t.writeUint16(n*65535)},unorm16x2(t,e,n){t.writeUint16(n.x*65535),t.writeUint16(n.y*65535)},unorm16x4(t,e,n){t.writeUint16(n.x*65535),t.writeUint16(n.y*65535),t.writeUint16(n.z*65535),t.writeUint16(n.w*65535)},snorm16(t,e,n){t.writeUint16(n*32767+32768)},snorm16x2(t,e,n){t.writeUint16(n.x*32767+32768),t.writeUint16(n.y*32767+32768)},snorm16x4(t,e,n){t.writeUint16(n.x*32767+32768),t.writeUint16(n.y*32767+32768),t.writeUint16(n.z*32767+32768),t.writeUint16(n.w*32767+32768)},float16(t,e,n){t.writeFloat16(n)},float16x2(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y)},float16x4(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z),t.writeFloat16(n.w)},float32(t,e,n){t.writeFloat32(n)},float32x2(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y)},float32x3(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z)},float32x4(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z),t.writeFloat32(n.w)},uint32(t,e,n){t.writeUint32(n)},uint32x2(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y)},uint32x3(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z)},uint32x4(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z),t.writeUint32(n.w)},sint32(t,e,n){t.writeInt32(n)},sint32x2(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y)},sint32x3(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z)},sint32x4(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z),t.writeInt32(n.w)},"unorm10-10-10-2"(t,e,n){let r=0;r|=(n.x*1023&1023)<<22,r|=(n.x*1023&1023)<<12,r|=(n.y*1023&1023)<<2,r|=n.z*3&3,t.writeUint32(r)},"unorm8x4-bgra"(t,e,n){t.writeUint8(n.z*255),t.writeUint8(n.y*255),t.writeUint8(n.x*255),t.writeUint8(n.w*255)},disarray(t,e,n){var r,a;let d=$t(e);_t(t,d);let m=t.currentByteOffset;for(let g=0;g<Math.min(e.elementCount,n.length);g++)_t(t,d),(a=fe[(r=e.elementType)==null?void 0:r.type])==null||a.call(fe,t,e.elementType,n[g]);t.seekTo(m+pt(e))},unstruct(t,e,n){var r;for(let[a,d]of Object.entries(e.propTypes))(r=fe[d.type])==null||r.call(fe,t,d,n[a])},"loose-decorated"(t,e,n){var r;let a=ue(e);_t(t,a);let d=t.currentByteOffset,m=fe[(r=e.inner)==null?void 0:r.type];return m?.(t,e.inner,n),t.seekTo(d+pt(e)),n}};function qe(t,e,n){let r=fe[e.type];if(!r)throw new Error(`Cannot write data of type '${e.type}'.`);r(t,e,n)}var Me={bool(t){return t.readBool()},f32(t){return t.readFloat32()},f16(t){return t.readFloat16()},i32(t){return t.readInt32()},u32(t){return t.readUint32()},vec2f(t){return C(t.readFloat32(),t.readFloat32())},vec3f(t){return Ye(t.readFloat32(),t.readFloat32(),t.readFloat32())},vec4f(t){return L(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},vec2h(t){return wo(t.readFloat16(),t.readFloat16())},vec3h(t){return mo(t.readFloat16(),t.readFloat16(),t.readFloat16())},vec4h(t){return yo(t.readFloat16(),t.readFloat16(),t.readFloat16(),t.readFloat16())},vec2i(t){return Ue(t.readInt32(),t.readInt32())},vec3i(t){return fr(t.readInt32(),t.readInt32(),t.readInt32())},vec4i(t){return te(t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32())},vec2u(t){return Ee(t.readUint32(),t.readUint32())},vec3u(t){return Oe(t.readUint32(),t.readUint32(),t.readUint32())},vec4u(t){return ee(t.readUint32(),t.readUint32(),t.readUint32(),t.readUint32())},mat2x2f(t){return Xa(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},mat3x3f(t){let e=()=>{let n=t.readFloat32();return t.readFloat32(),n};return Ze(t.readFloat32(),t.readFloat32(),e(),t.readFloat32(),t.readFloat32(),e(),t.readFloat32(),t.readFloat32(),e())},mat4x4f(t){return qs(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},struct(t,e){let n=$t(e);_t(t,n);let r={};for(let[a,d]of Object.entries(e.propTypes))_t(t,$t(d)),r[a]=he(t,d);return _t(t,n),r},array(t,e){if(e.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let n=$t(e),r=[];for(let a=0;a<e.elementCount;a++){_t(t,n);let d=e.elementType,m=he(t,d);r.push(m)}return _t(t,n),r},atomic(t,e){return he(t,e.inner)},decorated(t,e){let n=ue(e);_t(t,n);let r=t.currentByteOffset,a=he(t,e.inner);return t.seekTo(r+pt(e)),a},uint8:t=>t.readUint8(),uint8x2:t=>Ee(t.readUint8(),t.readUint8()),uint8x4:t=>ee(t.readUint8(),t.readUint8(),t.readUint8(),t.readUint8()),sint8:t=>t.readInt8(),sint8x2:t=>Ue(t.readInt8(),t.readInt8()),sint8x4:t=>te(t.readInt8(),t.readInt8(),t.readInt8(),t.readInt8()),unorm8:t=>t.readUint8()/255,unorm8x2:t=>C(t.readUint8()/255,t.readUint8()/255),unorm8x4:t=>L(t.readUint8()/255,t.readUint8()/255,t.readUint8()/255,t.readUint8()/255),snorm8:t=>(t.readUint8()-128)/127,snorm8x2:t=>C((t.readUint8()-128)/127,(t.readUint8()-128)/127),snorm8x4:t=>L((t.readUint8()-128)/127,(t.readUint8()-128)/127,(t.readUint8()-128)/127,(t.readUint8()-128)/127),uint16:t=>t.readUint16(),uint16x2:t=>Ee(t.readUint16(),t.readUint16()),uint16x4:t=>ee(t.readUint16(),t.readUint16(),t.readUint16(),t.readUint16()),sint16:t=>t.readInt16(),sint16x2:t=>Ue(t.readInt16(),t.readInt16()),sint16x4:t=>te(t.readInt16(),t.readInt16(),t.readInt16(),t.readInt16()),unorm16:t=>t.readUint16()/65535,unorm16x2:t=>C(t.readUint16()/65535,t.readUint16()/65535),unorm16x4:t=>L(t.readUint16()/65535,t.readUint16()/65535,t.readUint16()/65535,t.readUint16()/65535),snorm16:t=>(t.readUint16()-32768)/32767,snorm16x2:t=>C(Me.snorm16(t),Me.snorm16(t)),snorm16x4:t=>L(Me.snorm16(t),Me.snorm16(t),Me.snorm16(t),Me.snorm16(t)),float16(t){return t.readFloat16()},float16x2:t=>C(t.readFloat16(),t.readFloat16()),float16x4:t=>L(t.readFloat16(),t.readFloat16(),t.readFloat16(),t.readFloat16()),float32:t=>t.readFloat32(),float32x2:t=>C(t.readFloat32(),t.readFloat32()),float32x3:t=>Ye(t.readFloat32(),t.readFloat32(),t.readFloat32()),float32x4:t=>L(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32()),uint32:t=>t.readUint32(),uint32x2:t=>Ee(t.readUint32(),t.readUint32()),uint32x3:t=>Oe(t.readUint32(),t.readUint32(),t.readUint32()),uint32x4:t=>ee(t.readUint32(),t.readUint32(),t.readUint32(),t.readUint32()),sint32:t=>t.readInt32(),sint32x2:t=>Ue(t.readInt32(),t.readInt32()),sint32x3:t=>fr(t.readInt32(),t.readInt32(),t.readInt32()),sint32x4:t=>te(t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32()),"unorm10-10-10-2"(t){let e=t.readUint32(),n=(e>>22)/1023,r=(e>>12&1023)/1023,a=(e>>2&1023)/1023,d=(e&3)/3;return L(n,r,a,d)},"unorm8x4-bgra"(t){let e=t.readByte()/255,n=t.readByte()/255,r=t.readByte()/255,a=t.readByte()/255;return L(r,n,e,a)},unstruct(t,e){let n={};for(let[r,a]of Object.entries(e.propTypes))n[r]=he(t,a);return n},disarray(t,e){let n=$t(e),r=[];for(let a=0;a<e.elementCount;a++)_t(t,n),r.push(he(t,e.elementType));return _t(t,n),r},"loose-decorated"(t,e){_t(t,ue(e));let n=t.currentByteOffset,r=he(t,e.inner);return t.seekTo(n+pt(e)),r}};function he(t,e){let n=Me[e.type];if(!n)throw new Error(`Cannot read data of type '${e.type}'.`);return n(t,e)}function sc(t,e,n){return je(e)?new us(t,e,n):new us(t,e,n,["storage","uniform"])}function gr(t){return t.resourceType==="buffer"}function ic(t){return!!t.usableAsUniform}var us=class{constructor(t,e,n,r){this._group=t,this.dataType=e,this.initialOrBuffer=n,this._disallowedUsages=r,E(this,"resourceType","buffer"),E(this,"flags",GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),E(this,"_buffer",null),E(this,"_ownBuffer"),E(this,"_destroyed",!1),E(this,"_label"),E(this,"initial"),E(this,"usableAsUniform",!1),E(this,"usableAsStorage",!1),E(this,"usableAsVertex",!1),Iu(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}get label(){return this._label}get buffer(){var t;let e=this._group.device;if(this._destroyed)throw new Error("This buffer has been destroyed");if(!this._buffer&&(this._buffer=e.createBuffer({size:pt(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:(t=this.label)!=null?t:"<unnamed>"}),this.initial)){let n=new hn(this._buffer.getMappedRange());qe(n,this.dataType,this.initial),this._buffer.unmap()}return this._buffer}get destroyed(){return this._destroyed}$name(t){return this._label=t,this._buffer&&(this._buffer.label=t),this}$usage(...t){var e;for(let n of t){if((e=this._disallowedUsages)!=null&&e.includes(n))throw new Error(`Buffer of type ${this.dataType} cannot be used as ${n}`);this.flags|=n==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=n==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=n==="vertex"?GPUBufferUsage.VERTEX:0,this.usableAsUniform=this.usableAsUniform||n==="uniform",this.usableAsStorage=this.usableAsStorage||n==="storage",this.usableAsVertex=this.usableAsVertex||n==="vertex"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}write(t){let e=this.buffer,n=this._group.device;if(e.mapState==="mapped"){let d=e.getMappedRange();qe(new hn(d),this.dataType,t);return}let r=pt(this.dataType);this._group.flush();let a=new ArrayBuffer(r);qe(new hn(a),this.dataType,t),n.queue.writeBuffer(e,0,a,0,r)}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let e=pt(this.dataType);this._group.commandEncoder.copyBufferToBuffer(t.buffer,0,this.buffer,0,e)}async read(){this._group.flush();let t=this.buffer,e=this._group.device;if(t.mapState==="mapped"){let d=t.getMappedRange();return he(new fn(d),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let d=t.getMappedRange(),m=he(new fn(d),this.dataType);return t.unmap(),m}let n=e.createBuffer({size:pt(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),r=e.createCommandEncoder();r.copyBufferToBuffer(t,0,n,0,pt(this.dataType)),e.queue.submit([r.finish()]),await e.queue.onSubmittedWorkDone(),await n.mapAsync(GPUMapMode.READ,0,pt(this.dataType));let a=he(new fn(n.getMappedRange()),this.dataType);return n.unmap(),n.destroy(),a}destroy(){var t;this._destroyed||(this._destroyed=!0,this._ownBuffer&&((t=this._buffer)==null||t.destroy()))}toString(){var t;return`buffer:${(t=this._label)!=null?t:"<unnamed>"}`}};function cs(t){return!!(t!=null&&t.usableAsStorage)}var oc=class ci extends Error{constructor(e){var n;super(`Resource '${(n=e.label)!=null?n:"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,ci.prototype)}};function ac(t){return t?.resourceType==="buffer-usage"}var uc={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},ls=class{constructor(t,e,n){this.usage=t,this.dataType=e,this._membership=n,E(this,"~repr"),E(this,"resourceType","buffer-usage")}get label(){return this._membership.key}"~resolve"(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=uc[this.usage];return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var<${r}> ${e}: ${t.resolve(this.dataType)};`),e}toString(){var t;return`${this.usage}:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!le())throw new Error("Cannot access buffer's value directly in JS.");return this}};function cc(t){return new dc(t)}function lc(t){return new pc(t)}var fc=class{constructor(t){this._membership=t,E(this,"resourceType","sampler")}get label(){return this._membership.key}"~resolve"(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: sampler;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},hc=class{constructor(t){this._membership=t,E(this,"resourceType","sampler-comparison")}get label(){return this._membership.key}"~resolve"(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: sampler_comparison;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},dc=class{constructor(t){this._props=t,E(this,"resourceType","sampler"),E(this,"_label"),E(this,"_filtering"),this._filtering=t.minFilter==="linear"||t.magFilter==="linear"||t.mipmapFilter==="linear"}get label(){return this._label}$name(t){return this._label=t,this}"~resolve"(t){let e=t.names.makeUnique(this._label),{group:n,binding:r}=t.allocateFixedEntry({sampler:this._filtering?"filtering":"non-filtering"},this);return t.addDeclaration(`@group(${n}) @binding(${r}) var ${e}: sampler;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},pc=class{constructor(t){this._props=t,E(this,"resourceType","sampler-comparison"),E(this,"_label")}get label(){return this._label}$name(t){return this._label=t,this}"~resolve"(t){let e=t.names.makeUnique(this.label),{group:n,binding:r}=t.allocateFixedEntry({sampler:"comparison"},this);return t.addDeclaration(`@group(${n}) @binding(${r}) var ${e}: sampler_comparison;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},wc=class{constructor(t){this._membership=t,E(this,"resourceType","external-texture")}get label(){return this._membership.key}"~resolve"(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: texture_external;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},mc={r8unorm:k,r8snorm:k,r8uint:ft,r8sint:Xt,r16uint:ft,r16sint:Xt,r16float:k,rg8unorm:k,rg8snorm:k,rg8uint:ft,rg8sint:Xt,r32uint:ft,r32sint:Xt,r32float:k,rg16uint:ft,rg16sint:Xt,rg16float:k,rgba8unorm:k,"rgba8unorm-srgb":k,rgba8snorm:k,rgba8uint:ft,rgba8sint:Xt,bgra8unorm:k,"bgra8unorm-srgb":k,rgb9e5ufloat:k,rgb10a2uint:ft,rgb10a2unorm:k,rg11b10ufloat:k,rg32uint:ft,rg32sint:Xt,rg32float:k,rgba16uint:ft,rgba16sint:Xt,rgba16float:k,rgba32uint:ft,rgba32sint:Xt,rgba32float:k,stencil8:k,depth16unorm:k,depth24plus:k,"depth24plus-stencil8":k,depth32float:k,"depth32float-stencil8":k,"bc1-rgba-unorm":k,"bc1-rgba-unorm-srgb":k,"bc2-rgba-unorm":k,"bc2-rgba-unorm-srgb":k,"bc3-rgba-unorm":k,"bc3-rgba-unorm-srgb":k,"bc4-r-unorm":k,"bc4-r-snorm":k,"bc5-rg-unorm":k,"bc5-rg-snorm":k,"bc6h-rgb-ufloat":k,"bc6h-rgb-float":k,"bc7-rgba-unorm":k,"bc7-rgba-unorm-srgb":k,"etc2-rgb8unorm":k,"etc2-rgb8unorm-srgb":k,"etc2-rgb8a1unorm":k,"etc2-rgb8a1unorm-srgb":k,"etc2-rgba8unorm":k,"etc2-rgba8unorm-srgb":k,"eac-r11unorm":k,"eac-r11snorm":k,"eac-rg11unorm":k,"eac-rg11snorm":k,"astc-4x4-unorm":k,"astc-4x4-unorm-srgb":k,"astc-5x4-unorm":k,"astc-5x4-unorm-srgb":k,"astc-5x5-unorm":k,"astc-5x5-unorm-srgb":k,"astc-6x5-unorm":k,"astc-6x5-unorm-srgb":k,"astc-6x6-unorm":k,"astc-6x6-unorm-srgb":k,"astc-8x5-unorm":k,"astc-8x5-unorm-srgb":k,"astc-8x6-unorm":k,"astc-8x6-unorm-srgb":k,"astc-8x8-unorm":k,"astc-8x8-unorm-srgb":k,"astc-10x5-unorm":k,"astc-10x5-unorm-srgb":k,"astc-10x6-unorm":k,"astc-10x6-unorm-srgb":k,"astc-10x8-unorm":k,"astc-10x8-unorm-srgb":k,"astc-10x10-unorm":k,"astc-10x10-unorm-srgb":k,"astc-12x10-unorm":k,"astc-12x10-unorm-srgb":k,"astc-12x12-unorm":k,"astc-12x12-unorm-srgb":k},Sn={rgba8unorm:L,rgba8snorm:L,rgba8uint:ee,rgba8sint:te,rgba16uint:ee,rgba16sint:te,rgba16float:L,r32uint:ee,r32sint:te,r32float:L,rg32uint:ee,rg32sint:te,rg32float:L,rgba32uint:ee,rgba32sint:te,rgba32float:L,bgra8unorm:L},yc={f32:"float",u32:"uint",i32:"sint"},gc={float:k,"unfilterable-float":k,uint:ft,sint:Xt,depth:k};function vc(t,e){return new _c(t,e)}function Dn(t){return t?.resourceType==="texture"}function xc(t){return t?.resourceType==="texture-storage-view"}function bc(t){return t?.resourceType==="texture-sampled-view"}var li={mutable:"read_write",readonly:"read",writeonly:"write"},_c=class{constructor(t,e){this.props=t,this._branch=e,E(this,"resourceType","texture"),E(this,"usableAsSampled",!1),E(this,"usableAsStorage",!1),E(this,"usableAsRender",!1),E(this,"_destroyed",!1),E(this,"_label"),E(this,"_flags",GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC),E(this,"_texture",null)}get label(){return this._label}$name(t){return this._label=t,this}unwrap(){var t,e,n,r,a;if(this._destroyed)throw new Error("This texture has been destroyed");return this._texture||(this._texture=this._branch.device.createTexture({label:(t=this._label)!=null?t:"<unnamed>",format:this.props.format,size:this.props.size,usage:this._flags,dimension:(e=this.props.dimension)!=null?e:"2d",viewFormats:(n=this.props.viewFormats)!=null?n:[],mipLevelCount:(r=this.props.mipLevelCount)!=null?r:1,sampleCount:(a=this.props.sampleCount)!=null?a:1})),this._texture}$usage(...t){let e=t.includes("storage"),n=t.includes("sampled"),r=t.includes("render");return this._flags|=n?GPUTextureUsage.TEXTURE_BINDING:0,this._flags|=e?GPUTextureUsage.STORAGE_BINDING:0,this._flags|=r?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||(this.usableAsStorage=e),this.usableAsSampled||(this.usableAsSampled=n),this.usableAsRender||(this.usableAsRender=r),this}createView(t,e){if(t==="sampled")return this._asSampled(e);let n=e;switch(t){case"mutable":return this._asMutable(n);case"readonly":return this._asReadonly(n);case"writeonly":return this._asWriteonly(n)}}_asStorage(t,e){var n;if(!this.usableAsStorage)throw new Error("Unusable as storage");let r=(n=t?.format)!=null?n:this.props.format,a=Sn[r];return _n(!!a),new $c(t??{},e,this)}_asReadonly(t){return this._asStorage(t,"readonly")}_asWriteonly(t){return this._asStorage(t,"writeonly")}_asMutable(t){return this._asStorage(t,"mutable")}_asSampled(t){var e;if(!this.usableAsSampled)throw new Error("Unusable as sampled");let n=(e=t?.format)!=null?e:this.props.format;if(!Sn[n])throw new Error(`Unsupported storage texture format: ${n}`);return new Mc(t,this)}destroy(){var t;this._destroyed||(this._destroyed=!0,(t=this._texture)==null||t.destroy())}},Ln={"1d":"1d","2d":"2d","2d-array":"2d_array",cube:"cube","cube-array":"cube_array","3d":"3d"},$c=class{constructor(t,e,n){this.access=e,this._texture=n,E(this,"resourceType","texture-storage-view"),E(this,"texelDataType"),E(this,"dimension"),E(this,"_view"),E(this,"_format");var r,a,d;this.dimension=(a=(r=t?.dimension)!=null?r:n.props.dimension)!=null?a:"2d",this._format=(d=t?.format)!=null?d:n.props.format,this.texelDataType=Sn[this._format]}get label(){return this._texture.label}$name(t){return this._texture.$name(t),this}unwrap(){var t;return this._view||(this._view=this._texture.unwrap().createView({label:`${(t=this.label)!=null?t:"<unnamed>"} - View`,format:this._format,dimension:this.dimension})),this._view}"~resolve"(t){let e=t.names.makeUnique(this.label),{group:n,binding:r}=t.allocateFixedEntry({storageTexture:this._format,access:this.access,viewDimension:this.dimension},this),a=`texture_storage_${Ln[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${r}) var ${e}: ${a}<${this._format}, ${li[this.access]}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},Tc=class{constructor(t,e,n,r){this._format=t,this.dimension=e,this.access=n,this._membership=r,E(this,"resourceType","texture-storage-view"),E(this,"texelDataType"),this.texelDataType=Sn[this._format]}get label(){return this._membership.key}"~resolve"(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=`texture_storage_${Ln[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: ${r}<${this._format}, ${li[this.access]}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},Mc=class{constructor(t,e){this._props=t,this._texture=e,E(this,"resourceType","texture-sampled-view"),E(this,"channelDataType"),E(this,"dimension"),E(this,"_format"),E(this,"_view");var n,r,a;this.dimension=(r=(n=t?.dimension)!=null?n:e.props.dimension)!=null?r:"2d",this._format=(a=t?.format)!=null?a:e.props.format,this.channelDataType=mc[this._format]}get label(){return this._texture.label}$name(t){return this._texture.$name(t),this}unwrap(){var t;return this._view||(this._view=this._texture.unwrap().createView(De({label:`${(t=this.label)!=null?t:"<unnamed>"} - View`},this._props))),this._view}"~resolve"(t){var e;let n=t.names.makeUnique(this.label),r=((e=this._texture.props.sampleCount)!=null?e:1)>1,{group:a,binding:d}=t.allocateFixedEntry({texture:yc[this.channelDataType.type],viewDimension:this.dimension,multisampled:r},this),m=r?"texture_multisampled_2d":`texture_${Ln[this.dimension]}`;return t.addDeclaration(`@group(${a}) @binding(${d}) var ${n}: ${m}<${t.resolve(this.channelDataType)}>;`),n}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},Sc=class{constructor(t,e,n,r){this.dimension=e,this._multisampled=n,this._membership=r,E(this,"resourceType","texture-sampled-view"),E(this,"channelDataType"),this.channelDataType=gc[t]}get label(){return this._membership.key}"~resolve"(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=this._multisampled?"texture_multisampled_2d":`texture_${Ln[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: ${r}<${t.resolve(this.channelDataType)}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}};function Dc(t){return!!(t!=null&&t.usableAsSampled)}var Uc=class fi extends Error{constructor(e){var n;super(`Resource '${(n=e.label)!=null?n:"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,fi.prototype)}};function hi(t){return new Ic(t)}function di(t){return!!t&&t.resourceType==="bind-group-layout"}function Ec(t){return!!t&&t.resourceType==="bind-group"}var Oc=class pi extends Error{constructor(e,n){super(`Bind group '${e??"<unnamed>"}' is missing a required binding '${n}'`),Object.setPrototypeOf(this,pi.prototype)}},fs=["compute"],Fe=["compute","vertex","fragment"],Ic=class{constructor(t){this.entries=t,E(this,"_label"),E(this,"_index"),E(this,"resourceType","bind-group-layout"),E(this,"bound",{});var e,n,r,a,d;let m=0;for(let[g,T]of Object.entries(t)){if(T===null){m++;continue}let I={idx:m,key:g,layout:this};if("uniform"in T&&(this.bound[g]=new ls("uniform",T.uniform,I)),"storage"in T){let A="type"in T.storage?T.storage:T.storage(0);this.bound[g]=new ls((e=T.access)!=null?e:"readonly",A,I)}"texture"in T&&(this.bound[g]=new Sc(T.texture,(n=T.viewDimension)!=null?n:"2d",(r=T.multisampled)!=null?r:!1,I)),"storageTexture"in T&&(this.bound[g]=new Tc(T.storageTexture,(a=T.viewDimension)!=null?a:"2d",(d=T.access)!=null?d:"writeonly",I)),"externalTexture"in T&&(this.bound[g]=new wc(I)),"sampler"in T&&(T.sampler==="comparison"?this.bound[g]=new hc(I):this.bound[g]=new fc(I)),m++}}get label(){return this._label}get index(){return this._index}$name(t){return this._label=t,this}$idx(t){return this._index=t,this}unwrap(t){var e;return t.device.createBindGroupLayout({label:(e=this.label)!=null?e:"<unnamed>",entries:Object.values(this.entries).map((n,r)=>{var a,d,m,g;if(n===null)return null;let T=n.visibility,I={binding:r,visibility:0};if("uniform"in n)T=T??Fe,I.buffer={type:"uniform"};else if("storage"in n)T=T??(n.access==="mutable"?fs:Fe),I.buffer={type:n.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in n)T=T??Fe,I.sampler={type:n.sampler};else if("texture"in n)T=T??Fe,I.texture={sampleType:n.texture,viewDimension:(a=n.viewDimension)!=null?a:"2d",multisampled:(d=n.multisampled)!=null?d:!1};else if("storageTexture"in n){let A=(m=n.access)!=null?m:"writeonly";T=T??(A==="readonly"?Fe:fs),I.storageTexture={format:n.storageTexture,access:{mutable:"read-write",readonly:"read-only",writeonly:"write-only"}[A],viewDimension:(g=n.viewDimension)!=null?g:"2d"}}else"externalTexture"in n&&(T=T??Fe,I.externalTexture={});return T!=null&&T.includes("compute")&&(I.visibility|=GPUShaderStage.COMPUTE),T!=null&&T.includes("vertex")&&(I.visibility|=GPUShaderStage.VERTEX),T!=null&&T.includes("fragment")&&(I.visibility|=GPUShaderStage.FRAGMENT),I}).filter(n=>n!==null)})}populate(t){return new Br(this,t)}},Br=class{constructor(t,e){this.layout=t,this.entries=e,E(this,"resourceType","bind-group");for(let n of Object.keys(t.entries))if(t.entries[n]!==null&&!(n in e))throw new Oc(t.label,n)}unwrap(t){var e;return t.device.createBindGroup({label:(e=this.layout.label)!=null?e:"<unnamed>",layout:t.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([n,r],a)=>{var d;if(r===null)return null;let m=this.entries[n];if(m===void 0)throw new Error(`'${n}' is a resource required to populate bind group layout '${(d=this.layout.label)!=null?d:"<unnamed>"}'.`);if("uniform"in r){let g;if(gr(m)){if(!ic(m))throw new Xr(m);g={buffer:t.unwrap(m)}}else g={buffer:m};return{binding:a,resource:g}}if("storage"in r){let g;if(gr(m)){if(!cs(m))throw new Xr(m);g={buffer:t.unwrap(m)}}else g={buffer:m};return{binding:a,resource:g}}if("texture"in r){let g;if(Dn(m)){if(!Dc(m))throw new Uc(m);g=t.unwrap(m.createView("sampled"))}else g=m;return{binding:a,resource:g}}if("storageTexture"in r){let g;if(Dn(m)){if(!cs(m))throw new oc(m);r.access==="readonly"?g=t.unwrap(m.createView("readonly")):r.access==="mutable"?g=t.unwrap(m.createView("mutable")):g=t.unwrap(m.createView("writeonly"))}else g=m;return{binding:a,resource:g}}if("externalTexture"in r||"sampler"in r)return{binding:a,resource:m};throw new Error(`Malformed bind group entry: ${m} (${JSON.stringify(m)})`)}).filter(n=>n!==null)})}},wi="#CATCHALL#",Ac=class{constructor(){E(this,"_stack",[]),E(this,"_itemDepth",0)}get itemDepth(){return this._itemDepth}get topItem(){let t=this._stack[this._stack.length-1];if(!t||t.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return t}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}pushSlotBindings(t){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(t)})}pushFunctionScope(t,e,n){this._stack.push({type:"functionScope",args:t,returnType:e,externalMap:n})}pop(){let t=this._stack.pop();t?.type==="item"&&this._itemDepth--}readSlot(t){for(let e=this._stack.length-1;e>=0;--e){let n=this._stack[e];if(n?.type==="item")n.usedSlots.add(t);else if(n?.type==="slotBinding"){let r=n.bindingMap.get(t);if(r!==void 0)return r}else if(!(n?.type==="functionScope"||n?.type==="blockScope"))throw new Error("Unknown layer type.")}return t.defaultValue}getResourceById(t){for(let e=this._stack.length-1;e>=0;--e){let n=this._stack[e];if(n?.type==="functionScope"){let r=n.args.find(d=>d.value===t);if(r!==void 0)return r;let a=n.externalMap[t];return a!==void 0?{value:a,dataType:Qt}:void 0}if(n?.type==="blockScope"){let r=n.declarations.get(t);if(r!==void 0)return{value:t,dataType:r}}}}},pn=["","  ","    ","      ","        ","          ","            ","              ","                "],Yn=pn.length-1,kc=class{constructor(){E(this,"identLevel",0)}get pre(){var t;return(t=pn[this.identLevel])!=null?t:pn[Yn].repeat(this.identLevel/Yn)+pn[this.identLevel%Yn]}indent(){let t=this.pre;return this.identLevel++,t}dedent(){return this.identLevel--,this.pre}},Fc=class{constructor(t){E(this,"_memoizedResolves",new WeakMap),E(this,"_memoizedDerived",new WeakMap),E(this,"_indentController",new kc),E(this,"_jitTranspiler"),E(this,"_itemStateStack",new Ac),E(this,"_declarations",[]),E(this,"bindGroupLayoutsToPlaceholderMap",new Map),E(this,"_nextFreeLayoutPlaceholderIdx",0),E(this,"fixedBindings",[]),E(this,"names"),this.names=t.names,this._jitTranspiler=t.jitTranspiler}get pre(){return this._indentController.pre}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}getById(t){var e;return(e=this._itemStateStack.getResourceById(t))!=null?e:{value:t,dataType:Qt}}transpileFn(t){if(!this._jitTranspiler)throw new Error("Tried to execute a tgpu.fn function without providing a JIT transpiler, or transpiling at build time.");return this._jitTranspiler.transpileFn(t)}fnToWgsl(t){this._itemStateStack.pushFunctionScope(t.args,t.returnType,t.externalMap);let e=nc(this,t.body);this._itemStateStack.pop();let n=t.args.map(r=>`${r.value}: ${this.resolve(r.dataType)}`).join(", ");return{head:t.returnType!==void 0?`(${n}) -> ${this.resolve(t.returnType)}`:`(${n})`,body:e}}addDeclaration(t){this._declarations.push(t)}allocateLayoutEntry(t){let e=this.bindGroupLayoutsToPlaceholderMap,n=e.get(t);return n||(n=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,e.set(t,n)),n}allocateFixedEntry(t,e){let n=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:t,resource:e}),{group:wi,binding:n}}readSlot(t){let e=this._itemStateStack.readSlot(t);if(e===void 0)throw new co(t);return e}withSlots(t,e){this._itemStateStack.pushSlotBindings(t);try{return e()}finally{this._itemStateStack.pop()}}unwrap(t){let e=t;for(;;)if(pr(e))e=this.readSlot(e);else if(wr(e))e=this._getOrCompute(e);else break;return e}_getOrCompute(t){var e;let n=(e=this._memoizedDerived.get(t))!=null?e:[];this._itemStateStack.pushItem();try{for(let d of n)if([...d.slotToValueMap.entries()].every(([m,g])=>m.areEqual(this._itemStateStack.readSlot(m),g)))return d.result;let r=t["~compute"](),a=new Map;for(let d of this._itemStateStack.topItem.usedSlots)a.set(d,this._itemStateStack.readSlot(d));return n.push({slotToValueMap:a,result:r}),this._memoizedDerived.set(t,n),r}catch(r){throw r instanceof un?r.appendToTrace(t):new un(r,[t])}finally{this._itemStateStack.pop()}}_getOrInstantiate(t){var e;let n=(e=this._memoizedResolves.get(t))!=null?e:[];this._itemStateStack.pushItem();try{for(let d of n)if([...d.slotToValueMap.entries()].every(([m,g])=>m.areEqual(this._itemStateStack.readSlot(m),g)))return d.result;let r;je(t)?r=oi(this,t):wr(t)||pr(t)?r=this.resolve(t):ei(t)?r=t["~resolve"](this):r=this.resolveValue(t);let a=new Map;for(let d of this._itemStateStack.topItem.usedSlots)a.set(d,this._itemStateStack.readSlot(d));return n.push({slotToValueMap:a,result:r}),this._memoizedResolves.set(t,n),r}catch(r){throw r instanceof un?r.appendToTrace(t):new un(r,[t])}finally{this._itemStateStack.pop()}}resolve(t){let e=this.unwrap(t);if(e&&typeof e=="object"||typeof e=="function"){if(this._itemStateStack.itemDepth===0){let n=fo(this,()=>this._getOrInstantiate(e));return`${[...this._declarations].join(`

`)}${n}`}return this._getOrInstantiate(e)}return String(e)}resolveValue(t,e){if(Rn(t))return this.resolve(t);if(e&&Er(e))return`array(${t.map(n=>this.resolveValue(n,e.elementType))})`;if(Array.isArray(t))return`array(${t.map(n=>this.resolveValue(n))})`;if(e&&$e(e))return`${this.resolve(e)}(${Object.entries(e.propTypes).map(([n,r])=>this.resolveValue(t[n],r))})`;throw new Error(`Value ${t} (as json: ${JSON.stringify(t)}) of schema ${e} is not resolvable to WGSL`)}};function jr(t,e){var n;let r=new Fc(e),a=r.resolve(t),d=r.bindGroupLayoutsToPlaceholderMap,m=[],g=new Set([...d.keys()].map(F=>F.index).filter(F=>F!==void 0)),T=ho(g),I=r.fixedBindings.map((F,j)=>[String(j),F.layoutEntry]),A=()=>{let F=T.next().value,j=hi(Object.fromEntries(I));return m[F]=j,a=a.replaceAll(wi,String(F)),[F,new Br(j,Object.fromEntries(r.fixedBindings.map((B,P)=>[String(P),B.resource])))]},z=I.length>0?A():null;for(let[F,j]of d.entries()){let B=(n=F.index)!=null?n:T.next().value;m[B]=F,a=a.replaceAll(j,String(B))}return{code:a,bindGroupLayouts:m,catchall:z}}function zc(t){let{externals:e,template:n,names:r,unstable_jitTranspiler:a}=t,d={};Mn(d,e??{});let m={"~resolve"(T){return Vn(T,d,n??"")},toString:()=>"<root>"},{code:g}=jr(m,{names:r==="strict"?new Pr:new zr,jitTranspiler:a});return g}var hs=class{constructor(t){this._make=t,E(this,"_map",new WeakMap)}getOrMake(t,...e){if(this._map.has(t))return this._map.get(t);let n=this._make(t,...e);return this._map.set(t,n),n}};function Pc(t,e,n){return new jc(new Rc(t,e,n),{})}function Bc(t){return t?.resourceType==="compute-pipeline"}var jc=class mi{constructor(e,n){this._core=e,this._priors=n,E(this,"resourceType","compute-pipeline")}get label(){return this._core.label}get rawPipeline(){return this._core.unwrap().pipeline}with(e,n){var r;return new mi(this._core,{bindGroupLayoutMap:new Map([...(r=this._priors.bindGroupLayoutMap)!=null?r:[],[e,n]])})}dispatchWorkgroups(e,n,r){var a;let d=this._core.unwrap(),m=this._core.branch.commandEncoder.beginComputePass({label:(a=this._core.label)!=null?a:"<unnamed>"});m.setPipeline(d.pipeline),d.bindGroupLayouts.forEach((g,T)=>{var I;if(d.catchall&&T===d.catchall[0])m.setBindGroup(T,this._core.branch.unwrap(d.catchall[1]));else{let A=(I=this._priors.bindGroupLayoutMap)==null?void 0:I.get(g);if(A===void 0)throw new Ss(g.label);m.setBindGroup(T,this._core.branch.unwrap(A))}}),m.dispatchWorkgroups(e,n,r),m.end()}$name(e){return this._core.label=e,this}},Rc=class{constructor(t,e,n){this.branch=t,this._slotBindings=e,this._entryFn=n,E(this,"label"),E(this,"_memo")}unwrap(){var t,e,n,r,a;if(this._memo===void 0){let d=this.branch.device,{code:m,bindGroupLayouts:g,catchall:T}=jr({"~resolve":I=>(I.withSlots(this._slotBindings,()=>{I.resolve(this._entryFn)}),""),toString:()=>{var I;return`computePipeline:${(I=this.label)!=null?I:"<unnamed>"}`}},{names:this.branch.nameRegistry,jitTranspiler:this.branch.jitTranspiler});T!==null&&((e=g[T[0]])==null||e.$name(`${(t=this.label)!=null?t:"<unnamed>"} - Automatic Bind Group & Layout`)),this._memo={pipeline:d.createComputePipeline({label:(n=this.label)!=null?n:"<unnamed>",layout:d.createPipelineLayout({label:`${(r=this.label)!=null?r:"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:g.map(I=>this.branch.unwrap(I))}),compute:{module:d.createShaderModule({label:`${(a=this.label)!=null?a:"<unnamed>"} - Shader`,code:m})}}),bindGroupLayouts:g,catchall:T}}return this._memo}};function Vc(t){return typeof t?.format=="string"}function Nc(t,e){var n,r;let a=[];if(Pn(t)){if(!Vc(e))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return a.push(e._layout),{usedVertexLayouts:a,bufferDefinitions:[{arrayStride:e._layout.stride,stepMode:e._layout.stepMode,attributes:[{format:e.format,offset:e.offset,shaderLocation:(n=hr(t))!=null?n:0}]}]}}let d=[],m=new WeakMap,g=0;for(let[T,I]of Object.entries(t)){if(Cs(I))continue;let A=e[T];if(!A)throw new Error(`An attribute by the name of '${T}' was not provided to the shader.`);let z=A._layout,F=m.get(z);F||(a.push(z),F=[],d.push({arrayStride:z.stride,stepMode:z.stepMode,attributes:F}),m.set(z,F)),g=(r=hr(I))!=null?r:g,F.push({format:A.format,offset:A.offset,shaderLocation:g++})}return{usedVertexLayouts:a,bufferDefinitions:d}}function Lc(t,e="vertex"){return new qc(t,e)}function Gc(t){return t?.resourceType==="vertex-layout"}function wn(t,e,n){if(Re(e)||Ae(e))return wn(t,e.inner,ye(n,ue(e)));if($e(e)){let r=n;return Object.fromEntries(Object.entries(e.propTypes).map(([a,d])=>{r=ye(r,$t(d));let m=[a,wn(t,d,r)];return r+=pt(d),m}))}if(zn(e)){let r=n;return Object.fromEntries(Object.entries(e.propTypes).map(([a,d])=>{r=ye(r,ue(d));let m=[a,wn(t,d,r)];return r+=pt(d),m}))}if("type"in e&&typeof e.type=="string"){if(Ls.includes(e.type))return{_layout:t,format:e.type,offset:n};let r=Ua[e.type];if(r)return{_layout:t,format:r,offset:n}}throw new Error(`Unsupported data used in vertex layout: ${String(e)}`)}var qc=class{constructor(t,e){this.schemaForCount=t,this.stepMode=e,E(this,"resourceType","vertex-layout"),E(this,"stride"),E(this,"attrib"),E(this,"_label");let n=t(0);this.stride=ye(pt(n.elementType),$t(n)),this.attrib=wn(this,n.elementType,0)}get label(){return this._label}$name(t){return this._label=t,this}};function Cc(t){return typeof t?.loadOp=="string"}function Wc(t,e){if(Pn(t)){if(!Cc(e))throw new Error("Expected a single color attachment, not a record.");return[e]}let n=[];for(let r of Object.keys(t)){let a=e[r];if(!a)throw new Error(`A color attachment by the name of '${r}' was not provided to the shader.`);n.push(a)}return n}function Yc(t){return typeof t?.format=="string"}function Xc(t,e){if(Pn(t)){if(!Yc(e))throw new Error("Expected a single color target configuration, not a record.");return[e]}let n=[];for(let r of Object.keys(t)){let a=e[r];if(!a)throw new Error(`A color target by the name of '${r}' was not provided to the shader.`);n.push(a)}return n}function Zc(t){return new Kc(new Hc(t),{})}var Kc=class mn{constructor(e,n){this._core=e,this._priors=n,E(this,"resourceType","render-pipeline")}get label(){return this._core.label}$name(e){return this._core.label=e,this}with(e,n){var r,a;if(di(e))return new mn(this._core,Pe(De({},this._priors),{bindGroupLayoutMap:new Map([...(r=this._priors.bindGroupLayoutMap)!=null?r:[],[e,n]])}));if(Gc(e))return new mn(this._core,Pe(De({},this._priors),{vertexLayoutMap:new Map([...(a=this._priors.vertexLayoutMap)!=null?a:[],[e,n]])}));throw new Error("Unsupported value passed into .with()")}withColorAttachment(e){return new mn(this._core,Pe(De({},this._priors),{colorAttachment:e}))}draw(e,n,r,a){var d,m;let g=this._core.unwrap(),{branch:T,fragmentFn:I}=this._core.options,A=Wc(I.shell.returnType,(d=this._priors.colorAttachment)!=null?d:{}).map(F=>Dn(F.view)?Pe(De({},F),{view:T.unwrap(F.view).createView()}):F),z=T.commandEncoder.beginRenderPass({label:(m=this._core.label)!=null?m:"<unnamed>",colorAttachments:A});z.setPipeline(g.pipeline),g.bindGroupLayouts.forEach((F,j)=>{var B;if(g.catchall&&j===g.catchall[0])z.setBindGroup(j,T.unwrap(g.catchall[1]));else{let P=(B=this._priors.bindGroupLayoutMap)==null?void 0:B.get(F);if(P===void 0)throw new Ss(F.label);z.setBindGroup(j,T.unwrap(P))}}),this._core.usedVertexLayouts.forEach((F,j)=>{var B,P;let q=(B=this._priors.vertexLayoutMap)==null?void 0:B.get(F);if(!q)throw new Error(`Missing vertex buffer for layout '${(P=F.label)!=null?P:"<unnamed>"}'. Please provide it using pipeline.with(layout, buffer).(...)`);z.setVertexBuffer(j,T.unwrap(q))}),z.draw(e,n,r,a),z.end()}},Hc=class{constructor(t){this.options=t,E(this,"label"),E(this,"usedVertexLayouts"),E(this,"_memo"),E(this,"_vertexBufferLayouts"),E(this,"_targets");let e=Nc(t.vertexFn.shell.argTypes[0],t.vertexAttribs);this._vertexBufferLayouts=e.bufferDefinitions,this.usedVertexLayouts=e.usedVertexLayouts,this._targets=Xc(t.fragmentFn.shell.returnType,t.targets)}unwrap(){var t,e,n,r;if(this._memo===void 0){let{branch:a,vertexFn:d,fragmentFn:m,slotBindings:g,primitiveState:T}=this.options,{code:I,bindGroupLayouts:A,catchall:z}=jr({"~resolve":P=>(P.withSlots(g,()=>{P.resolve(d),P.resolve(m)}),""),toString:()=>{var P;return`renderPipeline:${(P=this.label)!=null?P:"<unnamed>"}`}},{names:a.nameRegistry,jitTranspiler:a.jitTranspiler});z!==null&&((e=A[z[0]])==null||e.$name(`${(t=this.label)!=null?t:"<unnamed>"} - Automatic Bind Group & Layout`));let F=a.device,j=F.createShaderModule({label:`${(n=this.label)!=null?n:"<unnamed>"} - Shader`,code:I}),B={layout:F.createPipelineLayout({label:`${(r=this.label)!=null?r:"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:A.map(P=>a.unwrap(P))}),vertex:{module:j,buffers:this._vertexBufferLayouts},fragment:{module:j,targets:this._targets}};this.label!==void 0&&(B.label=this.label),T&&(B.primitive=T),this._memo={pipeline:F.createRenderPipeline(B),bindGroupLayouts:A,catchall:z}}return this._memo}},Jc=class yi{constructor(e,n){this._getRoot=e,this._slotBindings=n}with(e,n){return new yi(this._getRoot,[...this._slotBindings,[kr(e)?e.slot:e,n]])}withCompute(e){return new Qc(this._getRoot(),this._slotBindings,e)}withVertex(e,n){return new tl({branch:this._getRoot(),primitiveState:void 0,slotBindings:this._slotBindings,vertexFn:e,vertexAttribs:n})}},Qc=class{constructor(t,e,n){this._root=t,this._slotBindings=e,this._entryFn=n}createPipeline(){return Pc(this._root,this._slotBindings,this._entryFn)}},tl=class{constructor(t){this._options=t}withFragment(t,e,n){return _n(typeof t!="string"),_n(typeof e!="string"),new el(Pe(De({},this._options),{fragmentFn:t,targets:e}))}},el=class gi{constructor(e){this._options=e}withPrimitive(e){return new gi(Pe(De({},this._options),{primitiveState:e}))}createPipeline(){return Zc(this._options)}},vi=class extends Jc{constructor(t,e,n,r){super(()=>this,[]),this.device=t,this.nameRegistry=e,this.jitTranspiler=n,this._ownDevice=r,E(this,"~unstable"),E(this,"_disposables",[]),E(this,"_unwrappedBindGroupLayouts",new hs(a=>a.unwrap(this))),E(this,"_unwrappedBindGroups",new hs(a=>a.unwrap(this))),E(this,"_commandEncoder",null),this["~unstable"]={nameRegistry:this.nameRegistry,commandEncoder:this.commandEncoder,createTexture:this.createTexture.bind(this),with:this.with.bind(this),withCompute:this.withCompute.bind(this),withVertex:this.withVertex.bind(this),flush:this.flush.bind(this)}}get commandEncoder(){return this._commandEncoder||(this._commandEncoder=this.device.createCommandEncoder()),this._commandEncoder}createBuffer(t,e){let n=sc(this,t,e);return this._disposables.push(n),n}createBindGroup(t,e){return new Br(t,e)}destroy(){for(let t of this._disposables)t.destroy();this._ownDevice&&this.device.destroy()}createTexture(t){let e=vc(t,this);return this._disposables.push(e),e}unwrap(t){if(Bc(t))return t.rawPipeline;if(di(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(Ec(t))return this._unwrappedBindGroups.getOrMake(t);if(gr(t))return t.buffer;if(Dn(t)||xc(t)||bc(t))return t.unwrap();throw new Error(`Unknown resource type: ${t}`)}flush(){this._commandEncoder&&(this.device.queue.submit([this._commandEncoder.finish()]),this._commandEncoder=null)}};async function nl(t){let{adapter:e,device:n,unstable_names:r="random",unstable_jitTranspiler:a}=t??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let d=await navigator.gpu.requestAdapter(e);if(!d)throw new Error("Could not find a compatible GPU");return new vi(await d.requestDevice(n),r==="random"?new zr:new Pr,a,!0)}function rl(t){let{device:e,unstable_names:n="random",unstable_jitTranspiler:r}=t??{};return new vi(e,n==="random"?new zr:new Pr,r,!1)}function xi(t){return new sl(t)}var sl=class{constructor(t=void 0){this.defaultValue=t,E(this,"resourceType","slot"),E(this,"label")}$name(t){return this.label=t,this}areEqual(t,e){return Object.is(t,e)}toString(){var t;return`slot:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){let t=We();if(!t)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return t.unwrap(this)}};function il(t,e){return new ol(t,e)}var ol=class{constructor(t,e=void 0){this.schema=t,this.defaultValue=e,E(this,"resourceType","accessor"),E(this,"label"),E(this,"slot"),this.slot=xi(e)}$name(t){return this.label=t,this.slot.$name(t),this}toString(){var t;return`accessor:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!We())throw new Error("Cannot access tgpu.accessor's value outside of resolution.");return this}"~resolve"(t){let e=t.unwrap(this.slot);return ac(e)?t.resolve(e):Nu(e)?`${t.resolve(e)}()`:t.resolveValue(e,this.schema)}};function al(t){return ul(t)}function ul(t){return{resourceType:"derived","~compute":t,get value(){let e=We();if(!e)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return e.unwrap(this)},with(e,n){return bi(t,this,[e,n])},toString(){return"derived"}}}function bi(t,e,n){return{resourceType:"derived","~compute"(){let r=We();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return r.withSlots([n],()=>r.unwrap(e))},get value(){let r=We();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return r.unwrap(this)},with(r,a){return bi(t,this,[r,a])},toString(){var r;let[a,d]=n;return`derived[${(r=a.label)!=null?r:"<unnamed>"}=${d}]`}}}function cl(t,e){return new _i("private",t,e)}function ll(t){return new _i("workgroup",t)}var _i=class{constructor(t,e,n){this.scope=t,this._dataType=e,this._initialValue=n,E(this,"_label")}$name(t){return this._label=t,this}"~resolve"(t){let e=t.names.makeUnique(this._label);return this._initialValue?t.addDeclaration(`var<${this.scope}> ${e}: ${t.resolve(this._dataType)} = ${t.resolveValue(this._initialValue,this._dataType)};`):t.addDeclaration(`var<${this.scope}> ${e}: ${t.resolve(this._dataType)};`),e}get label(){return this._label}toString(){var t;return`var:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!le())throw new Error("Cannot access tgpu.var's value directly in JS.");return this}},Rr={bindGroupLayout:hi,init:nl,initFromDevice:rl,resolve:zc,"~unstable":{fn:Vu,fragmentFn:qu,vertexFn:Wu,computeFn:ju,vertexLayout:Lc,derived:al,slot:xi,accessor:il,privateVar:cl,workgroupVar:ll,const:Uu,declare:Fu,sampler:cc,comparisonSampler:lc}},xe=Rr;Object.assign(Rr,{__assignAst:Bu});const $i=br(),fl=$i.Provider;function Vr(){return Tr($i,"useRootContext","RootContext")}function hl(t){const[e]=Ii(()=>({adapterOptions:t.adapterOptions}),async({adapterOptions:n})=>{Je(()=>{d?.destroy(),a?.destroy()});const r=await navigator.gpu?.requestAdapter(n);if(!r)throw new Error("Failed to get GPUAdapter, make sure to use a browser with WebGPU support.");console.info(`Using ${r.info.vendor} adapter.`);const a=await r?.requestDevice();if(!a)throw new Error("Failed to get GPUDevice, make sure to use a browser with WebGPU support.");const d=Rr.initFromDevice({device:a});return{adapter:r,device:a,root:d}});return Kt(_r,{get when(){return e()},keyed:!0,children:n=>Kt(fl,{value:n,get children(){return t.children}})})}function dl(t,e){const[n,r]=Nt();return Ie(()=>{const a=t();if(!a)return;const d=new ResizeObserver(m=>{const g=m[0]?.devicePixelContentBoxSize[0];if(!a.isConnected||!g)return;const{width:T,height:I}=a.getBoundingClientRect(),A=g.inlineSize,z=g.blockSize,F={width:T,height:I,widthPX:A,heightPX:z};r(F),e?.(F)});d.observe(a),Je(()=>{d.disconnect()})}),n}var pl=$r("<canvas>");const{min:ds,max:ps}=Math;function wl(t){const{device:e}=Vr(),[n,r]=Nt(),a=dl(n,m=>{const g=n();g&&(g.width=ps(1,ds(m.widthPX,e.limits.maxTextureDimension2D)),g.height=ps(1,ds(m.heightPX,e.limits.maxTextureDimension2D)))});function d(m){const g=m.getContext("webgpu");if(!g)throw new Error("GPUCanvasContext failed to initialize.");return g.configure({device:e,format:navigator.gpu.getPreferredCanvasFormat()}),g}return[(()=>{var m=pl();return qi(r,m),m.style.setProperty("width","100%"),m.style.setProperty("height","100%"),we(()=>ze(m,t.class)),m})(),Kt(_r,{get when(){return n()},keyed:!0,children:m=>Kt(Su,{get value(){return{canvas:m,context:d(m),canvasSize:()=>({width:a()?.widthPX??0,height:a()?.heightPX??0})}},get children(){return t.children}})})]}const Ti=Qe({viewMatrix:Ze,viewMatrixInverse:Ze,resolution:C}).$name("Camera2DUniforms"),Ke=xe.bindGroupLayout({camera2DUniforms:{uniform:Ti}}).$name("Camera2DBindGroupLayout"),ml=xe["~unstable"].fn([C],C).does(`(world: vec2f) -> vec2f {
      let clip = camera2DUniforms.viewMatrix * vec3(world, 1);
      return clip.xy / clip.z;
    }`).$uses({...Ke.bound}).$name("camera2DWorldToClip"),yl=xe["~unstable"].fn([C],C).does(`(clip: vec2f) -> vec2f {
      let world = camera2DUniforms.viewMatrixInverse * vec3(clip, 1);
      return world.xy / world.z;
    }`).$uses({...Ke.bound}).$name("camera2DClipToWorld"),gl=xe["~unstable"].fn([C],C).does(`(clip: vec2f) -> vec2f {
      return 0.5 * clip * camera2DUniforms.resolution;
    }`).$uses({...Ke.bound}).$name("camera2DClipToPixels");function vl(t){const{root:e}=Vr(),{canvasSize:n}=jn(),r=()=>1/t.fovy,a=e.createBuffer(Ti).$usage("uniform").$name("Camera2DUniforms"),d=Ke.populate({camera2DUniforms:a}),m=ce(()=>{const{position:I,fovy:A}=t,{x:z,y:F}=I,{width:j,height:B}=n(),P=j/B,q=qs();fu.ortho(z-P*A,z+P*A,F-A,F+A,0,0,q);const st=Ze(q.columns[0].xyw,q.columns[1].xyw,q.columns[3].xyw),ot=lu.inverse(st,Ze());return{viewMatrix:st,viewMatrixInverse:ot,resolution:C(j,B)}});function g({x:I,y:A}){return hu.transformMat3(Ye(I,A,1),m().viewMatrixInverse,C())}function T(){a.write(m())}return Kt(to,{value:{update:T,bindGroup:d,BindGroupLayout:Ke,wgsl:{worldToClip:ml,clipToWorld:yl,clipToPixels:gl},js:{clipToWorld:g},zoom:r},get children(){return t.children}})}function xl(t){const{canvas:e}=jn(),[n,r]=Nt(1),[a,d]=Nt(C());let m;function g(T){T.preventDefault();const I=Ys(T),A=m?.(I);if(!A)return;const z=n(),F=z*(1-T.deltaY*.001),j=z/F;Ai(()=>{d(({x:B,y:P})=>C(B+(A.x-B)*(1-j),P+(A.y-P)*(1-j))),r(F)})}return Ie(()=>{e.addEventListener("wheel",g,{passive:!1}),Je(()=>{e.removeEventListener("wheel",g)})}),Kt(vl,{get position(){return a()},get fovy(){return 1/n()},get children(){return[ce(()=>(()=>{let{js:T}=Mr();return m=T.clipToWorld,null})()),ce(()=>t.children)]}})}function bl(t){Ie(()=>{let e=-1;function n(){de(t),e=requestAnimationFrame(n)}Je(()=>{cancelAnimationFrame(e)}),n()})}function _l(t,...e){const n=[],r=[];for(let a=0;a<t.length;++a)if(r.push(t[a]),a<e.length){const d=e[a];typeof d=="object"?n.push(d):r.push(d)}return xe.resolve({template:r.join(""),externals:Object.assign({},...n)})}const $l={color:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},He=Qe({position:Ha.position,positionOriginal:dn(0,C),innerRatio:dn(1,k),styleIndex:dn(2,Za("flat, either",ft))}),vr=Qe({center:C,radius:k,styleIndex:ft}).$name("Circle"),xr=Qe({rimColor:L,fadeColor:L}),Tl=1e5,Mi=24,Un=xe.bindGroupLayout({circles:{storage:t=>Xe(vr,t)},styles:{storage:t=>Xe(xr,t)}}),Ml=xe["~unstable"].fn([k,k,k],k).does(`
  (edge0: f32, edge1: f32, x: f32) -> f32 {
    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
  }`),Sl=t=>xe["~unstable"].fn([ft,ft],He).does(`
    (vertexIndex: u32, instanceIndex: u32) -> VertexOutput {
      const SUBDIVS = ${Mi};
      const WEDGE_ANGLE = radians(360.0) / SUBDIVS;
      const MIN_INNER_RADIUS = 0.5;
      const MAX_INNER_RADIUS = 0.95;
      const OVERSIZE_FACTOR = 1.01;

      let circle = circles[instanceIndex];
      let angle = f32(vertexIndex / 2) * WEDGE_ANGLE;
      let unitCircle = vec2f(cos(angle), sin(angle));
      let clip0 = worldToClip(circle.center);
      let clip1 = worldToClip(circle.center + unitCircle * circle.radius);
      let lengthPX = length(clipToPixels(clip1 - clip0));
      let innerRatio = clamp(1 - 20 / lengthPX, MIN_INNER_RADIUS, MAX_INNER_RADIUS);
      let ratio = select(innerRatio, OVERSIZE_FACTOR, vertexIndex % 2 == 0);
      let clip = mix(clip0, clip1, ratio);

      var out: VertexOutput;
      out.position = vec4f(clip, 0, 1);
      out.positionOriginal = mix(vec2f(0,0), unitCircle, ratio);
      out.innerRatio = innerRatio;
      out.styleIndex = circle.styleIndex;
      return out;
    }
  `).$uses({VertexOutput:He,...t.BindGroupLayout.bound,circles:Un.bound.circles,worldToClip:t.wgsl.worldToClip,clipToPixels:t.wgsl.clipToPixels}),Dl=xe["~unstable"].fn([He],L).does(`
    (in: VertexOutput) -> vec4f {
      const OUTER_RADIUS = 1.0;
      let style = styles[in.styleIndex];
      let dist = length(in.positionOriginal);
      let distWidth = fwidth(dist);
      // adding half a distWidth in order for circles to touch fully
      let disk = clamp((0.5*distWidth + OUTER_RADIUS - dist) / distWidth, 0, 1);
      let fade = linearstep(in.innerRatio, OUTER_RADIUS, dist);
      let fadeEaseIn = fade * fade;
      return (
        mix(style.fadeColor, style.rimColor, fadeEaseIn) *
        vec4f(1, 1, 1, disk * fadeEaseIn)
      );
    }
  `).$uses({VertexOutput:He,styles:Un.bound.styles,linearstep:Ml});function Ul(t){const e=Mr(),{root:n,device:r}=Vr(),{context:a}=jn(),d=n.createBuffer(Xe(vr,Tl)).$usage("storage").$name("circles");Ie(()=>{const{circles:A}=t,z=Va(vr),F=new DataView(new ArrayBuffer(z*A.length));for(let j=0,B=0;j<A.length;++j,B+=z){const P=A[j];F.setFloat32(B+0,P.center[0],!0),F.setFloat32(B+4,P.center[1],!0),F.setFloat32(B+8,P.radius,!0),F.setUint32(B+12,P.styleIndex,!0)}r.queue.writeBuffer(d.buffer,0,F,0,F.buffer.byteLength)});const m=n.createBuffer(xr).$usage("uniform").$name("color");Ie(()=>{m.write(t.color??{rimColor:L(0,0,0,1),fadeColor:L(0,0,0,1)})});const g=n.createBuffer(Xe(xr,t.styles.length)).$usage("storage").$name("styles");Ie(()=>{g.write(t.styles)});const T=ce(()=>{const A=_l`
      ${{VertexOutput:He,vert:Sl(e),frag:Dl}}

      @vertex fn vs(
        @builtin(vertex_index) vertexIndex: u32,
        @builtin(instance_index) instanceIndex: u32,
      ) -> VertexOutput {
        return vert(vertexIndex, instanceIndex);
      }

      @fragment fn fs(in: VertexOutput) -> @location(0) vec4f {
        let color = frag(in);
        return vec4f(color.rgb * color.a, color.a);
      }
    `,z=r.createShaderModule({label:"our hardcoded red triangle shaders",code:A}),F=r.createRenderPipeline({label:"our hardcoded red triangle pipeline",primitive:{topology:"triangle-strip"},layout:r.createPipelineLayout({bindGroupLayouts:[n.unwrap(e.BindGroupLayout),n.unwrap(Un)]}),vertex:{entryPoint:"vs",module:z},fragment:{entryPoint:"fs",module:z,targets:[{format:navigator.gpu.getPreferredCanvasFormat(),blend:$l}]}}),j=Un.populate({circles:d.buffer,styles:g.buffer});return{pipeline:F,uniformBindGroup:j}});return bl(()=>{const{circles:A}=t,{pipeline:z,uniformBindGroup:F}=T(),j=a.getCurrentTexture().createView();e.update();const B=r.createCommandEncoder(),P=B.beginRenderPass({label:"our basic canvas renderPass",colorAttachments:[{clearValue:t.clearColor??[1,1,1,1],loadOp:"clear",storeOp:"store",view:j}]});P.setPipeline(z),P.setBindGroup(0,n.unwrap(e.bindGroup)),P.setBindGroup(1,n.unwrap(F)),A.length>0&&P.draw((Mi+1)*2,A.length),P.end();const q=B.finish();r.queue.submit([q])}),null}function*El(t){let e=0;for(const n of t)yield[e++,n]}const Ol={normal:{rimColor:L(0,0,0,1),fadeColor:L(0,0,0,1)},selected:{rimColor:L(0,0,0,1),fadeColor:L(.5,.8,1,1)},debugFirst:{rimColor:L(0,0,0,1),fadeColor:L(1,0,0,1)},debugSecond:{rimColor:L(0,0,0,1),fadeColor:L(0,1,0,1)},debugThird:{rimColor:L(0,0,0,1),fadeColor:L(0,0,1,1)}},Il={normal:{rimColor:L(1,1,1,1),fadeColor:L(1,1,1,1)},selected:{rimColor:L(1,1,1,1),fadeColor:L(.1,.3,.8,1)},debugFirst:{rimColor:L(1,1,1,1),fadeColor:L(1,0,0,1)},debugSecond:{rimColor:L(1,1,1,1),fadeColor:L(0,1,0,1)},debugThird:{rimColor:L(1,1,1,1),fadeColor:L(0,0,1,1)}},Al={light:Ol,dark:Il};function kl(t){const e=Al[t],n=Object.fromEntries(El(Object.keys(e)).map(([r,a])=>[a,r]));return{styles:Object.values(e),getStyleIndex(r){return n[r]}}}var Fl=$r("<div><h1>Apollonian Circles</h1><p>Click to create, scroll to zoom."),zl=$r("<div><div>Number of Circles: </div><div><label><input type=checkbox> Dark</label><label><input type=checkbox> Debug mode");function Pl(){const{js:{clipToWorld:t},zoom:e}=Mr(),[n,r]=Nt(),[a,d]=Nt(),[m,g]=Nt(),[T,I]=Nt();async function A(P,q){for(;;){const st=Ys(P),ot=t(st),it=vu(ot);r(it),d(void 0),g(void 0),I(void 0);const et=xu(it);if(await Wn(it,et.radius,et.curve,e,q),et.index===void 0)return;d(et.index);const at=_u(et.index,it);if(await Wn(it,at.radius,at.curve,e,q),at.index===void 0)return;g(at.index);const ut=Mu(et.index,at.index,it);if(await Wn(it,ut.radius,ut.curve,e,q),ut.index===void 0)return;I(ut.index),r(void 0);{const nt=pe()[it];if(ht.distance(nt.center,ot)<nt.radius)return}if(await Promise.race([Ks(),q])instanceof PointerEvent)return}}const{canvas:z}=jn();async function F(P){const{currentTarget:q}=P;if(!(q instanceof HTMLElement))return;q.setPointerCapture(P.pointerId);const{promise:st,resolve:ot}=Du();q.addEventListener("pointerup",ot),st.finally(()=>{q.removeEventListener("pointerup",ot)}),A(P,st)}Ie(()=>{z.addEventListener("pointerdown",F),Je(()=>{z.removeEventListener("pointerdown",F)})});const j=ce(()=>kl(Tn())),B=ce(()=>{const P=j(),q=a(),st=m(),ot=T(),it=n();function et(at){if(at===it)return"selected";if(Qs())switch(at){case q:return"debugFirst";case st:return"debugSecond";case ot:return"debugThird"}return"normal"}return pe().map((at,ut)=>({center:at.center,radius:at.radius,styleIndex:P.getStyleIndex(et(ut))}))});return Kt(Ul,{get circles(){return B()},get clearColor(){return Tn()==="light"?[1,1,1,1]:[0,0,0,1]},get styles(){return j().styles}})}function Bl(){return(()=>{var t=zl(),e=t.firstChild;e.firstChild;var n=e.nextSibling,r=n.firstChild,a=r.firstChild,d=r.nextSibling,m=d.firstChild;return ln(e,()=>pe().length,null),a.addEventListener("change",g=>gu(g.target.checked?"dark":"light")),m.addEventListener("change",g=>yu(g.target.checked)),ln(t,Kt(_r,{get when(){return pe().length===0},get children(){var g=Fl(),T=g.firstChild,I=T.nextSibling;return we(A=>{var z=Te.welcomeMessage,F=Te.welcomeMessageSubtitle;return z!==A.e&&ze(g,A.e=z),F!==A.t&&ze(I,A.t=F),A},{e:void 0,t:void 0}),g}}),null),ln(t,Kt(hl,{get children(){return Kt(wl,{get class(){return Te.canvas},get children(){return Kt(xl,{get children(){return Kt(Pl,{})}})}})}}),null),we(g=>{var T=Te.page,I={[Te[Tn()]]:!0},A=Te.circleCounter,z=Te.controls;return T!==g.e&&ze(t,g.e=T),g.t=Gi(t,I,g.t),A!==g.a&&ze(e,g.a=A),z!==g.o&&ze(n,g.o=z),g},{e:void 0,t:void 0,a:void 0,o:void 0}),we(()=>a.checked=Tn()==="dark"),we(()=>m.checked=Qs()),t})()}const jl=document.getElementById("root");Li(()=>Kt(Bl,{}),jl);
