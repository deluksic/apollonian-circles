(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const w of f.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&r(w)}).observe(document,{childList:!0,subtree:!0});function n(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=n(i);fetch(i.href,f)}})();const eo=(t,e)=>t===e,Ae=Symbol("solid-proxy"),Jr=Symbol("solid-track"),Tn={equals:eo};let $s=Us;const ve=1,Mn=2,Ss={owned:null,cleanups:null,context:null,owner:null},lr={};var pt=null;let fr=null,no=null,yt=null,Pt=null,ge=null,Jn=0;function ro(t,e){const n=yt,r=pt,i=t.length===0,f=e===void 0?r:e,w=i?Ss:{owned:null,cleanups:null,context:f?f.context:null,owner:f},g=i?t:()=>t(()=>he(()=>Je(w)));pt=w,yt=null;try{return Se(g,!0)}finally{yt=n,pt=r}}function Lt(t,e){e=e?Object.assign({},Tn,e):Tn;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=i=>(typeof i=="function"&&(i=i(n.value)),Ds(n,i));return[Ms.bind(n),r]}function so(t,e,n){const r=Qn(t,e,!0,ve);Ve(r)}function me(t,e,n){const r=Qn(t,e,!1,ve);Ve(r)}function ke(t,e,n){$s=ho;const r=Qn(t,e,!1,ve);r.user=!0,ge?ge.push(r):Ve(r)}function de(t,e,n){n=n?Object.assign({},Tn,n):Tn;const r=Qn(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Ve(r),Ms.bind(r)}function io(t){return t&&typeof t=="object"&&"then"in t}function oo(t,e,n){let r,i,f;arguments.length===2&&typeof e=="object"||arguments.length===1?(r=!0,i=t,f=e):(r=t,i=e,f={});let w=null,g=lr,D=!1,U="initialValue"in f,A=typeof r=="function"&&de(r);const P=new Set,[F,z]=(f.storage||Lt)(f.initialValue),[B,j]=Lt(void 0),[q,st]=Lt(void 0,{equals:!1}),[ot,it]=Lt(U?"ready":"unresolved");function nt(et,J,X,ut){return w===et&&(w=null,ut!==void 0&&(U=!0),(et===g||J===g)&&f.onHydrated&&queueMicrotask(()=>f.onHydrated(ut,{value:J})),g=lr,ft(J,X)),J}function ft(et,J){Se(()=>{J===void 0&&z(()=>et),it(J!==void 0?"errored":U?"ready":"unresolved"),j(J);for(const X of P.keys())X.decrement();P.clear()},!1)}function at(){const et=co,J=F(),X=B();if(X!==void 0&&!w)throw X;return yt&&yt.user,J}function vt(et=!0){if(et!==!1&&D)return;D=!1;const J=A?A():r;if(J==null||J===!1){nt(w,he(F));return}const X=g!==lr?g:he(()=>i(J,{value:F(),refetching:et}));return io(X)?(w=X,"value"in X?(X.status==="success"?nt(w,X.value,void 0,J):nt(w,void 0,wr(X.value),J),X):(D=!0,queueMicrotask(()=>D=!1),Se(()=>{it(U?"refreshing":"pending"),st()},!1),X.then(ut=>nt(X,ut,void 0,J),ut=>nt(X,void 0,wr(ut),J)))):(nt(w,X,void 0,J),X)}return Object.defineProperties(at,{state:{get:()=>ot()},error:{get:()=>B()},loading:{get(){const et=ot();return et==="pending"||et==="refreshing"}},latest:{get(){if(!U)return at();const et=B();if(et&&!w)throw et;return F()}}}),A?so(()=>vt(!1)):vt(!1),[at,{refetch:vt,mutate:z}]}function Ts(t){return Se(t,!1)}function he(t){if(yt===null)return t();const e=yt;yt=null;try{return t()}finally{yt=e}}function an(t){return pt===null||(pt.cleanups===null?pt.cleanups=[t]:pt.cleanups.push(t)),t}function pr(){return yt}function Dr(t,e){const n=Symbol("context");return{id:n,Provider:po(n),defaultValue:t}}function ao(t){let e;return pt&&pt.context&&(e=pt.context[t.id])!==void 0?e:t.defaultValue}function uo(t){const e=de(t),n=de(()=>yr(e()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let co;function Ms(){if(this.sources&&this.state)if(this.state===ve)Ve(this);else{const t=Pt;Pt=null,Se(()=>Un(this),!1),Pt=t}if(yt){const t=this.observers?this.observers.length:0;yt.sources?(yt.sources.push(this),yt.sourceSlots.push(t)):(yt.sources=[this],yt.sourceSlots=[t]),this.observers?(this.observers.push(yt),this.observerSlots.push(yt.sources.length-1)):(this.observers=[yt],this.observerSlots=[yt.sources.length-1])}return this.value}function Ds(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&Se(()=>{for(let i=0;i<t.observers.length;i+=1){const f=t.observers[i],w=fr&&fr.running;w&&fr.disposed.has(f),(w?!f.tState:!f.state)&&(f.pure?Pt.push(f):ge.push(f),f.observers&&Os(f)),w||(f.state=ve)}if(Pt.length>1e6)throw Pt=[],new Error},!1)),e}function Ve(t){if(!t.fn)return;Je(t);const e=Jn;lo(t,t.value,e)}function lo(t,e,n){let r;const i=pt,f=yt;yt=pt=t;try{r=t.fn(e)}catch(w){return t.pure&&(t.state=ve,t.owned&&t.owned.forEach(Je),t.owned=null),t.updatedAt=n+1,Es(w)}finally{yt=f,pt=i}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Ds(t,r):t.value=r,t.updatedAt=n)}function Qn(t,e,n,r=ve,i){const f={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:pt,context:pt?pt.context:null,pure:n};return pt===null||pt!==Ss&&(pt.owned?pt.owned.push(f):pt.owned=[f]),f}function Dn(t){if(t.state===0)return;if(t.state===Mn)return Un(t);if(t.suspense&&he(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Jn);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===ve)Ve(t);else if(t.state===Mn){const r=Pt;Pt=null,Se(()=>Un(t,e[0]),!1),Pt=r}}function Se(t,e){if(Pt)return t();let n=!1;e||(Pt=[]),ge?n=!0:ge=[],Jn++;try{const r=t();return fo(n),r}catch(r){n||(ge=null),Pt=null,Es(r)}}function fo(t){if(Pt&&(Us(Pt),Pt=null),t)return;const e=ge;ge=null,e.length&&Se(()=>$s(e),!1)}function Us(t){for(let e=0;e<t.length;e++)Dn(t[e])}function ho(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:Dn(r)}for(e=0;e<n;e++)Dn(t[e])}function Un(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const i=r.state;i===ve?r!==e&&(!r.updatedAt||r.updatedAt<Jn)&&Dn(r):i===Mn&&Un(r,e)}}}function Os(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=Mn,n.pure?Pt.push(n):ge.push(n),n.observers&&Os(n))}}function Je(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),i=n.observers;if(i&&i.length){const f=i.pop(),w=n.observerSlots.pop();r<i.length&&(f.sourceSlots[w]=r,i[r]=f,n.observerSlots[r]=w)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Je(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Je(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function wr(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Es(t,e=pt){throw wr(t)}function yr(t){if(typeof t=="function"&&!t.length)return yr(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=yr(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function po(t,e){return function(r){let i;return me(()=>i=he(()=>(pt.context={...pt.context,[t]:r.value},uo(()=>r.children))),void 0),i}}function Ht(t,e){return he(()=>t(e||{}))}const wo=t=>`Stale read from <${t}>.`;function Ur(t){const e=t.keyed,n=de(()=>t.when,void 0,{equals:(r,i)=>e?r===i:!r==!i});return de(()=>{const r=n();if(r){const i=t.children;return typeof i=="function"&&i.length>0?he(()=>i(e?r:()=>{if(!he(n))throw wo("Show");return t.when})):i}return t.fallback},void 0,void 0)}function yo(t,e,n){let r=n.length,i=e.length,f=r,w=0,g=0,D=e[i-1].nextSibling,U=null;for(;w<i||g<f;){if(e[w]===n[g]){w++,g++;continue}for(;e[i-1]===n[f-1];)i--,f--;if(i===w){const A=f<r?g?n[g-1].nextSibling:n[f-g]:D;for(;g<f;)t.insertBefore(n[g++],A)}else if(f===g)for(;w<i;)(!U||!U.has(e[w]))&&e[w].remove(),w++;else if(e[w]===n[f-1]&&n[g]===e[i-1]){const A=e[--i].nextSibling;t.insertBefore(n[g++],e[w++].nextSibling),t.insertBefore(n[--f],A),e[i]=n[f]}else{if(!U){U=new Map;let P=g;for(;P<f;)U.set(n[P],P++)}const A=U.get(e[w]);if(A!=null)if(g<A&&A<f){let P=w,F=1,z;for(;++P<i&&P<f&&!((z=U.get(e[P]))==null||z!==A+F);)F++;if(F>A-g){const B=e[w];for(;g<A;)t.insertBefore(n[g++],B)}else t.replaceChild(n[g++],e[w++])}else w++;else e[w++].remove()}}}function mo(t,e,n,r={}){let i;return ro(f=>{i=f,e===document?t():gn(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{i(),e.textContent=""}}function Or(t,e,n){let r;const i=()=>{const w=document.createElement("template");return w.innerHTML=t,w.content.firstChild},f=()=>(r||(r=i())).cloneNode(!0);return f.cloneNode=f,f}function Ce(t,e){e==null?t.removeAttribute("class"):t.className=e}function go(t,e,n={}){const r=Object.keys(e),i=Object.keys(n);let f,w;for(f=0,w=i.length;f<w;f++){const g=i[f];!g||g==="undefined"||e[g]||(Qr(t,g,!1),delete n[g])}for(f=0,w=r.length;f<w;f++){const g=r[f],D=!!e[g];!g||g==="undefined"||n[g]===D||!D||(Qr(t,g,!0),n[g]=D)}return n}function xo(t,e,n){return he(()=>t(e,n))}function gn(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return On(t,e,r,n);me(i=>On(t,e(),i,n),r)}function Qr(t,e,n){const r=e.trim().split(/\s+/);for(let i=0,f=r.length;i<f;i++)t.classList.toggle(r[i],n)}function On(t,e,n,r,i){for(;typeof n=="function";)n=n();if(e===n)return n;const f=typeof e,w=r!==void 0;if(t=w&&n[0]&&n[0].parentNode||t,f==="string"||f==="number"){if(f==="number"&&(e=e.toString(),e===n))return n;if(w){let g=n[0];g&&g.nodeType===3?g.data!==e&&(g.data=e):g=document.createTextNode(e),n=Pe(t,n,r,g)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||f==="boolean")n=Pe(t,n,r);else{if(f==="function")return me(()=>{let g=e();for(;typeof g=="function";)g=g();n=On(t,g,n,r)}),()=>n;if(Array.isArray(e)){const g=[],D=n&&Array.isArray(n);if(mr(g,e,n,i))return me(()=>n=On(t,g,n,r,!0)),()=>n;if(g.length===0){if(n=Pe(t,n,r),w)return n}else D?n.length===0?ts(t,g,r):yo(t,n,g):(n&&Pe(t),ts(t,g));n=g}else if(e.nodeType){if(Array.isArray(n)){if(w)return n=Pe(t,n,r,e);Pe(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function mr(t,e,n,r){let i=!1;for(let f=0,w=e.length;f<w;f++){let g=e[f],D=n&&n[t.length],U;if(!(g==null||g===!0||g===!1))if((U=typeof g)=="object"&&g.nodeType)t.push(g);else if(Array.isArray(g))i=mr(t,g,D)||i;else if(U==="function")if(r){for(;typeof g=="function";)g=g();i=mr(t,Array.isArray(g)?g:[g],Array.isArray(D)?D:[D])||i}else t.push(g),i=!0;else{const A=String(g);D&&D.nodeType===3&&D.data===A?t.push(D):t.push(document.createTextNode(A))}}return i}function ts(t,e,n=null){for(let r=0,i=e.length;r<i;r++)t.insertBefore(e[r],n)}function Pe(t,e,n,r){if(n===void 0)return t.textContent="";const i=r||document.createTextNode("");if(e.length){let f=!1;for(let w=e.length-1;w>=0;w--){const g=e[w];if(i!==g){const D=g.parentNode===t;!f&&!w?D?t.replaceChild(i,g):t.insertBefore(i,n):D&&g.remove()}else f=!0}}else t.insertBefore(i,n);return[i]}const vo="_light_1lfxz_1",bo="_dark_1lfxz_6",_o="_page_1lfxz_12",$o="_controls_1lfxz_22",So="_circle-counter_1lfxz_36",To="_welcome-message_1lfxz_56",Mo="_fade-in_1lfxz_1",Do="_canvas_1lfxz_71",Fe={light:vo,dark:bo,page:_o,controls:$o,circleCounter:So,welcomeMessage:To,fadeIn:Mo,canvas:Do};function Er(t,e,n){const r=ao(t);if(r===void 0)throw new Error(`Called '${e}' outside of ${n!==void 0?`<${n}>`:"its Provider"}.`);return r}const ks=Dr(),Uo=ks.Provider;function kr(){return Er(ks,"useCamera","CameraContext")}var Oo=Object.defineProperty,Eo=Object.defineProperties,ko=Object.getOwnPropertyDescriptors,es=Object.getOwnPropertySymbols,Ao=Object.prototype.hasOwnProperty,Io=Object.prototype.propertyIsEnumerable,gr=(t,e,n)=>e in t?Oo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,De=(t,e)=>{for(var n in e||(e={}))Ao.call(e,n)&&gr(t,n,e[n]);if(es)for(var n of es(e))Io.call(e,n)&&gr(t,n,e[n]);return t},Be=(t,e)=>Eo(t,ko(e)),k=(t,e,n)=>(gr(t,typeof e!="symbol"?e+"":e,n),n),Po="Invariant failed";function En(t,e){if(!t)throw new Error(Po)}var yn=class xr extends Error{constructor(e,n){let r=n.map(i=>`- ${i}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Resolution of the following tree failed: 
${r.join(`
`)}`),this.cause=e,this.trace=n,Object.setPrototypeOf(this,xr.prototype)}appendToTrace(e){let n=[e,...this.trace];return new xr(this.cause,n)}},Fo=class As extends Error{constructor(e){super(`Missing value for '${e}'`),this.slot=e,Object.setPrototypeOf(this,As.prototype)}},ns=class Is extends Error{constructor(e){var n;super(`Buffer '${(n=e.label)!=null?n:"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,Is.prototype)}},zo=class Ps extends Error{constructor(e,n){super(`The function '${e??"<unnamed>"}' is missing links to the following external values: ${n}.`),Object.setPrototypeOf(this,Ps.prototype)}},Fs=class zs extends Error{constructor(e){super(`Bind group was not provided for '${e??"<unnamed>"}' layout.`),Object.setPrototypeOf(this,zs.prototype)}},Xe=null;function Bo(t,e){En(Xe===null),Xe=t;try{return e()}finally{Xe=null}}function Qe(){return Xe}var we=()=>Xe!==null;function ne(t){let e={"~repr":void 0,type:t.type};return Object.assign((...n)=>{var r;let i=n;if(we())return`${e.type}(${i.join(", ")})`;if(i.length<=1)return t.makeFromScalar((r=i[0])!=null?r:0);if(i.length===t.length)return t.make(...i);throw new Error(`'${t.type}' constructor called with invalid number of arguments.`)},e)}var tr=class{constructor(t,e){this.x=t,this.y=e,k(this,"length",2)}*[Symbol.iterator](){yield this.x,yield this.y}get 0(){return this.x}get 1(){return this.y}set 0(t){this.x=t}set 1(t){this.y=t}resolve(){return`${this.kind}(${this.x}, ${this.y})`}toString(){return this.resolve()}},kn=class Bs extends tr{constructor(){super(...arguments),k(this,"kind","vec2f")}make2(e,n){return new Bs(e,n)}make3(e,n,r){return new Fn(e,n,r)}make4(e,n,r,i){return new Rn(e,n,r,i)}},An=class js extends tr{constructor(){super(...arguments),k(this,"kind","vec2h")}make2(e,n){return new js(e,n)}make3(e,n,r){return new zn(e,n,r)}make4(e,n,r,i){return new Nn(e,n,r,i)}},In=class Rs extends tr{constructor(){super(...arguments),k(this,"kind","vec2i")}make2(e,n){return new Rs(e,n)}make3(e,n,r){return new Bn(e,n,r)}make4(e,n,r,i){return new Vn(e,n,r,i)}},Pn=class Ns extends tr{constructor(){super(...arguments),k(this,"kind","vec2u")}make2(e,n){return new Ns(e,n)}make3(e,n,r){return new jn(e,n,r)}make4(e,n,r,i){return new Ln(e,n,r,i)}},er=class{constructor(e,n,r){this.x=e,this.y=n,this.z=r,k(this,"length",3)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}resolve(){return`${this.kind}(${this.x}, ${this.y}, ${this.z})`}toString(){return this.resolve()}},Fn=class Vs extends er{constructor(){super(...arguments),k(this,"kind","vec3f")}make2(e,n){return new kn(e,n)}make3(e,n,r){return new Vs(e,n,r)}make4(e,n,r,i){return new Rn(e,n,r,i)}},zn=class Ls extends er{constructor(){super(...arguments),k(this,"kind","vec3h")}make2(e,n){return new An(e,n)}make3(e,n,r){return new Ls(e,n,r)}make4(e,n,r,i){return new Nn(e,n,r,i)}},Bn=class Gs extends er{constructor(){super(...arguments),k(this,"kind","vec3i")}make2(e,n){return new In(e,n)}make3(e,n,r){return new Gs(e,n,r)}make4(e,n,r,i){return new Vn(e,n,r,i)}},jn=class qs extends er{constructor(){super(...arguments),k(this,"kind","vec3u")}make2(e,n){return new Pn(e,n)}make3(e,n,r){return new qs(e,n,r)}make4(e,n,r,i){return new Ln(e,n,r,i)}},nr=class{constructor(e,n,r,i){this.x=e,this.y=n,this.z=r,this.w=i,k(this,"length",4)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}get 3(){return this.w}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}set 3(e){this.w=e}resolve(){return`${this.kind}(${this.x}, ${this.y}, ${this.z}, ${this.w})`}toString(){return this.resolve()}},Rn=class Cs extends nr{constructor(){super(...arguments),k(this,"kind","vec4f")}make2(e,n){return new kn(e,n)}make3(e,n,r){return new Fn(e,n,r)}make4(e,n,r,i){return new Cs(e,n,r,i)}},Nn=class Ws extends nr{constructor(){super(...arguments),k(this,"kind","vec4h")}make2(e,n){return new An(e,n)}make3(e,n,r){return new zn(e,n,r)}make4(e,n,r,i){return new Ws(e,n,r,i)}},Vn=class Ys extends nr{constructor(){super(...arguments),k(this,"kind","vec4i")}make2(e,n){return new In(e,n)}make3(e,n,r){return new Bn(e,n,r)}make4(e,n,r,i){return new Ys(e,n,r,i)}},Ln=class Xs extends nr{constructor(){super(...arguments),k(this,"kind","vec4u")}make2(e,n){return new Pn(e,n)}make3(e,n,r){return new jn(e,n,r)}make4(e,n,r,i){return new Xs(e,n,r,i)}},ct={get:(t,e)=>{if(typeof e=="symbol"||!Number.isNaN(Number.parseInt(e)))return Reflect.get(t,e);let n=t,r=new Array(e.length),i=0;for(let f of e){switch(f){case"x":r[i]=n.x;break;case"y":r[i]=n.y;break;case"z":r[i]=n.z;break;case"w":r[i]=n.w;break;default:return Reflect.get(n,e)}i++}return e.length===4?new Proxy(n.make4(r[0],r[1],r[2],r[3]),ct):e.length===3?new Proxy(n.make3(r[0],r[1],r[2]),ct):e.length===2?new Proxy(n.make2(r[0],r[1]),ct):Reflect.get(t,e)}},C=ne({type:"vec2f",length:2,make:(t,e)=>new Proxy(new kn(t,e),ct),makeFromScalar:t=>new Proxy(new kn(t,t),ct)}),jo=ne({type:"vec2h",length:2,make:(t,e)=>new Proxy(new An(t,e),ct),makeFromScalar:t=>new Proxy(new An(t,t),ct)}),Ue=ne({type:"vec2i",length:2,make:(t,e)=>new Proxy(new In(t,e),ct),makeFromScalar:t=>new Proxy(new In(t,t),ct)}),Oe=ne({type:"vec2u",length:2,make:(t,e)=>new Proxy(new Pn(t,e),ct),makeFromScalar:t=>new Proxy(new Pn(t,t),ct)}),tn=ne({type:"vec3f",length:3,make:(t,e,n)=>new Proxy(new Fn(t,e,n),ct),makeFromScalar:t=>new Proxy(new Fn(t,t,t),ct)}),Ro=ne({type:"vec3h",length:3,make:(t,e,n)=>new Proxy(new zn(t,e,n),ct),makeFromScalar:t=>new Proxy(new zn(t,t,t),ct)}),vr=ne({type:"vec3i",length:3,make:(t,e,n)=>new Proxy(new Bn(t,e,n),ct),makeFromScalar:t=>new Proxy(new Bn(t,t,t),ct)}),Ee=ne({type:"vec3u",length:3,make:(t,e,n)=>new Proxy(new jn(t,e,n),ct),makeFromScalar:t=>new Proxy(new jn(t,t,t),ct)}),L=ne({type:"vec4f",length:4,make:(t,e,n,r)=>new Proxy(new Rn(t,e,n,r),ct),makeFromScalar:t=>new Proxy(new Rn(t,t,t,t),ct)}),No=ne({type:"vec4h",length:4,make:(t,e,n,r)=>new Proxy(new Nn(t,e,n,r),ct),makeFromScalar:t=>new Proxy(new Nn(t,t,t,t),ct)}),te=ne({type:"vec4i",length:4,make:(t,e,n,r)=>new Proxy(new Vn(t,e,n,r),ct),makeFromScalar:t=>new Proxy(new Vn(t,t,t,t),ct)}),ee=ne({length:4,type:"vec4u",make:(t,e,n,r)=>new Proxy(new Ln(t,e,n,r),ct),makeFromScalar:t=>new Proxy(new Ln(t,t,t,t),ct)}),Zs=Object.defineProperty,Vo=(t,e,n)=>e in t?Zs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Lo=(t,e)=>{for(var n in e)Zs(t,n,{get:e[n],enumerable:!0})},Q=(t,e,n)=>Vo(t,typeof e!="symbol"?e+"":e,n),Ks={};Lo(Ks,{BufferReader:()=>xn,BufferWriter:()=>vn,MaxValue:()=>xt,Measurer:()=>gt,UnresolvedReferenceError:()=>Me,ValidationError:()=>rr,arrayOf:()=>Yo,bool:()=>Zo,byte:()=>ea,chars:()=>wa,concat:()=>xa,dynamicArrayOf:()=>ba,f16:()=>fa,f32:()=>ha,f32Array:()=>Ba,f64Array:()=>ja,generic:()=>ma,genericEnum:()=>ga,i16:()=>ra,i16Array:()=>Fa,i32:()=>aa,i32Array:()=>za,i8:()=>Qo,i8Array:()=>Pa,keyed:()=>Sa,object:()=>ya,optional:()=>Ma,string:()=>Ho,tupleOf:()=>Oa,u16:()=>ia,u16Array:()=>Aa,u32:()=>ca,u32Array:()=>Ia,u8:()=>ei,u8Array:()=>Ea,u8ClampedArray:()=>ka});var Me=class Hs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Hs.prototype)}},rr=class Js extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Js.prototype)}},Go=class{constructor(){Q(this,"size",Number.NaN),Q(this,"unbounded",this),Q(this,"isUnbounded",!0)}add(){return this}fork(){return this}},qo=new Go,gt=class Qs{constructor(){Q(this,"size",0),Q(this,"unbounded",qo),Q(this,"isUnbounded",!1)}add(e){return this.size+=e,this}fork(){const e=new Qs;return e.size=this.size,e}},xt=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),Tt=class{constructor(){Q(this,"__unwrapped")}resolveReferences(t){}seekProperty(t,e){return null}},Co=class{constructor(t){this.key=t}},Ze={STRING:"string",ENUM:"enum"},Wo=class extends Tt{constructor(t,e){super(),this._unstableElementSchema=t,this.length=e,Q(this,"elementSchema"),this.elementSchema=t}resolveReferences(t){this.elementSchema=t.resolve(this._unstableElementSchema)}write(t,e){if(e.length!==this.length)throw new rr(`Expected array of length ${this.length}, got ${e.length}`);for(const n of e)this.elementSchema.write(t,n)}read(t){const e=[];for(let n=0;n<this.length;++n)e.push(this.elementSchema.read(t));return e}get maxSize(){return this.elementSchema.measure(xt).size*this.length}measure(t,e=new gt){for(let n=0;n<this.length;++n)this.elementSchema.measure(t===xt?xt:t[n],e);return e}};function Yo(t,e){return new Wo(t,e)}var Xo=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",1)}read(t){return t.readBool()}write(t,e){t.writeBool(e)}measure(t,e=new gt){return e.add(1)}},Zo=new Xo,ti=class We extends Tt{static get _encoder(){return We._cachedEncoder||(We._cachedEncoder=new TextEncoder),We._cachedEncoder}read(e){return e.readString()}write(e,n){e.writeString(n)}measure(e,n=new gt){if(e===xt)return n.unbounded;const r=We._encoder.encode(e);return n.add(r.byteLength+1)}};Q(ti,"_cachedEncoder");var Ko=ti,Ho=new Ko,Jo=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",1)}read(t){return t.readInt8()}write(t,e){t.writeInt8(e)}measure(t,e=new gt){return e.add(1)}},Qo=new Jo,ta=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",1)}read(t){return t.readUint8()}write(t,e){t.writeUint8(e)}measure(t,e=new gt){return e.add(1)}},ei=new ta,ea=ei,na=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",2)}read(t){return t.readInt16()}write(t,e){t.writeInt16(e)}measure(t,e=new gt){return e.add(2)}},ra=new na,sa=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",2)}read(t){return t.readUint16()}write(t,e){t.writeUint16(e)}measure(t,e=new gt){return e.add(2)}},ia=new sa,oa=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",4)}read(t){return t.readInt32()}write(t,e){t.writeInt32(e)}measure(t,e=new gt){return e.add(4)}},aa=new oa,ua=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",4)}read(t){return t.readUint32()}write(t,e){t.writeUint32(e)}measure(t,e=new gt){return e.add(4)}},ca=new ua,la=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",2)}read(t){return t.readFloat16()}write(t,e){t.writeFloat16(e)}measure(t,e=new gt){return e.add(2)}},fa=new la,da=class extends Tt{constructor(){super(...arguments),Q(this,"maxSize",4)}read(t){return t.readFloat32()}write(t,e){t.writeFloat32(e)}measure(t,e=new gt){return e.add(4)}},ha=new da,pa=class extends Tt{constructor(t){super(),this.length=t}write(t,e){if(e.length!==this.length)throw new rr(`Expected char-string of length ${this.length}, got ${e.length}`);for(let n=0;n<e.length;++n)t.writeUint8(e.charCodeAt(n))}read(t){let e="";for(let n=0;n<this.length;++n)e+=String.fromCharCode(t.readByte());return e}measure(t,e=new gt){return e.add(this.length)}};function wa(t){return new pa(t)}function $e(t){return Object.entries(t)}function ni(t,e){const n={};for(const[r,i]of $e(e))n[r]=t.resolve(i);return n}var Ar=class extends Tt{constructor(t){super(),this._properties=t,Q(this,"properties"),this.properties=t}resolveReferences(t){this.properties=ni(t,this._properties)}write(t,e){for(const[n,r]of $e(this.properties))r.write(t,e[n])}read(t){const e={};for(const[n,r]of $e(this.properties))e[n]=r.read(t);return e}get maxSize(){const t=new gt;for(const e of Object.values(this.properties))e.measure(xt,t);return t.size}measure(t,e=new gt){for(const[n,r]of $e(this.properties))r.measure(t===xt?xt:t[n],e);return e}seekProperty(t,e){let n=0;for(const[r,i]of $e(this.properties)){if(r===e)return{bufferOffset:n,schema:i};n+=i.measure(t).size}return null}};function ya(t){return new Ar(t)}var ri=class extends Tt{constructor(t,e,n){super(),this.keyedBy=t,this._subTypeMap=n,Q(this,"_baseObject"),Q(this,"subTypeMap"),this._baseObject=new Ar(e),this.subTypeMap=n}resolveReferences(t){this._baseObject.resolveReferences(t),this.subTypeMap=ni(t,this._subTypeMap)}write(t,e){const n=e.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===Ze.ENUM?t.writeUint8(e.type):t.writeString(e.type),this._baseObject.write(t,e);for(const[i,f]of $e(r.properties))f.write(t,e[i])}read(t){const e=this.keyedBy===Ze.ENUM?t.readByte():t.readString(),n=this.subTypeMap[e]||null;if(n===null)throw new Error(`Unknown sub-type '${e}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const r=this._baseObject.read(t);if(r.type=e,n!==null)for(const[i,f]of $e(n.properties))r[i]=f.read(t);return r}measure(t,e=new gt){if(this._baseObject.measure(t,e),this.keyedBy===Ze.ENUM)e.add(1);else if(t!==xt)e.add(t.type.length+1);else return e.unbounded;if(t===xt){const n=Object.values(this.subTypeMap).map(r=>{const i=e.fork();for(const f of Object.values(r.properties))f.measure(xt,i);return[r,i.size]}).reduce((r,i)=>r[1]>i[1]?r:i)[0];for(const r of Object.values(n.properties))r.measure(xt,e)}else{const n=t.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[i,f]of $e(r.properties))f.measure(t[i],e)}return e}};function ma(t,e){return new ri(Ze.STRING,t,e)}function ga(t,e){return new ri(Ze.ENUM,t,e)}function xa(t){return new Ar(Object.fromEntries(t.flatMap(({properties:e})=>Object.entries(e))))}var va=class extends Tt{constructor(t){super(),this._unstableElementType=t,Q(this,"elementType"),this.elementType=t}resolveReferences(t){this.elementType=t.resolve(this._unstableElementType)}write(t,e){t.writeUint32(e.length);for(const n of e)this.elementType.write(t,n)}read(t){const e=[],n=t.readUint32();for(let r=0;r<n;++r)e.push(this.elementType.read(t));return e}get maxSize(){return this.measure(xt).size}measure(t,e=new gt){if(t===xt)return e.unbounded;e.add(4);for(const n of t)this.elementType.measure(n,e);return e}seekProperty(t,e){if(typeof e=="symbol")return null;const n=Number.parseInt(String(e),10);if(Number.isNaN(n))return null;if(t===xt)return{bufferOffset:this.elementType.measure(xt).size*n,schema:this.elementType};if(n>=t.length)return null;const r=new gt;for(let i=0;i<n;++i)this.elementType.measure(t[i],r);return{bufferOffset:r.size,schema:this.elementType}}};function ba(t){return new va(t)}var si=class{constructor(t){Q(this,"__unwrapped"),Q(this,"ref"),this.ref=new Co(t)}resolveReferences(){throw new Me("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new Me("Tried to read a reference directly. Resolve it instead.")}write(){throw new Me("Tried to write a reference directly. Resolve it instead.")}measure(){throw new Me("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new Me("Tried to seek property of a reference directly. Resolve it instead.")}},_a=class{constructor(){Q(this,"registry",{})}hasKey(t){return this.registry[t]!==void 0}register(t,e){this.registry[t]=e}resolve(t){if(t instanceof si){const n=t.ref.key;if(this.registry[n]!==void 0)return this.registry[n];throw new Me(`Couldn't resolve reference to ${n}. Unknown key.`)}return t.resolveReferences(this),t}},$a=class{constructor(t,e){this.key=t,Q(this,"__unwrapped"),Q(this,"__keyDefinition"),Q(this,"innerType"),this.innerType=e(new si(t)),this.resolveReferences(new _a)}resolveReferences(t){t.hasKey(this.key)||(t.register(this.key,this.innerType),this.innerType.resolveReferences(t))}read(t){return this.innerType.read(t)}write(t,e){this.innerType.write(t,e)}get maxSize(){return this.measure(xt).size}measure(t,e=new gt){return this.innerType.measure(t,e)}seekProperty(t,e){return this.innerType.seekProperty(t,e)}};function Sa(t,e){return new $a(t,e)}var Ta=class extends Tt{constructor(t){super(),this._innerUnstableSchema=t,Q(this,"innerSchema"),this.innerSchema=t}resolveReferences(t){this.innerSchema=t.resolve(this._innerUnstableSchema)}write(t,e){e!=null?(t.writeBool(!0),this.innerSchema.write(t,e)):t.writeBool(!1)}read(t){if(t.readBool())return this.innerSchema.read(t)}get maxSize(){return this.measure(xt).size}measure(t,e=new gt){return t!==void 0&&this.innerSchema.measure(t,e),e.add(1)}};function Ma(t){return new Ta(t)}function Da(t,e){return e.map(n=>t.resolve(n))}var Ua=class extends Tt{constructor(t){super(),this._unstableSchemas=t,Q(this,"schemas"),this.schemas=t}resolveReferences(t){this.schemas=Da(t,this._unstableSchemas)}write(t,e){if(e.length!==this.schemas.length)throw new rr(`Expected tuple of length ${this.schemas.length}, got ${e.length}`);for(let n=0;n<this.schemas.length;++n)this.schemas[n].write(t,e[n])}read(t){const e=[];for(let n=0;n<this.schemas.length;++n)e.push(this.schemas[n].read(t));return e}get maxSize(){return this.measure(xt).size}measure(t,e=new gt){for(let n=0;n<this.schemas.length;++n)this.schemas[n].measure(t===xt?xt:t[n],e);return e}};function Oa(t){return new Ua(t)}var be=class extends Tt{constructor(t,e){super(),this.length=t,this._arrayConstructor=e,Q(this,"byteLength"),this.byteLength=t*e.BYTES_PER_ELEMENT}write(t,e){t.writeSlice(e)}read(t){const e=new ArrayBuffer(this.byteLength),n=new this._arrayConstructor(e,0,this.length);return t.readSlice(n,0,this.byteLength),n}measure(t,e=new gt){return e.add(this.byteLength)}},Ea=t=>new be(t,Uint8Array),ka=t=>new be(t,Uint8ClampedArray),Aa=t=>new be(t,Uint16Array),Ia=t=>new be(t,Uint32Array),Pa=t=>new be(t,Int8Array),Fa=t=>new be(t,Int16Array),za=t=>new be(t,Int32Array),Ba=t=>new be(t,Float32Array),ja=t=>new be(t,Float64Array);function Ra(){const t=new Uint8Array(4),e=new Uint32Array(t.buffer);return e[0]=1,t[0]===0}function Na(){return Ra()?"big":"little"}function Ir(t){let e=0,n=t;return n&&"buffer"in n&&"byteOffset"in n&&(e+=n.byteOffset,n=n.buffer),{buffer:n,byteOffset:e,byteLength:t.byteLength}}var ii=class{constructor(t,e){Q(this,"dataView"),Q(this,"littleEndian"),Q(this,"byteOffset",0),Q(this,"endianness");const{byteOffset:n=0,endianness:r="system"}=e??{};this.byteOffset=n;const i=Na();this.endianness=r==="system"?i:r,this.littleEndian=this.endianness==="little";const f=Ir(t);this.byteOffset+=f.byteOffset,this.dataView=new DataView(f.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(t){this.byteOffset=t}skipBytes(t){this.byteOffset+=t}};function Va(t){if(t===0)return 0;if(Number.isNaN(t))return 32256;if(!Number.isFinite(t))return t>0?31744:64512;const e=t<0?1:0,n=Math.abs(t),r=Math.floor(Math.log2(n)),i=n/2**r-1,f=r+15,w=Math.floor(i*1024);return e<<15|f<<10|w}function La(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?e===0?r/1024:-r/1024:n===31?r===0?e===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(e===0?1:-1)*(1+r/1024)*2**(n-15)}var xn=class extends ii{constructor(){super(...arguments),Q(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const t=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,t}readUint16(){const t=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,t}readInt32(){const t=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readUint32(){const t=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readFloat16(){const t=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,La(t)}readFloat32(){const t=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,t}readString(){let t=0;for(;this.byteOffset+t<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+t++)!==0;);const e=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,t-1));return this.byteOffset+=t,e}readSlice(t,e,n){const r=Ir(t),i=new Uint8Array(r.buffer,r.byteOffset+e);for(let f=0;f<n;++f)i[f]=this.dataView.getUint8(this.byteOffset++)}},vn=class extends ii{constructor(){super(...arguments),Q(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(t){this.dataView.setUint8(this.byteOffset++,t?1:0)}writeByte(t){this.dataView.setUint8(this.byteOffset++,t)}writeInt8(t){this.dataView.setInt8(this.byteOffset++,t)}writeUint8(t){this.dataView.setUint8(this.byteOffset++,t)}writeInt16(t){this.dataView.setInt16(this.byteOffset,t,this.littleEndian),this.byteOffset+=2}writeUint16(t){this.dataView.setUint16(this.byteOffset,t,this.littleEndian),this.byteOffset+=2}writeInt32(t){this.dataView.setInt32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeUint32(t){this.dataView.setUint32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeFloat16(t){this.dataView.setUint16(this.byteOffset,Va(t),this.littleEndian),this.byteOffset+=2}writeFloat32(t){this.dataView.setFloat32(this.byteOffset,t,this.littleEndian),this.byteOffset+=4}writeString(t){const e=this._textEncoder.encodeInto(t,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=e.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(t){const e=Ir(t),n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(const r of n)this.dataView.setUint8(this.byteOffset++,r)}},mn=Ks,rs={type:"bool"},Ga=t=>we()?`u32(${t})`:typeof t=="boolean"?t?1:0:Number.isInteger(t)?((t<0||t>4294967295)&&console.warn(`u32 value ${t} overflowed`),(t&4294967295)>>>0):Math.max(0,Math.min(4294967295,Math.floor(t))),dt=Object.assign(Ga,{type:"u32"}),qa=t=>{if(we())return`i32(${t})`;if(typeof t=="boolean")return t?1:0;if(Number.isInteger(t))return(t<-2147483648||t>2147483647)&&console.warn(`i32 value ${t} overflowed`),(t|0)&4294967295;let e=t<0?Math.ceil(t):Math.floor(t);return Math.max(-2147483648,Math.min(2147483647,e))},Zt=Object.assign(qa,{type:"i32"}),Ca=t=>{if(we())return`f32(${t})`;if(typeof t=="boolean")return t?1:0;let e=new Float32Array(1);return e[0]=t,e[0]},I=Object.assign(Ca,{type:"f32"}),Wa=t=>{if(we())return`f16(${t})`;if(typeof t=="boolean")return t?1:0;let e=new ArrayBuffer(2);return mn.f16.write(new mn.BufferWriter(e),t),mn.f16.read(new mn.BufferReader(e))};Object.assign(Wa,{type:"f16"});var Ya=["bool","f32","f16","i32","u32","vec2f","vec2h","vec2i","vec2u","vec3f","vec3h","vec3i","vec3u","vec4f","vec4h","vec4i","vec4u","mat2x2f","mat3x3f","mat4x4f","struct","array","atomic","decorated"];function Le(t){return Ya.includes(t?.type)}function Pr(t){return t?.type==="array"}function Ge(t){return t?.type==="struct"}function oi(t){return t?.type==="@align"}function ai(t){return t?.type==="@size"}function Xa(t){return t?.type==="@location"}function Za(t){return t?.type==="@builtin"}function qe(t){return t?.type==="decorated"}var un=t=>new Ka(t),Ka=class{constructor(e){this.propTypes=e,k(this,"_label"),k(this,"type","struct"),k(this,"~repr"),k(this,"~exotic")}get label(){return this._label}$name(e){return this._label=e,this}toString(){var e;return`struct:${(e=this.label)!=null?e:"<unnamed>"}`}},xe=(t,e)=>{let n=e-1,r=~n;return t&n?(t&r)+e:t},ui=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],Ha={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"},Ja=["unstruct","disarray","loose-decorated",...ui];function ci(t){return Ja.includes(t?.type)}function Fr(t){return t?.type==="disarray"}function sr(t){return t?.type==="unstruct"}function Ie(t){return t?.type==="loose-decorated"}function Ke(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(oi))==null?void 0:n.value}function Qa(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(ai))==null?void 0:n.value}function br(t){var e,n;return(n=(e=t.attribs)==null?void 0:e.find(Xa))==null?void 0:n.value}function ir(t){return Le(t)||ci(t)}var W=class{constructor(t){this.type=t,k(this,"~repr")}},tu={uint8:dt,uint8x2:Oe,uint8x4:ee,sint8:Zt,sint8x2:Ue,sint8x4:te,unorm8:I,unorm8x2:C,unorm8x4:L,snorm8:I,snorm8x2:C,snorm8x4:L,uint16:dt,uint16x2:Oe,uint16x4:ee,sint16:Zt,sint16x2:Ue,sint16x4:te,unorm16:I,unorm16x2:C,unorm16x4:L,snorm16:I,snorm16x2:C,snorm16x4:L,float16:I,float16x2:C,float16x4:L,float32:I,float32x2:C,float32x3:tn,float32x4:L,uint32:dt,uint32x2:Oe,uint32x3:Ee,uint32x4:ee,sint32:Zt,sint32x2:Ue,sint32x3:vr,sint32x4:te,"unorm10-10-10-2":L,"unorm8x4-bgra":L},eu=Object.keys(tu);new W("uint8");new W("uint8x2");new W("uint8x4");new W("sint8");new W("sint8x2");new W("sint8x4");new W("unorm8");new W("unorm8x2");new W("unorm8x4");new W("snorm8");new W("snorm8x2");new W("snorm8x4");new W("uint16");new W("uint16x2");new W("uint16x4");new W("sint16");new W("sint16x2");new W("sint16x4");new W("unorm16");new W("unorm16x2");new W("unorm16x4");new W("snorm16");new W("snorm16x2");new W("snorm16x4");new W("float16");new W("float16x2");new W("float16x4");new W("float32");new W("float32x2");new W("float32x3");new W("float32x4");new W("uint32");new W("uint32x2");new W("uint32x3");new W("uint32x4");new W("sint32");new W("sint32x2");new W("sint32x3");new W("sint32x4");new W("unorm10-10-10-2");new W("unorm8x4-bgra");var nu={bool:4,f32:4,f16:2,i32:4,u32:4,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,mat2x2f:8,mat3x3f:16,mat4x4f:16};function ru(t){var e,n,r;let i=t?.type,f=nu[i];if(f!==void 0)return f;if(Ge(t))return Object.values(t.propTypes).map(St).reduce((w,g)=>w>g?w:g);if(Pr(t))return St(t.elementType);if(sr(t)){let w=Object.values(t.propTypes)[0];return w&&(e=Ke(w))!=null?e:1}if(Fr(t))return(n=Ke(t.elementType))!=null?n:1;if(qe(t)||Ie(t))return(r=Ke(t))!=null?r:St(t.inner);if(eu.includes(i))return 1;throw new Error(`Cannot determine alignment of data: ${JSON.stringify(t)}`)}function su(t){var e,n;if(sr(t)){let r=Object.values(t.propTypes)[0];return r?ue(r):1}return Fr(t)?ue(t.elementType):Ie(t)?(e=Ke(t))!=null?e:ue(t.inner):(n=Ke(t))!=null?n:1}var ss=new WeakMap,is=new WeakMap;function St(t){let e=ss.get(t);return e===void 0&&(e=ru(t),ss.set(t,e)),e}function ue(t){let e=is.get(t);return e===void 0&&(e=su(t),is.set(t,e)),e}var iu={bool:4,f32:4,f16:2,i32:4,u32:4,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4};function ou(t){let e=0;for(let n of Object.values(t.propTypes)){if(Number.isNaN(e))throw new Error("Only the last property of a struct can be unbounded");if(e=xe(e,St(n)),e+=mt(n),Number.isNaN(e)&&n.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return xe(e,St(t))}function au(t){let e=0;for(let n of Object.values(t.propTypes)){let r=ue(n);e=xe(e,r),e+=mt(n)}return e}function uu(t){var e;let n=iu[t?.type];if(n!==void 0)return n;if(Ge(t))return ou(t);if(sr(t))return au(t);if(Pr(t)){if(t.elementCount===0)return Number.NaN;let r=St(t.elementType);return xe(mt(t.elementType),r)*t.elementCount}if(Fr(t)){let r=ue(t.elementType);return xe(mt(t.elementType),r)*t.elementCount}if(qe(t)||Ie(t))return(e=Qa(t))!=null?e:mt(t.inner);throw new Error(`Cannot determine size of data: ${t}`)}var os=new WeakMap;function mt(t){let e=os.get(t);return e===void 0&&(e=uu(t),os.set(t,e)),e}var en=(t,e)=>new cu(t,e),cu=class{constructor(e,n){if(this.elementType=e,this.elementCount=n,k(this,"type","array"),k(this,"~repr"),k(this,"~exotic"),Number.isNaN(mt(e)))throw new Error("Cannot nest runtime sized arrays.")}toString(){return`arrayOf(${this.elementType})`}};function zr(t){let e={"~repr":void 0,type:t.type,label:t.type};return Object.assign((...n)=>{let r=[];for(let i of n)if(typeof i=="number")r.push(i);else for(let f=0;f<i.length;++f)r.push(i[f]);for(let i=r.length;i<t.columns*t.rows;++i)r.push(0);return t.makeFromElements(...r)},e)}var lu=class{constructor(...e){k(this,"columns"),k(this,"length",4),this.columns=[this.makeColumn(e[0],e[1]),this.makeColumn(e[2],e[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[1].x=e}set 3(e){this.columns[1].y=e}},fu=class extends lu{constructor(){super(...arguments),k(this,"kind","mat2x2f")}makeColumn(e,n){return C(e,n)}},du=class{constructor(...e){k(this,"columns"),k(this,"length",12),this.columns=[this.makeColumn(e[0],e[1],e[2]),this.makeColumn(e[3],e[4],e[5]),this.makeColumn(e[6],e[7],e[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[0].z=e}set 3(e){}set 4(e){this.columns[1].x=e}set 5(e){this.columns[1].y=e}set 6(e){this.columns[1].z=e}set 7(e){}set 8(e){this.columns[2].x=e}set 9(e){this.columns[2].y=e}set 10(e){this.columns[2].z=e}set 11(e){}},hu=class extends du{constructor(){super(...arguments),k(this,"kind","mat3x3f")}makeColumn(e,n,r){return tn(e,n,r)}},pu=class{constructor(...e){k(this,"columns"),k(this,"length",16),this.columns=[this.makeColumn(e[0],e[1],e[2],e[3]),this.makeColumn(e[4],e[5],e[6],e[7]),this.makeColumn(e[8],e[9],e[10],e[11]),this.makeColumn(e[12],e[13],e[14],e[15])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(e){this.columns[0].x=e}set 1(e){this.columns[0].y=e}set 2(e){this.columns[0].z=e}set 3(e){this.columns[0].w=e}set 4(e){this.columns[1].x=e}set 5(e){this.columns[1].y=e}set 6(e){this.columns[1].z=e}set 7(e){this.columns[1].w=e}set 8(e){this.columns[2].x=e}set 9(e){this.columns[2].y=e}set 10(e){this.columns[2].z=e}set 11(e){this.columns[2].w=e}set 12(e){this.columns[3].x=e}set 13(e){this.columns[3].y=e}set 14(e){this.columns[3].z=e}set 15(e){this.columns[3].w=e}},wu=class extends pu{constructor(){super(...arguments),k(this,"kind","mat4x4f")}makeColumn(e,n,r,i){return L(e,n,r,i)}},yu=zr({type:"mat2x2f",rows:2,columns:2,makeFromElements:(...t)=>new fu(...t)}),nn=zr({type:"mat3x3f",rows:3,columns:3,makeFromElements:(...t)=>new hu(...t)}),li=zr({type:"mat4x4f",rows:4,columns:4,makeFromElements:(...t)=>new wu(...t)});function It(t,e){return qe(t)?new as(t.inner,[e,...t.attribs]):Ie(t)?new us(t.inner,[e,...t.attribs]):ci(t)?new us(t,[e]):new as(t,[e])}function bn(t,e){return It(e,{type:"@location",value:t})}function mu(t,e){return It(e,{type:"@interpolate",value:t})}function fi(t){return(qe(t)||Ie(t))&&t.attribs.find(Za)!==void 0}function gu(t){return!qe(t)&&!Ie(t)?"":t.attribs.map(e=>`${e.type}(${e.value}) `).join("")}var di=class{constructor(e,n){this.inner=e,this.attribs=n,k(this,"~repr");var r,i;let f=(r=n.find(oi))==null?void 0:r.value,w=(i=n.find(ai))==null?void 0:i.value;if(f!==void 0){if(f<=0)throw new Error(`Custom data alignment must be a positive number, got: ${f}.`);if(Math.log2(f)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${f}.`);if(Le(this.inner)&&f%St(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${f}, expected multiple of: ${St(this.inner)}.`)}if(w!==void 0){if(w<mt(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${w}, expected at least: ${mt(this.inner)}.`);if(w<=0)throw new Error(`Custom data size must be a positive number. Got: ${w}.`)}}},as=class extends di{constructor(){super(...arguments),k(this,"type","decorated")}},us=class extends di{constructor(){super(...arguments),k(this,"type","loose-decorated")}},xu={vertexIndex:It(dt,{type:"@builtin",value:"vertex_index"}),instanceIndex:It(dt,{type:"@builtin",value:"instance_index"}),position:It(L,{type:"@builtin",value:"position"}),clipDistances:It(en(dt,8),{type:"@builtin",value:"clip_distances"}),frontFacing:It(I,{type:"@builtin",value:"front_facing"}),fragDepth:It(I,{type:"@builtin",value:"frag_depth"}),sampleIndex:It(dt,{type:"@builtin",value:"sample_index"}),sampleMask:It(dt,{type:"@builtin",value:"sample_mask"}),localInvocationId:It(Ee,{type:"@builtin",value:"local_invocation_id"}),localInvocationIndex:It(dt,{type:"@builtin",value:"local_invocation_index"}),globalInvocationId:It(Ee,{type:"@builtin",value:"global_invocation_id"}),workgroupId:It(Ee,{type:"@builtin",value:"workgroup_id"}),numWorkgroups:It(Ee,{type:"@builtin",value:"num_workgroups"})};function hi(t){if(!(t.target instanceof HTMLElement))return C();const e=t.target?.getBoundingClientRect(),n=e.x+e.width/2,r=e.y+e.height/2,i=(t.clientX-n)/e.width*2,f=(r-t.clientY)/e.height*2;return C(i,f)}const Gn=Symbol("store-raw"),je=Symbol("store-node"),ye=Symbol("store-has"),pi=Symbol("store-self");function wi(t){let e=t[Ae];if(!e&&(Object.defineProperty(t,Ae,{value:e=new Proxy(t,_u)}),!Array.isArray(t))){const n=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let i=0,f=n.length;i<f;i++){const w=n[i];r[w].get&&Object.defineProperty(t,w,{enumerable:r[w].enumerable,get:r[w].get.bind(e)})}}return e}function Re(t){let e;return t!=null&&typeof t=="object"&&(t[Ae]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function pe(t,e=new Set){let n,r,i,f;if(n=t!=null&&t[Gn])return n;if(!Re(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let w=0,g=t.length;w<g;w++)i=t[w],(r=pe(i,e))!==i&&(t[w]=r)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const w=Object.keys(t),g=Object.getOwnPropertyDescriptors(t);for(let D=0,U=w.length;D<U;D++)f=w[D],!g[f].get&&(i=t[f],(r=pe(i,e))!==i&&(t[f]=r))}return t}function qn(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function rn(t,e,n){if(t[e])return t[e];const[r,i]=Lt(n,{equals:!1,internal:!0});return r.$=i,t[e]=r}function vu(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===Ae||e===je||(delete n.value,delete n.writable,n.get=()=>t[Ae][e]),n}function yi(t){pr()&&rn(qn(t,je),pi)()}function bu(t){return yi(t),Reflect.ownKeys(t)}const _u={get(t,e,n){if(e===Gn)return t;if(e===Ae)return n;if(e===Jr)return yi(t),n;const r=qn(t,je),i=r[e];let f=i?i():t[e];if(e===je||e===ye||e==="__proto__")return f;if(!i){const w=Object.getOwnPropertyDescriptor(t,e);pr()&&(typeof f!="function"||t.hasOwnProperty(e))&&!(w&&w.get)&&(f=rn(r,e,f)())}return Re(f)?wi(f):f},has(t,e){return e===Gn||e===Ae||e===Jr||e===je||e===ye||e==="__proto__"?!0:(pr()&&rn(qn(t,ye),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:bu,getOwnPropertyDescriptor:vu};function Ne(t,e,n,r=!1){if(!r&&t[e]===n)return;const i=t[e],f=t.length;n===void 0?(delete t[e],t[ye]&&t[ye][e]&&i!==void 0&&t[ye][e].$()):(t[e]=n,t[ye]&&t[ye][e]&&i===void 0&&t[ye][e].$());let w=qn(t,je),g;if((g=rn(w,e,i))&&g.$(()=>n),Array.isArray(t)&&t.length!==f){for(let D=t.length;D<f;D++)(g=w[D])&&g.$();(g=rn(w,"length",f))&&g.$(t.length)}(g=w[pi])&&g.$()}function mi(t,e){const n=Object.keys(e);for(let r=0;r<n.length;r+=1){const i=n[r];Ne(t,i,e[i])}}function $u(t,e){if(typeof e=="function"&&(e=e(t)),e=pe(e),Array.isArray(e)){if(t===e)return;let n=0,r=e.length;for(;n<r;n++){const i=e[n];t[n]!==i&&Ne(t,n,i)}Ne(t,"length",r)}else mi(t,e)}function Ye(t,e,n=[]){let r,i=t;if(e.length>1){r=e.shift();const w=typeof r,g=Array.isArray(t);if(Array.isArray(r)){for(let D=0;D<r.length;D++)Ye(t,[r[D]].concat(e),n);return}else if(g&&w==="function"){for(let D=0;D<t.length;D++)r(t[D],D)&&Ye(t,[D].concat(e),n);return}else if(g&&w==="object"){const{from:D=0,to:U=t.length-1,by:A=1}=r;for(let P=D;P<=U;P+=A)Ye(t,[P].concat(e),n);return}else if(e.length>1){Ye(t[r],e,[r].concat(n));return}i=t[r],n=[r].concat(n)}let f=e[0];typeof f=="function"&&(f=f(i,n),f===i)||r===void 0&&f==null||(f=pe(f),r===void 0||Re(i)&&Re(f)&&!Array.isArray(f)?mi(i,f):Ne(t,r,f))}function Su(...[t,e]){const n=pe(t||{}),r=Array.isArray(n),i=wi(n);function f(...w){Ts(()=>{r&&w.length===1?$u(n,w[0]):Ye(n,w)})}return[i,f]}const Cn=new WeakMap,gi={get(t,e){if(e===Gn)return t;const n=t[e];let r;return Re(n)?Cn.get(n)||(Cn.set(n,r=new Proxy(n,gi)),r):n},set(t,e,n){return Ne(t,e,pe(n)),!0},deleteProperty(t,e){return Ne(t,e,void 0,!0),!0}};function xi(t){return e=>{if(Re(e)){let n;(n=Cn.get(e))||Cn.set(e,n=new Proxy(e,gi)),t(n)}return e}}function Tu(t,e){return class extends t{constructor(...n){super(...n),e(this)}}}const Mu=Tu(Array,t=>t.fill(0));let Y=1e-6;function Du(t){function e(s=0,d=0){const o=new t(2);return s!==void 0&&(o[0]=s,d!==void 0&&(o[1]=d)),o}const n=e;function r(s,d,o){const u=o??new t(2);return u[0]=s,u[1]=d,u}function i(s,d){const o=d??new t(2);return o[0]=Math.ceil(s[0]),o[1]=Math.ceil(s[1]),o}function f(s,d){const o=d??new t(2);return o[0]=Math.floor(s[0]),o[1]=Math.floor(s[1]),o}function w(s,d){const o=d??new t(2);return o[0]=Math.round(s[0]),o[1]=Math.round(s[1]),o}function g(s,d=0,o=1,u){const p=u??new t(2);return p[0]=Math.min(o,Math.max(d,s[0])),p[1]=Math.min(o,Math.max(d,s[1])),p}function D(s,d,o){const u=o??new t(2);return u[0]=s[0]+d[0],u[1]=s[1]+d[1],u}function U(s,d,o,u){const p=u??new t(2);return p[0]=s[0]+d[0]*o,p[1]=s[1]+d[1]*o,p}function A(s,d){const o=s[0],u=s[1],p=d[0],_=d[1],M=Math.sqrt(o*o+u*u),h=Math.sqrt(p*p+_*_),y=M*h,b=y&&J(s,d)/y;return Math.acos(b)}function P(s,d,o){const u=o??new t(2);return u[0]=s[0]-d[0],u[1]=s[1]-d[1],u}const F=P;function z(s,d){return Math.abs(s[0]-d[0])<Y&&Math.abs(s[1]-d[1])<Y}function B(s,d){return s[0]===d[0]&&s[1]===d[1]}function j(s,d,o,u){const p=u??new t(2);return p[0]=s[0]+o*(d[0]-s[0]),p[1]=s[1]+o*(d[1]-s[1]),p}function q(s,d,o,u){const p=u??new t(2);return p[0]=s[0]+o[0]*(d[0]-s[0]),p[1]=s[1]+o[1]*(d[1]-s[1]),p}function st(s,d,o){const u=o??new t(2);return u[0]=Math.max(s[0],d[0]),u[1]=Math.max(s[1],d[1]),u}function ot(s,d,o){const u=o??new t(2);return u[0]=Math.min(s[0],d[0]),u[1]=Math.min(s[1],d[1]),u}function it(s,d,o){const u=o??new t(2);return u[0]=s[0]*d,u[1]=s[1]*d,u}const nt=it;function ft(s,d,o){const u=o??new t(2);return u[0]=s[0]/d,u[1]=s[1]/d,u}function at(s,d){const o=d??new t(2);return o[0]=1/s[0],o[1]=1/s[1],o}const vt=at;function et(s,d,o){const u=o??new t(3),p=s[0]*d[1]-s[1]*d[0];return u[0]=0,u[1]=0,u[2]=p,u}function J(s,d){return s[0]*d[0]+s[1]*d[1]}function X(s){const d=s[0],o=s[1];return Math.sqrt(d*d+o*o)}const ut=X;function Z(s){const d=s[0],o=s[1];return d*d+o*o}const rt=Z;function H(s,d){const o=s[0]-d[0],u=s[1]-d[1];return Math.sqrt(o*o+u*u)}const re=H;function Ft(s,d){const o=s[0]-d[0],u=s[1]-d[1];return o*o+u*u}const se=Ft;function zt(s,d){const o=d??new t(2),u=s[0],p=s[1],_=Math.sqrt(u*u+p*p);return _>1e-5?(o[0]=u/_,o[1]=p/_):(o[0]=0,o[1]=0),o}function ie(s,d){const o=d??new t(2);return o[0]=-s[0],o[1]=-s[1],o}function lt(s,d){const o=d??new t(2);return o[0]=s[0],o[1]=s[1],o}const oe=lt;function Gt(s,d,o){const u=o??new t(2);return u[0]=s[0]*d[0],u[1]=s[1]*d[1],u}const ae=Gt;function qt(s,d,o){const u=o??new t(2);return u[0]=s[0]/d[0],u[1]=s[1]/d[1],u}const Jt=qt;function Ct(s=1,d){const o=d??new t(2),u=Math.random()*2*Math.PI;return o[0]=Math.cos(u)*s,o[1]=Math.sin(u)*s,o}function c(s){const d=s??new t(2);return d[0]=0,d[1]=0,d}function x(s,d,o){const u=o??new t(2),p=s[0],_=s[1];return u[0]=p*d[0]+_*d[4]+d[12],u[1]=p*d[1]+_*d[5]+d[13],u}function a(s,d,o){const u=o??new t(2),p=s[0],_=s[1];return u[0]=d[0]*p+d[4]*_+d[8],u[1]=d[1]*p+d[5]*_+d[9],u}function l(s,d,o,u){const p=u??new t(2),_=s[0]-d[0],M=s[1]-d[1],h=Math.sin(o),y=Math.cos(o);return p[0]=_*y-M*h+d[0],p[1]=_*h+M*y+d[1],p}function m(s,d,o){const u=o??new t(2);return zt(s,u),it(u,d,u)}function v(s,d,o){const u=o??new t(2);return X(s)>d?m(s,d,u):lt(s,u)}function T(s,d,o){const u=o??new t(2);return j(s,d,.5,u)}return{create:e,fromValues:n,set:r,ceil:i,floor:f,round:w,clamp:g,add:D,addScaled:U,angle:A,subtract:P,sub:F,equalsApproximately:z,equals:B,lerp:j,lerpV:q,max:st,min:ot,mulScalar:it,scale:nt,divScalar:ft,inverse:at,invert:vt,cross:et,dot:J,length:X,len:ut,lengthSq:Z,lenSq:rt,distance:H,dist:re,distanceSq:Ft,distSq:se,normalize:zt,negate:ie,copy:lt,clone:oe,multiply:Gt,mul:ae,divide:qt,div:Jt,random:Ct,zero:c,transformMat4:x,transformMat3:a,rotate:l,setLength:m,truncate:v,midpoint:T}}const cs=new Map;function vi(t){let e=cs.get(t);return e||(e=Du(t),cs.set(t,e)),e}function Uu(t){function e(h,y,b){const $=new t(3);return h!==void 0&&($[0]=h,y!==void 0&&($[1]=y,b!==void 0&&($[2]=b))),$}const n=e;function r(h,y,b,$){const S=$??new t(3);return S[0]=h,S[1]=y,S[2]=b,S}function i(h,y){const b=y??new t(3);return b[0]=Math.ceil(h[0]),b[1]=Math.ceil(h[1]),b[2]=Math.ceil(h[2]),b}function f(h,y){const b=y??new t(3);return b[0]=Math.floor(h[0]),b[1]=Math.floor(h[1]),b[2]=Math.floor(h[2]),b}function w(h,y){const b=y??new t(3);return b[0]=Math.round(h[0]),b[1]=Math.round(h[1]),b[2]=Math.round(h[2]),b}function g(h,y=0,b=1,$){const S=$??new t(3);return S[0]=Math.min(b,Math.max(y,h[0])),S[1]=Math.min(b,Math.max(y,h[1])),S[2]=Math.min(b,Math.max(y,h[2])),S}function D(h,y,b){const $=b??new t(3);return $[0]=h[0]+y[0],$[1]=h[1]+y[1],$[2]=h[2]+y[2],$}function U(h,y,b,$){const S=$??new t(3);return S[0]=h[0]+y[0]*b,S[1]=h[1]+y[1]*b,S[2]=h[2]+y[2]*b,S}function A(h,y){const b=h[0],$=h[1],S=h[2],O=y[0],E=y[1],N=y[2],G=Math.sqrt(b*b+$*$+S*S),R=Math.sqrt(O*O+E*E+N*N),V=G*R,K=V&&J(h,y)/V;return Math.acos(K)}function P(h,y,b){const $=b??new t(3);return $[0]=h[0]-y[0],$[1]=h[1]-y[1],$[2]=h[2]-y[2],$}const F=P;function z(h,y){return Math.abs(h[0]-y[0])<Y&&Math.abs(h[1]-y[1])<Y&&Math.abs(h[2]-y[2])<Y}function B(h,y){return h[0]===y[0]&&h[1]===y[1]&&h[2]===y[2]}function j(h,y,b,$){const S=$??new t(3);return S[0]=h[0]+b*(y[0]-h[0]),S[1]=h[1]+b*(y[1]-h[1]),S[2]=h[2]+b*(y[2]-h[2]),S}function q(h,y,b,$){const S=$??new t(3);return S[0]=h[0]+b[0]*(y[0]-h[0]),S[1]=h[1]+b[1]*(y[1]-h[1]),S[2]=h[2]+b[2]*(y[2]-h[2]),S}function st(h,y,b){const $=b??new t(3);return $[0]=Math.max(h[0],y[0]),$[1]=Math.max(h[1],y[1]),$[2]=Math.max(h[2],y[2]),$}function ot(h,y,b){const $=b??new t(3);return $[0]=Math.min(h[0],y[0]),$[1]=Math.min(h[1],y[1]),$[2]=Math.min(h[2],y[2]),$}function it(h,y,b){const $=b??new t(3);return $[0]=h[0]*y,$[1]=h[1]*y,$[2]=h[2]*y,$}const nt=it;function ft(h,y,b){const $=b??new t(3);return $[0]=h[0]/y,$[1]=h[1]/y,$[2]=h[2]/y,$}function at(h,y){const b=y??new t(3);return b[0]=1/h[0],b[1]=1/h[1],b[2]=1/h[2],b}const vt=at;function et(h,y,b){const $=b??new t(3),S=h[2]*y[0]-h[0]*y[2],O=h[0]*y[1]-h[1]*y[0];return $[0]=h[1]*y[2]-h[2]*y[1],$[1]=S,$[2]=O,$}function J(h,y){return h[0]*y[0]+h[1]*y[1]+h[2]*y[2]}function X(h){const y=h[0],b=h[1],$=h[2];return Math.sqrt(y*y+b*b+$*$)}const ut=X;function Z(h){const y=h[0],b=h[1],$=h[2];return y*y+b*b+$*$}const rt=Z;function H(h,y){const b=h[0]-y[0],$=h[1]-y[1],S=h[2]-y[2];return Math.sqrt(b*b+$*$+S*S)}const re=H;function Ft(h,y){const b=h[0]-y[0],$=h[1]-y[1],S=h[2]-y[2];return b*b+$*$+S*S}const se=Ft;function zt(h,y){const b=y??new t(3),$=h[0],S=h[1],O=h[2],E=Math.sqrt($*$+S*S+O*O);return E>1e-5?(b[0]=$/E,b[1]=S/E,b[2]=O/E):(b[0]=0,b[1]=0,b[2]=0),b}function ie(h,y){const b=y??new t(3);return b[0]=-h[0],b[1]=-h[1],b[2]=-h[2],b}function lt(h,y){const b=y??new t(3);return b[0]=h[0],b[1]=h[1],b[2]=h[2],b}const oe=lt;function Gt(h,y,b){const $=b??new t(3);return $[0]=h[0]*y[0],$[1]=h[1]*y[1],$[2]=h[2]*y[2],$}const ae=Gt;function qt(h,y,b){const $=b??new t(3);return $[0]=h[0]/y[0],$[1]=h[1]/y[1],$[2]=h[2]/y[2],$}const Jt=qt;function Ct(h=1,y){const b=y??new t(3),$=Math.random()*2*Math.PI,S=Math.random()*2-1,O=Math.sqrt(1-S*S)*h;return b[0]=Math.cos($)*O,b[1]=Math.sin($)*O,b[2]=S*h,b}function c(h){const y=h??new t(3);return y[0]=0,y[1]=0,y[2]=0,y}function x(h,y,b){const $=b??new t(3),S=h[0],O=h[1],E=h[2],N=y[3]*S+y[7]*O+y[11]*E+y[15]||1;return $[0]=(y[0]*S+y[4]*O+y[8]*E+y[12])/N,$[1]=(y[1]*S+y[5]*O+y[9]*E+y[13])/N,$[2]=(y[2]*S+y[6]*O+y[10]*E+y[14])/N,$}function a(h,y,b){const $=b??new t(3),S=h[0],O=h[1],E=h[2];return $[0]=S*y[0*4+0]+O*y[1*4+0]+E*y[2*4+0],$[1]=S*y[0*4+1]+O*y[1*4+1]+E*y[2*4+1],$[2]=S*y[0*4+2]+O*y[1*4+2]+E*y[2*4+2],$}function l(h,y,b){const $=b??new t(3),S=h[0],O=h[1],E=h[2];return $[0]=S*y[0]+O*y[4]+E*y[8],$[1]=S*y[1]+O*y[5]+E*y[9],$[2]=S*y[2]+O*y[6]+E*y[10],$}function m(h,y,b){const $=b??new t(3),S=y[0],O=y[1],E=y[2],N=y[3]*2,G=h[0],R=h[1],V=h[2],K=O*V-E*R,tt=E*G-S*V,wt=S*R-O*G;return $[0]=G+K*N+(O*wt-E*tt)*2,$[1]=R+tt*N+(E*K-S*wt)*2,$[2]=V+wt*N+(S*tt-O*K)*2,$}function v(h,y){const b=y??new t(3);return b[0]=h[12],b[1]=h[13],b[2]=h[14],b}function T(h,y,b){const $=b??new t(3),S=y*4;return $[0]=h[S+0],$[1]=h[S+1],$[2]=h[S+2],$}function s(h,y){const b=y??new t(3),$=h[0],S=h[1],O=h[2],E=h[4],N=h[5],G=h[6],R=h[8],V=h[9],K=h[10];return b[0]=Math.sqrt($*$+S*S+O*O),b[1]=Math.sqrt(E*E+N*N+G*G),b[2]=Math.sqrt(R*R+V*V+K*K),b}function d(h,y,b,$){const S=$??new t(3),O=[],E=[];return O[0]=h[0]-y[0],O[1]=h[1]-y[1],O[2]=h[2]-y[2],E[0]=O[0],E[1]=O[1]*Math.cos(b)-O[2]*Math.sin(b),E[2]=O[1]*Math.sin(b)+O[2]*Math.cos(b),S[0]=E[0]+y[0],S[1]=E[1]+y[1],S[2]=E[2]+y[2],S}function o(h,y,b,$){const S=$??new t(3),O=[],E=[];return O[0]=h[0]-y[0],O[1]=h[1]-y[1],O[2]=h[2]-y[2],E[0]=O[2]*Math.sin(b)+O[0]*Math.cos(b),E[1]=O[1],E[2]=O[2]*Math.cos(b)-O[0]*Math.sin(b),S[0]=E[0]+y[0],S[1]=E[1]+y[1],S[2]=E[2]+y[2],S}function u(h,y,b,$){const S=$??new t(3),O=[],E=[];return O[0]=h[0]-y[0],O[1]=h[1]-y[1],O[2]=h[2]-y[2],E[0]=O[0]*Math.cos(b)-O[1]*Math.sin(b),E[1]=O[0]*Math.sin(b)+O[1]*Math.cos(b),E[2]=O[2],S[0]=E[0]+y[0],S[1]=E[1]+y[1],S[2]=E[2]+y[2],S}function p(h,y,b){const $=b??new t(3);return zt(h,$),it($,y,$)}function _(h,y,b){const $=b??new t(3);return X(h)>y?p(h,y,$):lt(h,$)}function M(h,y,b){const $=b??new t(3);return j(h,y,.5,$)}return{create:e,fromValues:n,set:r,ceil:i,floor:f,round:w,clamp:g,add:D,addScaled:U,angle:A,subtract:P,sub:F,equalsApproximately:z,equals:B,lerp:j,lerpV:q,max:st,min:ot,mulScalar:it,scale:nt,divScalar:ft,inverse:at,invert:vt,cross:et,dot:J,length:X,len:ut,lengthSq:Z,lenSq:rt,distance:H,dist:re,distanceSq:Ft,distSq:se,normalize:zt,negate:ie,copy:lt,clone:oe,multiply:Gt,mul:ae,divide:qt,div:Jt,random:Ct,zero:c,transformMat4:x,transformMat4Upper3x3:a,transformMat3:l,transformQuat:m,getTranslation:v,getAxis:T,getScaling:s,rotateX:d,rotateY:o,rotateZ:u,setLength:p,truncate:_,midpoint:M}}const ls=new Map;function or(t){let e=ls.get(t);return e||(e=Uu(t),ls.set(t,e)),e}function Ou(t){const e=vi(t),n=or(t);function r(c,x,a,l,m,v,T,s,d){const o=new t(12);return o[3]=0,o[7]=0,o[11]=0,c!==void 0&&(o[0]=c,x!==void 0&&(o[1]=x,a!==void 0&&(o[2]=a,l!==void 0&&(o[4]=l,m!==void 0&&(o[5]=m,v!==void 0&&(o[6]=v,T!==void 0&&(o[8]=T,s!==void 0&&(o[9]=s,d!==void 0&&(o[10]=d))))))))),o}function i(c,x,a,l,m,v,T,s,d,o){const u=o??new t(12);return u[0]=c,u[1]=x,u[2]=a,u[3]=0,u[4]=l,u[5]=m,u[6]=v,u[7]=0,u[8]=T,u[9]=s,u[10]=d,u[11]=0,u}function f(c,x){const a=x??new t(12);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=0,a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=0,a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=0,a}function w(c,x){const a=x??new t(12),l=c[0],m=c[1],v=c[2],T=c[3],s=l+l,d=m+m,o=v+v,u=l*s,p=m*s,_=m*d,M=v*s,h=v*d,y=v*o,b=T*s,$=T*d,S=T*o;return a[0]=1-_-y,a[1]=p+S,a[2]=M-$,a[3]=0,a[4]=p-S,a[5]=1-u-y,a[6]=h+b,a[7]=0,a[8]=M+$,a[9]=h-b,a[10]=1-u-_,a[11]=0,a}function g(c,x){const a=x??new t(12);return a[0]=-c[0],a[1]=-c[1],a[2]=-c[2],a[4]=-c[4],a[5]=-c[5],a[6]=-c[6],a[8]=-c[8],a[9]=-c[9],a[10]=-c[10],a}function D(c,x){const a=x??new t(12);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[8]=c[8],a[9]=c[9],a[10]=c[10],a}const U=D;function A(c,x){return Math.abs(c[0]-x[0])<Y&&Math.abs(c[1]-x[1])<Y&&Math.abs(c[2]-x[2])<Y&&Math.abs(c[4]-x[4])<Y&&Math.abs(c[5]-x[5])<Y&&Math.abs(c[6]-x[6])<Y&&Math.abs(c[8]-x[8])<Y&&Math.abs(c[9]-x[9])<Y&&Math.abs(c[10]-x[10])<Y}function P(c,x){return c[0]===x[0]&&c[1]===x[1]&&c[2]===x[2]&&c[4]===x[4]&&c[5]===x[5]&&c[6]===x[6]&&c[8]===x[8]&&c[9]===x[9]&&c[10]===x[10]}function F(c){const x=c??new t(12);return x[0]=1,x[1]=0,x[2]=0,x[4]=0,x[5]=1,x[6]=0,x[8]=0,x[9]=0,x[10]=1,x}function z(c,x){const a=x??new t(12);if(a===c){let _;return _=c[1],c[1]=c[4],c[4]=_,_=c[2],c[2]=c[8],c[8]=_,_=c[6],c[6]=c[9],c[9]=_,a}const l=c[0*4+0],m=c[0*4+1],v=c[0*4+2],T=c[1*4+0],s=c[1*4+1],d=c[1*4+2],o=c[2*4+0],u=c[2*4+1],p=c[2*4+2];return a[0]=l,a[1]=T,a[2]=o,a[4]=m,a[5]=s,a[6]=u,a[8]=v,a[9]=d,a[10]=p,a}function B(c,x){const a=x??new t(12),l=c[0*4+0],m=c[0*4+1],v=c[0*4+2],T=c[1*4+0],s=c[1*4+1],d=c[1*4+2],o=c[2*4+0],u=c[2*4+1],p=c[2*4+2],_=p*s-d*u,M=-p*T+d*o,h=u*T-s*o,y=1/(l*_+m*M+v*h);return a[0]=_*y,a[1]=(-p*m+v*u)*y,a[2]=(d*m-v*s)*y,a[4]=M*y,a[5]=(p*l-v*o)*y,a[6]=(-d*l+v*T)*y,a[8]=h*y,a[9]=(-u*l+m*o)*y,a[10]=(s*l-m*T)*y,a}function j(c){const x=c[0],a=c[0*4+1],l=c[0*4+2],m=c[1*4+0],v=c[1*4+1],T=c[1*4+2],s=c[2*4+0],d=c[2*4+1],o=c[2*4+2];return x*(v*o-d*T)-m*(a*o-d*l)+s*(a*T-v*l)}const q=B;function st(c,x,a){const l=a??new t(12),m=c[0],v=c[1],T=c[2],s=c[4],d=c[5],o=c[6],u=c[8],p=c[9],_=c[10],M=x[0],h=x[1],y=x[2],b=x[4],$=x[5],S=x[6],O=x[8],E=x[9],N=x[10];return l[0]=m*M+s*h+u*y,l[1]=v*M+d*h+p*y,l[2]=T*M+o*h+_*y,l[4]=m*b+s*$+u*S,l[5]=v*b+d*$+p*S,l[6]=T*b+o*$+_*S,l[8]=m*O+s*E+u*N,l[9]=v*O+d*E+p*N,l[10]=T*O+o*E+_*N,l}const ot=st;function it(c,x,a){const l=a??F();return c!==l&&(l[0]=c[0],l[1]=c[1],l[2]=c[2],l[4]=c[4],l[5]=c[5],l[6]=c[6]),l[8]=x[0],l[9]=x[1],l[10]=1,l}function nt(c,x){const a=x??e.create();return a[0]=c[8],a[1]=c[9],a}function ft(c,x,a){const l=a??e.create(),m=x*4;return l[0]=c[m+0],l[1]=c[m+1],l}function at(c,x,a,l){const m=l===c?c:D(c,l),v=a*4;return m[v+0]=x[0],m[v+1]=x[1],m}function vt(c,x){const a=x??e.create(),l=c[0],m=c[1],v=c[4],T=c[5];return a[0]=Math.sqrt(l*l+m*m),a[1]=Math.sqrt(v*v+T*T),a}function et(c,x){const a=x??n.create(),l=c[0],m=c[1],v=c[2],T=c[4],s=c[5],d=c[6],o=c[8],u=c[9],p=c[10];return a[0]=Math.sqrt(l*l+m*m+v*v),a[1]=Math.sqrt(T*T+s*s+d*d),a[2]=Math.sqrt(o*o+u*u+p*p),a}function J(c,x){const a=x??new t(12);return a[0]=1,a[1]=0,a[2]=0,a[4]=0,a[5]=1,a[6]=0,a[8]=c[0],a[9]=c[1],a[10]=1,a}function X(c,x,a){const l=a??new t(12),m=x[0],v=x[1],T=c[0],s=c[1],d=c[2],o=c[1*4+0],u=c[1*4+1],p=c[1*4+2],_=c[2*4+0],M=c[2*4+1],h=c[2*4+2];return c!==l&&(l[0]=T,l[1]=s,l[2]=d,l[4]=o,l[5]=u,l[6]=p),l[8]=T*m+o*v+_,l[9]=s*m+u*v+M,l[10]=d*m+p*v+h,l}function ut(c,x){const a=x??new t(12),l=Math.cos(c),m=Math.sin(c);return a[0]=l,a[1]=m,a[2]=0,a[4]=-m,a[5]=l,a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function Z(c,x,a){const l=a??new t(12),m=c[0*4+0],v=c[0*4+1],T=c[0*4+2],s=c[1*4+0],d=c[1*4+1],o=c[1*4+2],u=Math.cos(x),p=Math.sin(x);return l[0]=u*m+p*s,l[1]=u*v+p*d,l[2]=u*T+p*o,l[4]=u*s-p*m,l[5]=u*d-p*v,l[6]=u*o-p*T,c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function rt(c,x){const a=x??new t(12),l=Math.cos(c),m=Math.sin(c);return a[0]=1,a[1]=0,a[2]=0,a[4]=0,a[5]=l,a[6]=m,a[8]=0,a[9]=-m,a[10]=l,a}function H(c,x,a){const l=a??new t(12),m=c[4],v=c[5],T=c[6],s=c[8],d=c[9],o=c[10],u=Math.cos(x),p=Math.sin(x);return l[4]=u*m+p*s,l[5]=u*v+p*d,l[6]=u*T+p*o,l[8]=u*s-p*m,l[9]=u*d-p*v,l[10]=u*o-p*T,c!==l&&(l[0]=c[0],l[1]=c[1],l[2]=c[2]),l}function re(c,x){const a=x??new t(12),l=Math.cos(c),m=Math.sin(c);return a[0]=l,a[1]=0,a[2]=-m,a[4]=0,a[5]=1,a[6]=0,a[8]=m,a[9]=0,a[10]=l,a}function Ft(c,x,a){const l=a??new t(12),m=c[0*4+0],v=c[0*4+1],T=c[0*4+2],s=c[2*4+0],d=c[2*4+1],o=c[2*4+2],u=Math.cos(x),p=Math.sin(x);return l[0]=u*m-p*s,l[1]=u*v-p*d,l[2]=u*T-p*o,l[8]=u*s+p*m,l[9]=u*d+p*v,l[10]=u*o+p*T,c!==l&&(l[4]=c[4],l[5]=c[5],l[6]=c[6]),l}const se=ut,zt=Z;function ie(c,x){const a=x??new t(12);return a[0]=c[0],a[1]=0,a[2]=0,a[4]=0,a[5]=c[1],a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function lt(c,x,a){const l=a??new t(12),m=x[0],v=x[1];return l[0]=m*c[0*4+0],l[1]=m*c[0*4+1],l[2]=m*c[0*4+2],l[4]=v*c[1*4+0],l[5]=v*c[1*4+1],l[6]=v*c[1*4+2],c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function oe(c,x){const a=x??new t(12);return a[0]=c[0],a[1]=0,a[2]=0,a[4]=0,a[5]=c[1],a[6]=0,a[8]=0,a[9]=0,a[10]=c[2],a}function Gt(c,x,a){const l=a??new t(12),m=x[0],v=x[1],T=x[2];return l[0]=m*c[0*4+0],l[1]=m*c[0*4+1],l[2]=m*c[0*4+2],l[4]=v*c[1*4+0],l[5]=v*c[1*4+1],l[6]=v*c[1*4+2],l[8]=T*c[2*4+0],l[9]=T*c[2*4+1],l[10]=T*c[2*4+2],l}function ae(c,x){const a=x??new t(12);return a[0]=c,a[1]=0,a[2]=0,a[4]=0,a[5]=c,a[6]=0,a[8]=0,a[9]=0,a[10]=1,a}function qt(c,x,a){const l=a??new t(12);return l[0]=x*c[0*4+0],l[1]=x*c[0*4+1],l[2]=x*c[0*4+2],l[4]=x*c[1*4+0],l[5]=x*c[1*4+1],l[6]=x*c[1*4+2],c!==l&&(l[8]=c[8],l[9]=c[9],l[10]=c[10]),l}function Jt(c,x){const a=x??new t(12);return a[0]=c,a[1]=0,a[2]=0,a[4]=0,a[5]=c,a[6]=0,a[8]=0,a[9]=0,a[10]=c,a}function Ct(c,x,a){const l=a??new t(12);return l[0]=x*c[0*4+0],l[1]=x*c[0*4+1],l[2]=x*c[0*4+2],l[4]=x*c[1*4+0],l[5]=x*c[1*4+1],l[6]=x*c[1*4+2],l[8]=x*c[2*4+0],l[9]=x*c[2*4+1],l[10]=x*c[2*4+2],l}return{clone:U,create:r,set:i,fromMat4:f,fromQuat:w,negate:g,copy:D,equalsApproximately:A,equals:P,identity:F,transpose:z,inverse:B,invert:q,determinant:j,mul:ot,multiply:st,setTranslation:it,getTranslation:nt,getAxis:ft,setAxis:at,getScaling:vt,get3DScaling:et,translation:J,translate:X,rotation:ut,rotate:Z,rotationX:rt,rotateX:H,rotationY:re,rotateY:Ft,rotationZ:se,rotateZ:zt,scaling:ie,scale:lt,uniformScaling:ae,uniformScale:qt,scaling3D:oe,scale3D:Gt,uniformScaling3D:Jt,uniformScale3D:Ct}}const fs=new Map;function Eu(t){let e=fs.get(t);return e||(e=Ou(t),fs.set(t,e)),e}function ku(t){const e=or(t);function n(s,d,o,u,p,_,M,h,y,b,$,S,O,E,N,G){const R=new t(16);return s!==void 0&&(R[0]=s,d!==void 0&&(R[1]=d,o!==void 0&&(R[2]=o,u!==void 0&&(R[3]=u,p!==void 0&&(R[4]=p,_!==void 0&&(R[5]=_,M!==void 0&&(R[6]=M,h!==void 0&&(R[7]=h,y!==void 0&&(R[8]=y,b!==void 0&&(R[9]=b,$!==void 0&&(R[10]=$,S!==void 0&&(R[11]=S,O!==void 0&&(R[12]=O,E!==void 0&&(R[13]=E,N!==void 0&&(R[14]=N,G!==void 0&&(R[15]=G)))))))))))))))),R}function r(s,d,o,u,p,_,M,h,y,b,$,S,O,E,N,G,R){const V=R??new t(16);return V[0]=s,V[1]=d,V[2]=o,V[3]=u,V[4]=p,V[5]=_,V[6]=M,V[7]=h,V[8]=y,V[9]=b,V[10]=$,V[11]=S,V[12]=O,V[13]=E,V[14]=N,V[15]=G,V}function i(s,d){const o=d??new t(16);return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=0,o[4]=s[4],o[5]=s[5],o[6]=s[6],o[7]=0,o[8]=s[8],o[9]=s[9],o[10]=s[10],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function f(s,d){const o=d??new t(16),u=s[0],p=s[1],_=s[2],M=s[3],h=u+u,y=p+p,b=_+_,$=u*h,S=p*h,O=p*y,E=_*h,N=_*y,G=_*b,R=M*h,V=M*y,K=M*b;return o[0]=1-O-G,o[1]=S+K,o[2]=E-V,o[3]=0,o[4]=S-K,o[5]=1-$-G,o[6]=N+R,o[7]=0,o[8]=E+V,o[9]=N-R,o[10]=1-$-O,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function w(s,d){const o=d??new t(16);return o[0]=-s[0],o[1]=-s[1],o[2]=-s[2],o[3]=-s[3],o[4]=-s[4],o[5]=-s[5],o[6]=-s[6],o[7]=-s[7],o[8]=-s[8],o[9]=-s[9],o[10]=-s[10],o[11]=-s[11],o[12]=-s[12],o[13]=-s[13],o[14]=-s[14],o[15]=-s[15],o}function g(s,d){const o=d??new t(16);return o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],o[4]=s[4],o[5]=s[5],o[6]=s[6],o[7]=s[7],o[8]=s[8],o[9]=s[9],o[10]=s[10],o[11]=s[11],o[12]=s[12],o[13]=s[13],o[14]=s[14],o[15]=s[15],o}const D=g;function U(s,d){return Math.abs(s[0]-d[0])<Y&&Math.abs(s[1]-d[1])<Y&&Math.abs(s[2]-d[2])<Y&&Math.abs(s[3]-d[3])<Y&&Math.abs(s[4]-d[4])<Y&&Math.abs(s[5]-d[5])<Y&&Math.abs(s[6]-d[6])<Y&&Math.abs(s[7]-d[7])<Y&&Math.abs(s[8]-d[8])<Y&&Math.abs(s[9]-d[9])<Y&&Math.abs(s[10]-d[10])<Y&&Math.abs(s[11]-d[11])<Y&&Math.abs(s[12]-d[12])<Y&&Math.abs(s[13]-d[13])<Y&&Math.abs(s[14]-d[14])<Y&&Math.abs(s[15]-d[15])<Y}function A(s,d){return s[0]===d[0]&&s[1]===d[1]&&s[2]===d[2]&&s[3]===d[3]&&s[4]===d[4]&&s[5]===d[5]&&s[6]===d[6]&&s[7]===d[7]&&s[8]===d[8]&&s[9]===d[9]&&s[10]===d[10]&&s[11]===d[11]&&s[12]===d[12]&&s[13]===d[13]&&s[14]===d[14]&&s[15]===d[15]}function P(s){const d=s??new t(16);return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,d}function F(s,d){const o=d??new t(16);if(o===s){let tt;return tt=s[1],s[1]=s[4],s[4]=tt,tt=s[2],s[2]=s[8],s[8]=tt,tt=s[3],s[3]=s[12],s[12]=tt,tt=s[6],s[6]=s[9],s[9]=tt,tt=s[7],s[7]=s[13],s[13]=tt,tt=s[11],s[11]=s[14],s[14]=tt,o}const u=s[0*4+0],p=s[0*4+1],_=s[0*4+2],M=s[0*4+3],h=s[1*4+0],y=s[1*4+1],b=s[1*4+2],$=s[1*4+3],S=s[2*4+0],O=s[2*4+1],E=s[2*4+2],N=s[2*4+3],G=s[3*4+0],R=s[3*4+1],V=s[3*4+2],K=s[3*4+3];return o[0]=u,o[1]=h,o[2]=S,o[3]=G,o[4]=p,o[5]=y,o[6]=O,o[7]=R,o[8]=_,o[9]=b,o[10]=E,o[11]=V,o[12]=M,o[13]=$,o[14]=N,o[15]=K,o}function z(s,d){const o=d??new t(16),u=s[0*4+0],p=s[0*4+1],_=s[0*4+2],M=s[0*4+3],h=s[1*4+0],y=s[1*4+1],b=s[1*4+2],$=s[1*4+3],S=s[2*4+0],O=s[2*4+1],E=s[2*4+2],N=s[2*4+3],G=s[3*4+0],R=s[3*4+1],V=s[3*4+2],K=s[3*4+3],tt=E*K,wt=V*N,bt=b*K,_t=V*$,Mt=b*N,Dt=E*$,Ut=_*K,Ot=V*M,Et=_*N,kt=E*M,Bt=_*$,jt=b*M,Rt=S*R,Nt=G*O,Wt=h*R,Yt=G*y,Xt=h*O,cn=S*y,ln=u*R,fn=G*p,dn=u*O,hn=S*p,pn=u*y,wn=h*p,Xr=tt*y+_t*O+Mt*R-(wt*y+bt*O+Dt*R),Zr=wt*p+Ut*O+kt*R-(tt*p+Ot*O+Et*R),Kr=bt*p+Ot*y+Bt*R-(_t*p+Ut*y+jt*R),Hr=Dt*p+Et*y+jt*O-(Mt*p+kt*y+Bt*O),At=1/(u*Xr+h*Zr+S*Kr+G*Hr);return o[0]=At*Xr,o[1]=At*Zr,o[2]=At*Kr,o[3]=At*Hr,o[4]=At*(wt*h+bt*S+Dt*G-(tt*h+_t*S+Mt*G)),o[5]=At*(tt*u+Ot*S+Et*G-(wt*u+Ut*S+kt*G)),o[6]=At*(_t*u+Ut*h+jt*G-(bt*u+Ot*h+Bt*G)),o[7]=At*(Mt*u+kt*h+Bt*S-(Dt*u+Et*h+jt*S)),o[8]=At*(Rt*$+Yt*N+Xt*K-(Nt*$+Wt*N+cn*K)),o[9]=At*(Nt*M+ln*N+hn*K-(Rt*M+fn*N+dn*K)),o[10]=At*(Wt*M+fn*$+pn*K-(Yt*M+ln*$+wn*K)),o[11]=At*(cn*M+dn*$+wn*N-(Xt*M+hn*$+pn*N)),o[12]=At*(Wt*E+cn*V+Nt*b-(Xt*V+Rt*b+Yt*E)),o[13]=At*(dn*V+Rt*_+fn*E-(ln*E+hn*V+Nt*_)),o[14]=At*(ln*b+wn*V+Yt*_-(pn*V+Wt*_+fn*b)),o[15]=At*(pn*E+Xt*_+hn*b-(dn*b+wn*E+cn*_)),o}function B(s){const d=s[0],o=s[0*4+1],u=s[0*4+2],p=s[0*4+3],_=s[1*4+0],M=s[1*4+1],h=s[1*4+2],y=s[1*4+3],b=s[2*4+0],$=s[2*4+1],S=s[2*4+2],O=s[2*4+3],E=s[3*4+0],N=s[3*4+1],G=s[3*4+2],R=s[3*4+3],V=S*R,K=G*O,tt=h*R,wt=G*y,bt=h*O,_t=S*y,Mt=u*R,Dt=G*p,Ut=u*O,Ot=S*p,Et=u*y,kt=h*p,Bt=V*M+wt*$+bt*N-(K*M+tt*$+_t*N),jt=K*o+Mt*$+Ot*N-(V*o+Dt*$+Ut*N),Rt=tt*o+Dt*M+Et*N-(wt*o+Mt*M+kt*N),Nt=_t*o+Ut*M+kt*$-(bt*o+Ot*M+Et*$);return d*Bt+_*jt+b*Rt+E*Nt}const j=z;function q(s,d,o){const u=o??new t(16),p=s[0],_=s[1],M=s[2],h=s[3],y=s[4],b=s[5],$=s[6],S=s[7],O=s[8],E=s[9],N=s[10],G=s[11],R=s[12],V=s[13],K=s[14],tt=s[15],wt=d[0],bt=d[1],_t=d[2],Mt=d[3],Dt=d[4],Ut=d[5],Ot=d[6],Et=d[7],kt=d[8],Bt=d[9],jt=d[10],Rt=d[11],Nt=d[12],Wt=d[13],Yt=d[14],Xt=d[15];return u[0]=p*wt+y*bt+O*_t+R*Mt,u[1]=_*wt+b*bt+E*_t+V*Mt,u[2]=M*wt+$*bt+N*_t+K*Mt,u[3]=h*wt+S*bt+G*_t+tt*Mt,u[4]=p*Dt+y*Ut+O*Ot+R*Et,u[5]=_*Dt+b*Ut+E*Ot+V*Et,u[6]=M*Dt+$*Ut+N*Ot+K*Et,u[7]=h*Dt+S*Ut+G*Ot+tt*Et,u[8]=p*kt+y*Bt+O*jt+R*Rt,u[9]=_*kt+b*Bt+E*jt+V*Rt,u[10]=M*kt+$*Bt+N*jt+K*Rt,u[11]=h*kt+S*Bt+G*jt+tt*Rt,u[12]=p*Nt+y*Wt+O*Yt+R*Xt,u[13]=_*Nt+b*Wt+E*Yt+V*Xt,u[14]=M*Nt+$*Wt+N*Yt+K*Xt,u[15]=h*Nt+S*Wt+G*Yt+tt*Xt,u}const st=q;function ot(s,d,o){const u=o??P();return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11]),u[12]=d[0],u[13]=d[1],u[14]=d[2],u[15]=1,u}function it(s,d){const o=d??e.create();return o[0]=s[12],o[1]=s[13],o[2]=s[14],o}function nt(s,d,o){const u=o??e.create(),p=d*4;return u[0]=s[p+0],u[1]=s[p+1],u[2]=s[p+2],u}function ft(s,d,o,u){const p=u===s?u:g(s,u),_=o*4;return p[_+0]=d[0],p[_+1]=d[1],p[_+2]=d[2],p}function at(s,d){const o=d??e.create(),u=s[0],p=s[1],_=s[2],M=s[4],h=s[5],y=s[6],b=s[8],$=s[9],S=s[10];return o[0]=Math.sqrt(u*u+p*p+_*_),o[1]=Math.sqrt(M*M+h*h+y*y),o[2]=Math.sqrt(b*b+$*$+S*S),o}function vt(s,d,o,u,p){const _=p??new t(16),M=Math.tan(Math.PI*.5-.5*s);if(_[0]=M/d,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=M,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,Number.isFinite(u)){const h=1/(o-u);_[10]=u*h,_[14]=u*o*h}else _[10]=-1,_[14]=-o;return _}function et(s,d,o,u=1/0,p){const _=p??new t(16),M=1/Math.tan(s*.5);if(_[0]=M/d,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=M,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,u===1/0)_[10]=0,_[14]=o;else{const h=1/(u-o);_[10]=o*h,_[14]=u*o*h}return _}function J(s,d,o,u,p,_,M){const h=M??new t(16);return h[0]=2/(d-s),h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/(u-o),h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1/(p-_),h[11]=0,h[12]=(d+s)/(s-d),h[13]=(u+o)/(o-u),h[14]=p/(p-_),h[15]=1,h}function X(s,d,o,u,p,_,M){const h=M??new t(16),y=d-s,b=u-o,$=p-_;return h[0]=2*p/y,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*p/b,h[6]=0,h[7]=0,h[8]=(s+d)/y,h[9]=(u+o)/b,h[10]=_/$,h[11]=-1,h[12]=0,h[13]=0,h[14]=p*_/$,h[15]=0,h}function ut(s,d,o,u,p,_=1/0,M){const h=M??new t(16),y=d-s,b=u-o;if(h[0]=2*p/y,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2*p/b,h[6]=0,h[7]=0,h[8]=(s+d)/y,h[9]=(u+o)/b,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,_===1/0)h[10]=0,h[14]=p;else{const $=1/(_-p);h[10]=p*$,h[14]=_*p*$}return h}const Z=e.create(),rt=e.create(),H=e.create();function re(s,d,o,u){const p=u??new t(16);return e.normalize(e.subtract(d,s,H),H),e.normalize(e.cross(o,H,Z),Z),e.normalize(e.cross(H,Z,rt),rt),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=rt[0],p[5]=rt[1],p[6]=rt[2],p[7]=0,p[8]=H[0],p[9]=H[1],p[10]=H[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function Ft(s,d,o,u){const p=u??new t(16);return e.normalize(e.subtract(s,d,H),H),e.normalize(e.cross(o,H,Z),Z),e.normalize(e.cross(H,Z,rt),rt),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=rt[0],p[5]=rt[1],p[6]=rt[2],p[7]=0,p[8]=H[0],p[9]=H[1],p[10]=H[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function se(s,d,o,u){const p=u??new t(16);return e.normalize(e.subtract(s,d,H),H),e.normalize(e.cross(o,H,Z),Z),e.normalize(e.cross(H,Z,rt),rt),p[0]=Z[0],p[1]=rt[0],p[2]=H[0],p[3]=0,p[4]=Z[1],p[5]=rt[1],p[6]=H[1],p[7]=0,p[8]=Z[2],p[9]=rt[2],p[10]=H[2],p[11]=0,p[12]=-(Z[0]*s[0]+Z[1]*s[1]+Z[2]*s[2]),p[13]=-(rt[0]*s[0]+rt[1]*s[1]+rt[2]*s[2]),p[14]=-(H[0]*s[0]+H[1]*s[1]+H[2]*s[2]),p[15]=1,p}function zt(s,d){const o=d??new t(16);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=s[0],o[13]=s[1],o[14]=s[2],o[15]=1,o}function ie(s,d,o){const u=o??new t(16),p=d[0],_=d[1],M=d[2],h=s[0],y=s[1],b=s[2],$=s[3],S=s[1*4+0],O=s[1*4+1],E=s[1*4+2],N=s[1*4+3],G=s[2*4+0],R=s[2*4+1],V=s[2*4+2],K=s[2*4+3],tt=s[3*4+0],wt=s[3*4+1],bt=s[3*4+2],_t=s[3*4+3];return s!==u&&(u[0]=h,u[1]=y,u[2]=b,u[3]=$,u[4]=S,u[5]=O,u[6]=E,u[7]=N,u[8]=G,u[9]=R,u[10]=V,u[11]=K),u[12]=h*p+S*_+G*M+tt,u[13]=y*p+O*_+R*M+wt,u[14]=b*p+E*_+V*M+bt,u[15]=$*p+N*_+K*M+_t,u}function lt(s,d){const o=d??new t(16),u=Math.cos(s),p=Math.sin(s);return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=p,o[7]=0,o[8]=0,o[9]=-p,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function oe(s,d,o){const u=o??new t(16),p=s[4],_=s[5],M=s[6],h=s[7],y=s[8],b=s[9],$=s[10],S=s[11],O=Math.cos(d),E=Math.sin(d);return u[4]=O*p+E*y,u[5]=O*_+E*b,u[6]=O*M+E*$,u[7]=O*h+E*S,u[8]=O*y-E*p,u[9]=O*b-E*_,u[10]=O*$-E*M,u[11]=O*S-E*h,s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Gt(s,d){const o=d??new t(16),u=Math.cos(s),p=Math.sin(s);return o[0]=u,o[1]=0,o[2]=-p,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=p,o[9]=0,o[10]=u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ae(s,d,o){const u=o??new t(16),p=s[0*4+0],_=s[0*4+1],M=s[0*4+2],h=s[0*4+3],y=s[2*4+0],b=s[2*4+1],$=s[2*4+2],S=s[2*4+3],O=Math.cos(d),E=Math.sin(d);return u[0]=O*p-E*y,u[1]=O*_-E*b,u[2]=O*M-E*$,u[3]=O*h-E*S,u[8]=O*y+E*p,u[9]=O*b+E*_,u[10]=O*$+E*M,u[11]=O*S+E*h,s!==u&&(u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function qt(s,d){const o=d??new t(16),u=Math.cos(s),p=Math.sin(s);return o[0]=u,o[1]=p,o[2]=0,o[3]=0,o[4]=-p,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Jt(s,d,o){const u=o??new t(16),p=s[0*4+0],_=s[0*4+1],M=s[0*4+2],h=s[0*4+3],y=s[1*4+0],b=s[1*4+1],$=s[1*4+2],S=s[1*4+3],O=Math.cos(d),E=Math.sin(d);return u[0]=O*p+E*y,u[1]=O*_+E*b,u[2]=O*M+E*$,u[3]=O*h+E*S,u[4]=O*y-E*p,u[5]=O*b-E*_,u[6]=O*$-E*M,u[7]=O*S-E*h,s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function Ct(s,d,o){const u=o??new t(16);let p=s[0],_=s[1],M=s[2];const h=Math.sqrt(p*p+_*_+M*M);p/=h,_/=h,M/=h;const y=p*p,b=_*_,$=M*M,S=Math.cos(d),O=Math.sin(d),E=1-S;return u[0]=y+(1-y)*S,u[1]=p*_*E+M*O,u[2]=p*M*E-_*O,u[3]=0,u[4]=p*_*E-M*O,u[5]=b+(1-b)*S,u[6]=_*M*E+p*O,u[7]=0,u[8]=p*M*E+_*O,u[9]=_*M*E-p*O,u[10]=$+(1-$)*S,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}const c=Ct;function x(s,d,o,u){const p=u??new t(16);let _=d[0],M=d[1],h=d[2];const y=Math.sqrt(_*_+M*M+h*h);_/=y,M/=y,h/=y;const b=_*_,$=M*M,S=h*h,O=Math.cos(o),E=Math.sin(o),N=1-O,G=b+(1-b)*O,R=_*M*N+h*E,V=_*h*N-M*E,K=_*M*N-h*E,tt=$+(1-$)*O,wt=M*h*N+_*E,bt=_*h*N+M*E,_t=M*h*N-_*E,Mt=S+(1-S)*O,Dt=s[0],Ut=s[1],Ot=s[2],Et=s[3],kt=s[4],Bt=s[5],jt=s[6],Rt=s[7],Nt=s[8],Wt=s[9],Yt=s[10],Xt=s[11];return p[0]=G*Dt+R*kt+V*Nt,p[1]=G*Ut+R*Bt+V*Wt,p[2]=G*Ot+R*jt+V*Yt,p[3]=G*Et+R*Rt+V*Xt,p[4]=K*Dt+tt*kt+wt*Nt,p[5]=K*Ut+tt*Bt+wt*Wt,p[6]=K*Ot+tt*jt+wt*Yt,p[7]=K*Et+tt*Rt+wt*Xt,p[8]=bt*Dt+_t*kt+Mt*Nt,p[9]=bt*Ut+_t*Bt+Mt*Wt,p[10]=bt*Ot+_t*jt+Mt*Yt,p[11]=bt*Et+_t*Rt+Mt*Xt,s!==p&&(p[12]=s[12],p[13]=s[13],p[14]=s[14],p[15]=s[15]),p}const a=x;function l(s,d){const o=d??new t(16);return o[0]=s[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=s[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function m(s,d,o){const u=o??new t(16),p=d[0],_=d[1],M=d[2];return u[0]=p*s[0*4+0],u[1]=p*s[0*4+1],u[2]=p*s[0*4+2],u[3]=p*s[0*4+3],u[4]=_*s[1*4+0],u[5]=_*s[1*4+1],u[6]=_*s[1*4+2],u[7]=_*s[1*4+3],u[8]=M*s[2*4+0],u[9]=M*s[2*4+1],u[10]=M*s[2*4+2],u[11]=M*s[2*4+3],s!==u&&(u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}function v(s,d){const o=d??new t(16);return o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=s,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function T(s,d,o){const u=o??new t(16);return u[0]=d*s[0*4+0],u[1]=d*s[0*4+1],u[2]=d*s[0*4+2],u[3]=d*s[0*4+3],u[4]=d*s[1*4+0],u[5]=d*s[1*4+1],u[6]=d*s[1*4+2],u[7]=d*s[1*4+3],u[8]=d*s[2*4+0],u[9]=d*s[2*4+1],u[10]=d*s[2*4+2],u[11]=d*s[2*4+3],s!==u&&(u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u}return{create:n,set:r,fromMat3:i,fromQuat:f,negate:w,copy:g,clone:D,equalsApproximately:U,equals:A,identity:P,transpose:F,inverse:z,determinant:B,invert:j,multiply:q,mul:st,setTranslation:ot,getTranslation:it,getAxis:nt,setAxis:ft,getScaling:at,perspective:vt,perspectiveReverseZ:et,ortho:J,frustum:X,frustumReverseZ:ut,aim:re,cameraAim:Ft,lookAt:se,translation:zt,translate:ie,rotationX:lt,rotateX:oe,rotationY:Gt,rotateY:ae,rotationZ:qt,rotateZ:Jt,axisRotation:Ct,rotation:c,axisRotate:x,rotate:a,scaling:l,scale:m,uniformScaling:v,uniformScale:T}}const ds=new Map;function Au(t){let e=ds.get(t);return e||(e=ku(t),ds.set(t,e)),e}function Iu(t){const e=or(t);function n(c,x,a,l){const m=new t(4);return c!==void 0&&(m[0]=c,x!==void 0&&(m[1]=x,a!==void 0&&(m[2]=a,l!==void 0&&(m[3]=l)))),m}const r=n;function i(c,x,a,l,m){const v=m??new t(4);return v[0]=c,v[1]=x,v[2]=a,v[3]=l,v}function f(c,x,a){const l=a??new t(4),m=x*.5,v=Math.sin(m);return l[0]=v*c[0],l[1]=v*c[1],l[2]=v*c[2],l[3]=Math.cos(m),l}function w(c,x){const a=x??e.create(3),l=Math.acos(c[3])*2,m=Math.sin(l*.5);return m>Y?(a[0]=c[0]/m,a[1]=c[1]/m,a[2]=c[2]/m):(a[0]=1,a[1]=0,a[2]=0),{angle:l,axis:a}}function g(c,x){const a=X(c,x);return Math.acos(2*a*a-1)}function D(c,x,a){const l=a??new t(4),m=c[0],v=c[1],T=c[2],s=c[3],d=x[0],o=x[1],u=x[2],p=x[3];return l[0]=m*p+s*d+v*u-T*o,l[1]=v*p+s*o+T*d-m*u,l[2]=T*p+s*u+m*o-v*d,l[3]=s*p-m*d-v*o-T*u,l}const U=D;function A(c,x,a){const l=a??new t(4),m=x*.5,v=c[0],T=c[1],s=c[2],d=c[3],o=Math.sin(m),u=Math.cos(m);return l[0]=v*u+d*o,l[1]=T*u+s*o,l[2]=s*u-T*o,l[3]=d*u-v*o,l}function P(c,x,a){const l=a??new t(4),m=x*.5,v=c[0],T=c[1],s=c[2],d=c[3],o=Math.sin(m),u=Math.cos(m);return l[0]=v*u-s*o,l[1]=T*u+d*o,l[2]=s*u+v*o,l[3]=d*u-T*o,l}function F(c,x,a){const l=a??new t(4),m=x*.5,v=c[0],T=c[1],s=c[2],d=c[3],o=Math.sin(m),u=Math.cos(m);return l[0]=v*u+T*o,l[1]=T*u-v*o,l[2]=s*u+d*o,l[3]=d*u-s*o,l}function z(c,x,a,l){const m=l??new t(4),v=c[0],T=c[1],s=c[2],d=c[3];let o=x[0],u=x[1],p=x[2],_=x[3],M=v*o+T*u+s*p+d*_;M<0&&(M=-M,o=-o,u=-u,p=-p,_=-_);let h,y;if(1-M>Y){const b=Math.acos(M),$=Math.sin(b);h=Math.sin((1-a)*b)/$,y=Math.sin(a*b)/$}else h=1-a,y=a;return m[0]=h*v+y*o,m[1]=h*T+y*u,m[2]=h*s+y*p,m[3]=h*d+y*_,m}function B(c,x){const a=x??new t(4),l=c[0],m=c[1],v=c[2],T=c[3],s=l*l+m*m+v*v+T*T,d=s?1/s:0;return a[0]=-l*d,a[1]=-m*d,a[2]=-v*d,a[3]=T*d,a}function j(c,x){const a=x??new t(4);return a[0]=-c[0],a[1]=-c[1],a[2]=-c[2],a[3]=c[3],a}function q(c,x){const a=x??new t(4),l=c[0]+c[5]+c[10];if(l>0){const m=Math.sqrt(l+1);a[3]=.5*m;const v=.5/m;a[0]=(c[6]-c[9])*v,a[1]=(c[8]-c[2])*v,a[2]=(c[1]-c[4])*v}else{let m=0;c[5]>c[0]&&(m=1),c[10]>c[m*4+m]&&(m=2);const v=(m+1)%3,T=(m+2)%3,s=Math.sqrt(c[m*4+m]-c[v*4+v]-c[T*4+T]+1);a[m]=.5*s;const d=.5/s;a[3]=(c[v*4+T]-c[T*4+v])*d,a[v]=(c[v*4+m]+c[m*4+v])*d,a[T]=(c[T*4+m]+c[m*4+T])*d}return a}function st(c,x,a,l,m){const v=m??new t(4),T=c*.5,s=x*.5,d=a*.5,o=Math.sin(T),u=Math.cos(T),p=Math.sin(s),_=Math.cos(s),M=Math.sin(d),h=Math.cos(d);switch(l){case"xyz":v[0]=o*_*h+u*p*M,v[1]=u*p*h-o*_*M,v[2]=u*_*M+o*p*h,v[3]=u*_*h-o*p*M;break;case"xzy":v[0]=o*_*h-u*p*M,v[1]=u*p*h-o*_*M,v[2]=u*_*M+o*p*h,v[3]=u*_*h+o*p*M;break;case"yxz":v[0]=o*_*h+u*p*M,v[1]=u*p*h-o*_*M,v[2]=u*_*M-o*p*h,v[3]=u*_*h+o*p*M;break;case"yzx":v[0]=o*_*h+u*p*M,v[1]=u*p*h+o*_*M,v[2]=u*_*M-o*p*h,v[3]=u*_*h-o*p*M;break;case"zxy":v[0]=o*_*h-u*p*M,v[1]=u*p*h+o*_*M,v[2]=u*_*M+o*p*h,v[3]=u*_*h-o*p*M;break;case"zyx":v[0]=o*_*h-u*p*M,v[1]=u*p*h+o*_*M,v[2]=u*_*M-o*p*h,v[3]=u*_*h+o*p*M;break;default:throw new Error(`Unknown rotation order: ${l}`)}return v}function ot(c,x){const a=x??new t(4);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a}const it=ot;function nt(c,x,a){const l=a??new t(4);return l[0]=c[0]+x[0],l[1]=c[1]+x[1],l[2]=c[2]+x[2],l[3]=c[3]+x[3],l}function ft(c,x,a){const l=a??new t(4);return l[0]=c[0]-x[0],l[1]=c[1]-x[1],l[2]=c[2]-x[2],l[3]=c[3]-x[3],l}const at=ft;function vt(c,x,a){const l=a??new t(4);return l[0]=c[0]*x,l[1]=c[1]*x,l[2]=c[2]*x,l[3]=c[3]*x,l}const et=vt;function J(c,x,a){const l=a??new t(4);return l[0]=c[0]/x,l[1]=c[1]/x,l[2]=c[2]/x,l[3]=c[3]/x,l}function X(c,x){return c[0]*x[0]+c[1]*x[1]+c[2]*x[2]+c[3]*x[3]}function ut(c,x,a,l){const m=l??new t(4);return m[0]=c[0]+a*(x[0]-c[0]),m[1]=c[1]+a*(x[1]-c[1]),m[2]=c[2]+a*(x[2]-c[2]),m[3]=c[3]+a*(x[3]-c[3]),m}function Z(c){const x=c[0],a=c[1],l=c[2],m=c[3];return Math.sqrt(x*x+a*a+l*l+m*m)}const rt=Z;function H(c){const x=c[0],a=c[1],l=c[2],m=c[3];return x*x+a*a+l*l+m*m}const re=H;function Ft(c,x){const a=x??new t(4),l=c[0],m=c[1],v=c[2],T=c[3],s=Math.sqrt(l*l+m*m+v*v+T*T);return s>1e-5?(a[0]=l/s,a[1]=m/s,a[2]=v/s,a[3]=T/s):(a[0]=0,a[1]=0,a[2]=0,a[3]=1),a}function se(c,x){return Math.abs(c[0]-x[0])<Y&&Math.abs(c[1]-x[1])<Y&&Math.abs(c[2]-x[2])<Y&&Math.abs(c[3]-x[3])<Y}function zt(c,x){return c[0]===x[0]&&c[1]===x[1]&&c[2]===x[2]&&c[3]===x[3]}function ie(c){const x=c??new t(4);return x[0]=0,x[1]=0,x[2]=0,x[3]=1,x}const lt=e.create(),oe=e.create(),Gt=e.create();function ae(c,x,a){const l=a??new t(4),m=e.dot(c,x);return m<-.999999?(e.cross(oe,c,lt),e.len(lt)<1e-6&&e.cross(Gt,c,lt),e.normalize(lt,lt),f(lt,Math.PI,l),l):m>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(e.cross(c,x,lt),l[0]=lt[0],l[1]=lt[1],l[2]=lt[2],l[3]=1+m,Ft(l,l))}const qt=new t(4),Jt=new t(4);function Ct(c,x,a,l,m,v){const T=v??new t(4);return z(c,l,m,qt),z(x,a,m,Jt),z(qt,Jt,2*m*(1-m),T),T}return{create:n,fromValues:r,set:i,fromAxisAngle:f,toAxisAngle:w,angle:g,multiply:D,mul:U,rotateX:A,rotateY:P,rotateZ:F,slerp:z,inverse:B,conjugate:j,fromMat:q,fromEuler:st,copy:ot,clone:it,add:nt,subtract:ft,sub:at,mulScalar:vt,scale:et,divScalar:J,dot:X,lerp:ut,length:Z,len:rt,lengthSq:H,lenSq:re,normalize:Ft,equalsApproximately:se,equals:zt,identity:ie,rotationTo:ae,sqlerp:Ct}}const hs=new Map;function Pu(t){let e=hs.get(t);return e||(e=Iu(t),hs.set(t,e)),e}function Fu(t){function e(a,l,m,v){const T=new t(4);return a!==void 0&&(T[0]=a,l!==void 0&&(T[1]=l,m!==void 0&&(T[2]=m,v!==void 0&&(T[3]=v)))),T}const n=e;function r(a,l,m,v,T){const s=T??new t(4);return s[0]=a,s[1]=l,s[2]=m,s[3]=v,s}function i(a,l){const m=l??new t(4);return m[0]=Math.ceil(a[0]),m[1]=Math.ceil(a[1]),m[2]=Math.ceil(a[2]),m[3]=Math.ceil(a[3]),m}function f(a,l){const m=l??new t(4);return m[0]=Math.floor(a[0]),m[1]=Math.floor(a[1]),m[2]=Math.floor(a[2]),m[3]=Math.floor(a[3]),m}function w(a,l){const m=l??new t(4);return m[0]=Math.round(a[0]),m[1]=Math.round(a[1]),m[2]=Math.round(a[2]),m[3]=Math.round(a[3]),m}function g(a,l=0,m=1,v){const T=v??new t(4);return T[0]=Math.min(m,Math.max(l,a[0])),T[1]=Math.min(m,Math.max(l,a[1])),T[2]=Math.min(m,Math.max(l,a[2])),T[3]=Math.min(m,Math.max(l,a[3])),T}function D(a,l,m){const v=m??new t(4);return v[0]=a[0]+l[0],v[1]=a[1]+l[1],v[2]=a[2]+l[2],v[3]=a[3]+l[3],v}function U(a,l,m,v){const T=v??new t(4);return T[0]=a[0]+l[0]*m,T[1]=a[1]+l[1]*m,T[2]=a[2]+l[2]*m,T[3]=a[3]+l[3]*m,T}function A(a,l,m){const v=m??new t(4);return v[0]=a[0]-l[0],v[1]=a[1]-l[1],v[2]=a[2]-l[2],v[3]=a[3]-l[3],v}const P=A;function F(a,l){return Math.abs(a[0]-l[0])<Y&&Math.abs(a[1]-l[1])<Y&&Math.abs(a[2]-l[2])<Y&&Math.abs(a[3]-l[3])<Y}function z(a,l){return a[0]===l[0]&&a[1]===l[1]&&a[2]===l[2]&&a[3]===l[3]}function B(a,l,m,v){const T=v??new t(4);return T[0]=a[0]+m*(l[0]-a[0]),T[1]=a[1]+m*(l[1]-a[1]),T[2]=a[2]+m*(l[2]-a[2]),T[3]=a[3]+m*(l[3]-a[3]),T}function j(a,l,m,v){const T=v??new t(4);return T[0]=a[0]+m[0]*(l[0]-a[0]),T[1]=a[1]+m[1]*(l[1]-a[1]),T[2]=a[2]+m[2]*(l[2]-a[2]),T[3]=a[3]+m[3]*(l[3]-a[3]),T}function q(a,l,m){const v=m??new t(4);return v[0]=Math.max(a[0],l[0]),v[1]=Math.max(a[1],l[1]),v[2]=Math.max(a[2],l[2]),v[3]=Math.max(a[3],l[3]),v}function st(a,l,m){const v=m??new t(4);return v[0]=Math.min(a[0],l[0]),v[1]=Math.min(a[1],l[1]),v[2]=Math.min(a[2],l[2]),v[3]=Math.min(a[3],l[3]),v}function ot(a,l,m){const v=m??new t(4);return v[0]=a[0]*l,v[1]=a[1]*l,v[2]=a[2]*l,v[3]=a[3]*l,v}const it=ot;function nt(a,l,m){const v=m??new t(4);return v[0]=a[0]/l,v[1]=a[1]/l,v[2]=a[2]/l,v[3]=a[3]/l,v}function ft(a,l){const m=l??new t(4);return m[0]=1/a[0],m[1]=1/a[1],m[2]=1/a[2],m[3]=1/a[3],m}const at=ft;function vt(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3]}function et(a){const l=a[0],m=a[1],v=a[2],T=a[3];return Math.sqrt(l*l+m*m+v*v+T*T)}const J=et;function X(a){const l=a[0],m=a[1],v=a[2],T=a[3];return l*l+m*m+v*v+T*T}const ut=X;function Z(a,l){const m=a[0]-l[0],v=a[1]-l[1],T=a[2]-l[2],s=a[3]-l[3];return Math.sqrt(m*m+v*v+T*T+s*s)}const rt=Z;function H(a,l){const m=a[0]-l[0],v=a[1]-l[1],T=a[2]-l[2],s=a[3]-l[3];return m*m+v*v+T*T+s*s}const re=H;function Ft(a,l){const m=l??new t(4),v=a[0],T=a[1],s=a[2],d=a[3],o=Math.sqrt(v*v+T*T+s*s+d*d);return o>1e-5?(m[0]=v/o,m[1]=T/o,m[2]=s/o,m[3]=d/o):(m[0]=0,m[1]=0,m[2]=0,m[3]=0),m}function se(a,l){const m=l??new t(4);return m[0]=-a[0],m[1]=-a[1],m[2]=-a[2],m[3]=-a[3],m}function zt(a,l){const m=l??new t(4);return m[0]=a[0],m[1]=a[1],m[2]=a[2],m[3]=a[3],m}const ie=zt;function lt(a,l,m){const v=m??new t(4);return v[0]=a[0]*l[0],v[1]=a[1]*l[1],v[2]=a[2]*l[2],v[3]=a[3]*l[3],v}const oe=lt;function Gt(a,l,m){const v=m??new t(4);return v[0]=a[0]/l[0],v[1]=a[1]/l[1],v[2]=a[2]/l[2],v[3]=a[3]/l[3],v}const ae=Gt;function qt(a){const l=a??new t(4);return l[0]=0,l[1]=0,l[2]=0,l[3]=0,l}function Jt(a,l,m){const v=m??new t(4),T=a[0],s=a[1],d=a[2],o=a[3];return v[0]=l[0]*T+l[4]*s+l[8]*d+l[12]*o,v[1]=l[1]*T+l[5]*s+l[9]*d+l[13]*o,v[2]=l[2]*T+l[6]*s+l[10]*d+l[14]*o,v[3]=l[3]*T+l[7]*s+l[11]*d+l[15]*o,v}function Ct(a,l,m){const v=m??new t(4);return Ft(a,v),ot(v,l,v)}function c(a,l,m){const v=m??new t(4);return et(a)>l?Ct(a,l,v):zt(a,v)}function x(a,l,m){const v=m??new t(4);return B(a,l,.5,v)}return{create:e,fromValues:n,set:r,ceil:i,floor:f,round:w,clamp:g,add:D,addScaled:U,subtract:A,sub:P,equalsApproximately:F,equals:z,lerp:B,lerpV:j,max:q,min:st,mulScalar:ot,scale:it,divScalar:nt,inverse:ft,invert:at,dot:vt,length:et,len:J,lengthSq:X,lenSq:ut,distance:Z,dist:rt,distanceSq:H,distSq:re,normalize:Ft,negate:se,copy:zt,clone:ie,multiply:lt,mul:oe,divide:Gt,div:ae,zero:qt,transformMat4:Jt,setLength:Ct,truncate:c,midpoint:x}}const ps=new Map;function zu(t){let e=ps.get(t);return e||(e=Fu(t),ps.set(t,e)),e}function Br(t,e,n,r,i,f){return{mat3:Eu(t),mat4:Au(e),quat:Pu(n),vec2:vi(r),vec3:or(i),vec4:zu(f)}}const{mat3:Bu,mat4:ju,quat:vf,vec2:ht,vec3:Ru,vec4:bf}=Br(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Br(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Br(Mu,Array,Array,Array,Array,Array);function Nu(){return window.matchMedia("(prefers-color-scheme: dark)")?"dark":"light"}const{sign:bi,sqrt:Wn,abs:ws,min:Vu,max:Lu}=Math;function _i(){return new Promise(t=>requestAnimationFrame(t))}function _r({x:t,y:e}){return C(-e,t)}function Gu(t,e,n,r,i){return C(t.x+e.x*n+r.x*i,t.y+e.y*n+r.y*i)}function $i(t){const e=Wn(t.x*t.x+t.y*t.y)||1;return C(t.x/e,t.y/e)}const[ce,Si]=Su([]),[Ti,qu]=Lt(!1),[Yn,Cu]=Lt(Nu());function Wu(t){const n=pe(ce).findIndex(r=>ht.distance(r.center,t)<r.radius);return n===-1?(Si(xi(r=>{r.push({center:t,radius:0})})),ce.length-1):n}function Yu(t){const e=pe(ce);let n=Number.POSITIVE_INFINITY,r;const{center:i}=e[t];for(let w=0;w<e.length;++w){if(w===t)continue;const g=e[w],D=ht.distance(g.center,i)-g.radius;D<n&&(n=D,r=w)}return{index:r,radius:n,curve:()=>i}}function Xu(t,e,n){const r=ht.sub(e.center,t.center,C()),i=e.radius-t.radius,f=ht.dot(r,r),w=ht.dot(n,r);return(f-i*i)/(2*(w+i*ht.length(n)))-t.radius}function Zu(t,e){const n=pe(ce),r=n[t],i=n[e],f=$i(ht.sub(i.center,r.center,C()));let w=Number.POSITIVE_INFINITY,g;for(let U=0;U<n.length;++U){if(U===t||U===e)continue;const A=n[U],P=Xu(r,A,f);P>=-r.radius/2&&P<w&&(w=P,g=U)}return{index:g,radius:w,curve:U=>ht.addScaled(r.center,f,r.radius+U,C())}}function Ku(t,e,n,r){t.radius<e.radius&&([t,e]=[e,t]);const i=t.radius,f=e.radius,w=n.radius;if(i===f)throw new Error("Not Implemented when radii are the same");const g=ht.sub(e.center,t.center,C()),D=$i(g),U=_r(D),A=ht.sub(n.center,t.center,C()),P=ht.lengthSq(A),F=bi(ht.dot(U,ht.sub(r.center,t.center,C()))),z=ht.dot(D,A),B=ht.dot(U,A)*F,j=ht.length(g),q=j/(i-f),st=(i-f)/2-j*j/(2*(i-f)),ot=q*q,it=B*B,nt=w-i,ft=nt*nt,at=P-ft,vt=it-ft,et=q*(2*st*vt+nt*at)+z*(at-2*st*nt),J=at*((ot-1)*at+4*st*(q*z+st+nt));if(J<0||Number.isNaN(J))return Number.POSITIVE_INFINITY;const X=2*(2*q*nt*z+P-ot*vt),ut=(et-B*Wn(J))/X,Z=Wn((q*ut+st)**2-ut*ut),rt=q*ut+st-i;return ut<j/2||ws(ht.distance([ut,Z],[z,B])-w-rt)>ws(ht.distance([ut,-Z],[z,B])-w-rt)?Number.POSITIVE_INFINITY:rt}function Hu(t,e,n,r){t.radius>e.radius&&([t,e]=[e,t]);const i=ht.sub(e.center,t.center,C()),f=ht.length(i),w=t.radius,g=e.radius,D=n,U=(w*w-g*g+2*(w-g)*D+f*f)/(2*f),A=(w+D)**2-U*U;if(A<0)return;const P=ht.scale(i,1/f,C()),F=_r(P),z=Wn(A),B=bi(ht.dot(_r(i),ht.sub(r.center,t.center,C())));return Gu(t.center,P,U,F,z*B)}function Ju(t,e,n){const r=pe(ce),i=r[n],f=r[t],w=r[e];let g=Number.POSITIVE_INFINITY,D;for(let A=0;A<ce.length;++A){if(A===n||A===t||A===e)continue;const P=r[A],F=Ku(f,w,P,i);F!==void 0&&F<g&&(g=Lu(F,i.radius),D=A)}return{index:D,radius:g,curve:A=>Hu(f,w,A,i)}}async function dr(t,e,n,r,i){const f=ce[t];for(;;){if(await Promise.race([_i(),i])instanceof PointerEvent)return;const g=Vu(e,f.radius*1.025+.004/r()),D=n(g);if(!D||(Si(t,xi(U=>{U.radius=g,U.center=D})),g===e))return}}const Mi=Dr(),Qu=Mi.Provider;function ar(){return Er(Mi,"useCanvas","CanvasContext")}function tc(){let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}}var jr=class{constructor(){k(this,"lastUniqueId",0)}makeUnique(t){let e;return t?(e=t.replaceAll(/\s/g,"_"),e=e.replaceAll(/[^\w\d]/g,"")):e="item",`${e}_${this.lastUniqueId++}`}},Rr=class{constructor(){k(this,"_usedNames",new Set)}makeUnique(t){if(t===void 0)throw new Error("Unnamed item found when using a strict name registry");let e=0,n=t;for(;this._usedNames.has(n);)e++,n=`${t}_${e}`;return this._usedNames.add(n),n}};function Nr(t){return t?.resourceType==="slot"}function Di(t){return t?.resourceType==="derived"}function Vr(t){return t?.resourceType==="accessor"}function ec(t,e){let n="size"in t?t.size:t.currentByteOffset,r=e-1,i=n&r;"skipBytes"in t?t.skipBytes(e-i&r):t.add(e-i&r)}var $t=ec,le={bool(t,e,n){t.writeBool(n)},f32(t,e,n){t.writeFloat32(n)},f16(t,e,n){t.writeFloat16(n)},i32(t,e,n){t.writeInt32(n)},u32(t,e,n){t.writeUint32(n)},vec2f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y)},vec2h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y)},vec2i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y)},vec2u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y)},vec3f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z)},vec3h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z)},vec3i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z)},vec3u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z)},vec4f(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z),t.writeFloat32(n.w)},vec4h(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z),t.writeFloat16(n.w)},vec4i(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z),t.writeInt32(n.w)},vec4u(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z),t.writeUint32(n.w)},mat2x2f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},mat3x3f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},mat4x4f(t,e,n){for(let r=0;r<n.length;++r)t.writeFloat32(n[r])},struct(t,e,n){let r=St(e);$t(t,r);for(let[i,f]of Object.entries(e.propTypes))$t(t,St(f)),He(t,f,n[i]);$t(t,r)},array(t,e,n){if(e.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let r=St(e);$t(t,r);let i=t.currentByteOffset;for(let f=0;f<Math.min(e.elementCount,n.length);f++)$t(t,r),He(t,e.elementType,n[f]);t.seekTo(i+mt(e))},atomic(t,e,n){var r;(r=le[e.inner.type])==null||r.call(le,t,e,n)},decorated(t,e,n){var r,i;let f=ue(e);$t(t,f);let w=t.currentByteOffset;(i=le[(r=e.inner)==null?void 0:r.type])==null||i.call(le,t,e.inner,n),t.seekTo(w+mt(e))},uint8(t,e,n){t.writeUint8(n)},uint8x2(t,e,n){t.writeUint8(n.x),t.writeUint8(n.y)},uint8x4(t,e,n){t.writeUint8(n.x),t.writeUint8(n.y),t.writeUint8(n.z),t.writeUint8(n.w)},sint8(t,e,n){t.writeInt8(n)},sint8x2(t,e,n){t.writeInt8(n.x),t.writeInt8(n.y)},sint8x4(t,e,n){t.writeInt8(n.x),t.writeInt8(n.y),t.writeInt8(n.z),t.writeInt8(n.w)},unorm8(t,e,n){t.writeUint8(n*255)},unorm8x2(t,e,n){t.writeUint8(n.x*255),t.writeUint8(n.y*255)},unorm8x4(t,e,n){t.writeUint8(n.x*255),t.writeUint8(n.y*255),t.writeUint8(n.z*255),t.writeUint8(n.w*255)},snorm8(t,e,n){t.writeUint8(n*127+128)},snorm8x2(t,e,n){t.writeUint8(n.x*127+128),t.writeUint8(n.y*127+128)},snorm8x4(t,e,n){t.writeUint8(n.x*127+128),t.writeUint8(n.y*127+128),t.writeUint8(n.z*127+128),t.writeUint8(n.w*127+128)},uint16(t,e,n){t.writeUint16(n)},uint16x2(t,e,n){t.writeUint16(n.x),t.writeUint16(n.y)},uint16x4(t,e,n){t.writeUint16(n.x),t.writeUint16(n.y),t.writeUint16(n.z),t.writeUint16(n.w)},sint16(t,e,n){t.writeInt16(n)},sint16x2(t,e,n){t.writeInt16(n.x),t.writeInt16(n.y)},sint16x4(t,e,n){t.writeInt16(n.x),t.writeInt16(n.y),t.writeInt16(n.z),t.writeInt16(n.w)},unorm16(t,e,n){t.writeUint16(n*65535)},unorm16x2(t,e,n){t.writeUint16(n.x*65535),t.writeUint16(n.y*65535)},unorm16x4(t,e,n){t.writeUint16(n.x*65535),t.writeUint16(n.y*65535),t.writeUint16(n.z*65535),t.writeUint16(n.w*65535)},snorm16(t,e,n){t.writeUint16(n*32767+32768)},snorm16x2(t,e,n){t.writeUint16(n.x*32767+32768),t.writeUint16(n.y*32767+32768)},snorm16x4(t,e,n){t.writeUint16(n.x*32767+32768),t.writeUint16(n.y*32767+32768),t.writeUint16(n.z*32767+32768),t.writeUint16(n.w*32767+32768)},float16(t,e,n){t.writeFloat16(n)},float16x2(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y)},float16x4(t,e,n){t.writeFloat16(n.x),t.writeFloat16(n.y),t.writeFloat16(n.z),t.writeFloat16(n.w)},float32(t,e,n){t.writeFloat32(n)},float32x2(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y)},float32x3(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z)},float32x4(t,e,n){t.writeFloat32(n.x),t.writeFloat32(n.y),t.writeFloat32(n.z),t.writeFloat32(n.w)},uint32(t,e,n){t.writeUint32(n)},uint32x2(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y)},uint32x3(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z)},uint32x4(t,e,n){t.writeUint32(n.x),t.writeUint32(n.y),t.writeUint32(n.z),t.writeUint32(n.w)},sint32(t,e,n){t.writeInt32(n)},sint32x2(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y)},sint32x3(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z)},sint32x4(t,e,n){t.writeInt32(n.x),t.writeInt32(n.y),t.writeInt32(n.z),t.writeInt32(n.w)},"unorm10-10-10-2"(t,e,n){let r=0;r|=(n.x*1023&1023)<<22,r|=(n.x*1023&1023)<<12,r|=(n.y*1023&1023)<<2,r|=n.z*3&3,t.writeUint32(r)},"unorm8x4-bgra"(t,e,n){t.writeUint8(n.z*255),t.writeUint8(n.y*255),t.writeUint8(n.x*255),t.writeUint8(n.w*255)},disarray(t,e,n){var r,i;let f=St(e);$t(t,f);let w=t.currentByteOffset;for(let g=0;g<Math.min(e.elementCount,n.length);g++)$t(t,f),(i=le[(r=e.elementType)==null?void 0:r.type])==null||i.call(le,t,e.elementType,n[g]);t.seekTo(w+mt(e))},unstruct(t,e,n){var r;for(let[i,f]of Object.entries(e.propTypes))(r=le[f.type])==null||r.call(le,t,f,n[i])},"loose-decorated"(t,e,n){var r;let i=ue(e);$t(t,i);let f=t.currentByteOffset,w=le[(r=e.inner)==null?void 0:r.type];return w?.(t,e.inner,n),t.seekTo(f+mt(e)),n}};function He(t,e,n){let r=le[e.type];if(!r)throw new Error(`Cannot write data of type '${e.type}'.`);r(t,e,n)}var Te={bool(t){return t.readBool()},f32(t){return t.readFloat32()},f16(t){return t.readFloat16()},i32(t){return t.readInt32()},u32(t){return t.readUint32()},vec2f(t){return C(t.readFloat32(),t.readFloat32())},vec3f(t){return tn(t.readFloat32(),t.readFloat32(),t.readFloat32())},vec4f(t){return L(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},vec2h(t){return jo(t.readFloat16(),t.readFloat16())},vec3h(t){return Ro(t.readFloat16(),t.readFloat16(),t.readFloat16())},vec4h(t){return No(t.readFloat16(),t.readFloat16(),t.readFloat16(),t.readFloat16())},vec2i(t){return Ue(t.readInt32(),t.readInt32())},vec3i(t){return vr(t.readInt32(),t.readInt32(),t.readInt32())},vec4i(t){return te(t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32())},vec2u(t){return Oe(t.readUint32(),t.readUint32())},vec3u(t){return Ee(t.readUint32(),t.readUint32(),t.readUint32())},vec4u(t){return ee(t.readUint32(),t.readUint32(),t.readUint32(),t.readUint32())},mat2x2f(t){return yu(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},mat3x3f(t){let e=()=>{let n=t.readFloat32();return t.readFloat32(),n};return nn(t.readFloat32(),t.readFloat32(),e(),t.readFloat32(),t.readFloat32(),e(),t.readFloat32(),t.readFloat32(),e())},mat4x4f(t){return li(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32())},struct(t,e){let n=St(e);$t(t,n);let r={};for(let[i,f]of Object.entries(e.propTypes))$t(t,St(f)),r[i]=fe(t,f);return $t(t,n),r},array(t,e){if(e.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let n=St(e),r=[];for(let i=0;i<e.elementCount;i++){$t(t,n);let f=e.elementType,w=fe(t,f);r.push(w)}return $t(t,n),r},atomic(t,e){return fe(t,e.inner)},decorated(t,e){let n=ue(e);$t(t,n);let r=t.currentByteOffset,i=fe(t,e.inner);return t.seekTo(r+mt(e)),i},uint8:t=>t.readUint8(),uint8x2:t=>Oe(t.readUint8(),t.readUint8()),uint8x4:t=>ee(t.readUint8(),t.readUint8(),t.readUint8(),t.readUint8()),sint8:t=>t.readInt8(),sint8x2:t=>Ue(t.readInt8(),t.readInt8()),sint8x4:t=>te(t.readInt8(),t.readInt8(),t.readInt8(),t.readInt8()),unorm8:t=>t.readUint8()/255,unorm8x2:t=>C(t.readUint8()/255,t.readUint8()/255),unorm8x4:t=>L(t.readUint8()/255,t.readUint8()/255,t.readUint8()/255,t.readUint8()/255),snorm8:t=>(t.readUint8()-128)/127,snorm8x2:t=>C((t.readUint8()-128)/127,(t.readUint8()-128)/127),snorm8x4:t=>L((t.readUint8()-128)/127,(t.readUint8()-128)/127,(t.readUint8()-128)/127,(t.readUint8()-128)/127),uint16:t=>t.readUint16(),uint16x2:t=>Oe(t.readUint16(),t.readUint16()),uint16x4:t=>ee(t.readUint16(),t.readUint16(),t.readUint16(),t.readUint16()),sint16:t=>t.readInt16(),sint16x2:t=>Ue(t.readInt16(),t.readInt16()),sint16x4:t=>te(t.readInt16(),t.readInt16(),t.readInt16(),t.readInt16()),unorm16:t=>t.readUint16()/65535,unorm16x2:t=>C(t.readUint16()/65535,t.readUint16()/65535),unorm16x4:t=>L(t.readUint16()/65535,t.readUint16()/65535,t.readUint16()/65535,t.readUint16()/65535),snorm16:t=>(t.readUint16()-32768)/32767,snorm16x2:t=>C(Te.snorm16(t),Te.snorm16(t)),snorm16x4:t=>L(Te.snorm16(t),Te.snorm16(t),Te.snorm16(t),Te.snorm16(t)),float16(t){return t.readFloat16()},float16x2:t=>C(t.readFloat16(),t.readFloat16()),float16x4:t=>L(t.readFloat16(),t.readFloat16(),t.readFloat16(),t.readFloat16()),float32:t=>t.readFloat32(),float32x2:t=>C(t.readFloat32(),t.readFloat32()),float32x3:t=>tn(t.readFloat32(),t.readFloat32(),t.readFloat32()),float32x4:t=>L(t.readFloat32(),t.readFloat32(),t.readFloat32(),t.readFloat32()),uint32:t=>t.readUint32(),uint32x2:t=>Oe(t.readUint32(),t.readUint32()),uint32x3:t=>Ee(t.readUint32(),t.readUint32(),t.readUint32()),uint32x4:t=>ee(t.readUint32(),t.readUint32(),t.readUint32(),t.readUint32()),sint32:t=>t.readInt32(),sint32x2:t=>Ue(t.readInt32(),t.readInt32()),sint32x3:t=>vr(t.readInt32(),t.readInt32(),t.readInt32()),sint32x4:t=>te(t.readInt32(),t.readInt32(),t.readInt32(),t.readInt32()),"unorm10-10-10-2"(t){let e=t.readUint32(),n=(e>>22)/1023,r=(e>>12&1023)/1023,i=(e>>2&1023)/1023,f=(e&3)/3;return L(n,r,i,f)},"unorm8x4-bgra"(t){let e=t.readByte()/255,n=t.readByte()/255,r=t.readByte()/255,i=t.readByte()/255;return L(r,n,e,i)},unstruct(t,e){let n={};for(let[r,i]of Object.entries(e.propTypes))n[r]=fe(t,i);return n},disarray(t,e){let n=St(e),r=[];for(let i=0;i<e.elementCount;i++)$t(t,n),r.push(fe(t,e.elementType));return $t(t,n),r},"loose-decorated"(t,e){$t(t,ue(e));let n=t.currentByteOffset,r=fe(t,e.inner);return t.seekTo(n+mt(e)),r}};function fe(t,e){let n=Te[e.type];if(!n)throw new Error(`Cannot read data of type '${e.type}'.`);return n(t,e)}var Qt=Symbol("Unknown data type");function Ui(t){return!!t&&(typeof t=="object"||typeof t=="function")&&"resolve"in t}function Lr(t){return typeof t=="number"||typeof t=="boolean"||typeof t=="string"||Ui(t)||Nr(t)||Di(t)}function nc(t){return!!t&&typeof t=="object"&&"getMappedRange"in t&&"mapAsync"in t}function rc(t,e,n){return Le(e)?new ys(t,e,n):new ys(t,e,n,["storage","uniform"])}function $r(t){return t.resourceType==="buffer"}function sc(t){return!!t.usableAsUniform}var ys=class{constructor(t,e,n,r){this._group=t,this.dataType=e,this.initialOrBuffer=n,this._disallowedUsages=r,k(this,"resourceType","buffer"),k(this,"flags",GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC),k(this,"_buffer",null),k(this,"_ownBuffer"),k(this,"_destroyed",!1),k(this,"_label"),k(this,"initial"),k(this,"usableAsUniform",!1),k(this,"usableAsStorage",!1),k(this,"usableAsVertex",!1),nc(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}get label(){return this._label}get buffer(){var t;let e=this._group.device;if(this._destroyed)throw new Error("This buffer has been destroyed");if(!this._buffer&&(this._buffer=e.createBuffer({size:mt(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:(t=this.label)!=null?t:"<unnamed>"}),this.initial)){let n=new vn(this._buffer.getMappedRange());He(n,this.dataType,this.initial),this._buffer.unmap()}return this._buffer}get destroyed(){return this._destroyed}$name(t){return this._label=t,this._buffer&&(this._buffer.label=t),this}$usage(...t){var e;for(let n of t){if((e=this._disallowedUsages)!=null&&e.includes(n))throw new Error(`Buffer of type ${this.dataType} cannot be used as ${n}`);this.flags|=n==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=n==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=n==="vertex"?GPUBufferUsage.VERTEX:0,this.usableAsUniform=this.usableAsUniform||n==="uniform",this.usableAsStorage=this.usableAsStorage||n==="storage",this.usableAsVertex=this.usableAsVertex||n==="vertex"}return this}$addFlags(t){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return t&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):t&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=t,this)}write(t){let e=this.buffer,n=this._group.device;if(e.mapState==="mapped"){let f=e.getMappedRange();He(new vn(f),this.dataType,t);return}let r=mt(this.dataType);this._group.flush();let i=new ArrayBuffer(r);He(new vn(i),this.dataType,t),n.queue.writeBuffer(e,0,i,0,r)}copyFrom(t){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let e=mt(this.dataType);this._group.commandEncoder.copyBufferToBuffer(t.buffer,0,this.buffer,0,e)}async read(){this._group.flush();let t=this.buffer,e=this._group.device;if(t.mapState==="mapped"){let f=t.getMappedRange();return fe(new xn(f),this.dataType)}if(t.usage&GPUBufferUsage.MAP_READ){await t.mapAsync(GPUMapMode.READ);let f=t.getMappedRange(),w=fe(new xn(f),this.dataType);return t.unmap(),w}let n=e.createBuffer({size:mt(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),r=e.createCommandEncoder();r.copyBufferToBuffer(t,0,n,0,mt(this.dataType)),e.queue.submit([r.finish()]),await e.queue.onSubmittedWorkDone(),await n.mapAsync(GPUMapMode.READ,0,mt(this.dataType));let i=fe(new xn(n.getMappedRange()),this.dataType);return n.unmap(),n.destroy(),i}destroy(){var t;this._destroyed||(this._destroyed=!0,this._ownBuffer&&((t=this._buffer)==null||t.destroy()))}toString(){var t;return`buffer:${(t=this._label)!=null?t:"<unnamed>"}`}};function ms(t){return!!(t!=null&&t.usableAsStorage)}var ic=class Oi extends Error{constructor(e){var n;super(`Resource '${(n=e.label)!=null?n:"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,Oi.prototype)}};function oc(t){return t?.resourceType==="buffer-usage"}var ac={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},gs=class{constructor(e,n,r){this.usage=e,this.dataType=n,this._membership=r,k(this,"~repr"),k(this,"resourceType","buffer-usage")}get label(){return this._membership.key}resolve(e){let n=e.names.makeUnique(this.label),r=e.allocateLayoutEntry(this._membership.layout),i=ac[this.usage];return e.addDeclaration(`@group(${r}) @binding(${this._membership.idx}) var<${i}> ${n}: ${e.resolve(this.dataType)};`),n}toString(){var e;return`${this.usage}:${(e=this.label)!=null?e:"<unnamed>"}`}get value(){if(!we())throw new Error("Cannot access buffer's value directly in JS.");return this}},uc=class{constructor(t){this._membership=t,k(this,"resourceType","sampler")}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: sampler;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},cc=class{constructor(t){this._membership=t,k(this,"resourceType","sampler-comparison")}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: sampler_comparison;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},lc={r8unorm:I,r8snorm:I,r8uint:dt,r8sint:Zt,r16uint:dt,r16sint:Zt,r16float:I,rg8unorm:I,rg8snorm:I,rg8uint:dt,rg8sint:Zt,r32uint:dt,r32sint:Zt,r32float:I,rg16uint:dt,rg16sint:Zt,rg16float:I,rgba8unorm:I,"rgba8unorm-srgb":I,rgba8snorm:I,rgba8uint:dt,rgba8sint:Zt,bgra8unorm:I,"bgra8unorm-srgb":I,rgb9e5ufloat:I,rgb10a2uint:dt,rgb10a2unorm:I,rg11b10ufloat:I,rg32uint:dt,rg32sint:Zt,rg32float:I,rgba16uint:dt,rgba16sint:Zt,rgba16float:I,rgba32uint:dt,rgba32sint:Zt,rgba32float:I,stencil8:I,depth16unorm:I,depth24plus:I,"depth24plus-stencil8":I,depth32float:I,"depth32float-stencil8":I,"bc1-rgba-unorm":I,"bc1-rgba-unorm-srgb":I,"bc2-rgba-unorm":I,"bc2-rgba-unorm-srgb":I,"bc3-rgba-unorm":I,"bc3-rgba-unorm-srgb":I,"bc4-r-unorm":I,"bc4-r-snorm":I,"bc5-rg-unorm":I,"bc5-rg-snorm":I,"bc6h-rgb-ufloat":I,"bc6h-rgb-float":I,"bc7-rgba-unorm":I,"bc7-rgba-unorm-srgb":I,"etc2-rgb8unorm":I,"etc2-rgb8unorm-srgb":I,"etc2-rgb8a1unorm":I,"etc2-rgb8a1unorm-srgb":I,"etc2-rgba8unorm":I,"etc2-rgba8unorm-srgb":I,"eac-r11unorm":I,"eac-r11snorm":I,"eac-rg11unorm":I,"eac-rg11snorm":I,"astc-4x4-unorm":I,"astc-4x4-unorm-srgb":I,"astc-5x4-unorm":I,"astc-5x4-unorm-srgb":I,"astc-5x5-unorm":I,"astc-5x5-unorm-srgb":I,"astc-6x5-unorm":I,"astc-6x5-unorm-srgb":I,"astc-6x6-unorm":I,"astc-6x6-unorm-srgb":I,"astc-8x5-unorm":I,"astc-8x5-unorm-srgb":I,"astc-8x6-unorm":I,"astc-8x6-unorm-srgb":I,"astc-8x8-unorm":I,"astc-8x8-unorm-srgb":I,"astc-10x5-unorm":I,"astc-10x5-unorm-srgb":I,"astc-10x6-unorm":I,"astc-10x6-unorm-srgb":I,"astc-10x8-unorm":I,"astc-10x8-unorm-srgb":I,"astc-10x10-unorm":I,"astc-10x10-unorm-srgb":I,"astc-12x10-unorm":I,"astc-12x10-unorm-srgb":I,"astc-12x12-unorm":I,"astc-12x12-unorm-srgb":I},Xn={rgba8unorm:L,rgba8snorm:L,rgba8uint:ee,rgba8sint:te,rgba16uint:ee,rgba16sint:te,rgba16float:L,r32uint:ee,r32sint:te,r32float:L,rg32uint:ee,rg32sint:te,rg32float:L,rgba32uint:ee,rgba32sint:te,rgba32float:L,bgra8unorm:L},fc={f32:"float",u32:"uint",i32:"sint"},dc={float:I,"unfilterable-float":I,uint:dt,sint:Zt,depth:I};function hc(t,e){return new yc(t,e)}function Zn(t){return t?.resourceType==="texture"}function pc(t){return t?.resourceType==="texture-storage-view"}function wc(t){return t?.resourceType==="texture-sampled-view"}var Ei={mutable:"read_write",readonly:"read",writeonly:"write"},yc=class{constructor(t,e){this.props=t,this._branch=e,k(this,"resourceType","texture"),k(this,"usableAsSampled",!1),k(this,"usableAsStorage",!1),k(this,"usableAsRender",!1),k(this,"_destroyed",!1),k(this,"_label"),k(this,"_flags",GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC),k(this,"_texture",null)}get label(){return this._label}$name(t){return this._label=t,this}unwrap(){var t,e,n,r,i;if(this._destroyed)throw new Error("This texture has been destroyed");return this._texture||(this._texture=this._branch.device.createTexture({label:(t=this._label)!=null?t:"<unnamed>",format:this.props.format,size:this.props.size,usage:this._flags,dimension:(e=this.props.dimension)!=null?e:"2d",viewFormats:(n=this.props.viewFormats)!=null?n:[],mipLevelCount:(r=this.props.mipLevelCount)!=null?r:1,sampleCount:(i=this.props.sampleCount)!=null?i:1})),this._texture}$usage(...t){let e=t.includes("storage"),n=t.includes("sampled"),r=t.includes("render");return this._flags|=n?GPUTextureUsage.TEXTURE_BINDING:0,this._flags|=e?GPUTextureUsage.STORAGE_BINDING:0,this._flags|=r?GPUTextureUsage.RENDER_ATTACHMENT:0,this.usableAsStorage||(this.usableAsStorage=e),this.usableAsSampled||(this.usableAsSampled=n),this.usableAsRender||(this.usableAsRender=r),this}createView(t,e){if(t==="sampled")return this._asSampled(e);let n=e;switch(t){case"mutable":return this._asMutable(n);case"readonly":return this._asReadonly(n);case"writeonly":return this._asWriteonly(n)}}_asStorage(t,e){var n;if(!this.usableAsStorage)throw new Error("Unusable as storage");let r=(n=t?.format)!=null?n:this.props.format,i=Xn[r];return En(!!i),new mc(t??{},e,this)}_asReadonly(t){return this._asStorage(t,"readonly")}_asWriteonly(t){return this._asStorage(t,"writeonly")}_asMutable(t){return this._asStorage(t,"mutable")}_asSampled(t){var e;if(!this.usableAsSampled)throw new Error("Unusable as sampled");let n=(e=t?.format)!=null?e:this.props.format;if(!Xn[n])throw new Error(`Unsupported storage texture format: ${n}`);return new xc(t,this)}destroy(){var t;this._destroyed||(this._destroyed=!0,(t=this._texture)==null||t.destroy())}},ur={"1d":"1d","2d":"2d","2d-array":"2d_array",cube:"cube","cube-array":"cube_array","3d":"3d"},mc=class{constructor(t,e,n){this.access=e,this._texture=n,k(this,"resourceType","texture-storage-view"),k(this,"texelDataType"),k(this,"dimension"),k(this,"_view"),k(this,"_format");var r,i,f;this.dimension=(i=(r=t?.dimension)!=null?r:n.props.dimension)!=null?i:"2d",this._format=(f=t?.format)!=null?f:n.props.format,this.texelDataType=Xn[this._format]}get label(){return this._texture.label}$name(t){return this._texture.$name(t),this}unwrap(){var t;return this._view||(this._view=this._texture.unwrap().createView({label:`${(t=this.label)!=null?t:"<unnamed>"} - View`,format:this._format,dimension:this.dimension})),this._view}resolve(t){let e=t.names.makeUnique(this.label),{group:n,binding:r}=t.allocateFixedEntry({storageTexture:this._format,access:this.access,viewDimension:this.dimension},this),i=`texture_storage_${ur[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${r}) var ${e}: ${i}<${this._format}, ${Ei[this.access]}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},gc=class{constructor(t,e,n,r){this._format=t,this.dimension=e,this.access=n,this._membership=r,k(this,"resourceType","texture-storage-view"),k(this,"texelDataType"),this.texelDataType=Xn[this._format]}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=`texture_storage_${ur[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: ${r}<${this._format}, ${Ei[this.access]}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},xc=class{constructor(t,e){this._props=t,this._texture=e,k(this,"resourceType","texture-sampled-view"),k(this,"channelDataType"),k(this,"dimension"),k(this,"_format"),k(this,"_view");var n,r,i;this.dimension=(r=(n=t?.dimension)!=null?n:e.props.dimension)!=null?r:"2d",this._format=(i=t?.format)!=null?i:e.props.format,this.channelDataType=lc[this._format]}get label(){return this._texture.label}$name(t){return this._texture.$name(t),this}unwrap(){var t;return this._view||(this._view=this._texture.unwrap().createView(De({label:`${(t=this.label)!=null?t:"<unnamed>"} - View`},this._props))),this._view}resolve(t){var e;let n=t.names.makeUnique(this.label),r=((e=this._texture.props.sampleCount)!=null?e:1)>1,{group:i,binding:f}=t.allocateFixedEntry({texture:fc[this.channelDataType.type],viewDimension:this.dimension,multisampled:r},this),w=r?"texture_multisampled_2d":`texture_${ur[this.dimension]}`;return t.addDeclaration(`@group(${i}) @binding(${f}) var ${n}: ${w}<${t.resolve(this.channelDataType)}>;`),n}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}},vc=class{constructor(t,e,n,r){this.dimension=e,this._multisampled=n,this._membership=r,k(this,"resourceType","texture-sampled-view"),k(this,"channelDataType"),this.channelDataType=dc[t]}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout),r=this._multisampled?"texture_multisampled_2d":`texture_${ur[this.dimension]}`;return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: ${r}<${t.resolve(this.channelDataType)}>;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}};function bc(t){return!!(t!=null&&t.usableAsSampled)}var _c=class ki extends Error{constructor(e){var n;super(`Resource '${(n=e.label)!=null?n:"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,ki.prototype)}},$c=class{constructor(t){this._membership=t,k(this,"resourceType","external-texture")}get label(){return this._membership.key}resolve(t){let e=t.names.makeUnique(this.label),n=t.allocateLayoutEntry(this._membership.layout);return t.addDeclaration(`@group(${n}) @binding(${this._membership.idx}) var ${e}: texture_external;`),e}toString(){var t;return`${this.resourceType}:${(t=this.label)!=null?t:"<unnamed>"}`}};function Ai(t){return new Mc(t)}function Ii(t){return!!t&&t.resourceType==="bind-group-layout"}function Sc(t){return!!t&&t.resourceType==="bind-group"}var Tc=class Pi extends Error{constructor(e,n){super(`Bind group '${e??"<unnamed>"}' is missing a required binding '${n}'`),Object.setPrototypeOf(this,Pi.prototype)}},xs=["compute"],ze=["compute","vertex","fragment"],Mc=class{constructor(e){this.entries=e,k(this,"_label"),k(this,"_index"),k(this,"resourceType","bind-group-layout"),k(this,"bound",{});var n,r,i,f,w;let g=0;for(let[D,U]of Object.entries(e)){if(U===null){g++;continue}let A={idx:g,key:D,layout:this};if("uniform"in U&&(this.bound[D]=new gs("uniform",U.uniform,A)),"storage"in U){let P="type"in U.storage?U.storage:U.storage(0);this.bound[D]=new gs((n=U.access)!=null?n:"readonly",P,A)}"texture"in U&&(this.bound[D]=new vc(U.texture,(r=U.viewDimension)!=null?r:"2d",(i=U.multisampled)!=null?i:!1,A)),"storageTexture"in U&&(this.bound[D]=new gc(U.storageTexture,(f=U.viewDimension)!=null?f:"2d",(w=U.access)!=null?w:"writeonly",A)),"externalTexture"in U&&(this.bound[D]=new $c(A)),"sampler"in U&&(U.sampler==="comparison"?this.bound[D]=new cc(A):this.bound[D]=new uc(A)),g++}}get label(){return this._label}get index(){return this._index}$name(e){return this._label=e,this}$idx(e){return this._index=e,this}unwrap(e){var n;return e.device.createBindGroupLayout({label:(n=this.label)!=null?n:"<unnamed>",entries:Object.values(this.entries).map((r,i)=>{var f,w,g,D;if(r===null)return null;let U=r.visibility,A={binding:i,visibility:0};if("uniform"in r)U=U??ze,A.buffer={type:"uniform"};else if("storage"in r)U=U??(r.access==="mutable"?xs:ze),A.buffer={type:r.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in r)U=U??ze,A.sampler={type:r.sampler};else if("texture"in r)U=U??ze,A.texture={sampleType:r.texture,viewDimension:(f=r.viewDimension)!=null?f:"2d",multisampled:(w=r.multisampled)!=null?w:!1};else if("storageTexture"in r){let P=(g=r.access)!=null?g:"writeonly";U=U??(P==="readonly"?ze:xs),A.storageTexture={format:r.storageTexture,access:{mutable:"read-write",readonly:"read-only",writeonly:"write-only"}[P],viewDimension:(D=r.viewDimension)!=null?D:"2d"}}else"externalTexture"in r&&(U=U??ze,A.externalTexture={});return U!=null&&U.includes("compute")&&(A.visibility|=GPUShaderStage.COMPUTE),U!=null&&U.includes("vertex")&&(A.visibility|=GPUShaderStage.VERTEX),U!=null&&U.includes("fragment")&&(A.visibility|=GPUShaderStage.FRAGMENT),A}).filter(r=>r!==null)})}populate(e){return new Gr(this,e)}},Gr=class{constructor(t,e){this.layout=t,this.entries=e,k(this,"resourceType","bind-group");for(let n of Object.keys(t.entries))if(t.entries[n]!==null&&!(n in e))throw new Tc(t.label,n)}unwrap(t){var e;return t.device.createBindGroup({label:(e=this.layout.label)!=null?e:"<unnamed>",layout:t.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([n,r],i)=>{var f;if(r===null)return null;let w=this.entries[n];if(w===void 0)throw new Error(`'${n}' is a resource required to populate bind group layout '${(f=this.layout.label)!=null?f:"<unnamed>"}'.`);if("uniform"in r){let g;if($r(w)){if(!sc(w))throw new ns(w);g={buffer:t.unwrap(w)}}else g={buffer:w};return{binding:i,resource:g}}if("storage"in r){let g;if($r(w)){if(!ms(w))throw new ns(w);g={buffer:t.unwrap(w)}}else g={buffer:w};return{binding:i,resource:g}}if("texture"in r){let g;if(Zn(w)){if(!bc(w))throw new _c(w);g=t.unwrap(w.createView("sampled"))}else g=w;return{binding:i,resource:g}}if("storageTexture"in r){let g;if(Zn(w)){if(!ms(w))throw new ic(w);r.access==="readonly"?g=t.unwrap(w.createView("readonly")):r.access==="mutable"?g=t.unwrap(w.createView("mutable")):g=t.unwrap(w.createView("writeonly"))}else g=w;return{binding:i,resource:g}}if("externalTexture"in r||"sampler"in r)return{binding:i,resource:w};throw new Error(`Malformed bind group entry: ${w} (${JSON.stringify(w)})`)}).filter(n=>n!==null)})}};function Dc(t,e){throw new Error(`Failed to handle ${t} at ${e}`)}var Uc=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"];function Oc(t){return Uc.includes(t.type)}function Ec(t,[e,n]){return`  ${gu(n)}${e}: ${t.resolve(n)},
`}function kc(t,e){let n=t.names.makeUnique(e.label);return t.addDeclaration(`
struct ${n} {
${Object.entries(e.propTypes).map(r=>Ec(t,r)).join("")}}
`),n}function Ac(t,e){let n=t.resolve(e.elementType);return e.elementCount===0?`array<${n}>`:`array<${n}, ${e.elementCount}>`}function Fi(t,e){if(Oc(e))return e.type;if(e.type==="struct")return kc(t,e);if(e.type==="array")return Ac(t,e);if(e.type==="atomic")return`atomic<${Fi(t,e.inner)}>`;if(e.type==="decorated")return t.resolve(e.inner);Dc(e,"resolveData")}function*Ic(t){let e=0;for(;;)t.has(e)||(yield e),e++}var Pc=["==","!=","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"];function Vt(t,e){return Lr(e.value)||Le(e.value)?t.resolve(e.value):String(e.value)}function Fc(t){throw new Error(`'${JSON.stringify(t)}' was not handled by the WGSL generator.`)}function zi(t,e){return e?{value:"true",dataType:rs}:{value:"false",dataType:rs}}function Bi(t,e){return`${t.indent()}{
${e.b.map(n=>Tr(t,n)).join(`
`)}
${t.dedent()}}`}function Sr(t,e){return t.getById(e)}function Kt(t,e){if(typeof e=="string")return Sr(t,e);if(typeof e=="boolean")return zi(t,e);if("x"in e){let[n,r,i]=e.x,f=Vt(t,Kt(t,n)),w=Vt(t,Kt(t,i));return{value:Pc.includes(r)?`(${f} ${r} ${w})`:`${f} ${r} ${w}`,dataType:Qt}}if("u"in e){let[n,r]=e.u,i=Vt(t,Kt(t,r));return{value:`${n}${i}`,dataType:Qt}}if("a"in e){let[n,r]=e.a,i=Kt(t,n),f=Vt(t,Kt(t,r));if(typeof i.value=="string")return{value:`${i.value}.${f}`,dataType:Qt};if(Lr(i.value))return f==="value"?{value:Vt(t,i),dataType:Qt}:{value:i.value[f],dataType:Qt};if(typeof i.value=="object")return{value:i.value[f],dataType:Qt};throw new Error(`Cannot access member ${f} of ${i.value}`)}if("i"in e){let[n,r]=e.i,i=Vt(t,Kt(t,n)),f=Vt(t,Kt(t,r));return{value:`${i}[${f}]`,dataType:Qt}}if("n"in e)return{value:e.n,dataType:Qt};if("f"in e){let[n,r]=e.f,i=Kt(t,n).value,f=r.map(w=>Kt(t,w)).map(w=>Vt(t,w));return typeof i=="string"?{value:`${i}(${f.join(", ")})`,dataType:Qt}:{value:i(...f),dataType:Qt}}Fc(e)}function Tr(t,e){if(typeof e=="string")return`${t.pre}${Vt(t,Sr(t,e))};`;if(typeof e=="boolean")return`${t.pre}${Vt(t,zi(t,e))};`;if("r"in e)return e.r===null?`${t.pre}return;`:`${t.pre}return ${Vt(t,Kt(t,e.r))};`;if("q"in e){let[n,r,i]=e.q,f=Vt(t,Kt(t,n));t.indent();let w=Tr(t,r);t.dedent(),t.indent();let g=i?Tr(t,i):void 0;return t.dedent(),g?`${t.pre}if (${f})
${w}
${t.pre}else
${g}`:`${t.pre}if (${f})
${w}`}if("l"in e||"c"in e){let[n,r]="l"in e?e.l:e.c,i=Vt(t,Sr(t,n)),f=r?Kt(t,r):void 0;if(!f)throw new Error("Cannot create variable without an initial value.");return`${t.pre}var ${i} = ${Vt(t,f)};`}return"b"in e?Bi(t,e):`${t.pre}${Vt(t,Kt(t,e))};`}function zc(t,e){return Bi(t,e)}var ji="#CATCHALL#",Bc=class{constructor(){k(this,"_stack",[]),k(this,"_itemDepth",0)}get itemDepth(){return this._itemDepth}get topItem(){let t=this._stack[this._stack.length-1];if(!t||t.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return t}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}pushSlotBindings(t){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(t)})}pushFunctionScope(t,e,n){this._stack.push({type:"functionScope",args:t,returnType:e,externalMap:n})}pop(){let t=this._stack.pop();t?.type==="item"&&this._itemDepth--}readSlot(t){for(let e=this._stack.length-1;e>=0;--e){let n=this._stack[e];if(n?.type==="item")n.usedSlots.add(t);else if(n?.type==="slotBinding"){let r=n.bindingMap.get(t);if(r!==void 0)return r}else if(!(n?.type==="functionScope"||n?.type==="blockScope"))throw new Error("Unknown layer type.")}return t.defaultValue}getResourceById(t){for(let e=this._stack.length-1;e>=0;--e){let n=this._stack[e];if(n?.type==="functionScope"){let r=n.args.find(f=>f.value===t);if(r!==void 0)return r;let i=n.externalMap[t];return i!==void 0?{value:i,dataType:Qt}:void 0}if(n?.type==="blockScope"){let r=n.declarations.get(t);if(r!==void 0)return{value:t,dataType:r}}}}},_n=["","  ","    ","      ","        ","          ","            ","              ","                "],hr=_n.length-1,jc=class{constructor(){k(this,"identLevel",0)}get pre(){var t;return(t=_n[this.identLevel])!=null?t:_n[hr].repeat(this.identLevel/hr)+_n[this.identLevel%hr]}indent(){let t=this.pre;return this.identLevel++,t}dedent(){return this.identLevel--,this.pre}},Rc=class{constructor(t){k(this,"_memoizedResolves",new WeakMap),k(this,"_memoizedDerived",new WeakMap),k(this,"_indentController",new jc),k(this,"_jitTranspiler"),k(this,"_itemStateStack",new Bc),k(this,"_declarations",[]),k(this,"bindGroupLayoutsToPlaceholderMap",new Map),k(this,"_nextFreeLayoutPlaceholderIdx",0),k(this,"fixedBindings",[]),k(this,"names"),this.names=t.names,this._jitTranspiler=t.jitTranspiler}get pre(){return this._indentController.pre}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}getById(t){var e;return(e=this._itemStateStack.getResourceById(t))!=null?e:{value:t,dataType:Qt}}transpileFn(t){if(!this._jitTranspiler)throw new Error("Tried to execute a tgpu.fn function without providing a JIT transpiler, or transpiling at build time.");return this._jitTranspiler.transpileFn(t)}fnToWgsl(t){this._itemStateStack.pushFunctionScope(t.args,t.returnType,t.externalMap);let e=zc(this,t.body);this._itemStateStack.pop();let n=t.args.map(r=>`${r.value}: ${this.resolve(r.dataType)}`).join(", ");return{head:t.returnType!==void 0?`(${n}) -> ${this.resolve(t.returnType)}`:`(${n})`,body:e}}addDeclaration(t){this._declarations.push(t)}allocateLayoutEntry(t){let e=this.bindGroupLayoutsToPlaceholderMap,n=e.get(t);return n||(n=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,e.set(t,n)),n}allocateFixedEntry(t,e){let n=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:t,resource:e}),{group:ji,binding:n}}readSlot(t){let e=this._itemStateStack.readSlot(t);if(e===void 0)throw new Fo(t);return e}withSlots(t,e){this._itemStateStack.pushSlotBindings(t);try{return e()}finally{this._itemStateStack.pop()}}unwrap(t){let e=t;for(;;)if(Nr(e))e=this.readSlot(e);else if(Di(e))e=this._getOrCompute(e);else break;return e}_getOrCompute(t){var e;let n=(e=this._memoizedDerived.get(t))!=null?e:[];this._itemStateStack.pushItem();try{for(let f of n)if([...f.slotToValueMap.entries()].every(([w,g])=>w.areEqual(this._itemStateStack.readSlot(w),g)))return f.result;let r=t["~compute"](),i=new Map;for(let f of this._itemStateStack.topItem.usedSlots)i.set(f,this._itemStateStack.readSlot(f));return n.push({slotToValueMap:i,result:r}),this._memoizedDerived.set(t,n),r}catch(r){throw r instanceof yn?r.appendToTrace(t):new yn(r,[t])}finally{this._itemStateStack.pop()}}_getOrInstantiate(t){var e;let n=(e=this._memoizedResolves.get(t))!=null?e:[];this._itemStateStack.pushItem();try{for(let f of n)if([...f.slotToValueMap.entries()].every(([w,g])=>w.areEqual(this._itemStateStack.readSlot(w),g)))return f.result;let r=Le(t)?Fi(this,t):t.resolve(this),i=new Map;for(let f of this._itemStateStack.topItem.usedSlots)i.set(f,this._itemStateStack.readSlot(f));return n.push({slotToValueMap:i,result:r}),this._memoizedResolves.set(t,n),r}catch(r){throw r instanceof yn?r.appendToTrace(t):new yn(r,[t])}finally{this._itemStateStack.pop()}}resolve(t){let e=this.unwrap(t);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return String(e);if(this._itemStateStack.itemDepth===0){let n=Bo(this,()=>this._getOrInstantiate(e));return`${[...this._declarations].join(`

`)}${n}`}return this._getOrInstantiate(e)}resolveValue(t,e){if(Lr(t))return this.resolve(t);if(Pr(e))return`array(${t.map(n=>this.resolveValue(n,e.elementType))})`;if(Ge(e))return`${this.resolve(e)}(${Object.entries(e.propTypes).map(([n,r])=>this.resolveValue(t[n],r))})`;throw new Error(`Value ${t} of schema ${e} is not resolvable to WGSL`)}};function qr(t,e){var n;let r=new Rc(e),i=r.resolve(t),f=r.bindGroupLayoutsToPlaceholderMap,w=[],g=new Set([...f.keys()].map(F=>F.index).filter(F=>F!==void 0)),D=Ic(g),U=r.fixedBindings.map((F,z)=>[String(z),F.layoutEntry]),A=()=>{let F=D.next().value,z=Ai(Object.fromEntries(U));return w[F]=z,i=i.replaceAll(ji,String(F)),[F,new Gr(z,Object.fromEntries(r.fixedBindings.map((B,j)=>[String(j),B.resource])))]},P=U.length>0?A():null;for(let[F,z]of f.entries()){let B=(n=F.index)!=null?n:D.next().value;w[B]=F,i=i.replaceAll(z,String(B))}return{code:i,bindGroupLayouts:w,catchall:P}}function Nc(t){return!!t&&(typeof t=="object"||typeof t=="function")&&"$name"in t}function Kn(t,e){for(let[n,r]of Object.entries(e))t[n]=r,Nc(r)&&(!("label"in r)||r.label===void 0)&&r.$name(n)}function Cr(t,e,n){return Object.entries(e).reduce((r,[i,f])=>{let w=Ui(f)||Le(f)||Nr(f)?t.resolve(f):String(f);return r.replaceAll(new RegExp(`(?<![\\w_])${i}(?![\\w_])`,"g"),w)},n)}function Vc(t){let{externals:e,template:n,names:r,unstable_jitTranspiler:i}=t,f={};Kn(f,e??{});let w={resolve(D){return Cr(D,f,n??"")},toString:()=>"<root>"},{code:g}=qr(w,{names:r==="strict"?new Rr:new jr,jitTranspiler:i});return g}function Lc(t,e="vertex"){return new qc(t,e)}function Gc(t){return t?.resourceType==="vertex-layout"}function $n(t,e,n){if(qe(e)||Ie(e))return $n(t,e.inner,xe(n,ue(e)));if(Ge(e)){let r=n;return Object.fromEntries(Object.entries(e.propTypes).map(([i,f])=>{r=xe(r,St(f));let w=[i,$n(t,f,r)];return r+=mt(f),w}))}if(sr(e)){let r=n;return Object.fromEntries(Object.entries(e.propTypes).map(([i,f])=>{r=xe(r,ue(f));let w=[i,$n(t,f,r)];return r+=mt(f),w}))}if("type"in e&&typeof e.type=="string"){if(ui.includes(e.type))return{_layout:t,format:e.type,offset:n};let r=Ha[e.type];if(r)return{_layout:t,format:r,offset:n}}throw new Error(`Unsupported data used in vertex layout: ${String(e)}`)}var qc=class{constructor(t,e){this.schemaForCount=t,this.stepMode=e,k(this,"resourceType","vertex-layout"),k(this,"stride"),k(this,"attrib"),k(this,"_label");let n=t(0);this.stride=xe(mt(n.elementType),St(n)),this.attrib=$n(this,n.elementType,0)}get label(){return this._label}$name(t){return this._label=t,this}},vs=class{constructor(e){this._make=e,k(this,"_map",new WeakMap)}getOrMake(e,...n){if(this._map.has(e))return this._map.get(e);let r=this._make(e,...n);return this._map.set(e,r),r}};function Cc(t,e,n){return new Yc(new Xc(t,e,n),{})}function Wc(t){return t?.resourceType==="compute-pipeline"}var Yc=class Ri{constructor(e,n){this._core=e,this._priors=n,k(this,"resourceType","compute-pipeline")}get label(){return this._core.label}get rawPipeline(){return this._core.unwrap().pipeline}with(e,n){var r;return new Ri(this._core,{bindGroupLayoutMap:new Map([...(r=this._priors.bindGroupLayoutMap)!=null?r:[],[e,n]])})}dispatchWorkgroups(e,n,r){var i;let f=this._core.unwrap(),w=this._core.branch.commandEncoder.beginComputePass({label:(i=this._core.label)!=null?i:"<unnamed>"});w.setPipeline(f.pipeline),f.bindGroupLayouts.forEach((g,D)=>{var U;if(f.catchall&&D===f.catchall[0])w.setBindGroup(D,this._core.branch.unwrap(f.catchall[1]));else{let A=(U=this._priors.bindGroupLayoutMap)==null?void 0:U.get(g);if(A===void 0)throw new Fs(g.label);w.setBindGroup(D,this._core.branch.unwrap(A))}}),w.dispatchWorkgroups(e,n,r),w.end()}$name(e){return this._core.label=e,this}},Xc=class{constructor(t,e,n){this.branch=t,this._slotBindings=e,this._entryFn=n,k(this,"label"),k(this,"_memo")}unwrap(){var t,e,n,r,i;if(this._memo===void 0){let f=this.branch.device,{code:w,bindGroupLayouts:g,catchall:D}=qr({resolve:U=>(U.withSlots(this._slotBindings,()=>{U.resolve(this._entryFn)}),""),toString:()=>{var U;return`computePipeline:${(U=this.label)!=null?U:"<unnamed>"}`}},{names:this.branch.nameRegistry,jitTranspiler:this.branch.jitTranspiler});D!==null&&((e=g[D[0]])==null||e.$name(`${(t=this.label)!=null?t:"<unnamed>"} - Automatic Bind Group & Layout`)),this._memo={pipeline:f.createComputePipeline({label:(n=this.label)!=null?n:"<unnamed>",layout:f.createPipelineLayout({label:`${(r=this.label)!=null?r:"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:g.map(U=>this.branch.unwrap(U))}),compute:{module:f.createShaderModule({label:`${(i=this.label)!=null?i:"<unnamed>"} - Shader`,code:w})}}),bindGroupLayouts:g,catchall:D}}return this._memo}};function Zc(t){return typeof t?.format=="string"}function Kc(t,e){var n,r;let i=[];if(ir(t)){if(!Zc(e))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return i.push(e._layout),{usedVertexLayouts:i,bufferDefinitions:[{arrayStride:e._layout.stride,stepMode:e._layout.stepMode,attributes:[{format:e.format,offset:e.offset,shaderLocation:(n=br(t))!=null?n:0}]}]}}let f=[],w=new WeakMap,g=0;for(let[D,U]of Object.entries(t)){if(fi(U))continue;let A=e[D];if(!A)throw new Error(`An attribute by the name of '${D}' was not provided to the shader.`);let P=A._layout,F=w.get(P);F||(i.push(P),F=[],f.push({arrayStride:P.stride,stepMode:P.stepMode,attributes:F}),w.set(P,F)),g=(r=br(U))!=null?r:g,F.push({format:A.format,offset:A.offset,shaderLocation:g++})}return{usedVertexLayouts:i,bufferDefinitions:f}}function Hc(t){return typeof t?.loadOp=="string"}function Jc(t,e){if(ir(t)){if(!Hc(e))throw new Error("Expected a single color attachment, not a record.");return[e]}let n=[];for(let r of Object.keys(t)){let i=e[r];if(!i)throw new Error(`A color attachment by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function Qc(t){return typeof t?.format=="string"}function tl(t,e){if(ir(t)){if(!Qc(e))throw new Error("Expected a single color target configuration, not a record.");return[e]}let n=[];for(let r of Object.keys(t)){let i=e[r];if(!i)throw new Error(`A color target by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function el(t){return new nl(new rl(t),{})}var nl=class Sn{constructor(e,n){this._core=e,this._priors=n,k(this,"resourceType","render-pipeline")}get label(){return this._core.label}$name(e){return this._core.label=e,this}with(e,n){var r,i;if(Ii(e))return new Sn(this._core,Be(De({},this._priors),{bindGroupLayoutMap:new Map([...(r=this._priors.bindGroupLayoutMap)!=null?r:[],[e,n]])}));if(Gc(e))return new Sn(this._core,Be(De({},this._priors),{vertexLayoutMap:new Map([...(i=this._priors.vertexLayoutMap)!=null?i:[],[e,n]])}));throw new Error("Unsupported value passed into .with()")}withColorAttachment(e){return new Sn(this._core,Be(De({},this._priors),{colorAttachment:e}))}draw(e,n,r,i){var f,w;let g=this._core.unwrap(),{branch:D,fragmentFn:U}=this._core.options,A=Jc(U.shell.returnType,(f=this._priors.colorAttachment)!=null?f:{}).map(F=>Zn(F.view)?Be(De({},F),{view:D.unwrap(F.view).createView()}):F),P=D.commandEncoder.beginRenderPass({label:(w=this._core.label)!=null?w:"<unnamed>",colorAttachments:A});P.setPipeline(g.pipeline),g.bindGroupLayouts.forEach((F,z)=>{var B;if(g.catchall&&z===g.catchall[0])P.setBindGroup(z,D.unwrap(g.catchall[1]));else{let j=(B=this._priors.bindGroupLayoutMap)==null?void 0:B.get(F);if(j===void 0)throw new Fs(F.label);P.setBindGroup(z,D.unwrap(j))}}),this._core.usedVertexLayouts.forEach((F,z)=>{var B,j;let q=(B=this._priors.vertexLayoutMap)==null?void 0:B.get(F);if(!q)throw new Error(`Missing vertex buffer for layout '${(j=F.label)!=null?j:"<unnamed>"}'. Please provide it using pipeline.with(layout, buffer).(...)`);P.setVertexBuffer(z,D.unwrap(q))}),P.draw(e,n,r,i),P.end()}},rl=class{constructor(t){this.options=t,k(this,"label"),k(this,"usedVertexLayouts"),k(this,"_memo"),k(this,"_vertexBufferLayouts"),k(this,"_targets");let e=Kc(t.vertexFn.shell.argTypes[0],t.vertexAttribs);this._vertexBufferLayouts=e.bufferDefinitions,this.usedVertexLayouts=e.usedVertexLayouts,this._targets=tl(t.fragmentFn.shell.returnType,t.targets)}unwrap(){var t,e,n,r,i;if(this._memo===void 0){let{branch:f,vertexFn:w,fragmentFn:g,slotBindings:D,primitiveState:U}=this.options,{code:A,bindGroupLayouts:P,catchall:F}=qr({resolve:j=>(j.withSlots(D,()=>{j.resolve(w),j.resolve(g)}),""),toString:()=>{var j;return`renderPipeline:${(j=this.label)!=null?j:"<unnamed>"}`}},{names:f.nameRegistry,jitTranspiler:f.jitTranspiler});F!==null&&((e=P[F[0]])==null||e.$name(`${(t=this.label)!=null?t:"<unnamed>"} - Automatic Bind Group & Layout`));let z=f.device,B=z.createShaderModule({label:`${(n=this.label)!=null?n:"<unnamed>"} - Shader`,code:A});this._memo={pipeline:z.createRenderPipeline({label:(r=this.label)!=null?r:"<unnamed>",layout:z.createPipelineLayout({label:`${(i=this.label)!=null?i:"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:P.map(j=>f.unwrap(j))}),vertex:{module:B,buffers:this._vertexBufferLayouts},fragment:{module:B,targets:this._targets},primitive:U??{}}),bindGroupLayouts:P,catchall:F}}return this._memo}},sl=class Ni{constructor(e,n){this._getRoot=e,this._slotBindings=n}with(e,n){return new Ni(this._getRoot,[...this._slotBindings,[Vr(e)?e.slot:e,n]])}withCompute(e){return new il(this._getRoot(),this._slotBindings,e)}withVertex(e,n){return new ol({branch:this._getRoot(),primitiveState:void 0,slotBindings:this._slotBindings,vertexFn:e,vertexAttribs:n})}},il=class{constructor(t,e,n){this._root=t,this._slotBindings=e,this._entryFn=n}createPipeline(){return Cc(this._root,this._slotBindings,this._entryFn)}},ol=class{constructor(t){this._options=t}withFragment(t,e,n){return En(typeof t!="string"),En(typeof e!="string"),new al(Be(De({},this._options),{fragmentFn:t,targets:e}))}},al=class Vi{constructor(e){this._options=e}withPrimitive(e){return new Vi(Be(De({},this._options),{primitiveState:e}))}createPipeline(){return el(this._options)}},Li=class extends sl{constructor(t,e,n,r){super(()=>this,[]),this.device=t,this.nameRegistry=e,this.jitTranspiler=n,this._ownDevice=r,k(this,"_disposables",[]),k(this,"_unwrappedBindGroupLayouts",new vs(i=>i.unwrap(this))),k(this,"_unwrappedBindGroups",new vs(i=>i.unwrap(this))),k(this,"_commandEncoder",null)}get commandEncoder(){return this._commandEncoder||(this._commandEncoder=this.device.createCommandEncoder()),this._commandEncoder}createBuffer(t,e){let n=rc(this,t,e);return this._disposables.push(n),n}createTexture(t){let e=hc(t,this);return this._disposables.push(e),e}createBindGroup(t,e){return new Gr(t,e)}destroy(){for(let t of this._disposables)t.destroy();this._ownDevice&&this.device.destroy()}unwrap(t){if(Wc(t))return t.rawPipeline;if(Ii(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(Sc(t))return this._unwrappedBindGroups.getOrMake(t);if($r(t))return t.buffer;if(Zn(t)||pc(t)||wc(t))return t.unwrap();throw new Error(`Unknown resource type: ${t}`)}flush(){this._commandEncoder&&(this.device.queue.submit([this._commandEncoder.finish()]),this._commandEncoder=null)}};async function ul(t){let{adapter:e,device:n,unstable_names:r="random",unstable_jitTranspiler:i}=t??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let f=await navigator.gpu.requestAdapter(e);if(!f)throw new Error("Could not find a compatible GPU");return new Li(await f.requestDevice(n),r==="random"?new jr:new Rr,i,!0)}function cl(t){let{device:e,unstable_names:n="random",unstable_jitTranspiler:r}=t??{};return new Li(e,n==="random"?new jr:new Rr,r,!1)}function ll(t,e){return new fl(t,e)}var fl=class{constructor(t,e){this.dataType=t,this._value=e,k(this,"_label")}get label(){return this._label}$name(t){return this._label=t,this}resolve(t){let e=t.names.makeUnique(this._label),n=t.resolveValue(this._value,this.dataType);return t.addDeclaration(`const ${e} = ${n};`),e}toString(){var t;return`const:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){return we()?this:this._value}};function dl(t){return new hl(t)}var hl=class{constructor(t){this.declaration=t,k(this,"externalsToApply",[])}$uses(t){return this.externalsToApply.push(t),this}resolve(t){let e={};for(let r of this.externalsToApply)Kn(e,r);let n=Cr(t,e,this.declaration);return t.addDeclaration(n),""}toString(){return`declare: ${this.declaration}`}},Gi=new WeakMap;function pl(t){return Gi.get(t)}function wl(t,e,n){return Gi.set(t,{ast:e,externals:n}),t}function cr(t,e){let n=[];return{label:void 0,applyExternals(r){n.push(r)},resolve(r,i=""){var f;let w={};for(let D of n)Kn(w,D);let g=r.names.makeUnique(this.label);if(typeof e=="string"){let D=Cr(r,w,e.trim());r.addDeclaration(`${i}fn ${g}${D}`)}else{let D=pl(e);if(D!=null&&D.externals){let B=Object.fromEntries(Object.entries(D.externals).filter(([j])=>!(j in w)));Kn(w,B)}let U=(f=D?.ast)!=null?f:r.transpileFn(String(e)),A=U.externalNames.filter(B=>!(B in w));if(A.length>0)throw new zo(this.label,A);let P=U.argNames.map((B,j)=>({value:B,dataType:t.argTypes[j]})),{head:F,body:z}=r.fnToWgsl({args:P,returnType:t.returnType,body:U.body,externalMap:w});r.addDeclaration(`${i}fn ${g}${r.resolve(F)}${r.resolve(z)}`)}return g}}}function yl(t,e){var n,r,i;let{workgroupSize:f}=e;return{argTypes:[],returnType:void 0,workgroupSize:[(n=f[0])!=null?n:1,(r=f[1])!=null?r:1,(i=f[2])!=null?i:1],does(w){return ml(this,f,w)}}}function ml(t,e,n){let r=cr(t,n);return{shell:t,get label(){return r.label},$uses(i){return r.applyExternals(i),this},$name(i){return r.label=i,this},resolve(i){return r.resolve(i,`@compute @workgroup_size(${e.join(", ")}) `)},toString(){var i;return`computeFn:${(i=this.label)!=null?i:"<unnamed>"}`}}}function qi(t,e){return{argTypes:t,returnType:e,does(n){return vl(this,n)}}}function gl(t){return qi([]).does(t)}function xl(t){return t?.resourceType==="function"}function vl(t,e){let n=cr(t,e),r=Object.assign((...i)=>{if(we())return new Wi(r,i);if(typeof e=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");return e(...i)},{shell:t,resourceType:"function",$uses(i){return n.applyExternals(i),this},$name(i){return n.label=i,this},with(i,f){return Ci(r,Vr(i)?i.slot:i,f)},resolve(i){return n.resolve(i)}});return Object.defineProperty(r,"label",{get:()=>n.label}),Object.defineProperty(r,"toString",{value:()=>{var i;return`fn:${(i=n.label)!=null?i:"<unnamed>"}`}}),r}function Ci(t,e,n){let r={shell:t.shell,resourceType:"function",$uses(f){return t.$uses(f),this},$name(f){return t.$name(f),this},with(f,w){return Ci(i,Vr(f)?f.slot:f,w)},resolve(f){return f.withSlots([[e,n]],()=>f.resolve(t))}},i=Object.assign((...f)=>we()?new Wi(i,f):t(...f),r);return Object.defineProperty(i,"label",{get:()=>t.label}),Object.defineProperty(i,"toString",{value(){var f,w;return`fn:${(f=t.label)!=null?f:"<unnamed>"}[${(w=e.label)!=null?w:"<unnamed>"}=${n}]`}}),i}var Wi=class{constructor(t,e){this._fn=t,this._params=e}get label(){return this._fn.label}resolve(t){return t.resolve(`${t.resolve(this._fn)}(${this._params.map(e=>t.resolve(e)).join(", ")})`)}toString(){var t;return`call:${(t=this.label)!=null?t:"<unnamed>"}`}};function bl(t){let e=0;return Object.fromEntries(Object.entries(t).map(([n,r])=>{if(fi(r))return[n,r];let i=br(r);return i!==void 0?(e=i+1,[n,r]):[n,It(r,{type:"@location",value:e++})]}))}function Yi(t,e,n){var r,i,f;let w=ir(n)?bn(0,n):un(bl(n));if(typeof e=="string"){let g=(f=(i=(r=e.match(new RegExp("->(?<output>.*?){","s")))==null?void 0:r.groups)==null?void 0:i.output)==null?void 0:f.trim();g&&!/\s/g.test(g)&&t.applyExternals({[g]:w})}return w}function _l(t,e){return{argTypes:[t],returnType:e,does(n){return $l(this,n)}}}function $l(t,e){let n=cr(t,e),r=Yi(n,e,t.returnType);return{shell:t,outputType:r,get label(){return n.label},$uses(i){return n.applyExternals(i),this},$name(i){return n.label=i,Ge(r)&&r.$name(`${i}_Output`),this},resolve(i){return n.resolve(i,"@fragment ")},toString(){var i;return`fragmentFn:${(i=this.label)!=null?i:"<unnamed>"}`}}}function Sl(t,e){return{argTypes:[t],returnType:e,does(n){return Tl(this,n)}}}function Tl(t,e){let n=cr(t,e),r=Yi(n,e,t.returnType);return{shell:t,outputType:r,get label(){return n.label},$uses(i){return n.applyExternals(i),this},$name(i){return n.label=i,Ge(r)&&r.$name(`${i}_Output`),this},resolve(i){return n.resolve(i,"@vertex ")},toString(){var i;return`vertexFn:${(i=this.label)!=null?i:"<unnamed>"}`}}}function Xi(t){return new Ml(t)}var Ml=class{constructor(t=void 0){this.defaultValue=t,k(this,"resourceType","slot"),k(this,"label")}$name(t){return this.label=t,this}areEqual(t,e){return Object.is(t,e)}toString(){var t;return`slot:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){let t=Qe();if(!t)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return t.unwrap(this)}};function Dl(t,e){return new Ul(t,e)}var Ul=class{constructor(t,e=void 0){this.schema=t,this.defaultValue=e,k(this,"resourceType","accessor"),k(this,"label"),k(this,"slot"),this.slot=Xi(e)}$name(t){return this.label=t,this.slot.$name(t),this}toString(){var t;return`accessor:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!Qe())throw new Error("Cannot access tgpu.accessor's value outside of resolution.");return this}resolve(t){let e=t.unwrap(this.slot);return oc(e)?t.resolve(e):xl(e)?`${t.resolve(e)}()`:t.resolveValue(e,this.schema)}};function Ol(t){return El(t)}function El(t){return{resourceType:"derived","~compute":t,get value(){let e=Qe();if(!e)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return e.unwrap(this)},with(e,n){return Zi(t,this,[e,n])},toString(){return"derived"}}}function Zi(t,e,n){return{resourceType:"derived","~compute"(){let r=Qe();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return r.withSlots([n],()=>r.unwrap(e))},get value(){let r=Qe();if(!r)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return r.unwrap(this)},with(r,i){return Zi(t,this,[r,i])},toString(){var r;let[i,f]=n;return`derived[${(r=i.label)!=null?r:"<unnamed>"}=${f}]`}}}function kl(t,e){return new Ki("private",t,e)}function Al(t){return new Ki("workgroup",t)}var Ki=class{constructor(t,e,n){this.scope=t,this._dataType=e,this._initialValue=n,k(this,"_label")}$name(t){return this._label=t,this}get label(){return this._label}resolve(t){let e=t.names.makeUnique(this._label);return this._initialValue?t.addDeclaration(`var<${this.scope}> ${e}: ${t.resolve(this._dataType)} = ${t.resolveValue(this._initialValue,this._dataType)};`):t.addDeclaration(`var<${this.scope}> ${e}: ${t.resolve(this._dataType)};`),e}toString(){var t;return`var:${(t=this.label)!=null?t:"<unnamed>"}`}get value(){if(!we())throw new Error("Cannot access tgpu.var's value directly in JS.");return this}},Wr={Uniform:"uniform",Storage:"storage",Vertex:"vertex",fn:qi,procedure:gl,fragmentFn:_l,vertexFn:Sl,computeFn:yl,vertexLayout:Lc,bindGroupLayout:Ai,derived:Ol,slot:Xi,accessor:Dl,privateVar:kl,workgroupVar:Al,const:ll,declare:dl,init:ul,initFromDevice:cl,resolve:Vc};Object.assign(Wr,{__assignAst:wl});var _e=Wr;const Hi=Dr(),Il=Hi.Provider;function Yr(){return Er(Hi,"useRootContext","RootContext")}function Pl(t){const[e]=oo(()=>({adapterOptions:t.adapterOptions}),async({adapterOptions:n})=>{an(()=>{f?.destroy(),i?.destroy()});const r=await navigator.gpu?.requestAdapter(n);if(!r)throw new Error("Failed to get GPUAdapter, make sure to use a browser with WebGPU support.");console.info(`Using ${r.info.vendor} adapter.`);const i=await r?.requestDevice();if(!i)throw new Error("Failed to get GPUDevice, make sure to use a browser with WebGPU support.");const f=Wr.initFromDevice({device:i});return{adapter:r,device:i,root:f}});return Ht(Ur,{get when(){return e()},keyed:!0,children:n=>Ht(Il,{value:n,get children(){return t.children}})})}function Fl(t,e){const[n,r]=Lt();return ke(()=>{const i=t();if(!i)return;const f=new ResizeObserver(w=>{const g=w[0]?.devicePixelContentBoxSize[0];if(!i.isConnected||!g)return;const{width:D,height:U}=i.getBoundingClientRect(),A=g.inlineSize,P=g.blockSize,F={width:D,height:U,widthPX:A,heightPX:P};r(F),e?.(F)});f.observe(i),an(()=>{f.disconnect()})}),n}var zl=Or("<canvas>");const{min:bs,max:_s}=Math;function Bl(t){const{device:e}=Yr(),[n,r]=Lt(),i=Fl(n,w=>{const g=n();g&&(g.width=_s(1,bs(w.widthPX,e.limits.maxTextureDimension2D)),g.height=_s(1,bs(w.heightPX,e.limits.maxTextureDimension2D)))});function f(w){const g=w.getContext("webgpu");if(!g)throw new Error("GPUCanvasContext failed to initialize.");return g.configure({device:e,format:navigator.gpu.getPreferredCanvasFormat()}),g}return[(()=>{var w=zl();return xo(r,w),w.style.setProperty("width","100%"),w.style.setProperty("height","100%"),me(()=>Ce(w,t.class)),w})(),Ht(Ur,{get when(){return n()},keyed:!0,children:w=>Ht(Qu,{get value(){return{canvas:w,context:f(w),canvasSize:()=>({width:i()?.widthPX??0,height:i()?.heightPX??0})}},get children(){return t.children}})})]}const Ji=un({viewMatrix:nn,viewMatrixInverse:nn,resolution:C}).$name("Camera2DUniforms"),sn=_e.bindGroupLayout({camera2DUniforms:{uniform:Ji}}).$name("Camera2DBindGroupLayout"),jl=_e.fn([C],C).does(`(world: vec2f) -> vec2f {
      let clip = camera2DUniforms.viewMatrix * vec3(world, 1);
      return clip.xy / clip.z;
    }`).$uses({...sn.bound}).$name("camera2DWorldToClip"),Rl=_e.fn([C],C).does(`(clip: vec2f) -> vec2f {
      let world = camera2DUniforms.viewMatrixInverse * vec3(clip, 1);
      return world.xy / world.z;
    }`).$uses({...sn.bound}).$name("camera2DClipToWorld"),Nl=_e.fn([C],C).does(`(clip: vec2f) -> vec2f {
      return 0.5 * clip * camera2DUniforms.resolution;
    }`).$uses({...sn.bound}).$name("camera2DClipToPixels");function Vl(t){const{root:e}=Yr(),{canvasSize:n}=ar(),r=()=>1/t.fovy,i=e.createBuffer(Ji).$usage("uniform").$name("Camera2DUniforms"),f=sn.populate({camera2DUniforms:i}),w=de(()=>{const{position:U,fovy:A}=t,{x:P,y:F}=U,{width:z,height:B}=n(),j=z/B,q=li();ju.ortho(P-j*A,P+j*A,F-A,F+A,0,0,q);const st=nn(q.columns[0].xyw,q.columns[1].xyw,q.columns[3].xyw),ot=Bu.inverse(st,nn());return{viewMatrix:st,viewMatrixInverse:ot,resolution:C(z,B)}});function g({x:U,y:A}){return Ru.transformMat3(tn(U,A,1),w().viewMatrixInverse,C())}function D(){i.write(w())}return Ht(Uo,{value:{update:D,bindGroup:f,BindGroupLayout:sn,wgsl:{worldToClip:jl,clipToWorld:Rl,clipToPixels:Nl},js:{clipToWorld:g},zoom:r},get children(){return t.children}})}function Ll(t){const{canvas:e}=ar(),[n,r]=Lt(1),[i,f]=Lt(C());let w;function g(D){D.preventDefault();const U=hi(D),A=w?.(U);if(!A)return;const P=n(),F=P*(1-D.deltaY*.001),z=P/F;Ts(()=>{f(({x:B,y:j})=>C(B+(A.x-B)*(1-z),j+(A.y-j)*(1-z))),r(F)})}return ke(()=>{e.addEventListener("wheel",g,{passive:!1}),an(()=>{e.removeEventListener("wheel",g)})}),Ht(Vl,{get position(){return i()},get fovy(){return 1/n()},get children(){return[de(()=>(()=>{let{js:D}=kr();return w=D.clipToWorld,null})()),de(()=>t.children)]}})}function Gl(t){ke(()=>{let e=-1;function n(){he(t),e=requestAnimationFrame(n)}an(()=>{cancelAnimationFrame(e)}),n()})}function ql(t,...e){const n=[],r=[];for(let i=0;i<t.length;++i)if(r.push(t[i]),i<e.length){const f=e[i];typeof f=="object"?n.push(f):r.push(f)}return _e.resolve({template:r.join(""),externals:Object.assign({},...n)})}const Cl={color:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},on=un({position:xu.position,positionOriginal:bn(0,C),innerRatio:bn(1,I),styleIndex:bn(2,mu("flat, either",dt))}),Qi=un({center:C,radius:I,styleIndex:dt}).$name("Circle"),Mr=un({rimColor:L,fadeColor:L}),Wl=1e4,to=24,Hn=_e.bindGroupLayout({circles:{storage:t=>en(Qi,t)},styles:{storage:t=>en(Mr,t)}}),Yl=_e.fn([I,I,I],I).does(`
  (edge0: f32, edge1: f32, x: f32) -> f32 {
    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
  }`),Xl=t=>_e.fn([dt,dt],on).does(`
    (vertexIndex: u32, instanceIndex: u32) -> VertexOutput {
      const SUBDIVS = ${to};
      const WEDGE_ANGLE = radians(360.0) / SUBDIVS;
      const MIN_INNER_RADIUS = 0.5;
      const MAX_INNER_RADIUS = 0.95;
      const OVERSIZE_FACTOR = 1.01;

      let circle = circles[instanceIndex];
      let angle = f32(vertexIndex / 2) * WEDGE_ANGLE;
      let unitCircle = vec2f(cos(angle), sin(angle));
      let clip0 = worldToClip(circle.center);
      let clip1 = worldToClip(circle.center + unitCircle * circle.radius);
      let lengthPX = length(clipToPixels(clip1 - clip0));
      let innerRatio = clamp(1 - 20 / lengthPX, MIN_INNER_RADIUS, MAX_INNER_RADIUS);
      let ratio = select(innerRatio, OVERSIZE_FACTOR, vertexIndex % 2 == 0);
      let clip = mix(clip0, clip1, ratio);

      var out: VertexOutput;
      out.position = vec4f(clip, 0, 1);
      out.positionOriginal = mix(vec2f(0,0), unitCircle, ratio);
      out.innerRatio = innerRatio;
      out.styleIndex = circle.styleIndex;
      return out;
    }
  `).$uses({VertexOutput:on,...t.BindGroupLayout.bound,circles:Hn.bound.circles,worldToClip:t.wgsl.worldToClip,clipToPixels:t.wgsl.clipToPixels}),Zl=_e.fn([on],L).does(`
    (in: VertexOutput) -> vec4f {
      const OUTER_RADIUS = 1.0;
      let style = styles[in.styleIndex];
      let dist = length(in.positionOriginal);
      let distWidth = fwidth(dist);
      // adding half a distWidth in order for circles to touch fully
      let disk = clamp((0.5*distWidth + OUTER_RADIUS - dist) / distWidth, 0, 1);
      let fade = linearstep(in.innerRatio, OUTER_RADIUS, dist);
      return mix(style.fadeColor, style.rimColor, fade * fade) * vec4f(1, 1, 1, disk * fade);
    }
  `).$uses({VertexOutput:on,styles:Hn.bound.styles,linearstep:Yl});function Kl(t){const e=kr(),{root:n,device:r}=Yr(),{context:i}=ar(),f=n.createBuffer(en(Qi,Wl)).$usage("storage").$name("circles");ke(()=>{f.write(t.circles)});const w=n.createBuffer(Mr).$usage("uniform").$name("color");ke(()=>{w.write(t.color??{rimColor:L(0,0,0,1),fadeColor:L(0,0,0,1)})});const g=n.createBuffer(en(Mr,t.styles.length)).$usage("storage").$name("styles");ke(()=>{g.write(t.styles)});const D=de(()=>{const A=ql`
      ${{VertexOutput:on,vert:Xl(e),frag:Zl}}

      @vertex fn vs(
        @builtin(vertex_index) vertexIndex: u32,
        @builtin(instance_index) instanceIndex: u32,
      ) -> VertexOutput {
        return vert(vertexIndex, instanceIndex);
      }

      @fragment fn fs(in: VertexOutput) -> @location(0) vec4f {
        let color = frag(in);
        return vec4f(color.rgb * color.a, color.a);
      }
    `,P=r.createShaderModule({label:"our hardcoded red triangle shaders",code:A}),F=r.createRenderPipeline({label:"our hardcoded red triangle pipeline",primitive:{topology:"triangle-strip"},layout:r.createPipelineLayout({bindGroupLayouts:[n.unwrap(e.BindGroupLayout),n.unwrap(Hn)]}),vertex:{entryPoint:"vs",module:P},fragment:{entryPoint:"fs",module:P,targets:[{format:navigator.gpu.getPreferredCanvasFormat(),blend:Cl}]}}),z=Hn.populate({circles:f.buffer,styles:g.buffer});return{pipeline:F,uniformBindGroup:z}});return Gl(()=>{const{pipeline:A,uniformBindGroup:P}=D(),F=i.getCurrentTexture().createView();e.update();const z=r.createCommandEncoder(),B=z.beginRenderPass({label:"our basic canvas renderPass",colorAttachments:[{clearValue:t.clearColor??[1,1,1,1],loadOp:"clear",storeOp:"store",view:F}]});B.setPipeline(A),B.setBindGroup(0,n.unwrap(e.bindGroup)),B.setBindGroup(1,n.unwrap(P)),t.circles.length>0&&B.draw((to+1)*2,t.circles.length),B.end();const j=z.finish();r.queue.submit([j])}),null}function*Hl(t){let e=0;for(const n of t)yield[e++,n]}const Jl={normal:{rimColor:L(0,0,0,1),fadeColor:L(0,0,0,1)},selected:{rimColor:L(0,0,0,1),fadeColor:L(.5,.8,1,1)},debugFirst:{rimColor:L(0,0,0,1),fadeColor:L(1,0,0,1)},debugSecond:{rimColor:L(0,0,0,1),fadeColor:L(0,1,0,1)},debugThird:{rimColor:L(0,0,0,1),fadeColor:L(0,0,1,1)}},Ql={normal:{rimColor:L(1,1,1,1),fadeColor:L(1,1,1,1)},selected:{rimColor:L(1,1,1,1),fadeColor:L(.1,.3,.8,1)},debugFirst:{rimColor:L(1,1,1,1),fadeColor:L(1,0,0,1)},debugSecond:{rimColor:L(1,1,1,1),fadeColor:L(0,1,0,1)},debugThird:{rimColor:L(1,1,1,1),fadeColor:L(0,0,1,1)}},tf={light:Jl,dark:Ql};function ef(t){const e=tf[t],n=Object.fromEntries(Hl(Object.keys(e)).map(([r,i])=>[i,r]));return{styles:Object.values(e),getStyleIndex(r){return n[r]}}}var nf=Or("<div><h1>Apollonian Circles</h1><span>Click to create, scroll to zoom."),rf=Or("<div><div>Number of Circles: </div><div><label><input type=checkbox> Dark</label><label><input type=checkbox> Debug mode");function sf(){const{js:{clipToWorld:t},zoom:e}=kr(),[n,r]=Lt(),[i,f]=Lt(),[w,g]=Lt(),[D,U]=Lt();async function A(j,q){for(;;){const st=hi(j),ot=t(st),it=Wu(ot);r(it),f(void 0),g(void 0),U(void 0);const nt=Yu(it);if(await dr(it,nt.radius,nt.curve,e,q),nt.index===void 0)return;f(nt.index);const ft=Zu(nt.index,it);if(await dr(it,ft.radius,ft.curve,e,q),ft.index===void 0)return;g(ft.index);const at=Ju(nt.index,ft.index,it);if(await dr(it,at.radius,at.curve,e,q),at.index===void 0)return;U(at.index),r(void 0);{const et=ce[it];if(ht.distance(et.center,ot)<et.radius)return}if(await Promise.race([_i(),q])instanceof PointerEvent)return}}const{canvas:P}=ar();async function F(j){const{currentTarget:q}=j;if(!(q instanceof HTMLElement))return;q.setPointerCapture(j.pointerId);const{promise:st,resolve:ot}=tc();q.addEventListener("pointerup",ot),st.finally(()=>{q.removeEventListener("pointerup",ot)}),A(j,st)}ke(()=>{P.addEventListener("pointerdown",F),an(()=>{P.removeEventListener("pointerdown",F)})});const z=de(()=>ef(Yn()));function B(j){if(j===n())return"selected";if(Ti())switch(j){case i():return"debugFirst";case w():return"debugSecond";case D():return"debugThird"}return"normal"}return Ht(Kl,{get circles(){return ce.map((j,q)=>({...j,styleIndex:z().getStyleIndex(B(q))}))},get clearColor(){return Yn()==="light"?[1,1,1,1]:[0,0,0,1]},get styles(){return z().styles}})}function of(){return(()=>{var t=rf(),e=t.firstChild;e.firstChild;var n=e.nextSibling,r=n.firstChild,i=r.firstChild,f=r.nextSibling,w=f.firstChild;return gn(e,()=>ce.length,null),i.addEventListener("change",g=>Cu(g.target.checked?"dark":"light")),w.addEventListener("change",g=>qu(g.target.checked)),gn(t,Ht(Ur,{get when(){return ce.length===0},get children(){var g=nf();return me(()=>Ce(g,Fe.welcomeMessage)),g}}),null),gn(t,Ht(Pl,{get children(){return Ht(Bl,{get class(){return Fe.canvas},get children(){return Ht(Ll,{get children(){return Ht(sf,{})}})}})}}),null),me(g=>{var D=Fe.page,U={[Fe[Yn()]]:!0},A=Fe.circleCounter,P=Fe.controls;return D!==g.e&&Ce(t,g.e=D),g.t=go(t,U,g.t),A!==g.a&&Ce(e,g.a=A),P!==g.o&&Ce(n,g.o=P),g},{e:void 0,t:void 0,a:void 0,o:void 0}),me(()=>i.checked=Yn()==="dark"),me(()=>w.checked=Ti()),t})()}const af=document.getElementById("root");mo(()=>Ht(of,{}),af);
